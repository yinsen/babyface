/*
 * deCarta JavaScript Mapping API
 * Copyright 2006-2009 deCarta. All rights reserved.
 * version DDS 4.5.2
 *
 * Bundles:
 *   Raphael
 *   Project: http://raphaeljs.com/
 *   License: MIT License
 *
 *   Sarissa
 *   Project: http://dev.abiss.gr/sarissa/
 *   License: Apache 2.0
 *   License Location: http://dev.abiss.gr/sarissa/licenses/asl.txt
 */
(function(){function a8(){if(a8.is(arguments[0],dc)){var a=arguments[0],l=dh[aO](a8,a.splice(0,3+a8.is(a[0],dg))),k=l.set();for(var j=0,f=a[av];j<f;j++){var c=a[j]||{};a4[aY](c.type)&&k[c5](l[c.type]().attr(c))}return k}return dh[aO](a8,arguments)}a8.version="1.5.2";var a6=/[, ]+/,a4={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},a2=/\{(\d+)\}/g,a0="prototype",aY="hasOwnProperty",aW=document,aU=window,aS={was:Object[a0][aY].call(aU,"Raphael"),is:aU.Raphael},aR= function(){this.customAttributes={}},aQ,aP="appendChild",aO="apply",aN="concat",aL="createTouch" in aW,aJ="",aH=" ",aF=String,aD="split",aB="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend orientationchange touchcancel gesturestart gesturechange gestureend"[aD](aH),az={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},ax="join",av="length",at=aF[a0].toLowerCase,aq=Math,ao=aq.max,dp=aq.min,dm=aq.abs,dk=aq.pow,di=aq.PI,dg="number",de="string",dc="array",da="toString",c8="fill",c7=Object[a0][da],c6={},c5="push",c4=/^url\(['"]?([^\)]+?)['"]?\)$/i,c2=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,c0={"NaN":1,Infinity:1,"-Infinity":1},cX=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,cU=aq.round,cR="setAttribute",cP=parseFloat,cN=parseInt,cL=" progid:DXImageTransform.Microsoft",cJ=aF[a0].toUpperCase,cH={blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rotation:0,rx:0,ry:0,scale:"1 1",src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",translation:"0 0",width:0,x:0,y:0},cF={along:"along",blur:dg,"clip-rect":"csv",cx:dg,cy:dg,fill:"colour","fill-opacity":dg,"font-size":dg,height:dg,opacity:dg,path:"path",r:dg,rotation:"csv",rx:dg,ry:dg,scale:"csv",stroke:"colour","stroke-opacity":dg,"stroke-width":dg,translation:"csv",width:dg,x:dg,y:dg},b9="replace",b7=/^(from|to|\d+%?)$/,dI=/\s*,\s*/,b0={hs:1,rg:1},cZ=/,?([achlmqrstvxz]),?/gi,cW=/([achlmqstvz])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?\s*,?\s*)+)/ig,cT=/(-?\d*\.?\d*(?:e[-+]?\d+)?)\s*,?\s*/ig,cQ=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/,cO= function(d,c){return d.key-c.key};a8.type=aU.SVGAngle||aW.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if(a8.type=="VML"){var cM=aW.createElement("div"),cK;cM.innerHTML='<v:shape adj="1"/>';cK=cM.firstChild;cK.style.behavior="url(#default#VML)";if(!(cK&&typeof cK.adj=="object")){return a8.type=null}cM=null}a8.svg=!(a8.vml=a8.type=="VML");aR[a0]=a8[a0];aQ=aR[a0];a8._id=0;a8._oid=0;a8.fn={};a8.is= function(d,c){c=at.call(c);if(c=="finite"){return !c0[aY](+d)}return c=="null"&&d===null||c==typeof d||c=="object"&&d===Object(d)||c=="array"&&Array.isArray&&Array.isArray(d)||c7.call(d).slice(8,-1).toLowerCase()==c};a8.angle= function(a,p,o,n,m,l){if(m==null){var k=a-o,j=p-n;if(!k&&!j){return 0}return((k<0)*180+aq.atan(-j/-k)*180/di+360)%360}return a8.angle(a,p,m,l)-a8.angle(o,n,m,l)};a8.rad= function(b){return b%360*di/180};a8.deg= function(b){return b*180/di%360};a8.snapTo= function(a,k,j){j=a8.is(j,"finite")?j:10;if(a8.is(a,dc)){var h=a.length;while(h--){if(dm(a[h]-k)<=j){return a[h]}}}else{a=+a;var g=k%a;if(g<j){return k-g}if(g>a-j){return k-g+a}}return k};function cI(){var d=[],c=0;for(;c<32;c++){d[c]=(~(~(aq.random()*16)))[da](16)}d[12]=4;d[16]=(d[16]&3|8)[da](16);return"r-"+d[ax]("")}a8.setWindow= function(b){aU=b;aW=aU.document};var cG= function(g){if(j.vml){var o=/^\s+|\s+$/g,n;try{var m=new ActiveXObject("htmlfile");m.write("<body>");m.close();n=m.body}catch(j){n=createPopup().document.body}var l=n.createTextRange();cG=b5(function(d){try{n.style.color=aF(d)[b9](o,aJ);var c=l.queryCommandValue("ForeColor");c=(c&255)<<16|c&65280|(c&16711680)>>>16;return"#"+("000000"+c[da](16)).slice(-6)}catch(d){return"none"}})}else{var k=aW.createElement("i");k.title="Rapha�l Colour Picker";k.style.display="none";aW.body[aP](k);cG=b5(function(b){k.style.color=b;return aW.defaultView.getComputedStyle(k,aJ).getPropertyValue("color")})}return cG(g)},cE= function(){return"hsb("+[this.h,this.s,this.b]+")"},b8= function(){return"hsl("+[this.h,this.s,this.l]+")"},b6= function(){return this.hex};a8.hsb2rgb= function(a,h,g,f){if(a8.is(a,"object")&&"h" in a&&"s" in a&&"b" in a){g=a.b;h=a.s;a=a.h;f=a.o}return a8.hsl2rgb(a,h,g/2,f)};a8.hsl2rgb= function(B,A,z,y){if(a8.is(B,"object")&&"h" in B&&"s" in B&&"l" in B){z=B.l;A=B.s;B=B.h}if(B>1||A>1||z>1){B/=360;A/=100;z/=100}var w={},u=["r","g","b"],t,s,r,q,p,o;if(A){z<0.5?t=z*(1+A):t=z+A-z*A;s=2*z-t;for(var a=0;a<3;a++){r=B+1/3*-(a-1);r<0&&r++;r>1&&r--;r*6<1?w[u[a]]=s+(t-s)*6*r:r*2<1?w[u[a]]=t:r*3<2?w[u[a]]=s+(t-s)*(2/3-r)*6:w[u[a]]=s}}else{w={r:z,g:z,b:z}}w.r*=255;w.g*=255;w.b*=255;w.hex="#"+(16777216|w.b|w.g<<8|w.r<<16).toString(16).slice(1);a8.is(y,"finite")&&(w.opacity=y);w.toString=b6;return w};a8.rgb2hsb= function(t,s,r){if(s==null&&a8.is(t,"object")&&"r" in t&&"g" in t&&"b" in t){r=t.b;s=t.g;t=t.r}if(s==null&&a8.is(t,de)){var q=a8.getRGB(t);t=q.r;s=q.g;r=q.b}if(t>1||s>1||r>1){t/=255;s/=255;r/=255}var p=ao(t,s,r),o=dp(t,s,r),n,m,l=p;if(o==p){return{h:0,s:0,b:p,toString:cE}}var a=p-o;m=a/p;t==p?n=(s-r)/a:s==p?n=2+(r-t)/a:n=4+(t-s)/a;n/=6;n<0&&n++;n>1&&n--;return{h:n,s:m,b:l,toString:cE}};a8.rgb2hsl= function(w,u,t){if(u==null&&a8.is(w,"object")&&"r" in w&&"g" in w&&"b" in w){t=w.b;u=w.g;w=w.r}if(u==null&&a8.is(w,de)){var s=a8.getRGB(w);w=s.r;u=s.g;t=s.b}if(w>1||u>1||t>1){w/=255;u/=255;t/=255}var r=ao(w,u,t),q=dp(w,u,t),p,o,n=(r+q)/2,m;if(q==r){m={h:0,s:0,l:n}}else{var a=r-q;o=n<0.5?a/(r+q):a/(2-r-q);w==r?p=(u-t)/a:u==r?p=2+(t-w)/a:p=4+(w-u)/a;p/=6;p<0&&p++;p>1&&p--;m={h:p,s:o,l:n}}m.toString=b8;return m};a8._path2string= function(){return this.join(",")[b9](cZ,"$1")};function b5(g,f,j){function h(){var d=Array[a0].slice.call(arguments,0),c=d[ax]("?"),b=h.cache=h.cache||{},a=h.count=h.count||[];if(b[aY](c)){return j?j(b[c]):b[c]}a[av]>=1000&&delete b[a.shift()];a[c5](c);b[c]=g[aO](f,d);return j?j(b[c]):b[c]}return h}a8.getRGB=b5(function(r){if(!r||!(!((r=aF(r)).indexOf("-")+1))){return{r:-1,g:-1,b:-1,hex:"none",error:1}}if(r=="none"){return{r:-1,g:-1,b:-1,hex:"none"}}!(b0[aY](r.toLowerCase().substring(0,2))||r.charAt()=="#")&&(r=cG(r));var q,p,o,n,m,l,f,a=r.match(c2);if(a){if(a[2]){n=cN(a[2].substring(5),16);o=cN(a[2].substring(3,5),16);p=cN(a[2].substring(1,3),16)}if(a[3]){n=cN((l=a[3].charAt(3))+l,16);o=cN((l=a[3].charAt(2))+l,16);p=cN((l=a[3].charAt(1))+l,16)}if(a[4]){f=a[4][aD](dI);p=cP(f[0]);f[0].slice(-1)=="%"&&(p*=2.55);o=cP(f[1]);f[1].slice(-1)=="%"&&(o*=2.55);n=cP(f[2]);f[2].slice(-1)=="%"&&(n*=2.55);a[1].toLowerCase().slice(0,4)=="rgba"&&(m=cP(f[3]));f[3]&&f[3].slice(-1)=="%"&&(m/=100)}if(a[5]){f=a[5][aD](dI);p=cP(f[0]);f[0].slice(-1)=="%"&&(p*=2.55);o=cP(f[1]);f[1].slice(-1)=="%"&&(o*=2.55);n=cP(f[2]);f[2].slice(-1)=="%"&&(n*=2.55);(f[0].slice(-3)=="deg"||f[0].slice(-1)=="�")&&(p/=360);a[1].toLowerCase().slice(0,4)=="hsba"&&(m=cP(f[3]));f[3]&&f[3].slice(-1)=="%"&&(m/=100);return a8.hsb2rgb(p,o,n,m)}if(a[6]){f=a[6][aD](dI);p=cP(f[0]);f[0].slice(-1)=="%"&&(p*=2.55);o=cP(f[1]);f[1].slice(-1)=="%"&&(o*=2.55);n=cP(f[2]);f[2].slice(-1)=="%"&&(n*=2.55);(f[0].slice(-3)=="deg"||f[0].slice(-1)=="�")&&(p/=360);a[1].toLowerCase().slice(0,4)=="hsla"&&(m=cP(f[3]));f[3]&&f[3].slice(-1)=="%"&&(m/=100);return a8.hsl2rgb(p,o,n,m)}a={r:p,g:o,b:n};a.hex="#"+(16777216|n|o<<8|p<<16).toString(16).slice(1);a8.is(m,"finite")&&(a.opacity=m);return a}return{r:-1,g:-1,b:-1,hex:"none",error:1}},a8);a8.getColor= function(f){var d=this.getColor.start=this.getColor.start||{h:0,s:1,b:f||0.75},g=this.hsb2rgb(d.h,d.s,d.b);d.h+=0.075;if(d.h>1){d.h=0;d.s-=0.2;d.s<=0&&(this.getColor.start={h:0,s:1,b:d.b})}return g.hex};a8.getColor.reset= function(){delete this.start};a8.parsePathString=b5(function(a){if(!a){return null}var g={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},f=[];a8.is(a,dc)&&a8.is(a[0],dc)&&(f=b3(a));f[av]||aF(a)[b9](cW,function(d,c,k){var j=[],h=at.call(c);k[b9](cT,function(m,l){l&&j[c5](+l)});if(h=="m"&&j[av]>2){f[c5]([c][aN](j.splice(0,2)));h="l";c=c=="m"?"l":"L"}while(j[av]>=g[h]){f[c5]([c][aN](j.splice(0,g[h])));if(!g[h]){break}}});f[da]=a8._path2string;return f});a8.findDotsAtSegment= function(S,R,Q,P,O,N,M,L,K){var I=1-K,H=dk(I,3)*S+dk(I,2)*3*K*Q+I*3*K*K*O+dk(K,3)*M,G=dk(I,3)*R+dk(I,2)*3*K*P+I*3*K*K*N+dk(K,3)*L,F=S+2*K*(Q-S)+K*K*(O-2*Q+S),E=R+2*K*(P-R)+K*K*(N-2*P+R),D=Q+2*K*(O-Q)+K*K*(M-2*O+Q),C=P+2*K*(N-P)+K*K*(L-2*N+P),B=(1-K)*S+K*Q,A=(1-K)*R+K*P,z=(1-K)*O+K*M,y=(1-K)*N+K*L,w=90-aq.atan((F-D)/(E-C))*180/di;(F>D||E<C)&&(w+=180);return{x:H,y:G,m:{x:F,y:E},n:{x:D,y:C},start:{x:B,y:A},end:{x:z,y:y},alpha:w}};var b4=b5(function(w){if(!w){return{x:0,y:0,width:0,height:0}}w=aZ(w);var u=0,t=0,s=[],r=[],q;for(var p=0,o=w[av];p<o;p++){q=w[p];if(q[0]=="M"){u=q[1];t=q[2];s[c5](u);r[c5](t)}else{var n=a1(u,t,q[1],q[2],q[3],q[4],q[5],q[6]);s=s[aN](n.min.x,n.max.x);r=r[aN](n.min.y,n.max.y);u=q[5];t=q[6]}}var m=dp[aO](0,s),l=dp[aO](0,r);return{x:m,y:l,width:ao[aO](0,s)-m,height:ao[aO](0,r)-l}}),b3= function(a){var m=[];if(!a8.is(a,dc)||!a8.is(a&&a[0],dc)){a=a8.parsePathString(a)}for(var l=0,k=a[av];l<k;l++){m[l]=[];for(var j=0,h=a[l][av];j<h;j++){m[l][j]=a[l][j]}}m[da]=a8._path2string;return m},b2=b5(function(H){if(!a8.is(H,dc)||!a8.is(H&&H[0],dc)){H=a8.parsePathString(H)}var G=[],F=0,E=0,D=0,C=0,B=0;if(H[0][0]=="M"){F=H[0][1];E=H[0][2];D=F;C=E;B++;G[c5](["M",F,E])}for(var A=B,z=H[av];A<z;A++){var y=G[A]=[],w=H[A];if(w[0]!=at.call(w[0])){y[0]=at.call(w[0]);switch(y[0]){case"a":y[1]=w[1];y[2]=w[2];y[3]=w[3];y[4]=w[4];y[5]=w[5];y[6]=+(w[6]-F).toFixed(3);y[7]=+(w[7]-E).toFixed(3);break;case"v":y[1]=+(w[1]-E).toFixed(3);break;case"m":D=w[1];C=w[2];default:for(var u=1,t=w[av];u<t;u++){y[u]=+(w[u]-(u%2?F:E)).toFixed(3)}}}else{y=G[A]=[];if(w[0]=="m"){D=w[1]+F;C=w[2]+E}for(var s=0,r=w[av];s<r;s++){G[A][s]=w[s]}}var a=G[A][av];switch(G[A][0]){case"z":F=D;E=C;break;case"h":F+=+G[A][a-1];break;case"v":E+=+G[A][a-1];break;default:F+=+G[A][a-2];E+=+G[A][a-1]}}G[da]=a8._path2string;return G},0,b3),b1=b5(function(F){if(!a8.is(F,dc)||!a8.is(F&&F[0],dc)){F=a8.parsePathString(F)}var E=[],D=0,C=0,B=0,A=0,z=0;if(F[0][0]=="M"){D=+F[0][1];C=+F[0][2];B=D;A=C;z++;E[0]=["M",D,C]}for(var y=z,w=F[av];y<w;y++){var u=E[y]=[],t=F[y];if(t[0]!=cJ.call(t[0])){u[0]=cJ.call(t[0]);switch(u[0]){case"A":u[1]=t[1];u[2]=t[2];u[3]=t[3];u[4]=t[4];u[5]=t[5];u[6]=+(t[6]+D);u[7]=+(t[7]+C);break;case"V":u[1]=+t[1]+C;break;case"H":u[1]=+t[1]+D;break;case"M":B=+t[1]+D;A=+t[2]+C;default:for(var s=1,r=t[av];s<r;s++){u[s]=+t[s]+(s%2?D:C)}}}else{for(var q=0,a=t[av];q<a;q++){E[y][q]=t[q]}}switch(u[0]){case"Z":D=B;C=A;break;case"H":D=u[1];break;case"V":C=u[1];break;case"M":B=E[y][E[y][av]-2];A=E[y][E[y][av]-1];default:D=E[y][E[y][av]-2];C=E[y][E[y][av]-1]}}E[da]=a8._path2string;return E},null,b3),a9= function(g,f,j,h){return[g,f,j,h,j,h]},a7= function(k,j,q,p,o,n){var m=1/3,l=2/3;return[m*k+l*q,m*j+l*p,m*o+l*q,m*n+l*p,o,n]},a5= function(bM,bL,bK,bJ,bI,bH,bG,bF,bE,bD){var bC=di*120/180,bB=di/180*(+bI||0),bA=[],bz,by=b5(function(g,f,k){var j=g*aq.cos(k)-f*aq.sin(k),h=g*aq.sin(k)+f*aq.cos(k);return{x:j,y:h}});if(bD){bn=bD[0];bm=bD[1];bp=bD[2];bo=bD[3]}else{bz=by(bM,bL,-bB);bM=bz.x;bL=bz.y;bz=by(bF,bE,-bB);bF=bz.x;bE=bz.y;var bx=aq.cos(di/180*bI),bw=aq.sin(di/180*bI),bv=(bM-bF)/2,bu=(bL-bE)/2,bt=bv*bv/(bK*bK)+bu*bu/(bJ*bJ);if(bt>1){bt=aq.sqrt(bt);bK=bt*bK;bJ=bt*bJ}var bs=bK*bK,br=bJ*bJ,bq=(bH==bG?-1:1)*aq.sqrt(dm((bs*br-bs*bu*bu-br*bv*bv)/(bs*bu*bu+br*bv*bv))),bp=bq*bK*bu/bJ+(bM+bF)/2,bo=bq*-bJ*bv/bK+(bL+bE)/2,bn=aq.asin(((bL-bo)/bJ).toFixed(9)),bm=aq.asin(((bE-bo)/bJ).toFixed(9));bn=bM<bp?di-bn:bn;bm=bF<bp?di-bm:bm;bn<0&&(bn=di*2+bn);bm<0&&(bm=di*2+bm);bG&&bn>bm&&(bn=bn-di*2);!bG&&bm>bn&&(bm=bm-di*2)}var bl=bm-bn;if(dm(bl)>bC){var bk=bm,bj=bF,bi=bE;bm=bn+bC*(bG&&bm>bn?1:-1);bF=bp+bK*aq.cos(bm);bE=bo+bJ*aq.sin(bm);bA=a5(bF,bE,bK,bJ,bI,0,bG,bj,bi,[bm,bk,bp,bo])}bl=bm-bn;var bh=aq.cos(bn),bg=aq.sin(bn),bf=aq.cos(bm),be=aq.sin(bm),bd=aq.tan(bl/4),bc=4/3*bK*bd,bb=4/3*bJ*bd,ba=[bM,bL],D=[bM+bc*bg,bL-bb*bh],B=[bF+bc*be,bE-bb*bf],y=[bF,bE];D[0]=2*ba[0]-D[0];D[1]=2*ba[1]-D[1];if(bD){return[D,B,y][aN](bA)}bA=[D,B,y][aN](bA)[ax]()[aD](",");var w=[];for(var s=0,n=bA[av];s<n;s++){w[s]=s%2?by(bA[s-1],bA[s],bB).y:by(bA[s],bA[s+1],bB).x}return w},a3= function(t,s,r,q,p,o,n,m,l){var k=1-l;return{x:dk(k,3)*t+dk(k,2)*3*l*r+k*3*l*l*p+dk(l,3)*n,y:dk(k,3)*s+dk(k,2)*3*l*q+k*3*l*l*o+dk(l,3)*m}},a1=b5(function(H,G,F,E,D,C,B,A){var z=D-2*F+H-(B-2*D+F),y=2*(F-H)-2*(D-F),w=H-F,u=(-y+aq.sqrt(y*y-4*z*w))/2/z,t=(-y-aq.sqrt(y*y-4*z*w))/2/z,s=[G,A],r=[H,B],m;dm(u)>"1e12"&&(u=0.5);dm(t)>"1e12"&&(t=0.5);if(u>0&&u<1){m=a3(H,G,F,E,D,C,B,A,u);r[c5](m.x);s[c5](m.y)}if(t>0&&t<1){m=a3(H,G,F,E,D,C,B,A,t);r[c5](m.x);s[c5](m.y)}z=C-2*E+G-(A-2*C+E);y=2*(E-G)-2*(C-E);w=G-E;u=(-y+aq.sqrt(y*y-4*z*w))/2/z;t=(-y-aq.sqrt(y*y-4*z*w))/2/z;dm(u)>"1e12"&&(u=0.5);dm(t)>"1e12"&&(t=0.5);if(u>0&&u<1){m=a3(H,G,F,E,D,C,B,A,u);r[c5](m.x);s[c5](m.y)}if(t>0&&t<1){m=a3(H,G,F,E,D,C,B,A,t);r[c5](m.x);s[c5](m.y)}return{min:{x:dp[aO](0,r),y:dp[aO](0,s)},max:{x:ao[aO](0,r),y:ao[aO](0,s)}}}),aZ=b5(function(F,E){var D=b1(F),C=E&&b1(E),B={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},A={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},z= function(g,f){var j,h;if(!g){return["C",f.x,f.y,f.x,f.y,f.x,f.y]}!(g[0] in {T:1,Q:1})&&(f.qx=f.qy=null);switch(g[0]){case"M":f.X=g[1];f.Y=g[2];break;case"A":g=["C"][aN](a5[aO](0,[f.x,f.y][aN](g.slice(1))));break;case"S":j=f.x+(f.x-(f.bx||f.x));h=f.y+(f.y-(f.by||f.y));g=["C",j,h][aN](g.slice(1));break;case"T":f.qx=f.x+(f.x-(f.qx||f.x));f.qy=f.y+(f.y-(f.qy||f.y));g=["C"][aN](a7(f.x,f.y,f.qx,f.qy,g[1],g[2]));break;case"Q":f.qx=g[1];f.qy=g[2];g=["C"][aN](a7(f.x,f.y,g[1],g[2],g[3],g[4]));break;case"L":g=["C"][aN](a9(f.x,f.y,g[1],g[2]));break;case"H":g=["C"][aN](a9(f.x,f.y,g[1],f.y));break;case"V":g=["C"][aN](a9(f.x,f.y,f.x,g[1]));break;case"Z":g=["C"][aN](a9(f.x,f.y,f.X,f.Y));break}return g},y= function(d,c){if(d[c][av]>7){d[c].shift();var f=d[c];while(f[av]){d.splice(c++,0,["C"][aN](f.splice(0,6)))}d.splice(c,1);t=ao(D[av],C&&C[av]||0)}},w= function(d,c,k,j,h){if(d&&c&&d[h][0]=="M"&&c[h][0]!="M"){c.splice(h,0,["M",j.x,j.y]);k.bx=0;k.by=0;k.x=d[h][1];k.y=d[h][2];t=ao(D[av],C&&C[av]||0)}};for(var u=0,t=ao(D[av],C&&C[av]||0);u<t;u++){D[u]=z(D[u],B);y(D,u);C&&(C[u]=z(C[u],A));C&&y(C,u);w(D,C,B,A,u);w(C,D,A,B,u);var s=D[u],r=C&&C[u],n=s[av],m=C&&r[av];B.x=s[n-2];B.y=s[n-1];B.bx=cP(s[n-4])||B.x;B.by=cP(s[n-3])||B.y;A.bx=C&&(cP(r[m-4])||A.x);A.by=C&&(cP(r[m-3])||A.y);A.x=C&&r[m-2];A.y=C&&r[m-1]}return C?[D,C]:D},null,b3),aX=b5(function(t){var s=[];for(var r=0,q=t[av];r<q;r++){var p={},o=t[r].match(/^([^:]*):?([\d\.]*)/);p.color=a8.getRGB(o[1]);if(p.color.error){return null}p.color=p.color.hex;o[2]&&(p.offset=o[2]+"%");s[c5](p)}for(r=1,q=s[av]-1;r<q;r++){if(!s[r].offset){var n=cP(s[r-1].offset||0),m=0;for(var l=r+1;l<q;l++){if(s[l].offset){m=s[l].offset;break}}if(!m){m=100;l=q}m=cP(m);var a=(m-n)/(l-r+1);for(;r<l;r++){n+=a;s[r].offset=n+"%"}}}return s}),aV= function(a,k,j,h){var g;if(a8.is(a,de)||a8.is(a,"object")){g=a8.is(a,de)?aW.getElementById(a):a;if(g.tagName){return k==null?{container:g,width:g.style.pixelWidth||g.offsetWidth,height:g.style.pixelHeight||g.offsetHeight}:{container:g,width:k,height:j}}}else{return{container:1,x:a,y:k,width:j,height:h}}},aT= function(g,f){var j=this;for(var h in f){if(f[aY](h)&&!(h in g)){switch(typeof f[h]){case"function":(function(a){g[h]=g===j?a:function(){return a[aO](j,arguments)}})(f[h]);break;case"object":g[h]=g[h]||{};aT.call(this,g[h],f[h]);break;default:g[h]=f[h];break}}}},dH= function(d,c){d==c.top&&(c.top=d.prev);d==c.bottom&&(c.bottom=d.next);d.next&&(d.next.prev=d.prev);d.prev&&(d.prev.next=d.next)},dG= function(d,c){if(c.top===d){return}dH(d,c);d.next=null;d.prev=c.top;c.top.next=d;c.top=d},dF= function(d,c){if(c.bottom===d){return}dH(d,c);d.next=c.bottom;d.prev=null;c.bottom.prev=d;c.bottom=d},dE= function(f,d,g){dH(f,g);d==g.top&&(g.top=f);d.next&&(d.next.prev=f);f.next=d.next;f.prev=d;d.next=f},dD= function(f,d,g){dH(f,g);d==g.bottom&&(g.bottom=f);d.prev&&(d.prev.next=f);f.prev=d.prev;d.prev=f;f.next=d},dC= function(b){return function(){throw new Error("Rapha�l: you are calling to method �"+b+"� of removed object")}};a8.pathToRelative=b2;if(a8.svg){aQ.svgns="http://www.w3.org/2000/svg";aQ.xlink="http://www.w3.org/1999/xlink";cU= function(b){return +b+(~(~b)===b)*0.5};var dB= function(f,d){if(d){for(var g in d){d[aY](g)&&f[cR](g,aF(d[g]))}}else{f=aW.createElementNS(aQ.svgns,f);f.style.webkitTapHighlightColor="rgba(0,0,0,0)";return f}};a8[da]= function(){return"Your browser supports SVG.\nYou are running Rapha�l "+this.version};var dA= function(g,f){var j=dB("path");f.canvas&&f.canvas[aP](j);var h=new du(j,f);h.type="path";dx(h,{fill:"none",stroke:"#000",path:g});return h},dz= function(F,E,D){var C="linear",B=0.5,A=0.5,z=F.style;E=aF(E)[b9](cQ,function(f,d,j){C="radial";if(d&&j){B=cP(d);A=cP(j);var h=(A>0.5)*2-1;dk(B-0.5,2)+dk(A-0.5,2)>0.25&&(A=aq.sqrt(0.25-dk(B-0.5,2))*h+0.5)&&A!=0.5&&(A=A.toFixed(5)-0.00001*h)}return aJ});E=E[aD](/\s*\-\s*/);if(C=="linear"){var y=E.shift();y=-cP(y);if(isNaN(y)){return null}var w=[0,0,aq.cos(y*di/180),aq.sin(y*di/180)],s=1/(ao(dm(w[2]),dm(w[3]))||1);w[2]*=s;w[3]*=s;if(w[2]<0){w[0]=-w[2];w[2]=0}if(w[3]<0){w[1]=-w[3];w[3]=0}}var r=aX(E);if(!r){return null}var p=F.getAttribute(c8);p=p.match(/^url\(#(.*)\)$/);p&&D.defs.removeChild(aW.getElementById(p[1]));var l=dB(C+"Gradient");l.id=cI();dB(l,C=="radial"?{fx:B,fy:A}:{x1:w[0],y1:w[1],x2:w[2],y2:w[3]});D.defs[aP](l);for(var g=0,H=r[av];g<H;g++){var G=dB("stop");dB(G,{offset:r[g].offset?r[g].offset:g?"100%":"0%","stop-color":r[g].color||"#fff"});l[aP](G)}dB(F,{fill:"url(#"+l.id+")",opacity:1,"fill-opacity":1});z.fill=aJ;z.opacity=1;z.fillOpacity=1;return 1},dy= function(a){var d=a.getBBox();dB(a.pattern,{patternTransform:a8.format("translate({0},{1})",d.x,d.y)})},dx= function(X,W){var V={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},U=X.node,T=X.attrs,S=X.rotate(),R= function(h,d){d=V[at.call(d)];if(d){var n=h.attrs["stroke-width"]||"1",m=({round:n,square:n,butt:0})[h.attrs["stroke-linecap"]||W["stroke-linecap"]]||0,k=[],j=d[av];while(j--){k[j]=d[j]*n+(j%2?1:-1)*m}dB(U,{"stroke-dasharray":k[ax](",")})}};W[aY]("rotation")&&(S=W.rotation);var Q=aF(S)[aD](a6);if(Q.length-1){Q[1]=+Q[1];Q[2]=+Q[2]}else{Q=null}cP(S)&&X.rotate(0,true);for(var P in W){if(W[aY](P)){if(!cH[aY](P)){continue}var O=W[P];T[P]=O;switch(P){case"blur":X.blur(O);break;case"rotation":X.rotate(O,true);break;case"href":case"title":case"target":var w=U.parentNode;if(at.call(w.tagName)!="a"){var r=dB("a");w.insertBefore(r,U);r[aP](U);w=r}P=="target"&&O=="blank"?w.setAttributeNS(X.paper.xlink,"show","new"):w.setAttributeNS(X.paper.xlink,P,O);break;case"cursor":U.style.cursor=O;break;case"clip-rect":var g=aF(O)[aD](a6);if(g[av]==4){X.clip&&X.clip.parentNode.parentNode.removeChild(X.clip.parentNode);var b=dB("clipPath"),N=dB("rect");b.id=cI();dB(N,{x:g[0],y:g[1],width:g[2],height:g[3]});b[aP](N);X.paper.defs[aP](b);dB(U,{"clip-path":"url(#"+b.id+")"});X.clip=N}if(!O){var M=aW.getElementById(U.getAttribute("clip-path")[b9](/(^url\(#|\)$)/g,aJ));M&&M.parentNode.removeChild(M);dB(U,{"clip-path":aJ});delete X.clip}break;case"path":X.type=="path"&&dB(U,{d:O?T.path=b1(O):"M0,0"});break;case"width":U[cR](P,O);if(T.fx){P="x";O=T.x}else{break}case"x":T.fx&&(O=-T.x-(T.width||0));case"rx":if(P=="rx"&&X.type=="rect"){break}case"cx":Q&&(P=="x"||P=="cx")&&(Q[1]+=O-T[P]);U[cR](P,O);X.pattern&&dy(X);break;case"height":U[cR](P,O);if(T.fy){P="y";O=T.y}else{break}case"y":T.fy&&(O=-T.y-(T.height||0));case"ry":if(P=="ry"&&X.type=="rect"){break}case"cy":Q&&(P=="y"||P=="cy")&&(Q[2]+=O-T[P]);U[cR](P,O);X.pattern&&dy(X);break;case"r":X.type=="rect"?dB(U,{rx:O,ry:O}):U[cR](P,O);break;case"src":X.type=="image"&&U.setAttributeNS(X.paper.xlink,"href",O);break;case"stroke-width":U.style.strokeWidth=O;U[cR](P,O);T["stroke-dasharray"]&&R(X,T["stroke-dasharray"]);break;case"stroke-dasharray":R(X,O);break;case"translation":var L=aF(O)[aD](a6);L[0]=+L[0]||0;L[1]=+L[1]||0;if(Q){Q[1]+=L[0];Q[2]+=L[1]}aa.call(X,L[0],L[1]);break;case"scale":L=aF(O)[aD](a6);X.scale(+L[0]||1,+L[1]||+L[0]||1,isNaN(cP(L[2]))?null:+L[2],isNaN(cP(L[3]))?null:+L[3]);break;case c8:var I=aF(O).match(c4);if(I){b=dB("pattern");var s=dB("image");b.id=cI();dB(b,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});dB(s,{x:0,y:0});s.setAttributeNS(X.paper.xlink,"href",I[1]);b[aP](s);var q=aW.createElement("img");q.style.cssText="position:absolute;left:-9999em;top-9999em";q.onload= function(){dB(b,{width:this.offsetWidth,height:this.offsetHeight});dB(s,{width:this.offsetWidth,height:this.offsetHeight});aW.body.removeChild(this);X.paper.safari()};aW.body[aP](q);q.src=I[1];X.paper.defs[aP](b);U.style.fill="url(#"+b.id+")";dB(U,{fill:"url(#"+b.id+")"});X.pattern=b;X.pattern&&dy(X);break}var p=a8.getRGB(O);if(p.error){if((({circle:1,ellipse:1})[aY](X.type)||aF(O).charAt()!="r")&&dz(U,O,X.paper)){T.gradient=O;T.fill="none";break}else{delete W.gradient;delete T.gradient;!a8.is(T.opacity,"undefined")&&a8.is(W.opacity,"undefined")&&dB(U,{opacity:T.opacity});!a8.is(T["fill-opacity"],"undefined")&&a8.is(W["fill-opacity"],"undefined")&&dB(U,{"fill-opacity":T["fill-opacity"]})}}p[aY]("opacity")&&dB(U,{"fill-opacity":p.opacity>1?p.opacity/100:p.opacity});case"stroke":p=a8.getRGB(O);U[cR](P,p.hex);P=="stroke"&&p[aY]("opacity")&&dB(U,{"stroke-opacity":p.opacity>1?p.opacity/100:p.opacity});break;case"gradient":(({circle:1,ellipse:1})[aY](X.type)||aF(O).charAt()!="r")&&dz(U,O,X.paper);break;case"opacity":T.gradient&&!T[aY]("stroke-opacity")&&dB(U,{"stroke-opacity":O>1?O/100:O});case"fill-opacity":if(T.gradient){var l=aW.getElementById(U.getAttribute(c8)[b9](/^url\(#|\)$/g,aJ));if(l){var f=l.getElementsByTagName("stop");f[f[av]-1][cR]("stop-opacity",O)}break}default:P=="font-size"&&(O=cN(O,10)+"px");var a=P[b9](/(\-.)/g,function(c){return cJ.call(c.substring(1))});U.style[a]=O;U[cR](P,O);break}}}dv(X,W);Q?X.rotate(Q.join(aH)):cP(S)&&X.rotate(S,true)},dw=1.2,dv= function(w,u){if(w.type!="text"||!(u[aY]("text")||u[aY]("font")||u[aY]("font-size")||u[aY]("x")||u[aY]("y"))){return}var t=w.attrs,s=w.node,r=s.firstChild?cN(aW.defaultView.getComputedStyle(s.firstChild,aJ).getPropertyValue("font-size"),10):10;if(u[aY]("text")){t.text=u.text;while(s.firstChild){s.removeChild(s.firstChild)}var q=aF(u.text)[aD]("\n");for(var p=0,l=q[av];p<l;p++){if(q[p]){var g=dB("tspan");p&&dB(g,{dy:r*dw,x:t.x});g[aP](aW.createTextNode(q[p]));s[aP](g)}}}else{q=s.getElementsByTagName("tspan");for(p=0,l=q[av];p<l;p++){p&&dB(q[p],{dy:r*dw,x:t.x})}}dB(s,{y:t.y});var f=w.getBBox(),a=t.y-(f.y+f.height/2);a&&a8.is(a,"finite")&&dB(s,{y:t.y+a})},du= function(a,h){var g=0,f=0;this[0]=a;this.id=a8._oid++;this.node=a;a.raphael=this;this.paper=h;this.attrs=this.attrs||{};this.transformations=[];this._={tx:0,ty:0,rt:{deg:0,cx:0,cy:0},sx:1,sy:1};!h.bottom&&(h.bottom=this);this.prev=h.top;h.top&&(h.top.next=this);h.top=this;this.next=null},dt=du[a0];du[a0].rotate= function(h,g,b){if(this.removed){return this}if(h==null){if(this._.rt.cx){return[this._.rt.deg,this._.rt.cx,this._.rt.cy][ax](aH)}return this._.rt.deg}var a=this.getBBox();h=aF(h)[aD](a6);if(h[av]-1){g=cP(h[1]);b=cP(h[2])}h=cP(h[0]);g!=null&&g!==false?this._.rt.deg=h:this._.rt.deg+=h;b==null&&(g=null);this._.rt.cx=g;this._.rt.cy=b;g=g==null?a.x+a.width/2:g;b=b==null?a.y+a.height/2:b;if(this._.rt.deg){this.transformations[0]=a8.format("rotate({0} {1} {2})",this._.rt.deg,g,b);this.clip&&dB(this.clip,{transform:a8.format("rotate({0} {1} {2})",-this._.rt.deg,g,b)})}else{this.transformations[0]=aJ;this.clip&&dB(this.clip,{transform:aJ})}dB(this.node,{transform:this.transformations[ax](aH)});return this};du[a0].hide= function(){!this.removed&&(this.node.style.display="none");return this};du[a0].show= function(){!this.removed&&(this.node.style.display="");return this};du[a0].remove= function(){if(this.removed){return}dH(this,this.paper);this.node.parentNode.removeChild(this.node);for(var b in this){delete this[b]}this.removed=true};du[a0].getBBox= function(){if(this.removed){return this}if(this.type=="path"){return b4(this.attrs.path)}if(this.node.style.display=="none"){this.show();var g=true}var f={};try{f=this.node.getBBox()}catch(g){}finally{f=f||{}}if(this.type=="text"){f={x:f.x,y:Infinity,width:0,height:0};for(var k=0,j=this.node.getNumberOfChars();k<j;k++){var h=this.node.getExtentOfChar(k);h.y<f.y&&(f.y=h.y);h.y+h.height-f.y>f.height&&(f.height=h.y+h.height-f.y);h.x+h.width-f.x>f.width&&(f.width=h.x+h.width-f.x)}}g&&this.hide();return f};du[a0].attr= function(w,u){if(this.removed){return this}if(w==null){var t={};for(var s in this.attrs){this.attrs[aY](s)&&(t[s]=this.attrs[s])}this._.rt.deg&&(t.rotation=this.rotate());(this._.sx!=1||this._.sy!=1)&&(t.scale=this.scale());t.gradient&&t.fill=="none"&&(t.fill=t.gradient)&&delete t.gradient;return t}if(u==null&&a8.is(w,de)){if(w=="translation"){return aa.call(this)}if(w=="rotation"){return this.rotate()}if(w=="scale"){return this.scale()}if(w==c8&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient}return this.attrs[w]}if(u==null&&a8.is(w,dc)){var r={};for(var q=0,p=w.length;q<p;q++){r[w[q]]=this.attr(w[q])}return r}if(u!=null){var o={};o[w]=u}else{w!=null&&a8.is(w,"object")&&(o=w)}for(var n in this.paper.customAttributes){if(this.paper.customAttributes[aY](n)&&o[aY](n)&&a8.is(this.paper.customAttributes[n],"function")){var f=this.paper.customAttributes[n].apply(this,[][aN](o[n]));this.attrs[n]=o[n];for(var a in f){f[aY](a)&&(o[a]=f[a])}}}dx(this,o);return this};du[a0].toFront= function(){if(this.removed){return this}this.node.parentNode[aP](this.node);var b=this.paper;b.top!=this&&dG(this,b);return this};du[a0].toBack= function(){if(this.removed){return this}if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);dF(this,this.paper);var b=this.paper}return this};du[a0].insertAfter= function(d){if(this.removed){return this}var c=d.node||d[d.length-1].node;c.nextSibling?c.parentNode.insertBefore(this.node,c.nextSibling):c.parentNode[aP](this.node);dE(this,d,this.paper);return this};du[a0].insertBefore= function(d){if(this.removed){return this}var c=d.node||d[0].node;c.parentNode.insertBefore(this.node,c);dD(this,d,this.paper);return this};du[a0].blur= function(g){var f=this;if(+g!==0){var j=dB("filter"),h=dB("feGaussianBlur");f.attrs.blur=g;j.id=cI();dB(h,{stdDeviation:+g||1.5});j.appendChild(h);f.paper.defs.appendChild(j);f._blur=j;dB(f.node,{filter:"url(#"+j.id+")"})}else{if(f._blur){f._blur.parentNode.removeChild(f._blur);delete f._blur;delete f.attrs.blur}f.node.removeAttribute("filter")}};var ds= function(h,g,m,l){var k=dB("circle");h.canvas&&h.canvas[aP](k);var j=new du(k,h);j.attrs={cx:g,cy:m,r:l,fill:"none",stroke:"#000"};j.type="circle";dB(k,j.attrs);return j},dr= function(k,j,q,p,o,n){var m=dB("rect");k.canvas&&k.canvas[aP](m);var l=new du(m,k);l.attrs={x:j,y:q,width:p,height:o,r:n||0,rx:n||0,ry:n||0,fill:"none",stroke:"#000"};l.type="rect";dB(m,l.attrs);return l},dq= function(j,h,o,n,m){var l=dB("ellipse");j.canvas&&j.canvas[aP](l);var k=new du(l,j);k.attrs={cx:h,cy:o,rx:n,ry:m,fill:"none",stroke:"#000"};k.type="ellipse";dB(l,k.attrs);return k},dn= function(k,j,q,p,o,n){var m=dB("image");dB(m,{x:q,y:p,width:o,height:n,preserveAspectRatio:"none"});m.setAttributeNS(k.xlink,"href",j);k.canvas&&k.canvas[aP](m);var l=new du(m,k);l.attrs={x:q,y:p,width:o,height:n,src:j};l.type="image";return l},dl= function(h,g,m,l){var k=dB("text");dB(k,{x:g,y:m,"text-anchor":"middle"});h.canvas&&h.canvas[aP](k);var j=new du(k,h);j.attrs={x:g,y:m,"text-anchor":"middle",text:l,font:cH.font,stroke:"none",fill:"#000"};j.type="text";dx(j,j.attrs);return j},dj= function(d,c){this.width=d||this.width;this.height=c||this.height;this.canvas[cR]("width",this.width);this.canvas[cR]("height",this.height);return this},dh= function(){var a=aV[aO](0,arguments),n=a&&a.container,m=a.x,l=a.y,k=a.width,j=a.height;if(!n){throw new Error("SVG container not found.")}var g=dB("svg");m=m||0;l=l||0;k=k||512;j=j||342;dB(g,{xmlns:"http://www.w3.org/2000/svg",version:1.1,width:k,height:j});if(n==1){g.style.cssText="position:absolute;left:"+m+"px;top:"+l+"px";aW.body[aP](g)}else{n.firstChild?n.insertBefore(g,n.firstChild):n[aP](g)}n=new aR;n.width=k;n.height=j;n.canvas=g;aT.call(n,n,a8.fn);n.clear();return n};aQ.clear= function(){var b=this.canvas;while(b.firstChild){b.removeChild(b.firstChild)}this.bottom=this.top=null;(this.desc=dB("desc"))[aP](aW.createTextNode("Created with Rapha�l"));b[aP](this.desc);b[aP](this.defs=dB("defs"))};aQ.remove= function(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var b in this){this[b]=dC(b)}}}if(a8.vml){var df={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},dd=/([clmz]),?([^clmz]*)/gi,db=/ progid:\S+Blur\([^\)]+\)/g,c9=/-?[^,\s-]+/g,dJ=1000+aH+1000,c3=10,aM={path:1,rect:1},aK= function(w){var u=/[ahqstv]/ig,t=b1;aF(w).match(u)&&(t=aZ);u=/[clmz]/g;if(t==b1&&!aF(w).match(u)){var s=aF(w)[b9](dd,function(h,g,z){var y=[],k=at.call(g)=="m",j=df[g];z[b9](c9,function(b){if(k&&y[av]==2){j+=y+df[g=="m"?"l":"L"];y=[]}y[c5](cU(b*c3))});return j+y});return s}var r=t(w),q,p;s=[];for(var o=0,n=r[av];o<n;o++){q=r[o];p=at.call(r[o][0]);p=="z"&&(p="x");for(var m=1,l=q[av];m<l;m++){p+=cU(q[m]*c3)+(m!=l-1?",":aJ)}s[c5](p)}return s[ax](aH)};a8[da]= function(){return"Your browser doesn�t support SVG. Falling down to VML.\nYou are running Rapha�l "+this.version};dA= function(j,h){var o=aG("group");o.style.cssText="position:absolute;left:0;top:0;width:"+h.width+"px;height:"+h.height+"px";o.coordsize=h.coordsize;o.coordorigin=h.coordorigin;var n=aG("shape"),m=n.style;m.width=h.width+"px";m.height=h.height+"px";n.coordsize=dJ;n.coordorigin=h.coordorigin;o[aP](n);var l=new du(n,o,h),k={fill:"none",stroke:"#000"};j&&(k.path=j);l.type="path";l.path=[];l.Path=aJ;dx(l,k);h.canvas[aP](o);return l};dx= function(S,R){S.attrs=S.attrs||{};var Q=S.node,P=S.attrs,O=Q.style,N,M=(R.x!=P.x||R.y!=P.y||R.width!=P.width||R.height!=P.height||R.r!=P.r)&&S.type=="rect",L=S;for(var K in R){R[aY](K)&&(P[K]=R[K])}if(M){P.path=aI(P.x,P.y,P.width,P.height,P.r);S.X=P.x;S.Y=P.y;S.W=P.width;S.H=P.height}R.href&&(Q.href=R.href);R.title&&(Q.title=R.title);R.target&&(Q.target=R.target);R.cursor&&(O.cursor=R.cursor);"blur" in R&&S.blur(R.blur);if(R.path&&S.type=="path"||M){Q.path=aK(P.path)}R.rotation!=null&&S.rotate(R.rotation,true);if(R.translation){N=aF(R.translation)[aD](a6);aa.call(S,N[0],N[1]);if(S._.rt.cx!=null){S._.rt.cx+=+N[0];S._.rt.cy+=+N[1];S.setBox(S.attrs,N[0],N[1])}}if(R.scale){N=aF(R.scale)[aD](a6);S.scale(+N[0]||1,+N[1]||+N[0]||1,+N[2]||null,+N[3]||null)}if("clip-rect" in R){var I=aF(R["clip-rect"])[aD](a6);if(I[av]==4){I[2]=+I[2]+ +I[0];I[3]=+I[3]+ +I[1];var H=Q.clipRect||aW.createElement("div"),s=H.style,p=Q.parentNode;s.clip=a8.format("rect({1}px {2}px {3}px {0}px)",I);if(!Q.clipRect){s.position="absolute";s.top=0;s.left=0;s.width=S.paper.width+"px";s.height=S.paper.height+"px";p.parentNode.insertBefore(H,p);H[aP](p);Q.clipRect=H}}R["clip-rect"]||Q.clipRect&&(Q.clipRect.style.clip=aJ)}S.type=="image"&&R.src&&(Q.src=R.src);if(S.type=="image"&&R.opacity){Q.filterOpacity=cL+".Alpha(opacity="+R.opacity*100+")";O.filter=(Q.filterMatrix||aJ)+(Q.filterOpacity||aJ)}R.font&&(O.font=R.font);R["font-family"]&&(O.fontFamily='"'+R["font-family"][aD](",")[0][b9](/^['"]+|['"]+$/g,aJ)+'"');R["font-size"]&&(O.fontSize=R["font-size"]);R["font-weight"]&&(O.fontWeight=R["font-weight"]);R["font-style"]&&(O.fontStyle=R["font-style"]);if(R.opacity!=null||R["stroke-width"]!=null||R.fill!=null||R.stroke!=null||R["stroke-width"]!=null||R["stroke-opacity"]!=null||R["fill-opacity"]!=null||R["stroke-dasharray"]!=null||R["stroke-miterlimit"]!=null||R["stroke-linejoin"]!=null||R["stroke-linecap"]!=null){Q=S.shape||Q;var g=Q.getElementsByTagName(c8)&&Q.getElementsByTagName(c8)[0],b=false;!g&&(b=g=aG(c8));if("fill-opacity" in R||"opacity" in R){var a=((+P["fill-opacity"]+1||2)-1)*((+P.opacity+1||2)-1)*((+a8.getRGB(R.fill).o+1||2)-1);a=dp(ao(a,0),1);g.opacity=a}R.fill&&(g.on=true);if(g.on==null||R.fill=="none"){g.on=false}if(g.on&&R.fill){var A=R.fill.match(c4);if(A){g.src=A[1];g.type="tile"}else{g.color=a8.getRGB(R.fill).hex;g.src=aJ;g.type="solid";if(a8.getRGB(R.fill).error&&(L.type in {circle:1,ellipse:1}||aF(R.fill).charAt()!="r")&&dz(L,R.fill)){P.fill="none";P.gradient=R.fill}}}b&&Q[aP](g);var z=Q.getElementsByTagName("stroke")&&Q.getElementsByTagName("stroke")[0],w=false;!z&&(w=z=aG("stroke"));if(R.stroke&&R.stroke!="none"||R["stroke-width"]||R["stroke-opacity"]!=null||R["stroke-dasharray"]||R["stroke-miterlimit"]||R["stroke-linejoin"]||R["stroke-linecap"]){z.on=true}(R.stroke=="none"||z.on==null||R.stroke==0||R["stroke-width"]==0)&&(z.on=false);var r=a8.getRGB(R.stroke);z.on&&R.stroke&&(z.color=r.hex);a=((+P["stroke-opacity"]+1||2)-1)*((+P.opacity+1||2)-1)*((+r.o+1||2)-1);var l=(cP(R["stroke-width"])||1)*0.75;a=dp(ao(a,0),1);R["stroke-width"]==null&&(l=P["stroke-width"]);R["stroke-width"]&&(z.weight=l);l&&l<1&&(a*=l)&&(z.weight=1);z.opacity=a;R["stroke-linejoin"]&&(z.joinstyle=R["stroke-linejoin"]||"miter");z.miterlimit=R["stroke-miterlimit"]||8;R["stroke-linecap"]&&(z.endcap=R["stroke-linecap"]=="butt"?"flat":R["stroke-linecap"]=="square"?"square":"round");if(R["stroke-dasharray"]){var f={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};z.dashstyle=f[aY](R["stroke-dasharray"])?f[R["stroke-dasharray"]]:aJ}w&&Q[aP](z)}if(L.type=="text"){O=L.paper.span.style;P.font&&(O.font=P.font);P["font-family"]&&(O.fontFamily=P["font-family"]);P["font-size"]&&(O.fontSize=P["font-size"]);P["font-weight"]&&(O.fontWeight=P["font-weight"]);P["font-style"]&&(O.fontStyle=P["font-style"]);L.node.string&&(L.paper.span.innerHTML=aF(L.node.string)[b9](/</g,"&#60;")[b9](/&/g,"&#38;")[b9](/\n/g,"<br>"));L.W=P.w=L.paper.span.offsetWidth;L.H=P.h=L.paper.span.offsetHeight;L.X=P.x;L.Y=P.y+cU(L.H/2);switch(P["text-anchor"]){case"start":L.node.style["v-text-align"]="left";L.bbx=cU(L.W/2);break;case"end":L.node.style["v-text-align"]="right";L.bbx=-cU(L.W/2);break;default:L.node.style["v-text-align"]="center";break}}};dz= function(w,u){w.attrs=w.attrs||{};var t=w.attrs,s,r="linear",q=".5 .5";w.attrs.gradient=u;u=aF(u)[b9](cQ,function(f,d,g){r="radial";if(d&&g){d=cP(d);g=cP(g);dk(d-0.5,2)+dk(g-0.5,2)>0.25&&(g=aq.sqrt(0.25-dk(d-0.5,2))*((g>0.5)*2-1)+0.5);q=d+aH+g}return aJ});u=u[aD](/\s*\-\s*/);if(r=="linear"){var p=u.shift();p=-cP(p);if(isNaN(p)){return null}}var o=aX(u);if(!o){return null}w=w.shape||w.node;s=w.getElementsByTagName(c8)[0]||aG(c8);!s.parentNode&&w.appendChild(s);if(o[av]){s.on=true;s.method="none";s.color=o[0].color;s.color2=o[o[av]-1].color;var n=[];for(var m=0,l=o[av];m<l;m++){o[m].offset&&n[c5](o[m].offset+aH+o[m].color)}s.colors&&(s.colors.value=n[av]?n[ax]():"0% "+s.color);if(r=="radial"){s.type="gradientradial";s.focus="100%";s.focussize=q;s.focusposition=q}else{s.type="gradient";s.angle=(270-p)%360}}return 1};du= function(a,o,n){var m=0,l=0,k=0,j=1;this[0]=a;this.id=a8._oid++;this.node=a;a.raphael=this;this.X=0;this.Y=0;this.attrs={};this.Group=o;this.paper=n;this._={tx:0,ty:0,rt:{deg:0},sx:1,sy:1};!n.bottom&&(n.bottom=this);this.prev=n.top;n.top&&(n.top.next=this);n.top=this;this.next=null};dt=du[a0];dt.rotate= function(b,g,f){if(this.removed){return this}if(b==null){if(this._.rt.cx){return[this._.rt.deg,this._.rt.cx,this._.rt.cy][ax](aH)}return this._.rt.deg}b=aF(b)[aD](a6);if(b[av]-1){g=cP(b[1]);f=cP(b[2])}b=cP(b[0]);g!=null?this._.rt.deg=b:this._.rt.deg+=b;f==null&&(g=null);this._.rt.cx=g;this._.rt.cy=f;this.setBox(this.attrs,g,f);this.Group.style.rotation=this._.rt.deg;return this};dt.setBox= function(F,E,D){if(this.removed){return this}var C=this.Group.style,B=this.shape&&this.shape.style||this.node.style;F=F||{};for(var A in F){F[aY](A)&&(this.attrs[A]=F[A])}E=E||this._.rt.cx;D=D||this._.rt.cy;var z=this.attrs,y,w,u,t;switch(this.type){case"circle":y=z.cx-z.r;w=z.cy-z.r;u=t=z.r*2;break;case"ellipse":y=z.cx-z.rx;w=z.cy-z.ry;u=z.rx*2;t=z.ry*2;break;case"image":y=+z.x;w=+z.y;u=z.width||0;t=z.height||0;break;case"text":this.textpath.v=["m",cU(z.x),", ",cU(z.y-2),"l",cU(z.x)+1,", ",cU(z.y-2)][ax](aJ);y=z.x-cU(this.W/2);w=z.y-this.H/2;u=this.W;t=this.H;break;case"rect":case"path":if(this.attrs.path){var s=b4(this.attrs.path);y=s.x;w=s.y;u=s.width;t=s.height}else{y=0;w=0;u=this.paper.width;t=this.paper.height}break;default:y=0;w=0;u=this.paper.width;t=this.paper.height;break}E=E==null?y+u/2:E;D=D==null?w+t/2:D;var r=E-this.paper.width/2,p=D-this.paper.height/2,f;C.left!=(f=r+"px")&&(C.left=f);C.top!=(f=p+"px")&&(C.top=f);this.X=aM[aY](this.type)?-r:y;this.Y=aM[aY](this.type)?-p:w;this.W=u;this.H=t;if(aM[aY](this.type)){B.left!=(f=-r*c3+"px")&&(B.left=f);B.top!=(f=-p*c3+"px")&&(B.top=f)}else{if(this.type=="text"){B.left!=(f=-r+"px")&&(B.left=f);B.top!=(f=-p+"px")&&(B.top=f)}else{C.width!=(f=this.paper.width+"px")&&(C.width=f);C.height!=(f=this.paper.height+"px")&&(C.height=f);B.left!=(f=y-r+"px")&&(B.left=f);B.top!=(f=w-p+"px")&&(B.top=f);B.width!=(f=u+"px")&&(B.width=f);B.height!=(f=t+"px")&&(B.height=f)}}};dt.hide= function(){!this.removed&&(this.Group.style.display="none");return this};dt.show= function(){!this.removed&&(this.Group.style.display="block");return this};dt.getBBox= function(){if(this.removed){return this}if(aM[aY](this.type)){return b4(this.attrs.path)}return{x:this.X+(this.bbx||0),y:this.Y,width:this.W,height:this.H}};dt.remove= function(){if(this.removed){return}dH(this,this.paper);this.node.parentNode.removeChild(this.node);this.Group.parentNode.removeChild(this.Group);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var b in this){delete this[b]}this.removed=true};dt.attr= function(t,s){if(this.removed){return this}if(t==null){var r={};for(var q in this.attrs){this.attrs[aY](q)&&(r[q]=this.attrs[q])}this._.rt.deg&&(r.rotation=this.rotate());(this._.sx!=1||this._.sy!=1)&&(r.scale=this.scale());r.gradient&&r.fill=="none"&&(r.fill=r.gradient)&&delete r.gradient;return r}if(s==null&&a8.is(t,"string")){if(t=="translation"){return aa.call(this)}if(t=="rotation"){return this.rotate()}if(t=="scale"){return this.scale()}if(t==c8&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient}return this.attrs[t]}if(this.attrs&&s==null&&a8.is(t,dc)){var p,o={};for(q=0,p=t[av];q<p;q++){o[t[q]]=this.attr(t[q])}return o}var n;if(s!=null){n={};n[t]=s}s==null&&a8.is(t,"object")&&(n=t);if(n){for(var m in this.paper.customAttributes){if(this.paper.customAttributes[aY](m)&&n[aY](m)&&a8.is(this.paper.customAttributes[m],"function")){var f=this.paper.customAttributes[m].apply(this,[][aN](n[m]));this.attrs[m]=n[m];for(var a in f){f[aY](a)&&(n[a]=f[a])}}}n.text&&this.type=="text"&&(this.node.string=n.text);dx(this,n);n.gradient&&(({circle:1,ellipse:1})[aY](this.type)||aF(n.gradient).charAt()!="r")&&dz(this,n.gradient);(!aM[aY](this.type)||this._.rt.deg)&&this.setBox(this.attrs)}return this};dt.toFront= function(){!this.removed&&this.Group.parentNode[aP](this.Group);this.paper.top!=this&&dG(this,this.paper);return this};dt.toBack= function(){if(this.removed){return this}if(this.Group.parentNode.firstChild!=this.Group){this.Group.parentNode.insertBefore(this.Group,this.Group.parentNode.firstChild);dF(this,this.paper)}return this};dt.insertAfter= function(b){if(this.removed){return this}b.constructor==cV&&(b=b[b.length-1]);b.Group.nextSibling?b.Group.parentNode.insertBefore(this.Group,b.Group.nextSibling):b.Group.parentNode[aP](this.Group);dE(this,b,this.paper);return this};dt.insertBefore= function(b){if(this.removed){return this}b.constructor==cV&&(b=b[0]);b.Group.parentNode.insertBefore(this.Group,b.Group);dD(this,b,this.paper);return this};dt.blur= function(a){var g=this.node.runtimeStyle,f=g.filter;f=f.replace(db,aJ);if(+a!==0){this.attrs.blur=a;g.filter=f+aH+cL+".Blur(pixelradius="+(+a||1.5)+")";g.margin=a8.format("-{0}px 0 0 -{0}px",cU(+a||1.5))}else{g.filter=f;g.margin=0;delete this.attrs.blur}};ds= function(k,j,q,p){var o=aG("group"),n=aG("oval"),m=n.style;o.style.cssText="position:absolute;left:0;top:0;width:"+k.width+"px;height:"+k.height+"px";o.coordsize=dJ;o.coordorigin=k.coordorigin;o[aP](n);var l=new du(n,o,k);l.type="circle";dx(l,{stroke:"#000",fill:"none"});l.attrs.cx=j;l.attrs.cy=q;l.attrs.r=p;l.setBox({x:j-p,y:q-p,width:p*2,height:p*2});k.canvas[aP](o);return l};function aI(a,k,j,h,g){return g?a8.format("M{0},{1}l{2},0a{3},{3},0,0,1,{3},{3}l0,{5}a{3},{3},0,0,1,{4},{3}l{6},0a{3},{3},0,0,1,{4},{4}l0,{7}a{3},{3},0,0,1,{3},{4}z",a+g,k,j-g*2,g,-g,h-g*2,g*2-j,g*2-h):a8.format("M{0},{1}l{2},0,0,{3},{4},0z",a,k,j,h,-j)}dr= function(r,q,p,o,n,m){var l=aI(q,p,o,n,m),k=r.path(l),j=k.attrs;k.X=j.x=q;k.Y=j.y=p;k.W=j.width=o;k.H=j.height=n;j.r=m;j.path=l;k.type="rect";return k};dq= function(r,q,p,o,n){var m=aG("group"),l=aG("oval"),k=l.style;m.style.cssText="position:absolute;left:0;top:0;width:"+r.width+"px;height:"+r.height+"px";m.coordsize=dJ;m.coordorigin=r.coordorigin;m[aP](l);var j=new du(l,m,r);j.type="ellipse";dx(j,{stroke:"#000"});j.attrs.cx=q;j.attrs.cy=p;j.attrs.rx=o;j.attrs.ry=n;j.setBox({x:q-o,y:p-n,width:o*2,height:n*2});r.canvas[aP](m);return j};dn= function(r,q,p,o,n,m){var l=aG("group"),k=aG("image");l.style.cssText="position:absolute;left:0;top:0;width:"+r.width+"px;height:"+r.height+"px";l.coordsize=dJ;l.coordorigin=r.coordorigin;k.src=q;l[aP](k);var j=new du(k,l,r);j.type="image";j.attrs.src=q;j.attrs.x=p;j.attrs.y=o;j.attrs.w=n;j.attrs.h=m;j.setBox({x:p,y:o,width:n,height:m});r.canvas[aP](l);return j};dl= function(w,u,t,s){var r=aG("group"),q=aG("shape"),p=q.style,o=aG("path"),n=o.style,l=aG("textpath");r.style.cssText="position:absolute;left:0;top:0;width:"+w.width+"px;height:"+w.height+"px";r.coordsize=dJ;r.coordorigin=w.coordorigin;o.v=a8.format("m{0},{1}l{2},{1}",cU(u*10),cU(t*10),cU(u*10)+1);o.textpathok=true;p.width=w.width;p.height=w.height;l.string=aF(s);l.on=true;q[aP](l);q[aP](o);r[aP](q);var a=new du(l,r,w);a.shape=q;a.textpath=o;a.type="text";a.attrs.text=s;a.attrs.x=u;a.attrs.y=t;a.attrs.w=1;a.attrs.h=1;dx(a,{font:cH.font,stroke:"none",fill:"#000"});a.setBox();w.canvas[aP](r);return a};dj= function(f,d){var g=this.canvas.style;f==+f&&(f+="px");d==+d&&(d+="px");g.width=f;g.height=d;g.clip="rect(0 "+f+" "+d+" 0)";return this};var aG;aW.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!aW.namespaces.rvml&&aW.namespaces.add("rvml","urn:schemas-microsoft-com:vml");aG= function(b){return aW.createElement("<rvml:"+b+' class="rvml">')}}catch(a8){aG= function(b){return aW.createElement("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}dh= function(){var t=aV[aO](0,arguments),s=t.container,r=t.height,q,p=t.width,m=t.x,l=t.y;if(!s){throw new Error("VML container not found.")}var j=new aR,g=j.canvas=aW.createElement("div"),a=g.style;m=m||0;l=l||0;p=p||512;r=r||342;p==+p&&(p+="px");r==+r&&(r+="px");j.width=1000;j.height=1000;j.coordsize=c3*1000+aH+c3*1000;j.coordorigin="0 0";j.span=aW.createElement("span");j.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";g[aP](j.span);a.cssText=a8.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",p,r);if(s==1){aW.body[aP](g);a.left=m+"px";a.top=l+"px";a.position="absolute"}else{s.firstChild?s.insertBefore(g,s.firstChild):s[aP](g)}aT.call(j,j,a8.fn);return j};aQ.clear= function(){this.canvas.innerHTML=aJ;this.span=aW.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas[aP](this.span);this.bottom=this.top=null};aQ.remove= function(){this.canvas.parentNode.removeChild(this.canvas);for(var b in this){this[b]=dC(b)}return true}}var aE=navigator.userAgent.match(/Version\\x2f(.*?)\s/);navigator.vendor=="Apple Computer, Inc."&&(aE&&aE[1]<4||navigator.platform.slice(0,2)=="iP")?aQ.safari= function(){var b=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});aU.setTimeout(function(){b.remove()})}:aQ.safari= function(){};var aC= function(){this.returnValue=false},aA= function(){return this.originalEvent.preventDefault()},ay= function(){this.cancelBubble=true},aw= function(){return this.originalEvent.stopPropagation()},au=(function(){if(aW.addEventListener){return function(h,f,m,l){var k=aL&&az[f]?az[f]:f,j= function(d){if(aL&&az[aY](f)){for(var c=0,b=d.targetTouches&&d.targetTouches.length;c<b;c++){if(d.targetTouches[c].target==h){var a=d;d=d.targetTouches[c];d.originalEvent=a;d.preventDefault=aA;d.stopPropagation=aw;break}}}return m.call(l,d)};h.addEventListener(k,j,false);return function(){h.removeEventListener(k,j,false);return true}}}if(aW.attachEvent){return function(h,g,m,l){var k= function(b){b=b||aU.event;b.preventDefault=b.preventDefault||aC;b.stopPropagation=b.stopPropagation||ay;return m.call(l,b)};h.attachEvent("on"+g,k);var j= function(){h.detachEvent("on"+g,k);return true};return j}}})(),ar=[],ap= function(r){var q=r.clientX,p=r.clientY,o=aW.documentElement.scrollTop||aW.body.scrollTop,n=aW.documentElement.scrollLeft||aW.body.scrollLeft,m,l=ar.length;while(l--){m=ar[l];if(aL){var k=r.touches.length,g;while(k--){g=r.touches[k];if(g.identifier==m.el._drag.id){q=g.clientX;p=g.clientY;(r.originalEvent?r.originalEvent:r).preventDefault();break}}}else{r.preventDefault()}q+=n;p+=o;m.move&&m.move.call(m.move_scope||m.el,q-m.el._drag.x,p-m.el._drag.y,q,p,r)}},an= function(a){a8.unmousemove(ap).unmouseup(an);var g=ar.length,f;while(g--){f=ar[g];f.el._drag={};f.end&&f.end.call(f.end_scope||f.start_scope||f.move_scope||f.el,a)}ar=[]};for(var am=aB[av];am--;){(function(a){a8[a]=du[a0][a]= function(f,b){if(a8.is(f,"function")){this.events=this.events||[];this.events.push({name:a,f:f,unbind:au(this.shape||this.node||aW,a,f,b||this)})}return this};a8["un"+a]=du[a0]["un"+a]= function(b){var g=this.events,f=g[av];while(f--){if(g[f].name==a&&g[f].f==b){g[f].unbind();g.splice(f,1);!g.length&&delete this.events;return this}}return this}})(aB[am])}dt.hover= function(g,f,j,h){return this.mouseover(g,j).mouseout(f,h||j)};dt.unhover= function(d,c){return this.unmouseover(d).unmouseout(c)};dt.drag= function(a,m,l,k,j,g){this._drag={};this.mousedown(function(d){(d.originalEvent||d).preventDefault();var c=aW.documentElement.scrollTop||aW.body.scrollTop,b=aW.documentElement.scrollLeft||aW.body.scrollLeft;this._drag.x=d.clientX+b;this._drag.y=d.clientY+c;this._drag.id=d.identifier;m&&m.call(j||k||this,d.clientX+b,d.clientY+c,d);!ar.length&&a8.mousemove(ap).mouseup(an);ar.push({el:this,move:a,end:l,move_scope:k,start_scope:j,end_scope:g})});return this};dt.undrag= function(a,h,g){var f=ar.length;while(f--){ar[f].el==this&&(ar[f].move==a&&ar[f].end==g)&&ar.splice(f++,1)}!ar.length&&a8.unmousemove(ap).unmouseup(an)};aQ.circle= function(f,d,g){return ds(this,f||0,d||0,g||0)};aQ.rect= function(g,f,k,j,h){return dr(this,g||0,f||0,k||0,j||0,h||0)};aQ.ellipse= function(g,f,j,h){return dq(this,g||0,f||0,j||0,h||0)};aQ.path= function(a){a&&!a8.is(a,de)&&!a8.is(a[0],dc)&&(a+=aJ);return dA(a8.format[aO](a8,arguments),this)};aQ.image= function(g,f,k,j,h){return dn(this,g||"about:blank",f||0,k||0,j||0,h||0)};aQ.text= function(f,d,g){return dl(this,f||0,d||0,aF(g))};aQ.set= function(b){arguments[av]>1&&(b=Array[a0].splice.call(arguments,0,arguments[av]));return new cV(b)};aQ.setSize=dj;aQ.top=aQ.bottom=null;aQ.raphael=a8;function al(){return this.x+aH+this.y}dt.resetScale= function(){if(this.removed){return this}this._.sx=1;this._.sy=1;this.attrs.scale="1 1"};dt.scale= function(bw,bv,bu,bt){if(this.removed){return this}if(bw==null&&bv==null){return{x:this._.sx,y:this._.sy,toString:al}}bv=bv||bw;!(+bv)&&(bv=bw);var bs,br,bq,bp,bo=this.attrs;if(bw!=0){var bn=this.getBBox(),bm=bn.x+bn.width/2,bl=bn.y+bn.height/2,bk=dm(bw/this._.sx),bj=dm(bv/this._.sy);bu=+bu||bu==0?bu:bm;bt=+bt||bt==0?bt:bl;var bi=this._.sx>0,bh=this._.sy>0,bg=~(~(bw/dm(bw))),bf=~(~(bv/dm(bv))),be=bk*bg,bd=bj*bf,bc=this.node.style,bb=bu+dm(bm-bu)*be*(bm>bu==bi?1:-1),ba=bt+dm(bl-bt)*bd*(bl>bt==bh?1:-1),Z=bw*bg>bv*bf?bj:bk;switch(this.type){case"rect":case"image":var Y=bo.width*bk,X=bo.height*bj;this.attr({height:X,r:bo.r*Z,width:Y,x:bb-Y/2,y:ba-X/2});break;case"circle":case"ellipse":this.attr({rx:bo.rx*bk,ry:bo.ry*bj,r:bo.r*Z,cx:bb,cy:ba});break;case"text":this.attr({x:bb,y:ba});break;case"path":var W=b2(bo.path),V=true,U=bi?be:bk,T=bh?bd:bj;for(var S=0,R=W[av];S<R;S++){var B=W[S],w=cJ.call(B[0]);if(w=="M"&&V){continue}V=false;if(w=="A"){B[W[S][av]-2]*=U;B[W[S][av]-1]*=T;B[1]*=bk;B[2]*=bj;B[5]=+(bg+bf?!(!(+B[5])):!(+B[5]))}else{if(w=="H"){for(var q=1,p=B[av];q<p;q++){B[q]*=U}}else{if(w=="V"){for(q=1,p=B[av];q<p;q++){B[q]*=T}}else{for(q=1,p=B[av];q<p;q++){B[q]*=q%2?U:T}}}}}var n=b4(W);bs=bb-n.x-n.width/2;br=ba-n.y-n.height/2;W[0][1]+=bs;W[0][2]+=br;this.attr({path:W});break}if(this.type in {text:1,image:1}&&(bg!=1||bf!=1)){if(this.transformations){this.transformations[2]="scale("[aN](bg,",",bf,")");this.node[cR]("transform",this.transformations[ax](aH));bs=bg==-1?-bo.x-(Y||0):bo.x;br=bf==-1?-bo.y-(X||0):bo.y;this.attr({x:bs,y:br});bo.fx=bg-1;bo.fy=bf-1}else{this.node.filterMatrix=cL+".Matrix(M11="[aN](bg,", M12=0, M21=0, M22=",bf,", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')");bc.filter=(this.node.filterMatrix||aJ)+(this.node.filterOpacity||aJ)}}else{if(this.transformations){this.transformations[2]=aJ;this.node[cR]("transform",this.transformations[ax](aH));bo.fx=0;bo.fy=0}else{this.node.filterMatrix=aJ;bc.filter=(this.node.filterMatrix||aJ)+(this.node.filterOpacity||aJ)}}bo.scale=[bw,bv,bu,bt][ax](aH);this._.sx=bw;this._.sy=bv}return this};dt.clone= function(){if(this.removed){return null}var b=this.attr();delete b.scale;delete b.translation;return this.paper[this.type]().attr(b)};var ak={},aj= function(K,I,H,G,F,E,D,C,B){var A=0,z=100,y=[K,I,H,G,F,E,D,C].join(),w=ak[y],u,t;!w&&(ak[y]=w={data:[]});w.timer&&clearTimeout(w.timer);w.timer=setTimeout(function(){delete ak[y]},2000);if(B!=null){var s=aj(K,I,H,G,F,E,D,C);z=~(~s)*10}for(var a=0;a<z+1;a++){if(w.data[B]>a){t=w.data[a*z]}else{t=a8.findDotsAtSegment(K,I,H,G,F,E,D,C,a/z);w.data[a]=t}a&&(A+=dk(dk(u.x-t.x,2)+dk(u.y-t.y,2),0.5));if(B!=null&&A>=B){return t}u=t}if(B==null){return A}},ai= function(a,d){return function(C,B,A){C=aZ(C);var z,y,w,u,t="",s={},r,q=0;for(var c=0,b=C.length;c<b;c++){w=C[c];if(w[0]=="M"){z=+w[1];y=+w[2]}else{u=aj(z,y,w[1],w[2],w[3],w[4],w[5],w[6]);if(q+u>B){if(d&&!s.start){r=aj(z,y,w[1],w[2],w[3],w[4],w[5],w[6],B-q);t+=["C",r.start.x,r.start.y,r.m.x,r.m.y,r.x,r.y];if(A){return t}s.start=t;t=["M",r.x,r.y+"C",r.n.x,r.n.y,r.end.x,r.end.y,w[5],w[6]][ax]();q+=u;z=+w[5];y=+w[6];continue}if(!a&&!d){r=aj(z,y,w[1],w[2],w[3],w[4],w[5],w[6],B-q);return{x:r.x,y:r.y,alpha:r.alpha}}}q+=u;z=+w[5];y=+w[6]}t+=w}s.end=t;r=a?q:d?s:a8.findDotsAtSegment(z,y,w[1],w[2],w[3],w[4],w[5],w[6],1);r.alpha&&(r={x:r.x,y:r.y,alpha:r.alpha});return r}},ah=ai(1),ag=ai(),af=ai(0,1);dt.getTotalLength= function(){if(this.type!="path"){return}if(this.node.getTotalLength){return this.node.getTotalLength()}return ah(this.attrs.path)};dt.getPointAtLength= function(b){if(this.type!="path"){return}return ag(this.attrs.path,b)};dt.getSubpath= function(f,d){if(this.type!="path"){return}if(dm(this.getTotalLength()-d)<"1e-6"){return af(this.attrs.path,f).end}var g=af(this.attrs.path,d,1);return f?af(g,f).end:g};a8.easing_formulas={linear:function(b){return b},"<":function(b){return dk(b,3)},">":function(b){return dk(b-1,3)+1},"<>":function(b){b=b*2;if(b<1){return dk(b,3)/2}b-=2;return(dk(b,3)+2)/2},backIn:function(d){var c=1.70158;return d*d*((c+1)*d-c)},backOut:function(d){d=d-1;var c=1.70158;return d*d*((c+1)*d+c)+1},elastic:function(f){if(f==0||f==1){return f}var d=0.3,g=d/4;return dk(2,-10*f)*aq.sin((f-g)*(2*di)/d)+1},bounce:function(g){var f=7.5625,j=2.75,h;if(g<1/j){h=f*g*g}else{if(g<2/j){g-=1.5/j;h=f*g*g+0.75}else{if(g<2.5/j){g-=2.25/j;h=f*g*g+0.9375}else{g-=2.625/j;h=f*g*g+0.984375}}}return h}};var ae=[],ad= function(){var V=+(new Date);for(var U=0;U<ae[av];U++){var T=ae[U];if(T.stop||T.el.removed){continue}var S=V-T.start,R=T.ms,Q=T.easing,P=T.from,O=T.diff,N=T.to,M=T.t,L=T.el,K={},I;if(S<R){var F=Q(S/R);for(var D in P){if(P[aY](D)){switch(cF[D]){case"along":I=F*R*O[D];N.back&&(I=N.len-I);var w=ag(N[D],I);L.translate(O.sx-O.x||0,O.sy-O.y||0);O.x=w.x;O.y=w.y;L.translate(w.x-O.sx,w.y-O.sy);N.rot&&L.rotate(O.r+w.alpha,w.x,w.y);break;case dg:I=+P[D]+F*R*O[D];break;case"colour":I="rgb("+[ab(cU(P[D].r+F*R*O[D].r)),ab(cU(P[D].g+F*R*O[D].g)),ab(cU(P[D].b+F*R*O[D].b))][ax](",")+")";break;case"path":I=[];for(var q=0,p=P[D][av];q<p;q++){I[q]=[P[D][q][0]];for(var f=1,a=P[D][q][av];f<a;f++){I[q][f]=+P[D][q][f]+F*R*O[D][q][f]}I[q]=I[q][ax](aH)}I=I[ax](aH);break;case"csv":switch(D){case"translation":var H=F*R*O[D][0]-M.x,G=F*R*O[D][1]-M.y;M.x+=H;M.y+=G;I=H+aH+G;break;case"rotation":I=+P[D][0]+F*R*O[D][0];P[D][1]&&(I+=","+P[D][1]+","+P[D][2]);break;case"scale":I=[+P[D][0]+F*R*O[D][0],+P[D][1]+F*R*O[D][1],2 in N[D]?N[D][2]:aJ,3 in N[D]?N[D][3]:aJ][ax](aH);break;case"clip-rect":I=[];q=4;while(q--){I[q]=+P[D][q]+F*R*O[D][q]}break}break;default:var E=[].concat(P[D]);I=[];q=L.paper.customAttributes[D].length;while(q--){I[q]=+E[q]+F*R*O[D][q]}break}K[D]=I}}L.attr(K);L._run&&L._run.call(L)}else{if(N.along){w=ag(N.along,N.len*!N.back);L.translate(O.sx-(O.x||0)+w.x-O.sx,O.sy-(O.y||0)+w.y-O.sy);N.rot&&L.rotate(O.r+w.alpha,w.x,w.y)}(M.x||M.y)&&L.translate(-M.x,-M.y);N.scale&&(N.scale+=aJ);L.attr(N);ae.splice(U--,1)}}a8.svg&&L&&L.paper&&L.paper.safari();ae[av]&&setTimeout(ad)},ac= function(a,m,l,k,j){var h=l-k;m.timeouts.push(setTimeout(function(){a8.is(j,"function")&&j.call(m);m.animate(a,h,a.easing)},k))},ab= function(b){return ao(dp(b,255),0)},aa= function(f,d){if(f==null){return{x:this._.tx,y:this._.ty,toString:al}}this._.tx+=+f;this._.ty+=+d;switch(this.type){case"circle":case"ellipse":this.attr({cx:+f+this.attrs.cx,cy:+d+this.attrs.cy});break;case"rect":case"image":case"text":this.attr({x:+f+this.attrs.x,y:+d+this.attrs.y});break;case"path":var g=b2(this.attrs.path);g[0][1]+=+f;g[0][2]+=+d;this.attr({path:g});break}return this};dt.animateWith= function(j,h,o,n,m){for(var l=0,k=ae.length;l<k;l++){ae[l].el.id==j.id&&(h.start=ae[l].start)}return this.animate(h,o,n,m)};dt.animateAlong=c1();dt.animateAlongBack=c1(1);function c1(a){return function(l,k,j,h){var b={back:a};a8.is(j,"function")?h=j:b.rot=j;l&&l.constructor==du&&(l=l.attrs.path);l&&(b.along=l);return this.animate(b,k,h)}}function cY(F,E,D,C,B,A){var z=3*E,y=3*(C-E)-z,w=1-z-y,u=3*D,t=3*(B-D)-u,s=1-u-t;function r(b){return((w*b+y)*b+z)*b}function q(f,d){var g=p(f,d);return((s*g+t)*g+u)*g}function p(h,g){var H,G,o,n,m,l;for(o=h,l=0;l<8;l++){n=r(o)-h;if(dm(n)<g){return o}m=(3*w*o+2*y)*o+z;if(dm(m)<0.000001){break}o=o-n/m}H=0;G=1;o=h;if(o<H){return H}if(o>G){return G}while(H<G){n=r(o);if(dm(n-h)<g){return o}h>n?H=o:G=o;o=(G-H)/2+H}return o}return q(F,1/(200*A))}dt.onAnimation= function(b){this._run=b||0;return this};dt.animate= function(bc,bb,ba,Z){var Y=this;Y.timeouts=Y.timeouts||[];if(a8.is(ba,"function")||!ba){Z=ba||null}if(Y.removed){Z&&Z.call(Y);return Y}var X={},W={},V=false,U={};for(var T in bc){if(bc[aY](T)){if(cF[aY](T)||Y.paper.customAttributes[aY](T)){V=true;X[T]=Y.attr(T);X[T]==null&&(X[T]=cH[T]);W[T]=bc[T];switch(cF[T]){case"along":var S=ah(bc[T]),R=ag(bc[T],S*!(!bc.back)),Q=Y.getBBox();U[T]=S/bb;U.tx=Q.x;U.ty=Q.y;U.sx=R.x;U.sy=R.y;W.rot=bc.rot;W.back=bc.back;W.len=S;bc.rot&&(U.r=cP(Y.rotate())||0);break;case dg:U[T]=(W[T]-X[T])/bb;break;case"colour":X[T]=a8.getRGB(X[T]);var O=a8.getRGB(W[T]);U[T]={r:(O.r-X[T].r)/bb,g:(O.g-X[T].g)/bb,b:(O.b-X[T].b)/bb};break;case"path":var K=aZ(X[T],W[T]);X[T]=K[0];var I=K[1];U[T]=[];for(var w=0,f=X[T][av];w<f;w++){U[T][w]=[0];for(var b=1,a=X[T][w][av];b<a;b++){U[T][w][b]=(I[w][b]-X[T][w][b])/bb}}break;case"csv":var P=aF(bc[T])[aD](a6),N=aF(X[T])[aD](a6);switch(T){case"translation":X[T]=[0,0];U[T]=[P[0]/bb,P[1]/bb];break;case"rotation":X[T]=N[1]==P[1]&&N[2]==P[2]?N:[0,P[1],P[2]];U[T]=[(P[0]-X[T][0])/bb,0,0];break;case"scale":bc[T]=P;X[T]=aF(X[T])[aD](a6);U[T]=[(P[0]-X[T][0])/bb,(P[1]-X[T][1])/bb,0,0];break;case"clip-rect":X[T]=aF(X[T])[aD](a6);U[T]=[];w=4;while(w--){U[T][w]=(P[w]-X[T][w])/bb}break}W[T]=P;break;default:P=[].concat(bc[T]);N=[].concat(X[T]);U[T]=[];w=Y.paper.customAttributes[T][av];while(w--){U[T][w]=((P[w]||0)-(N[w]||0))/bb}break}}}}if(V){var s=a8.easing_formulas[ba];if(!s){s=aF(ba).match(cX);if(s&&s[av]==5){var r=s;s= function(c){return cY(c,+r[1],+r[2],+r[3],+r[4],bb)}}else{s= function(c){return c}}}ae.push({start:bc.start||+(new Date),ms:bb,easing:s,from:X,diff:U,to:W,el:Y,t:{x:0,y:0}});a8.is(Z,"function")&&(Y._ac=setTimeout(function(){Z.call(Y)},bb));ae[av]==1&&setTimeout(ad)}else{var M=[],L;for(var E in bc){if(bc[aY](E)&&b7.test(E)){T={value:bc[E]};E=="from"&&(E=0);E=="to"&&(E=100);T.key=cN(E,10);M.push(T)}}M.sort(cO);M[0].key&&M.unshift({key:0,value:Y.attrs});for(w=0,f=M[av];w<f;w++){ac(M[w].value,Y,bb/100*M[w].key,bb/100*(M[w-1]&&M[w-1].key||0),M[w-1]&&M[w-1].value.callback)}L=M[M[av]-1].value.callback;L&&Y.timeouts.push(setTimeout(function(){L.call(Y)},bb))}return this};dt.stop= function(){for(var b=0;b<ae.length;b++){ae[b].el.id==this.id&&ae.splice(b--,1)}for(b=0,ii=this.timeouts&&this.timeouts.length;b<ii;b++){clearTimeout(this.timeouts[b])}this.timeouts=[];clearTimeout(this._ac);delete this._ac;return this};dt.translate= function(d,c){return this.attr({translation:d+" "+c})};dt[da]= function(){return"Rapha�l�s object"};a8.ae=ae;var cV= function(f){this.items=[];this[av]=0;this.type="set";if(f){for(var d=0,g=f[av];d<g;d++){if(f[d]&&(f[d].constructor==du||f[d].constructor==cV)){this[this.items[av]]=this.items[this.items[av]]=f[d];this[av]++}}}};cV[a0][c5]= function(){var g,f;for(var j=0,h=arguments[av];j<h;j++){g=arguments[j];if(g&&(g.constructor==du||g.constructor==cV)){f=this.items[av];this[f]=this.items[f]=g;this[av]++}}return this};cV[a0].pop= function(){delete this[this[av]--];return this.items.pop()};for(var cS in dt){dt[aY](cS)&&(cV[a0][cS]=(function(b){return function(){for(var a=0,d=this.items[av];a<d;a++){this.items[a][b][aO](this.items[a],arguments)}return this}})(cS))}cV[a0].attr= function(a,m){if(a&&a8.is(a,dc)&&a8.is(a[0],"object")){for(var l=0,k=a[av];l<k;l++){this.items[l].attr(a[l])}}else{for(var j=0,h=this.items[av];j<h;j++){this.items[j].attr(a,m)}}return this};cV[a0].animate= function(r,q,p,o){(a8.is(p,"function")||!p)&&(o=p||null);var n=this.items[av],m=n,l,k=this,a;o&&(a= function(){!(--n)&&o.call(k)});p=a8.is(p,de)?p:a;l=this.items[--m].animate(r,q,p,a);while(m--){this.items[m]&&!this.items[m].removed&&this.items[m].animateWith(l,r,q,p,a)}return this};cV[a0].insertAfter= function(d){var c=this.items[av];while(c--){this.items[c].insertAfter(d)}return this};cV[a0].getBBox= function(){var h=[],g=[],m=[],l=[];for(var k=this.items[av];k--;){var j=this.items[k].getBBox();h[c5](j.x);g[c5](j.y);m[c5](j.x+j.width);l[c5](j.y+j.height)}h=dp[aO](0,h);g=dp[aO](0,g);return{x:h,y:g,width:ao[aO](0,m)-h,height:ao[aO](0,l)-g}};cV[a0].clone= function(f){f=new cV;for(var d=0,g=this.items[av];d<g;d++){f[c5](this.items[d].clone())}return f};a8.registerFont= function(j){if(!j.face){return j}this.fonts=this.fonts||{};var f={w:j.w,face:{},glyphs:{}},o=j.face["font-family"];for(var n in j.face){j.face[aY](n)&&(f.face[n]=j.face[n])}this.fonts[o]?this.fonts[o][c5](f):this.fonts[o]=[f];if(!j.svg){f.face["units-per-em"]=cN(j.face["units-per-em"],10);for(var m in j.glyphs){if(j.glyphs[aY](m)){var l=j.glyphs[m];f.glyphs[m]={w:l.w,k:{},d:l.d&&"M"+l.d[b9](/[mlcxtrv]/g,function(b){return({l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"})[b]||"M"})+"z"};if(l.k){for(var k in l.k){l[aY](k)&&(f.glyphs[m].k[k]=l.k[k])}}}}}return j};aQ.getFont= function(t,s,r,q){q=q||"normal";r=r||"normal";s=+s||({normal:400,bold:700,lighter:300,bolder:800})[s]||400;if(!a8.fonts){return}var p=a8.fonts[t];if(!p){var o=new RegExp("(^|\\s)"+t[b9](/[^\w\d\s+!~.:_-]/g,aJ)+"(\\s|$)","i");for(var n in a8.fonts){if(a8.fonts[aY](n)){if(o.test(n)){p=a8.fonts[n];break}}}}var m;if(p){for(var f=0,a=p[av];f<a;f++){m=p[f];if(m.face["font-weight"]==s&&(m.face["font-style"]==r||!m.face["font-style"])&&m.face["font-stretch"]==q){break}}}return m};aQ.print= function(M,L,K,I,H,G,F){G=G||"middle";F=ao(dp(F||0,1),-1);var E=this.set(),D=aF(K)[aD](aJ),C=0,B=aJ,A;a8.is(I,K)&&(I=this.getFont(I));if(I){A=(H||16)/I.face["units-per-em"];var z=I.face.bbox.split(a6),w=+z[0],s=+z[1]+(G=="baseline"?z[3]-z[1]+ +I.face.descent:(z[3]-z[1])/2);for(var r=0,p=D[av];r<p;r++){var b=r&&I.glyphs[D[r-1]]||{},a=I.glyphs[D[r]];C+=r?(b.w||I.w)+(b.k&&b.k[D[r]]||0)+I.w*F:0;a&&a.d&&E[c5](this.path(a.d).attr({fill:"#000",stroke:"none",translation:[C,0]}))}E.scale(A,A,w,s).translate(M-w,L-s)}return E};a8.format= function(a,f){var d=a8.is(f,dc)?[0][aN](f):arguments;a&&a8.is(a,de)&&d[av]-1&&(a=a[b9](a2,function(g,c){return d[++c]==null?aJ:d[c]}));return a||aJ};a8.ninja= function(){aS.was?aU.Raphael=aS.is:delete Raphael;return a8};a8.el=dt;a8.st=cV[a0];aS.was?aU.Raphael=a8:Raphael=a8})();function SarissaMediaWikiContext(b,a){this.baseUrl=b;this.format="json";this.languages=a}SarissaMediaWikiContext.prototype.doArticleGet= function(b,a){Sarissa.setRemoteJsonCallback(this.baseUrl+"?action=parse&redirects&format="+this.format+"&page"+encodeURIComponent(b),a)};SarissaMediaWikiContext.prototype.doBacklinksGet= function(c,a,b){Sarissa.setRemoteJsonCallback(this.baseUrl+"?&generator=backlinks&format="+this.format+"&gbllimit="+a+"&gbltitle"+encodeURIComponent(c),b)};SarissaMediaWikiContext.prototype.doSearch= function(c,a,b){Sarissa.setRemoteJsonCallback(this.baseUrl+"?action=query&list=search&srsearch="+encodeURIComponent(c)+"&srwhat=text&srnamespace=0&format="+this.format+"&srlimit="+a,b)};SarissaMediaWikiContext.prototype.doCategorySearch= function(c,a,b){Sarissa.setRemoteJsonCallback(this.baseUrl+"?format="+this.format+"&list=categorymembers&action=query&cmlimit="+a+"&cmtitle=Category:"+encodeURIComponent(c),b)};SarissaMediaWikiContext.prototype.doArticleCategoriesGet= function(c,a,b){Sarissa.setRemoteJsonCallback(this.baseUrl+"?format="+this.format+"&action=query&prop=categories&titles="+encodeURIComponent(c),b)};Sarissa.sortHtmlTableData= function(q,h,s,r){var l=q.parentNode.parentNode;while(l.nodeName.toLowerCase()!="table"){l=l.parentNode}if(!l.id){l.id="SarissaTable"+(Sarissa.tableIdGenCount++)}var a=q.cellIndex;var o;if(!s&&Sarissa.tableDataCache[l.id]){o=Sarissa.tableDataCache[l.id]}else{o=this.getArrayFromTableData(l,null,null,"th");if(!s){Sarissa.tableDataCache[l.id]=o}}if(!Sarissa.tableColumnSortStates[l.id]){Sarissa.tableColumnSortStates[l.id]=[]}var f=[];for(var g=0;g<o.length;g++){f[g]=Sarissa.stripTags(o[g][a])+"_mbns_"+g}if(h){f.sort(h)}else{f.sort()}var b=Sarissa.tableColumnSortStates[l.id][a];if(b!="asc"){Sarissa.tableColumnSortStates[l.id][a]="asc"}else{f.reverse();Sarissa.tableColumnSortStates[l.id][a]="desc"}var p=[];for(var d=0;d<o.length;d++){var n=f[d];var m=n.substring(n.indexOf("_mbns_")+6,n.length);p[d]=[];for(var c=0;c<o[d].length;c++){p[d][c]=o[m][c]}}this.updateTableData(l,p,null,null,"th");if(r){r(l,a)}};Sarissa.tableIdGenCount=0;Sarissa.tableColumnSortStates=[];Sarissa.tableDataCache=[];Sarissa.tableDataCacheSize=0;Sarissa.tableDataCacheMaxSize=5;Sarissa.tableDataCachePut= function(b,a){if(Sarissa.tableDataCacheSize.length>=Sarissa.tableDataCacheMaxSize){Sarissa.tableDataCache.shift();Sarissa.tableDataCacheSize--}Sarissa.tableDataCache[b]=a;Sarissa.tableDataCacheSize++};Sarissa.tableDataCacheMoveColumn= function(a,d,b){var k=Sarissa.tableDataCache[a];var l=[];var g,h,m;for(var f=0;f<k.length;f++){g=k[f];h=g.splice(d,1);m=[];for(var c=0;c<oldArr.length;J++){if(c==b){m.put(h)}m.put(g[c])}l[f]=m}Sarissa.tableDataCache[a]=l};Sarissa.SORT_IGNORE_CASE= function(f,c){var g=f.toLowerCase(),d=c.toLowerCase();if(g<d){return -1}else{if(g>d){return 1}else{return 0}}};Sarissa.SORT_DATE_US= function(d,c){var g=new Date(d.substring(0,d.lastIndexOf("_mbns_"))),f=new Date(c.substring(0,c.lastIndexOf("_mbns_")));if(g<f){return -1}else{if(g>f){return 1}else{return 0}}};Sarissa.SORT_DATE_EU= function(f,c){var g=f.substring(0,f.lastIndexOf("_mbns_")).split("/"),d=c.substring(0,c.lastIndexOf("_mbns_")).split("/"),j=new Date(g[2],g[1],g[0]),h=new Date(d[2],d[1],d[0]);if(j<h){return -1}else{if(j>h){return 1}else{return 0}}};Sarissa.getArrayFromTableData= function(n,h,f,d,l){if(!h){h="tr"}if(!f){f="td"}if(!d){d="th"}var p=n.getElementsByTagName(h);var g=[];for(var c=0,b=0;c<p.length;c++){var o=p[c];if((!d)||o.getElementsByTagName(d).length==0){g[b]=[];var m=o.getElementsByTagName(f);for(var a=0;a<m.length;a++){g[b][a]=l?Sarissa.stripTags(m[a].innerHTML):m[a].innerHTML}b++}}return g};Sarissa.updateTableData= function(l,o,g,f,d){if(!g){g="tr"}if(!f){f="td"}var n=l.getElementsByTagName(g);for(var c=0,b=0;c<o.length&&b<n.length;b++){var m=n[b];if((!d)||m.getElementsByTagName(d).length==0){var h=m.getElementsByTagName(f);for(var a=0;a<h.length;a++){h[a].innerHTML=o[c][a]}c++}}};function Sarissa(){}Sarissa.VERSION="0.9.9.5";Sarissa.PARSED_OK="Document contains no parsing errors";Sarissa.PARSED_EMPTY="Document is empty";Sarissa.PARSED_UNKNOWN_ERROR="Not well-formed or other error";Sarissa.IS_ENABLED_TRANSFORM_NODE=false;Sarissa.REMOTE_CALL_FLAG="gr.abiss.sarissa.REMOTE_CALL_FLAG";Sarissa._lastUniqueSuffix=0;Sarissa._getUniqueSuffix= function(){return Sarissa._lastUniqueSuffix++};Sarissa._SARISSA_IEPREFIX4XSLPARAM="";Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION=document.implementation&&true;Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.createDocument;Sarissa._SARISSA_HAS_DOM_FEATURE=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.hasFeature;Sarissa._SARISSA_IS_MOZ=Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT&&Sarissa._SARISSA_HAS_DOM_FEATURE;Sarissa._SARISSA_IS_SAFARI=navigator.userAgent.toLowerCase().indexOf("safari")!=-1||navigator.userAgent.toLowerCase().indexOf("konqueror")!=-1;Sarissa._SARISSA_IS_SAFARI_OLD=Sarissa._SARISSA_IS_SAFARI&&(parseInt((navigator.userAgent.match(/AppleWebKit\/(\d+)/)||{})[1],10)<420);Sarissa._SARISSA_IS_IE=document.all&&window.ActiveXObject&&navigator.userAgent.toLowerCase().indexOf("msie")>-1&&navigator.userAgent.toLowerCase().indexOf("opera")==-1;Sarissa._SARISSA_IS_OPERA=navigator.userAgent.toLowerCase().indexOf("opera")!=-1;if(!window.Node||!Node.ELEMENT_NODE){Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}}if(Sarissa._SARISSA_IS_SAFARI_OLD){HTMLHtmlElement=document.createElement("html").constructor;Node=HTMLElement={};HTMLElement.prototype=HTMLHtmlElement.__proto__.__proto__;HTMLDocument=Document=document.constructor;var x=new DOMParser();XMLDocument=x.constructor;Element=x.parseFromString("<Single />","text/xml").documentElement.constructor;x=null}if(typeof XMLDocument=="undefined"&&typeof Document!="undefined"){XMLDocument=Document}if(Sarissa._SARISSA_IS_IE){Sarissa._SARISSA_IEPREFIX4XSLPARAM="xsl:";var _SARISSA_DOM_PROGID="";var _SARISSA_XMLHTTP_PROGID="";var _SARISSA_DOM_XMLWRITER="";Sarissa.pickRecentProgID= function(f){var d=false,h;var g;for(var b=0;b<f.length&&!d;b++){try{var a=new ActiveXObject(f[b]);g=f[b];d=true}catch(c){h=c}}if(!d){throw"Could not retrieve a valid progID of Class: "+f[f.length-1]+". (original exception: "+h+")"}f=null;return g};_SARISSA_DOM_PROGID=null;_SARISSA_THREADEDDOM_PROGID=null;_SARISSA_XSLTEMPLATE_PROGID=null;_SARISSA_XMLHTTP_PROGID=null;XMLHttpRequest= function(){if(!_SARISSA_XMLHTTP_PROGID){_SARISSA_XMLHTTP_PROGID=Sarissa.pickRecentProgID(["Msxml2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"])}return new ActiveXObject(_SARISSA_XMLHTTP_PROGID)};Sarissa.getDomDocument= function(f,d){if(!_SARISSA_DOM_PROGID){try{_SARISSA_DOM_PROGID=Sarissa.pickRecentProgID(["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"])}catch(c){_SARISSA_DOM_PROGID="noActiveX"}}var a=_SARISSA_DOM_PROGID=="noActiveX"?document.createElement("xml"):new ActiveXObject(_SARISSA_DOM_PROGID);try{a.validateOnParse=false;a.resolveExternals="false";a.setProperty("ProhibitDTD",false)}catch(c){}if(d){var b="";if(f){if(d.indexOf(":")>1){b=d.substring(0,d.indexOf(":"));d=d.substring(d.indexOf(":")+1)}else{b="a"+Sarissa._getUniqueSuffix()}}if(f){a.loadXML("<"+b+":"+d+" xmlns:"+b+'="'+f+'" />')}else{a.loadXML("<"+d+" />")}}return a};Sarissa.getParseErrorText= function(a){var c=Sarissa.PARSED_OK;if(a&&a.parseError&&a.parseError.errorCode&&a.parseError.errorCode!=0){c="XML Parsing Error: "+a.parseError.reason+"\nLocation: "+a.parseError.url+"\nLine Number "+a.parseError.line+", Column "+a.parseError.linepos+":\n"+a.parseError.srcText+"\n";for(var b=0;b<a.parseError.linepos;b++){c+="-"}c+="^\n"}else{if(a.documentElement===null){c=Sarissa.PARSED_EMPTY}}return c};Sarissa.setXpathNamespaces= function(a,b){a.setProperty("SelectionLanguage","XPath");a.setProperty("SelectionNamespaces",b)};XSLTProcessor= function(){if(!_SARISSA_XSLTEMPLATE_PROGID){_SARISSA_XSLTEMPLATE_PROGID=Sarissa.pickRecentProgID(["Msxml2.XSLTemplate.6.0","MSXML2.XSLTemplate.3.0"])}this.template=new ActiveXObject(_SARISSA_XSLTEMPLATE_PROGID);this.processor=null};XSLTProcessor.prototype.importStylesheet= function(d){if(!_SARISSA_THREADEDDOM_PROGID){_SARISSA_THREADEDDOM_PROGID=Sarissa.pickRecentProgID(["MSXML2.FreeThreadedDOMDocument.6.0","MSXML2.FreeThreadedDOMDocument.3.0"])}d.setProperty("SelectionLanguage","XPath");d.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var c=new ActiveXObject(_SARISSA_THREADEDDOM_PROGID);try{c.resolveExternals=true;c.setProperty("AllowDocumentFunction",true);c.setProperty("AllowXsltScript",true)}catch(b){}if(d.url&&d.selectSingleNode("//xsl:*[local-name() = 'import' or local-name() = 'include']")!=null){c.async=false;c.load(d.url)}else{c.loadXML(d.xml)}c.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var a=c.selectSingleNode("//xsl:output");if(a){this.outputMethod=a.getAttribute("method")}else{delete this.outputMethod}this.template.stylesheet=c;this.processor=this.template.createProcessor();this.paramsSet=[]};XSLTProcessor.prototype.transformToDocument= function(c){var b;if(_SARISSA_THREADEDDOM_PROGID){this.processor.input=c;b=new ActiveXObject(_SARISSA_DOM_PROGID);this.processor.output=b;this.processor.transform();return b}else{if(!_SARISSA_DOM_XMLWRITER){_SARISSA_DOM_XMLWRITER=Sarissa.pickRecentProgID(["Msxml2.MXXMLWriter.6.0","Msxml2.MXXMLWriter.3.0","MSXML2.MXXMLWriter","MSXML.MXXMLWriter","Microsoft.XMLDOM"])}this.processor.input=c;b=new ActiveXObject(_SARISSA_DOM_XMLWRITER);this.processor.output=b;this.processor.transform();var a=new ActiveXObject(_SARISSA_DOM_PROGID);a.loadXML(b.output+"");return a}};XSLTProcessor.prototype.transformToFragment= function(j,d){this.processor.input=j;this.processor.transform();var g=this.processor.output;var h=d.createDocumentFragment();var b;if(this.outputMethod=="text"){h.appendChild(d.createTextNode(g))}else{if(d.body&&d.body.innerHTML){b=d.createElement("div");b.innerHTML=g;while(b.hasChildNodes()){h.appendChild(b.firstChild)}}else{var a=new ActiveXObject(_SARISSA_DOM_PROGID);if(g.substring(0,5)=="<?xml"){g=g.substring(g.indexOf("?>")+2)}var c="".concat("<my>",g,"</my>");a.loadXML(c);b=a.documentElement;while(b.hasChildNodes()){h.appendChild(b.firstChild)}}}return h};XSLTProcessor.prototype.setParameter= function(c,a,b){b=b?b:"";if(c){this.processor.addParameter(a,b,c)}else{this.processor.addParameter(a,b)}c=""+(c||"");if(!this.paramsSet[c]){this.paramsSet[c]=[]}this.paramsSet[c][a]=b};XSLTProcessor.prototype.getParameter= function(b,a){b=""+(b||"");if(this.paramsSet[b]&&this.paramsSet[b][a]){return this.paramsSet[b][a]}else{return null}};XSLTProcessor.prototype.clearParameters= function(){for(var b in this.paramsSet){for(var a in this.paramsSet[b]){if(b!=""){this.processor.addParameter(a,"",b)}else{this.processor.addParameter(a,"")}}}this.paramsSet=[]}}else{if(Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT){Sarissa.__handleLoad__= function(a){Sarissa.__setReadyState__(a,4)};_sarissa_XMLDocument_onload= function(){Sarissa.__handleLoad__(this)};Sarissa.__setReadyState__= function(a,b){a.readyState=b;a.readystate=b;if(a.onreadystatechange!=null&&typeof a.onreadystatechange=="function"){a.onreadystatechange()}};Sarissa.getDomDocument= function(c,b){var a=document.implementation.createDocument(c?c:null,b?b:null,null);if(!a.onreadystatechange){a.onreadystatechange=null}if(!a.readyState){a.readyState=0}a.addEventListener("load",_sarissa_XMLDocument_onload,false);return a};if(window.XMLDocument){}else{if(Sarissa._SARISSA_HAS_DOM_FEATURE&&window.Document&&!Document.prototype.load&&document.implementation.hasFeature("LS","3.0")){Sarissa.getDomDocument= function(c,b){var a=document.implementation.createDocument(c?c:null,b?b:null,null);return a}}else{Sarissa.getDomDocument= function(c,b){var a=document.implementation.createDocument(c?c:null,b?b:null,null);if(a&&(c||b)&&!a.documentElement){a.appendChild(a.createElementNS(c,b))}return a}}}}}if(!window.DOMParser){if(Sarissa._SARISSA_IS_SAFARI){DOMParser= function(){};DOMParser.prototype.parseFromString= function(b,c){var a=new XMLHttpRequest();a.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(b),false);a.send(null);return a.responseXML}}else{if(Sarissa.getDomDocument&&Sarissa.getDomDocument()&&Sarissa.getDomDocument(null,"bar").xml){DOMParser= function(){};DOMParser.prototype.parseFromString= function(a,d){var c=Sarissa.getDomDocument();try{c.validateOnParse=false;c.setProperty("ProhibitDTD",false)}catch(b){}c.loadXML(a);return c}}}}if((typeof(document.importNode)=="undefined")&&Sarissa._SARISSA_IS_IE){try{document.importNode= function(c,b){var a;if(c.nodeName=="#text"){return document.createTextNode(c.data)}else{if(c.nodeName=="tbody"||c.nodeName=="tr"){a=document.createElement("table")}else{if(c.nodeName=="td"){a=document.createElement("tr")}else{if(c.nodeName=="option"){a=document.createElement("select")}else{a=document.createElement("div")}}}if(b){a.innerHTML=c.xml?c.xml:c.outerHTML}else{a.innerHTML=c.xml?c.cloneNode(false).xml:c.cloneNode(false).outerHTML}return a.getElementsByTagName("*")[0]}}}catch(e){}}if(!Sarissa.getParseErrorText){Sarissa.getParseErrorText= function(a){var c=Sarissa.PARSED_OK;if((!a)||(!a.documentElement)){c=Sarissa.PARSED_EMPTY}else{if(a.documentElement.tagName=="parsererror"){c=a.documentElement.firstChild.data;c+="\n"+a.documentElement.firstChild.nextSibling.firstChild.data}else{if(a.getElementsByTagName("parsererror").length>0){var b=a.getElementsByTagName("parsererror")[0];c=Sarissa.getText(b,true)+"\n"}else{if(a.parseError&&a.parseError.errorCode!=0){c=Sarissa.PARSED_UNKNOWN_ERROR}}}}return c}}Sarissa.getText= function(h,b){var f="";var c=h.childNodes;if(h.nodeType==Node.ATTRIBUTE_NODE&&c.length==0){return h.value}for(var d=0;d<c.length;d++){var g=c[d];var a=g.nodeType;if(a==Node.TEXT_NODE||a==Node.CDATA_SECTION_NODE){f+=g.data}else{if(b===true&&(a==Node.ELEMENT_NODE||a==Node.DOCUMENT_NODE||a==Node.DOCUMENT_FRAGMENT_NODE)){f+=Sarissa.getText(g,true)}}}return f};if(!window.XMLSerializer&&Sarissa.getDomDocument&&Sarissa.getDomDocument("","foo",null).xml){XMLSerializer= function(){};XMLSerializer.prototype.serializeToString= function(a){return a.xml}}Sarissa.stripTags= function(a){return a?a.replace(/<[^>]+>/g,""):a};Sarissa.clearChildNodes= function(a){while(a.firstChild){a.removeChild(a.firstChild)}};Sarissa.copyChildNodes= function(d,f,g){if(Sarissa._SARISSA_IS_SAFARI&&f.nodeType==Node.DOCUMENT_NODE){f=f.documentElement}if((!d)||(!f)){throw"Both source and destination nodes must be provided"}if(!g){Sarissa.clearChildNodes(f)}var b=f.nodeType==Node.DOCUMENT_NODE?f:f.ownerDocument;var a=d.childNodes;var c;if(typeof(b.importNode)!="undefined"){for(c=0;c<a.length;c++){f.appendChild(b.importNode(a[c],true))}}else{for(c=0;c<a.length;c++){f.appendChild(a[c].cloneNode(true))}}};Sarissa.moveChildNodes= function(d,f,g){if((!d)||(!f)){throw"Both source and destination nodes must be provided"}if(!g){Sarissa.clearChildNodes(f)}var a=d.childNodes;if(d.ownerDocument==f.ownerDocument){while(d.firstChild){f.appendChild(d.firstChild)}}else{var b=f.nodeType==Node.DOCUMENT_NODE?f:f.ownerDocument;var c;if(typeof(b.importNode)!="undefined"){for(c=0;c<a.length;c++){f.appendChild(b.importNode(a[c],true))}}else{for(c=0;c<a.length;c++){f.appendChild(a[c].cloneNode(true))}}Sarissa.clearChildNodes(d)}};Sarissa.xmlize= function(g,j,d,f){d=d?d:"";var h=d+"<"+j+">";var b=false;if(!(g instanceof Object)||g instanceof Number||g instanceof String||g instanceof Boolean||g instanceof Date){h+=(f?Sarissa.escape(g):g);b=true}else{h+="\n";var a=g instanceof Array;for(var c in g){if(g[c] instanceof Function){continue}h+=Sarissa.xmlize(g[c],(a?'array-item key="'+c+'"':c),d+" ")}h+=d}return(h+=(j.indexOf(" ")!=-1?"</array-item>\n":"</"+j+">\n"))};Sarissa.escape= function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};Sarissa.unescape= function(a){return a.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")};Sarissa.updateCursor= function(b,a){if(b&&b.style&&b.style.cursor!=undefined){b.style.cursor=a}};Sarissa.updateContentFromURI= function(c,j,a,h,f){try{Sarissa.updateCursor(j,"wait");var b=new XMLHttpRequest();b.open("GET",c,true);b.onreadystatechange= function(){if(b.readyState==4){try{var k=b.responseXML;if(k&&Sarissa.getParseErrorText(k)==Sarissa.PARSED_OK){Sarissa.updateContentFromNode(b.responseXML,j,a);if(h){h(c,j)}}else{throw Sarissa.getParseErrorText(k)}}catch(l){if(h){h(c,j,l)}else{throw l}}}};if(f){var g="Sat, 1 Jan 2000 00:00:00 GMT";b.setRequestHeader("If-Modified-Since",g)}b.send("")}catch(d){Sarissa.updateCursor(j,"auto");if(h){h(c,j,d)}else{throw d}}};Sarissa.updateContentFromNode= function(f,g,a){try{Sarissa.updateCursor(g,"wait");Sarissa.clearChildNodes(g);var b=f.nodeType==Node.DOCUMENT_NODE?f:f.ownerDocument;if(b.parseError&&b.parseError.errorCode!=0){var d=document.createElement("pre");d.appendChild(document.createTextNode(Sarissa.getParseErrorText(b)));g.appendChild(d)}else{if(a){f=a.transformToDocument(f)}if(g.tagName.toLowerCase()=="textarea"||g.tagName.toLowerCase()=="input"){g.value=new XMLSerializer().serializeToString(f)}else{try{g.appendChild(g.ownerDocument.importNode(f,true))}catch(c){g.innerHTML=new XMLSerializer().serializeToString(f)}}}}catch(c){throw c}finally{Sarissa.updateCursor(g,"auto")}};Sarissa.formToQueryString= function(h){var a="";for(var g=0;g<h.elements.length;g++){var f=h.elements[g];var d=f.getAttribute("name")?f.getAttribute("name"):f.getAttribute("id");if(d&&((!f.disabled)||f.type=="hidden")){switch(f.type){case"hidden":case"text":case"textarea":case"password":a+=d+"="+encodeURIComponent(f.value)+"&";break;case"select-one":a+=d+"="+encodeURIComponent(f.options[f.selectedIndex].value)+"&";break;case"select-multiple":for(var c=0;c<f.length;c++){var b=f.options[c];if(b.selected===true){a+=d+"[]="+encodeURIComponent(b.value)+"&"}}break;case"checkbox":case"radio":if(f.checked){a+=d+"="+encodeURIComponent(f.value)+"&"}break}}}return a.substr(0,a.length-1)};Sarissa.updateContentFromForm= function(g,j,a,h){try{Sarissa.updateCursor(j,"wait");var f=Sarissa.formToQueryString(g)+"&"+Sarissa.REMOTE_CALL_FLAG+"=true";var b=new XMLHttpRequest();var c=g.getAttribute("method")&&g.getAttribute("method").toLowerCase()=="get";if(c){b.open("GET",g.getAttribute("action")+"?"+f,true)}else{b.open("POST",g.getAttribute("action"),true);b.setRequestHeader("Content-type","application/x-www-form-urlencoded");b.setRequestHeader("Content-length",f.length);b.setRequestHeader("Connection","close")}b.onreadystatechange= function(){try{if(b.readyState==4){var k=b.responseXML;if(k&&Sarissa.getParseErrorText(k)==Sarissa.PARSED_OK){Sarissa.updateContentFromNode(b.responseXML,j,a);if(h){h(g,j)}}else{throw Sarissa.getParseErrorText(k)}}}catch(l){if(h){h(g,j,l)}else{throw l}}};b.send(c?"":f)}catch(d){Sarissa.updateCursor(j,"auto");if(h){h(g,j,d)}else{throw d}}return false};Sarissa.getFunctionName= function(c){if(!c||(typeof c!="function")){throw"The value of parameter 'oFunc' must be a function"}if(c.name){return c.name}var a=c.toString();alert("sFunc: "+a);var b=a.substring(a.indexOf("function")+8,a.indexOf("("));if(!b||b.length==0||b==" "){b="SarissaAnonymous"+Sarissa._getUniqueSuffix();window[b]=c}return b};Sarissa.setRemoteJsonCallback= function(a,h,b){if(!b){b="callback"}var g=Sarissa.getFunctionName(h);var f="sarissa_json_script_id_"+Sarissa._getUniqueSuffix();var d=document.getElementsByTagName("head")[0];var c=document.createElement("script");c.type="text/javascript";c.id=f;c.onload= function(){};if(a.indexOf("?")!=-1){a+=("&"+b+"="+g)}else{a+=("?"+b+"="+g)}c.src=a;d.appendChild(c);return f};var _XMLSerializer=new XMLSerializer();Sarissa.serialize= function(a){return _XMLSerializer.serializeToString(a)};if(Sarissa._SARISSA_HAS_DOM_FEATURE&&document.implementation.hasFeature("XPath","3.0")){SarissaNodeList= function(a){this.length=a};SarissaNodeList.prototype=[];SarissaNodeList.prototype.constructor=Array;SarissaNodeList.prototype.item= function(a){return(a<0||a>=this.length)?null:this[a]};SarissaNodeList.prototype.expr="";if(window.XMLDocument&&(!XMLDocument.prototype.setProperty)){XMLDocument.prototype.setProperty= function(a,b){}}Sarissa.setXpathNamespaces= function(h,c){h._sarissa_useCustomResolver=true;var a=c.indexOf(" ")>-1?c.split(" "):[c];h._sarissa_xpathNamespaces=[];for(var d=0;d<a.length;d++){var g=a[d];var j=g.indexOf(":");var k=g.indexOf("=");if(j>0&&k>j+1){var f=g.substring(j+1,k);var b=g.substring(k+2,g.length-1);h._sarissa_xpathNamespaces[f]=b}else{throw"Bad format on namespace declaration(s) given"}}};XMLDocument.prototype._sarissa_useCustomResolver=false;XMLDocument.prototype._sarissa_xpathNamespaces=[];XMLDocument.prototype.selectNodes= function(c,h,a){var f=this;var b;if(this._sarissa_useCustomResolver){b= function(m){var l=f._sarissa_xpathNamespaces[m];if(l){return l}else{throw"No namespace URI found for prefix: '"+m+"'"}}}else{b=this.createNSResolver(this.documentElement)}var k=null;if(!a){var j=this.evaluate(c,(h?h:this),b,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var d=new SarissaNodeList(j.snapshotLength);d.expr=c;for(var g=0;g<d.length;g++){d[g]=j.snapshotItem(g)}k=d}else{k=this.evaluate(c,(h?h:this),b,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}return k};Element.prototype.selectNodes= function(a){var b=this.ownerDocument;if(b.selectNodes){return b.selectNodes(a,this)}else{throw"Method selectNodes is only supported by XML Elements"}};XMLDocument.prototype.selectSingleNode= function(c,b){var a=b?b:null;return this.selectNodes(c,a,true)};Element.prototype.selectSingleNode= function(a){var b=this.ownerDocument;if(b.selectSingleNode){return b.selectSingleNode(a,this)}else{throw"Method selectNodes is only supported by XML Elements"}};Sarissa.IS_ENABLED_SELECT_NODES=true}var deCarta={};function GLOBALS(){}GLOBALS.HYBRID="HYBRID";GLOBALS.STREET="STREET";GLOBALS.SATELLITE="SATELLITE";GLOBALS.PAN_PIXEL_DISTANCE=300;GLOBALS.DEFAULT_MAP_TILE_SIZE=256;GLOBALS.DEFAULT_MAP_WIDTH="800px";GLOBALS.DEFAULT_MAP_HEIGHT="500px";GLOBALS.API_VERSION="4.5.2";GLOBALS.API_BUILD="$LastChangedRevision: 68808 $";GLOBALS.API_RELEASECLASS="RELEASE";GLOBALS.ALLOWDOMEVENTS=true;GLOBALS.DEBUG_JSON=false;GLOBALS.TILE_SESSION_ID=Math.round(Math.random()*100000);function Credentials(){}Credentials.url="http://ws.decarta.com/openls/openls";Credentials.jsonServletName="JSON";Credentials.clientName="";Credentials.clientPassword="";Credentials.configuration="old-english-tile";Credentials.transparentConfiguration="transparent-tile";Credentials.mapType="STREET";Credentials.ISOCountryCode="US";Credentials.trafficEnabled=false;Credentials.rel="4.5.2";Credentials.dgkey="";Credentials.imgPath="img/";Credentials.errorTile=Credentials.imgPath+"tile.png";Credentials.transparentPNG=Credentials.imgPath+"tile.png";Credentials.transparentGIF=Credentials.imgPath+"x.gif";Credentials.infoWindowCloseButton=Credentials.imgPath+"close.png";Credentials.pinIconPath=Credentials.imgPath+"greenDot.png";Credentials.zoomUnselectedIconPath=Credentials.imgPath+"zoom.png";Credentials.zoomSelectedIconPath=Credentials.imgPath+"zoomChecked.png";Credentials.zoomOutIconPath=Credentials.imgPath+"zoomBottom.png";Credentials.zoomInIconPath=Credentials.imgPath+"zoomTop.png";deCarta.AJAXContentLoader={};deCarta.AJAXContentLoader.load= function(b,g,a){if(a&&a.mode=="iframe"){var c=document.createElement("iframe");c.style.width=a.height||"0px";c.style.height=a.width||"0px";c.style.border="0px";c.src=b;if(typeof(g)=="function"){c.onload=g}a.dom.appendChild(c)}else{if(!Utilities.ie){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalPreferencesWrite UniversalBrowserWrite UniversalPreferencesRead UniversalBrowserRead")}catch(d){}}var f=new XMLHttpRequest();f.open("GET",b,true);f.onreadystatechange= function(){if(f.readyState==4){if(f.status==200){g(f.responseText)}else{g(f.responseText)}}};f.send(null)}};function AbstractSearchCriteria(){this.queryString="";this.maximumResponses=10;this.database=null;this.sortDirection="Ascending";this.sortCriteria="Distance";this.rankCriteria=null;this.allowAggregates=false;this.retrieveAll=false;this.properties={};this.defaultUOM=null}deCarta.AdManager={url:"http://mobile-dev.decarta.com/adproxies/AdController",callbacks:[],scriptCounter:0,scriptTagId:"deCartaAdScript",requestAds:function(g,j,h){var c=deCarta.AdManager.scriptCounter++;var d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("id",deCarta.AdManager.scriptTagId+c);var k="?DECARTAADID="+c;var a="&ADPROVIDER="+g;deCarta.AdManager.callbacks[c]=h;var f=deCarta.AdManager.url+k+a;for(var b in j){if(j.hasOwnProperty(b)){f+="&"+b+"="+escape(j[b])}}d.setAttribute("src",f);document.getElementsByTagName("head").item(0).appendChild(d);deCarta.AdManager.scriptObj=d},callback:function(b){var c=parseInt(b.DECARTAADID);var a=document.getElementById(deCarta.AdManager.scriptTagId+c);if(a){document.getElementsByTagName("head").item(0).removeChild(a)}deCarta.AdManager.callbacks[c](b)}};function Address(f,j,c,b,h,g,d,a){if(f||f==0){this.buildingNumber=f}else{this.buildingNumber=""}this.landmark="";this.street=j||"";this.streetNameAndNumber="";this.speedLimit="";this.countryCode="";this.countrySubdivision=c||"";this.countrySecondarySubdivision=b||"";this.countryTertiarySubdivision="";this.municipality=h||"";this.postalCode=g||"";this.municipalitySubdivision=d||"";this.locale=a||new Locale("en","US");this.type="Structured"}Address.prototype.getBuildingNumber= function(){return this.buildingNumber};Address.prototype.setBuildingNumber= function(a){this.buildingNumber=a};Address.prototype.getStreet= function(){return this.street};Address.prototype.setStreet= function(a){this.street=a};Address.prototype.getCountrySubdivision= function(){return this.countrySubdivision};Address.prototype.setCountrySubdivision= function(a){this.countrySubdivision=a};Address.prototype.getCountrySecondarySubdivision= function(){return this.countrySecondarySubdivision};Address.prototype.setCountrySecondarySubdivision= function(a){this.countrySecondarySubdivision=a};Address.prototype.getMunicipality= function(){return this.municipality};Address.prototype.setMunicipality= function(a){this.municipality=a};Address.prototype.getMunicipalitySubdivision= function(){return this.municipalitySubdivision};Address.prototype.setMunicipalitySubdivision= function(a){this.municipalitySubdivision=a};Address.prototype.getPostalCode= function(){return this.postalCode};Address.prototype.setPostalCode= function(a){this.postalCode=a};Address.prototype.getLocale= function(){return this.locale};Address.prototype.setLocale= function(a){this.locale=a};Address.prototype.toString= function(){var a="";if(this.buildingNumber!=""){a+=this.buildingNumber+" "}if(this.street!=""){a+=this.street+" "}if(this.municipality!=""){a+=this.municipality+" "}if(this.countrySubdivision!=""){a+=this.countrySubdivision+" "}if(this.postalCode!=""){a+=this.postalCode}return a};deCarta.Animator= function(){};deCarta.Animator.prototype.objsToAnimate=null;deCarta.Animator.prototype.objsType=null;deCarta.Animator.prototype.scopeObj=null;deCarta.Animator.prototype.onendCallback=null;deCarta.Animator.prototype.animation=null;deCarta.Animator.prototype.animationId=null;deCarta.Animator.prototype.setObjsToAnimate= function(a){if(!deCarta.Array.isArray(a)){a=[a]}var b;var g=a[0].type;var f=["pin"];var c=f.length;for(b=0;b<c;b++){if(g==f[b]){break}}if(b>=c){throw new Exception("requesting to animate invalid object type: "+this.objsType)}var d=a.length;for(b=0;b<d;b++){if(a[b].type!=g){throw new Exception("obj index: "+b+" is of invalid type: "+a[b].type)}}this.objsType=g;this.objsToAnimate=a};deCarta.Animator.prototype.setScopeObj= function(a){this.scopeObj=a};deCarta.Animator.prototype.setOnendCallback= function(a){if(typeof a!="function"){throw new Exception("deCarta.Animator.setOnendCallback: callback not a function")}this.onendCallback=a};deCarta.Animator.prototype.setAnimation= function(a){};deCarta.Array={};deCarta.Array.isArray= function(a){return Object.prototype.toString.call(a)==="[object Array]"};deCarta.Array.indexOf= function(d,a,c){var b=d.length;c=(!c||isNaN(c))?0:c;c=(c<=0)?0:c;c=(c>=b-1)?b-1:c;for(;c<b;c++){if(d[c]===a){return c}}return -1};function BoundingBox(b,a){if(!(b&&(b.lat||b.lat==0)&&(b.lon||b.lon==0))||!(a&&(a.lat||a.lat==0)&&(a.lon||a.lon==0))){throw new Exception("Error instantiating BoundingBox, invalid parameters: "+b+a)}if(b.lat>a.lat){throw new Exception("Error instantiating BoundingBox, minPos.lat should <= maxPos.lat")}this.minPosition=new Position(b.lat,b.lon);this.maxPosition=new Position(a.lat,a.lon);this.getHeightInDegrees= function(){return this.maxPosition.lat-this.minPosition.lat};this.getWidthInDegrees= function(){if(this.minPosition.lon>this.maxPosition.lon){return(this.maxPosition.lon-this.minPosition.lon)+360}else{return(this.maxPosition.lon-this.minPosition.lon)}};this.getUpperLeftPosition= function(){var c=new Position(this.maxPosition.lat,this.minPosition.lon);return c};this.getLowerRightPosition= function(){var c=new Position(this.minPosition.lat,this.maxPosition.lon);return c};this.getMaxPosition= function(){return this.maxPosition};this.setMaxPosition= function(c){if(this.minPosition.lat>c.lat){throw new Exception("Error setting maxPosition, minPos.lat should <= maxPos.lat")}this.maxPosition=new Position(c.lat,c.lon)};this.getMinPosition= function(){return this.minPosition};this.setMinPosition= function(c){if(c.lat>this.maxPosition.lat){throw new Exception("Error setting minPosition, minPos.lat should <= maxPos.lat")}this.minPosition=new Position(c.lat,c.lon)};this.getCenterPosition= function(){var d=parseFloat(this.maxPosition.lat-((this.maxPosition.lat-this.minPosition.lat)/2));var c=parseFloat(this.maxPosition.lon-((this.maxPosition.lon-this.minPosition.lon)/2));if(this.maxPosition.lon<this.minPosition.lon){c=c+180}return new Position(d,c)};this.getRadius= function(){if(this.getHeightInDegrees()>this.getWidthInDegrees()){return(this.getHeightInDegrees()*111.111)/2}else{return(this.getWidthInDegrees()*111.111)/2}};this.contains= function(f){var d=this.maxPosition.lon;var c=f.lon;if(this.minPosition.lon>0&&this.maxPosition.lon<this.minPosition.lon){d=d+360;if(f.lon<this.minPosition.lon){c=c+360}}if(this.minPosition.lon<0&&this.maxPosition.lon<this.minPosition.lon){d=d+360;if(f.lon<this.minPosition.lon){c=c+360}}if(f.lat>=this.minPosition.lat&&c>=this.minPosition.lon&&f.lat<=this.maxPosition.lat&&c<=d){return true}else{return false}};this.containsBoundingBox= function(h){if(!h){return true}var c=new Position(h.maxPosition.lat,h.minPosition.lon);var f=h.minPosition;var d=h.maxPosition;var g=new Position(h.minPosition.lat,h.maxPosition.lon);if(this.contains(c)&&this.contains(f)&&this.contains(d)&&this.contains(g)){if(new BoundingBox(this.minPosition,d).contains(f)){return true}}return false};this.getOverlapBoundingBox= function(o){var f=this.minPosition;var l=this.maxPosition;var n=o.minPosition;var m=o.maxPosition;if(f.lat>=m.lat||n.lat>=l.lat){return null}var d=new BoundingBox(new Position(-90,f.lon),new Position(90,l.lon));var c=new BoundingBox(new Position(-90,n.lon),new Position(90,m.lon));if(!d.contains(n)&&!d.contains(m)&&!c.contains(f)&&!c.contains(l)){return null}var k=0,h=0;if(d.contains(n)){k=n.lon;if(c.contains(f)){h=l.lon}else{if(d.contains(m)){h=m.lon}else{h=l.lon}}}else{if(c.contains(f)){k=f.lon;if(c.contains(l)){h=l.lon}else{h=m.lon}}}var j=[f.lat,l.lat,n.lat,m.lat];g(j);return new BoundingBox(new Position(j[1],k),new Position(j[2],h));function g(s){var r=0,p=0;for(r=0;r<s.length-1;r++){for(p=0;p<s.length-r-1;p++){if(s[p]>s[p+1]){var q=s[p];s[p]=s[p+1];s[p+1]=q}}}}};this.extendedContains= function(h){var d=new Position(this.minPosition.lat-this.getHeightInDegrees(),this.minPosition.lon-this.getWidthInDegrees());var c=new Position(this.maxPosition.lat+this.getHeightInDegrees(),this.maxPosition.lon+this.getWidthInDegrees());var g=c.lon;var f=h.lon;if(d.lon>0&&c.lon<d.lon){g=g+360;if(h.lon<d.lon){f=f+360}}if(d.lon<0&&c.lon<d.lon){g=g+360;if(h.lon<d.lon){f=f+360}}if(h.lat>d.lat&&f>d.lon&&h.lat<c.lat&&f<g){return true}else{return false}};this.equals= function(c){if(c&&this.minPosition.toString()==c.getMinPosition().toString()&&this.maxPosition.toString()==c.getMaxPosition().toString()){return true}else{return false}};this.toString= function(){return this.minPosition.toString()+" "+this.maxPosition.toString()}}deCarta.CopyrightMessage= function(a){this.init(a)};deCarta.CopyrightMessage.prototype.map=null;deCarta.CopyrightMessage.prototype.type="CopyrightMessage";deCarta.CopyrightMessage.prototype.frame=null;deCarta.CopyrightMessage.prototype.cssClass="decarta-copyright";deCarta.CopyrightMessage.prototype.message=null;deCarta.CopyrightMessage.prototype.init= function(a){this.message=a};deCarta.CopyrightMessage.prototype.build= function(){this.frame=document.createElement("DIV");this.frame.id=this.cssClass;this.frame.className=this.cssClass;this.frame.innerHTML=this.message;Utilities.setUnselectable(this.frame)};deCarta.CopyrightMessage.prototype.appendThis= function(){if(!this.frame){this.build()}return this.frame};deCarta.CopyrightMessage.prototype.removeThis= function(){this.map=null;return this.frame};deCarta.CopyrightMessage.prototype.position= function(a){this.frame.style.top=(a.height-20)+"px";this.frame.style.left="1px"};function CorridorSearchCriteria(a,c,b){if(!c){alert("CorridorSearchCriteria requires routeId");return}this.routeId=c;this.type="distance";this.duration=5;this.distance=500;if(b){if(b.type&&(b.type==="distance"||b.type==="euclideanDistance"||b.type==="drivetime")){this.type=b.type}else{if(b.type&&!(b.type==="distance"||b.type==="euclideanDistance"||b.type==="drivetime")){alert("allowed values for the CorridorSearchCriteria.type distance || euclideanDistance || drivetime ")}}if(b.duration&&parseInt(b.duration)>0){this.duration=parseInt(b.duration)}if(b.distance&&parseInt(b.distance)>0){this.distance=parseInt(b.distance)}}}CorridorSearchCriteria.prototype=new AbstractSearchCriteria();CorridorSearchCriteria.prototype.constructor=AbstractSearchCriteria;function DDSShape(){this.borderColor="(0.0.0)";this.borderColorRed=0;this.borderColorGreen=0;this.borderColorBlue=0;this.borderStyle="SOLID";this.borderWidth="2";this.fillColor="(0.0.0)";this.fillColorRed=0;this.fillColorBlue=0;this.fillColorGreen=0;this.id=null;this.opacity="65";this.opacityFloat=0.65;this.strokeOpacity="65";this.strokeOpacityFloat=0.65;this.fillOpacity="65";this.fillOpacityFloat=0.65;this.map=null;this.isVisible=true;this.rendering=null;this.eventListenerMap=null;this.raphael_element=null;this.title="";this.description="";this.customProperties=null;this.generalizedMinLonIndex=[]}DDSShape.prototype.inside=null;DDSShape.prototype.setBorderColor= function(b){if(!b.match(/\([0-9]+\.[0-9]+\.[0-9]+\)/)){throw new Exception("Error setting RGB value in DDSShape.setBorderColor. Please use format (255.255.255)");return}this.borderColor=b;var a=b.replace("(","").replace(")","").split(".");this.borderColorRed=parseInt(a[0],10);this.borderColorGreen=parseInt(a[1],10);this.borderColorBlue=parseInt(a[2],10)};DDSShape.prototype.getBorderColor= function(){return this.borderColor};DDSShape.prototype.setBorderStyle= function(a){if(a=="SOLID"||a=="DASH"||a=="DOT"||a=="DASHDOTDOT"||a=="ALTBLACKDASH"||a=="RAIL"||a=="NONE"){this.borderStyle=a}else{throw new Exception("Error setting border style value in DDSShape.setBorderStyle. Please use format SOLID, DASH, DOT, DASHDOTDOT, ALTBLACKDASH, RAIL, NONE");return}};DDSShape.prototype.getBorderStyle= function(){return this.borderStyle};DDSShape.prototype.setBorderWidth= function(a){this.borderWidth=a};DDSShape.prototype.getBorderWidth= function(){return this.borderWidth};DDSShape.prototype.setFillColor= function(b){if(!b.match(/\([0-9]+\.[0-9]+\.[0-9]+\)/)){throw new Exception("Error setting RGB value in DDSShape.setColor. Please use format (255.255.255)");return}this.fillColor=b;var a=b.replace("(","").replace(")","").split(".");this.fillColorRed=parseInt(a[0],10);this.fillColorGreen=parseInt(a[1],10);this.fillColorBlue=parseInt(a[2],10)};DDSShape.prototype.getFillColor= function(){return this.fillColor};DDSShape.prototype.getId= function(){return this.id};DDSShape.prototype.getTitle= function(){return this.title};DDSShape.prototype.setTitle= function(a){this.title=a};DDSShape.prototype.getDescription= function(){return this.description};DDSShape.prototype.setDescription= function(a){this.description=a};DDSShape.prototype.setOpacity= function(a){var b=parseInt(a,10)/100;if(isNaN(b)){throw new Exception("DDSShape.prototype.setOpacity: invalid argument of: "+a)}this.opacity=a;this.opacityFloat=b;this.strokeOpacityFloat=b;this.fillOpacityFloat=b};DDSShape.prototype.getOpacity= function(){return this.opacity};DDSShape.prototype.setStrokeOpacity= function(a){var b=parseInt(a,10)/100;if(isNaN(b)){throw new Exception("DDSShape.prototype.setStrokeOpacity: invalid argument of: "+a)}this.strokeOpacity=a;this.strokeOpacityFloat=b};DDSShape.prototype.getStrokeOpacity= function(){return this.strokeOpacity};DDSShape.prototype.setFillOpacity= function(a){var b=parseInt(a,10)/100;if(isNaN(b)){throw new Exception("DDSShape.prototype.setStrokeOpacity: invalid argument of: "+a)}this.fillOpacity=a;this.fillOpacityFloat=b};DDSShape.prototype.getFillOpacity= function(){return this.fillOpacity};DDSShape.prototype.hide= function(){if(this.isVisible==true){this.isVisible=false;if(this.map){if(this.map.getShapeRendering()=="client"){if(this.raphael_element){this.raphael_element.hide()}}else{this.map.reDrawMap()}}}};DDSShape.prototype.show= function(){if(this.isVisible==false){this.isVisible=true;if(this.map){if(this.map.getShapeRendering()=="client"){if(this.raphael_element){this.raphael_element.show()}else{this.map.drawShape(this)}}else{this.map.reDrawMap()}}}};DDSShape.prototype.equals= function(a){if(a&&this.id==a.id){return true}else{return false}};DDSShape.prototype.addEventListener= function(b,a){if(!this.eventListenerMap){this.eventListenerMap={}}if(typeof a=="function"){this.eventListenerMap[b]=a;if(this.raphael_element&&this.raphael_element.node){this.raphael_element.node[b]= function(g){g=g?g:window.event;var d=this.raphael.owner_shape;var c=g.type;c="on"+c;var f=d.eventListenerMap[c];f(d)}}}};DDSShape.getMercPixels= function(g,r){if(this.mercPixels[g]){return(this.mercPixels[g])}var a=this.positions;var s=this.getBoundingBox().minPosition.lon;var k=0;var h=Utilities.radsPerPixelAtZoomLevel(r,g);if(this.generalize){if(this.generalized[g]){a=this.generalized[g];if(this.generalizedMinLonIndex[g]){k=this.generalizedMinLonIndex[g]}else{var m=Utilities.pix2lon(10,h);for(var q=0;q<a.length;q++){if(Math.abs(a[q].lon-s)<=m){k=q;this.generalizedMinLonIndex[g]=q;break}}}}else{a=Utilities.generalize(a,g,10,r);this.generalized[g]=a;m=Utilities.pix2lon(10,h);for(q=0;q<a.length;q++){if(Math.abs(a[q].lon-s)<=m){k=q;this.generalizedMinLonIndex[g]=q;break}}}}var p=a.length;var d=[];for(var j=k;j<p;j++){var n=(a[j]);var c=Utilities.lat2pix(n.lat,h);var f;if(j>k){var b=a[j-1].lon;var l=d[j-1].x;var o=n.lon-b;if(o>180){o-=360}else{if(o<-180){o+=360}}f=l+Utilities.lon2pix(o,h)}else{f=Utilities.lon2pix(n.lon,h)}d[j]=new PixelPoint(f,c)}for(j=k-1;j>=0;j--){n=(a[j]);c=Utilities.lat2pix(n.lat,h);if(j<k){b=a[j+1].lon;l=d[j+1].x;o=n.lon-b;if(o>180){o-=360}else{if(o<-180){o+=360}}f=l+Utilities.lon2pix(o,h)}d[j]=new PixelPoint(f,c)}this.mercPixels[g]=d;return(this.mercPixels[g])};function DDSCircle(b,a){this.id=Math.floor(Math.random()*10000000);this.type="circle";this.radius=a||new Radius(100,new UOM("M"));this.position=b;this.customProperties={}}DDSCircle.prototype=new DDSShape();DDSCircle.prototype.constructor=DDSCircle;DDSCircle.prototype.setPosition= function(a){this.position=a;if(this.map!=null&&this.map.getShapeRendering()=="client"){this.bbox=null;this.map.drawShape(this)}};DDSCircle.prototype.getPosition= function(){return this.position};DDSCircle.prototype.setRadius= function(a){this.radius=a;if(this.map!=null&&this.map.getShapeRendering()=="client"){this.bbox=null;this.map.drawShape(this)}};DDSCircle.prototype.getRadius= function(){return this.radius};DDSCircle.prototype.inside= function(b){var a=deCarta.Math.greatCircleDist(this.position,b,this.radius.uom);if(a<this.radius.distance){return true}else{return false}};DDSCircle.prototype.getBoundingBox= function(){if(this.bbox){return(this.bbox)}this.bbox=Utilities.centerContextToBoundingBox(this.position,this.radius.getDegrees()*111.111);return this.bbox};function DDSLine(a){this.id=Math.floor(Math.random()*10000000);this.type="line";this.generalize=true;this.generalized=[];this.mercPixels=[];this.positions=[];this.width=a||2;this.VR7="";this.clip=false;this.setFillColor("(0.0.0)");this.setBorderWidth("0");this.customProperties={}}DDSLine.prototype=new DDSShape();DDSLine.prototype.constructor=DDSLine;DDSLine.prototype.setColor= function(a){try{this.setBorderColor(a);this.setFillColor(a)}catch(b){throw new Exception("Error setting RGB value in DDSLine.setColor. Please use format (255.255.255)")}};DDSLine.prototype.setPositions= function(a){this.positions=a;this.generalized=[];this.mercPixels=[];if(this.map!=null&&this.map.getShapeRendering()=="client"){this.bbox=null;this.map.drawShape(this)}};DDSLine.prototype.getPositions= function(){return this.positions};DDSLine.prototype.getPosition= function(){return this.getBoundingBox().getCenterPosition()};DDSLine.prototype.setWidth= function(a){this.width=a;if(this.map!=null&&this.map.getShapeRendering()=="client"){this.bbox=null;this.map.drawShape(this)}};DDSLine.prototype.getWidth= function(){return this.width};DDSLine.prototype.setVR7= function(a){this.VR7=a};DDSLine.prototype.getVR7= function(){return this.VR7};DDSLine.prototype.setGeneralize= function(a){this.generalize=a};DDSLine.prototype.getGeneralize= function(){return this.generalize};DDSLine.prototype.setClip= function(a){this.clip=(a)?true:false};DDSLine.prototype.getMercPixels=DDSShape.getMercPixels;DDSLine.prototype.getMercPixelsClipped= function(z,r,b){var G,F;var l=this.getMercPixels(z,r);var f=l.length;if(f<2){return[l]}var t=[];var s=0;for(G=0;G<f-1;G++){if(l[G].equals(l[G+1])){continue}t[s]=[];t[s][0]=l[G];t[s][1]=l[G+1];s++}var E=t.length;var I=Utilities.radsPerPixelAtZoomLevel(r,z);var g=Math.round(Utilities.lat2pix(b.maxPosition.lat,I));var A=Math.round(Utilities.lat2pix(b.minPosition.lat,I));var w=Math.round(Utilities.lon2pix(b.maxPosition.lon,I));var c=Math.round(Utilities.lon2pix(b.minPosition.lon,I));for(G=0;G<E;G++){a(t[G])}var K=[];var h=0;var H="oc";var n="oc0";var k="oc1";var B=1;var m=2;var q=4;var u=8;G=0;while(G<E){var d=t[G];if(!(d[n]|d[k])){if(!(d[0].equals(d[1]))){K[h++]=d}else{}G++;continue}else{if(d[n]&d[k]){G++;continue}else{for(F=0;F<2;F++){var C=d[H+F];var p,o;if(!C){continue}if(C&B){p=d[0].x+(d[1].x-d[0].x)*(g-d[0].y)/(d[1].y-d[0].y);o=g}else{if(C&m){p=d[0].x+(d[1].x-d[0].x)*(A-d[0].y)/(d[1].y-d[0].y);o=A}}if(C&q){p=w;o=d[0].y+(d[1].y-d[0].y)*(w-d[0].x)/(d[1].x-d[0].x)}else{if(C&u){p=c;o=d[0].y+(d[1].y-d[0].y)*(c-d[0].x)/(d[1].x-d[0].x)}}if(isNaN(p)||!isFinite(p)||isNaN(o)||!isFinite(o)){G++;break}var D=new PixelPoint(p,o);d[F]=D}a(d)}}}return K;function a(j){var Q="oc";var O=1;var P=2;var N=4;var L=8;for(var y=0;y<2;y++){var M=j[y];j[Q+y]=0;if(M.x>w){j[Q+y]+=N}else{if(M.x<c){j[Q+y]+=L}}if(M.y>g){j[Q+y]=O}else{if(M.y<A){j[Q+y]=P}}}}};DDSLine.prototype.getBoundingBox= function(){if(this.bbox){return(this.bbox)}if(this.positions.length>1){this.bbox=Utilities.positionsToBoundingBox(this.positions)}else{this.bbox=new BoundingBox(this.positions[0],this.positions[0])}return this.bbox};function DDSPolygon(){this.id=Math.floor(Math.random()*10000000);this.type="polygon";this.generalize=true;this.generalized=[];this.mercPixels=[];this.positions=[];this.VR7="";this.customProperties={}}DDSPolygon.prototype=new DDSShape();DDSPolygon.prototype.constructor=DDSPolygon;DDSPolygon.prototype.setPositions= function(a){this.positions=a;if(!this.positions[this.positions.length-1].equals(this.positions[0])){this.positions.push(this.positions[0].clone())}this.generalized=[];this.mercPixels=[];if(this.map!=null&&this.map.getShapeRendering()=="client"){this.bbox=null;this.map.drawShape(this)}};DDSPolygon.prototype.getPositions= function(){return this.positions};DDSPolygon.prototype.getPosition= function(){return this.getBoundingBox().getCenterPosition()};DDSPolygon.prototype.setVR7= function(a){this.VR7=a;if(this.map!=null){this.bbox=null;this.map.drawShape(this)}};DDSPolygon.prototype.getVR7= function(){return this.VR7};DDSPolygon.prototype.setGeneralize= function(a){this.generalize=a};DDSPolygon.prototype.getGeneralize= function(){return this.generalize};DDSPolygon.prototype.inside= function(a){return deCarta.Math.pointInPolygon(this.positions,a)};DDSPolygon.prototype.getMercPixels=DDSShape.getMercPixels;DDSPolygon.prototype.getBoundingBox= function(){if(this.bbox){return(this.bbox)}if(this.positions.length>1){this.bbox=Utilities.positionsToBoundingBox(this.positions)}else{this.bbox=new BoundingBox(this.positions[0],this.positions[0])}return this.bbox};deCarta.DOMDimensions= function(a){this.init(a)};deCarta.DOMDimensions.prototype.left=null;deCarta.DOMDimensions.prototype.top=null;deCarta.DOMDimensions.prototype.right=null;deCarta.DOMDimensions.prototype.bottom=null;deCarta.DOMDimensions.prototype.width=null;deCarta.DOMDimensions.prototype.height=null;deCarta.DOMDimensions.prototype.init= function(a){try{if(!a||(a&&!a.style)){throw new Exception("passed in element not valid")}this.width=parseInt(a.clientWidth,10);this.height=parseInt(a.clientHeight,10);this.left=parseInt(Utilities.getAbsoluteLeft(a),10);this.top=parseInt(Utilities.getAbsoluteTop(a),10);this.right=this.left+this.width;this.bottom=this.top+this.height;if(isNaN(this.width)||isNaN(this.height)||isNaN(this.left)||isNaN(this.top)||isNaN(this.right)||isNaN(this.bottom)){throw new Exception("element does not have calculable dimensions")}}catch(b){throw new Exception("DOMDimensions: Argument not applicable: "+b.message)}};function DefaultInfoWindow(c){this.width=255;this.height=213;this.autoHeight=false;var a=24;var b=66;var d=89;this.xOffset=-20;this.yOffset=undefined;this.bubble=null;this.bubbleClassName="decarta-bubble";this.bubbleIgnoreMapEvents=true;this.bubbleContent=null;this.bubbleContentClassName="decarta-bubbleContent";this.bubbleContentIgnoreMapEvents=true;this.bubbleContentSelectable=false;this.bubbleClose=null;this.bubbleCloseClassName="decarta-close";this.bubbleCloseIgnoreMapEvents=true;this.associatedPin=null;this.onCloseCallback=null;this.onHideCallback=null;this.onShowCallback=null;this.shouldAutoCenter=false;this.bubbleCloseSrc=Credentials.infoWindowCloseButton;this.setAutoCenter= function(f){f=f||false;this.shouldAutoCenter=f};this.setOnClose= function(f){this.onCloseCallback=f};this.setOnHide= function(f){this.onHideCallback=f};this.setOnShow= function(f){this.onShowCallback=f};this.setIgnoreMapEvents= function(g){for(var f in g){if(g.hasOwnProperty(f)){this[f]=g[f]}}this.resetMapEventIgnorance()};this.setContentSelectable= function(f){this.bubbleContentSelectable=f;this.resetSelectability()};this.init= function(m){for(var n in m){if(m.hasOwnProperty(n)){this[n]=m[n]}}this.bubble=document.createElement("div");this.bubble.id=this.bubbleClassName;this.bubble.style.cssText="display:none;filter:alpha(opacity=100); opacity:1; position:absolute; z-index:10000;background-color:transparent;font-size:11px;";this.bubble.style.width=this.width+"px";var g=document.createElement("img");g.src=Credentials.imgPath+"info-tl.png";g.style.cssText="top:0px;left:0px;margin:0px; padding:0px;position:absolute;background-color:transparent;";g.style.height=a+"px";g.style.width=a+"px";this.bubble.appendChild(g);var q=document.createElement("div");q.style.cssText="top:0px;margin:0px;padding:0px;border-top:1px solid #ABABAB;position:absolute;background-color:white;";q.style.left=a+"px";q.style.right=a+"px";q.style.height=a-1+"px";this.bubble.appendChild(q);this.tElement=q;var p=document.createElement("img");p.src=Credentials.imgPath+"info-tr.png";p.style.cssText="top:0px;right:0px; margin:0px; padding:0px;position:absolute;background-color:transparent;";p.style.height=a+"px";p.style.width=a+"px";this.bubble.appendChild(p);var h=document.createElement("div");h.style.cssText="left:0px;margin:0px; padding:0px;border-left:1px solid #ABABAB;position:absolute;background-color:white;";h.style.top=a+"px";h.style.bottom=a+b+"px";h.style.width=a-1+"px";this.bubble.appendChild(h);this.lElement=h;var r=document.createElement("div");r.style.cssText="right:0px;margin:0px; padding:0px;border-right:1px solid #ABABAB;position:absolute;background-color:white;";r.style.top=a+"px";r.style.bottom=a+b+"px";r.style.width=a-1+"px";this.bubble.appendChild(r);this.rElement=r;var j=document.createElement("img");j.src=Credentials.imgPath+"info-bl.png";j.style.cssText="left:0px; margin:0px; padding:0px;position:absolute;background-color:transparent;";j.style.bottom=b+"px";j.style.height=a+"px";j.style.width=a+"px";this.bubble.appendChild(j);var l=document.createElement("div");l.style.cssText="margin:0px; padding:0px;border-bottom:1px solid #ABABAB;position:absolute;background-color:white;";l.style.bottom=b+"px";l.style.left=a+"px";l.style.right=a+"px";l.style.height=a-1+"px";this.bubble.appendChild(l);this.bElement=l;var f=document.createElement("img");f.src=Credentials.imgPath+"info-br.png";f.style.cssText="right:0px; margin:0px; padding:0px;position:absolute;background-color:transparent;";f.style.bottom=b+"px";f.style.height=a+"px";f.style.width=a+"px";this.bubble.appendChild(f);var k=document.createElement("img");k.src=Credentials.imgPath+"info-pointer.png";k.style.cssText="bottom:1px;left:0px; margin:0px; padding:0px;position:absolute;background-color:transparent;";k.style.width=d+"px";k.style.height=b+"px";this.bubble.appendChild(k);this.bubbleContent=document.createElement("div");this.bubbleContent.id=this.bubbleContentClassName;this.bubbleContent.style.cssText="background-color:white;";this.bubbleContent.style.marginTop=a+"px";this.bubbleContent.style.marginRight=a+"px";this.bubbleContent.style.marginBottom=a+b+"px";this.bubbleContent.style.marginLeft=a+"px";this.bubbleContent.style.padding=0+"px";if(this.autoHeight){}else{var o=this.height-2*a-b;if(o>0){this.bubbleContent.style.height=o+"px";this.bubbleContent.style.overflowY="auto"}else{throw new Exception("height must be bigger than:"+(2*a+b))}}if(this.width<(a+d)){throw new Exception("width must be bigger than:"+(a+d))}this.bubble.appendChild(this.bubbleContent);if(this.bubbleCloseSrc){this.bubbleClose=document.createElement("img");this.bubbleClose.src=this.bubbleCloseSrc;this.bubbleClose.id=this.bubbleCloseClassName;this.bubbleClose.owner=this;this.bubbleClose.style.cssText="position:absolute; width:13px; height:13px; top:8px; right:8px; cursor:pointer;";deCarta.Events.addEvent(this.bubbleClose,"click",DefaultInfoWindow.eventClose);this.bubble.appendChild(this.bubbleClose)}};this.build= function(){try{this.bubble=document.createElement("div");this.bubble.id=this.bubbleClassName;this.bubble.className=this.bubbleClassName;this.bubbleContent=document.createElement("div");this.bubbleContent.id=this.bubbleContentClassName;this.bubbleContent.className=this.bubbleContentClassName;if(Credentials.infoWindowCloseButton){this.buildCloseIcon(Credentials.infoWindowCloseButton)}this.bubble.appendChild(this.bubbleContent)}catch(f){throw new Exception("build error:"+f.message)}};this.buildCloseIcon= function(f){this.bubbleClose=document.createElement("img");if(f){this.bubbleClose.src=f}this.bubbleClose.id=this.bubbleCloseClassName;this.bubbleClose.className=this.bubbleCloseClassName;this.bubbleClose.owner=this;deCarta.Events.addEvent(this.bubbleClose,"click",DefaultInfoWindow.eventClose);this.bubble.appendChild(this.bubbleClose)};this.setPosition= function(g,f){f=f||0;g=g||0;if(this.yOffset!=undefined){this.bubble.style.top=f-this.yOffset+"px"}else{if(this.autoHeight){this.bubble.style.top=f+"px"}else{this.bubble.style.top=f-this.height+1+"px"}}this.bubble.style.left=g-this.xOffset+"px"};this.setContent= function(f){this.bubbleContent.innerHTML="";if(f.style){this.bubbleContent.appendChild(f)}else{this.bubbleContent.innerHTML=f}this.resetSelectability();this.resetMapEventIgnorance()};this.resetSelectability= function(){var k=(this.bubbleContentSelectable)?Utilities.setSelectable:Utilities.setUnselectable;var f=this.bubbleContent;k(f);if(f.hasChildNodes()){var g=f.getElementsByTagName("*");for(var h=0;h<g.length;h++){k(g[h])}}};this.resetMapEventIgnorance= function(){var k,h,l,g,f;if(this.bubbleIgnoreMapEvents){deCarta.IdManager.setTag(this.bubble,"ignoreForMapEvents");if(this.bubble.hasChildNodes()){g=this.bubble.childNodes;for(k=0;k<g.length;k++){l=g[k];if(l.id!=this.bubbleContentClassName&&l.id!=this.bubbleCloseClassName){f=l.getElementsByTagName("*");for(h=0;h<f.length;h++){deCarta.IdManager.setTag(f[h],"ignoreForMapEvents")}}}}}if(this.bubbleContentIgnoreMapEvents){deCarta.IdManager.setTag(this.bubbleContent,"ignoreForMapEvents");f=this.bubbleContent.getElementsByTagName("*");for(k=0;k<f.length;k++){deCarta.IdManager.setTag(f[k],"ignoreForMapEvents")}}if(this.bubbleCloseIgnoreMapEvents&&this.bubbleClose){deCarta.IdManager.setTag(this.bubbleClose,"ignoreForMapEvents")}};this.show= function(g){this.bubble.style.zIndex=Pin.zIndexCounter+10000;this.bubbleContent.style.zIndex=Pin.zIndexCounter+10000;if(this.bubbleClose){this.bubbleClose.style.zIndex=Pin.zIndexCounter+10000}this.bubble.style.display="block";if(this.autoHeight&&this.yOffset==undefined){var f=this.bubble.offsetHeight;var h=parseInt(this.bubble.style.top);this.bubble.style.top=h-f-1+"px"}if(g){this.associatedPin=g}else{this.associatedPin=null}if(this.onShowCallback){this.onShowCallback()}this.autoCenter();this.ie6sizeTLRB();this.ie6FixPng()};this.hide= function(){this.bubble.style.display="none";if(this.onHideCallback){this.onHideCallback()}};this.autoCenter= function(){var n=this.associatedPin;if(!(n&&n.map)||!this.shouldAutoCenter){return}var D=n.map;var k=n.pinImg.clientHeight;var q=n.pinImg.clientWidth;var B=parseInt(n.pinImg.style.top);var F=parseInt(n.pinImg.style.left);var G=Utilities.radsPerPixelAtZoomLevel(D.getTileSize(),D.getZoomController().selected);var t=n.getViewableBoundingBox(G);var E=t.getUpperLeftPosition();var w=D.posToMercPix(E);var C=new PixelPoint(w.x+q,w.y-k);var A=this.bubble.clientHeight;var z=this.bubble.clientWidth;var p=parseInt(this.bubble.style.top);var y=parseInt(this.bubble.style.left);var r=w.y+(B-p);var g=w.x-(F-y);var f=new PixelPoint(g,r);var m=new PixelPoint(g+z,r-A);var s=new PixelPoint(g,r-A);var o=new PixelPoint(g+z,r);var h=D.mercPixToPos(s);var u=D.mercPixToPos(o);var j=new BoundingBox(h,u);var l=j.getCenterPosition();D.panToPosition(l)};this.init(c);this.ie6sizeTLRB= function(){if(!Utilities.ie6){return}var f=document.getElementById(this.bubbleClassName).clientWidth-(a*2);var g=document.getElementById(this.bubbleClassName).clientHeight-a-b;this.bElement.style.width=f+"px";this.tElement.style.width=f+"px";this.lElement.style.height=g+"px";this.rElement.style.height=g+"px";return};this.ie6FixPng= function(){if(Utilities.ie6){var f=this.bubble.getElementsByTagName("img");for(var g=0;g<f.length;g++){if(f[g].src.match(/.png/ig)){Utilities.fixPng(f[g])}}}}}DefaultInfoWindow.eventClose= function(){var a=this.owner;if(a.onCloseCallback){a.onCloseCallback()}a.hide()};function EventRegistry(){}EventRegistry.addListener= function(c,a,b){if(c.type=="map"&&(a=="rightclick"||a=="dblclick"||a=="click"||a=="mousedown"||a=="mouseout"||a=="mouseup"||a=="move"||a=="movestart"||a=="moveend"||a=="zoomend")){c.addEventListener(a,b)}else{if(c.type=="pin"&&(a=="rightclick"||a=="dblclick"||a=="click"||a=="mousedown"||a=="mouseover"||a=="mouseout"||a=="mouseup")){c.addEventListener(a,b)}else{throw new Exception(a+" is unsupported event type for "+c.type)}}};EventRegistry.clearListeners= function(b,a){b.clearListeners(a)};EventRegistry.clearInstanceListeners= function(a){a.clearInstanceListeners()};deCarta.Events={};deCarta.Events.addEvent= function(d,c,b){var a=deCarta.Events.eventKey;if(!deCarta.IdManager.checkTag(d,a)){deCarta.IdManager.setTag(d,a,deCarta.IdManager.getUniqueId())}if(d.attachEvent){if(d["e"+c+b]){return}d["e"+c+b]=b;d[c+b]= function(){d["e"+c+b](window.event)};d.attachEvent("on"+c,d[c+b])}else{if(d.addEventListener){d.addEventListener(c,b,false)}else{d["on"+c]=b}}};deCarta.Events.removeEvent= function(c,b,a){if(c.detachEvent){if(c[b+a]){c.detachEvent("on"+b,c[b+a]);c["e"+b+a]=null;c[b+a]=null}}else{if(c.removeEventListener){c.removeEventListener(b,a,false)}else{c["on"+b]=undefined}}};deCarta.Events.checkIfTarget= function(c,b){var a=deCarta.Events.eventKey;if(c&&c[a]){if(b&&(b.target||b.srcElement)){var d=b.target||b.srcElement;if(d[a]==c[a]){return true}}}return false};deCarta.Events.eventKey="deCartaEventId";(function(){if(Error){Exception=Error}else{Exception= function(b){this.message=b||"an exception has occurred";var a=this;this.toString= function(){return a.message}}}})();function FreeFormAddress(b,a){if(!b||b.toString()==""){throw new Exception("Error instantiating FreeFormAddress, invalid parameters.");return false}this.locale=a||new Locale("en","US");this.address=b;this.type="FreeForm"}FreeFormAddress.prototype.getLocale= function(){return this.locale};FreeFormAddress.prototype.toString= function(){return this.address};function GeocodedAddress(){this.position=null;this.freeFormAddress=null;this.structuredAddress=null;this.boundingBox=null;this.matchType=""}GeocodedAddress.prototype.toString= function(){return this.position+"\n"+this.freeFormAddress+"\n"+this.boundingBox+"\n"+this.matchType};function Geocoder(){this.xmlRecFac=new deCarta.XMLStringBuilder();this.returnFreeForm=true;var b=[];var a=this;this.locale;this.authenticate= function(d,c){if(!d||!c||d==""||c==""){throw new Exception("Error authenticating Geocoder, invalid parameters.");return false}Credentials.clientName=d;Credentials.clientPassword=c;this.xmlRecFac.clientName=d;this.xmlRecFac.clientPassword=c};this.setConfiguration= function(c){if(!c){throw new Exception("error calling Geocoder.setConfiguration()")}Credentials.configuration=c;this.xmlRecFac.configuration=c};this.geocode= function(d,j,f,c){var h=Utilities.getRequestId();this.locale=d.locale;if(typeof j=="function"){b[h]=j}else{throw new Exception("Geocode.geocode: callBack must be a function, arg was: "+j)}var g=this.xmlRecFac.createGeocodeRequest(d,h,this.returnFreeForm,c);JSRequest.send(g,a.geocodeCallback,null,f)};this.reverseGeocode= function(c,h,d){var g=Utilities.getRequestId();if(typeof h=="function"){b[g]=h}else{throw new Exception("Geocode.reverseGeocode: callBack must be a function, arg was: "+h)}var f=this.xmlRecFac.createReverseGeocodeRequest(c,g);JSRequest.send(f,a.reverseGeocodeCallback,null,d)};this.reverseGeocodeCallback= function(f){var d=f.XLS.Response.requestID;var c;if(deCarta.JSONParser.parseErrors(f)){c=new Address()}else{c=deCarta.JSONParser.parseAddress(f.XLS.Response.ReverseGeocodeResponse.ReverseGeocodedLocation.Address)}if((d>=0)&&b[d]){b[d](c);b[d]=undefined}};this.geocodeCallback= function(j){var l=[];var c=[];var f=[];var h=j.XLS.Response.requestID;if(deCarta.JSONParser.parseErrors(j)){}else{if(j.XLS.Response.GeocodeResponse.GeocodeResponseList){var k;if(j.XLS.Response.GeocodeResponse.GeocodeResponseList.GeocodedAddress.length==undefined){k=[];k.push(j.XLS.Response.GeocodeResponse.GeocodeResponseList.GeocodedAddress)}else{k=j.XLS.Response.GeocodeResponse.GeocodeResponseList.GeocodedAddress}for(var d=0;d<k.length;d++){var g=new GeocodedAddress();l.push(new Position(k[d].Point.pos));g.position=new Position(k[d].Point.pos.toString());if(k[d].Address.freeFormAddress){g.freeFormAddress=new FreeFormAddress(k[d].Address.freeFormAddress,a.locale);c.push(new FreeFormAddress(k[d].Address.freeFormAddress,a.locale))}else{if(k[d].Address.Place){g.structuredAddress=deCarta.JSONParser.parseAddress(k[d].Address);g.structuredAddress.locale=a.locale;c.push(g.structuredAddress)}}if(k[d].BoundingBox){g.boundingBox=new BoundingBox(new Position(k[d].BoundingBox.pos[0].content),new Position(k[d].BoundingBox.pos[1].content))}g.matchType=k[d].GeocodeMatchCode.matchType;g.accuracy=k[d].GeocodeMatchCode.accuracy;f.push(g)}}}if((h>=0)&&b[h]){b[h](l,c,f);b[h]=undefined}}}function Icon(g,d,b,f,a,c){if(!g||(d!=0&&!d)||(b!=0&&!b)||(f!=0&&!f)||(a!=0&&!a)){throw new Exception("Error instantiating Icon, missing parameters. Icon(src,iconAnchorX,iconAnchorY,width,height) all required. The last parameter overlay is optional.")}this._previousX=null;this._previousY=null;this.src=g;this.anchorX=d;this.anchorY=b;this.width=f;this.height=a;this.overlay=c||new TextOverlay("",1,1)}Icon.prototype.getAnchorX= function(){return this.anchorX};Icon.prototype.getAnchorY= function(){return this.anchorY};Icon.prototype.getHeight= function(){return this.height};Icon.prototype.getOverlay= function(){return this.overlay};Icon.prototype.getSrc= function(){return this.src};Icon.prototype.getWidth= function(){return this.width};Icon.prototype.setAnchorX= function(a){this._previousX=this.anchorX;this.anchorX=a};Icon.prototype.setAnchorY= function(a){this._previousY=this.anchorY;this.anchorY=a};Icon.prototype.setHeight= function(a){this.height=a};Icon.prototype.setOverlay= function(a){this.overlay=a};Icon.prototype.setSrc= function(a){this.src=a};Icon.prototype.setWidth= function(a){this.width=a};deCarta.IdManager={};deCarta.IdManager.getUniqueId= function(c){var b=deCarta.IdManager.getUniqueId.seedNumber++;var a=null;if(c){a=""+c+b}else{a=b}return a};deCarta.IdManager.getUniqueId.seedNumber=10000;deCarta.IdManager.setTag= function(c,a,d){var b=deCarta.IdManager.tagDitionary;d=d||true;if(!c[b]){c[b]={}}c[b][a]=d};deCarta.IdManager.checkTag= function(c,a){var b=deCarta.IdManager.tagDitionary;if(c&&a){if(c[b]){return c[b][a]}}return undefined};deCarta.IdManager.tagDitionary="deCartaTagDictionary";function InfoWindow(b,c,f,d,a){this.init(b,c,f,d,a)}InfoWindow.prototype.xOffset=-20;InfoWindow.prototype.yOffset=0;InfoWindow.prototype.bubble=null;InfoWindow.prototype.bubbleClassName="decarta-bubble";InfoWindow.prototype.bubbleIgnoreMapEvents=false;InfoWindow.prototype.bubbleContent=null;InfoWindow.prototype.bubbleContentClassName="decarta-bubbleContent";InfoWindow.prototype.bubbleContentIgnoreMapEvents=false;InfoWindow.prototype.bubbleContentSelectable=false;InfoWindow.prototype.bubbleClose=null;InfoWindow.prototype.bubbleCloseClassName="decarta-close";InfoWindow.prototype.bubbleCloseIgnoreMapEvents=true;InfoWindow.prototype.associatedPin=null;InfoWindow.prototype.onCloseCallback=null;InfoWindow.prototype.onHideCallback=null;InfoWindow.prototype.onShowCallback=null;InfoWindow.prototype.shouldAutoCenter=false;InfoWindow.prototype.setAutoCenter= function(a){a=a||false;this.shouldAutoCenter=a};InfoWindow.prototype.setOnClose= function(a){this.onCloseCallback=a};InfoWindow.prototype.setOnHide= function(a){this.onHideCallback=a};InfoWindow.prototype.setOnShow= function(a){this.onShowCallback=a};InfoWindow.prototype.setIgnoreMapEvents= function(b){for(var a in b){if(b.hasOwnProperty(a)){this[a]=b[a]}}this.resetMapEventIgnorance()};InfoWindow.prototype.setContentSelectable= function(a){this.bubbleContentSelectable=a;this.resetSelectability()};InfoWindow.prototype.init= function(d,f,h,g,b){var c;this.build();if(d){this.bubble=d;this.bubble.id="decarta-bubble";this.bubbleContent.style.position="absolute";this.bubble.appendChild(this.bubbleContent);if(this.bubbleClose){this.bubble.appendChild(this.bubbleClose)}}if(b){this.bubble.style.width=b.width+"px";this.bubble.style.height=b.height+"px";this.bubble.style.backgroundImage="url("+b.src+")";this.bubble.style.backgroundRepeat="no-repeat";this.bubble.style.backgroundColor="transparent";this.bubble.style.borderStyle="none"}if(g){if(!this.bubbleClose){this.buildCloseIcon(g.src)}this.bubbleClose.style.position="absolute";this.bubbleClose.style.top=g.anchorY+"px";this.bubbleClose.style.left=g.anchorX+"px";if(g.height){this.bubbleClose.style.height=g.height+"px"}if(g.width){this.bubbleClose.style.width=g.width+"px"}}if(f){this.xOffset=f}if(h){this.yOffset=h}if(Utilities.ie6){var a=this.bubble.getElementsByTagName("img");for(c=0;c<a.length;c++){if(a[c].src.match(/\bpng\b/g)){Utilities.fixPng(a[c])}}}};InfoWindow.prototype.build= function(){try{this.bubble=document.createElement("div");this.bubble.id=this.bubbleClassName;this.bubble.className=this.bubbleClassName;this.bubbleContent=document.createElement("div");this.bubbleContent.id=this.bubbleContentClassName;this.bubbleContent.className=this.bubbleContentClassName;if(Credentials.infoWindowCloseButton){this.buildCloseIcon(Credentials.infoWindowCloseButton)}this.bubble.appendChild(this.bubbleContent)}catch(a){throw new Exception("build error:"+a.message)}};InfoWindow.prototype.buildCloseIcon= function(a){this.bubbleClose=document.createElement("img");if(a){this.bubbleClose.src=a}this.bubbleClose.id=this.bubbleCloseClassName;this.bubbleClose.className=this.bubbleCloseClassName;this.bubbleClose.owner=this;deCarta.Events.addEvent(this.bubbleClose,"click",InfoWindow.eventClose);this.bubble.appendChild(this.bubbleClose)};InfoWindow.prototype.setPosition= function(b,a){a=a||0;b=b||0;this.bubble.style.top=a-this.yOffset+"px";this.bubble.style.left=b-this.xOffset+"px"};InfoWindow.prototype.setContent= function(a){this.bubbleContent.innerHTML="";if(a.style){this.bubbleContent.appendChild(a)}else{this.bubbleContent.innerHTML=a}this.resetSelectability();this.resetMapEventIgnorance()};InfoWindow.prototype.resetSelectability= function(){var d=(this.bubbleContentSelectable)?Utilities.setSelectable:Utilities.setUnselectable;var a=this.bubbleContent;d(a);if(a.hasChildNodes()){var b=a.getElementsByTagName("*");for(var c=0;c<b.length;c++){d(b[c])}}};InfoWindow.prototype.resetMapEventIgnorance= function(){var d,c,f,b,a;if(this.bubbleIgnoreMapEvents){deCarta.IdManager.setTag(this.bubble,"ignoreForMapEvents");if(this.bubble.hasChildNodes()){b=this.bubble.childNodes;for(d=0;d<b.length;d++){f=b[d];if(f.id!=this.bubbleContentClassName&&f.id!=this.bubbleCloseClassName){a=f.getElementsByTagName("*");for(c=0;c<a.length;c++){deCarta.IdManager.setTag(a[c],"ignoreForMapEvents")}}}}}if(this.bubbleContentIgnoreMapEvents){deCarta.IdManager.setTag(this.bubbleContent,"ignoreForMapEvents");a=this.bubbleContent.getElementsByTagName("*");for(d=0;d<a.length;d++){deCarta.IdManager.setTag(a[d],"ignoreForMapEvents")}}if(this.bubbleCloseIgnoreMapEvents&&this.bubbleClose){deCarta.IdManager.setTag(this.bubbleClose,"ignoreForMapEvents")}};InfoWindow.prototype.show= function(a){this.bubble.style.zIndex=Pin.zIndexCounter+10000;this.bubbleContent.style.zIndex=Pin.zIndexCounter+10000;if(this.bubbleClose){this.bubbleClose.style.zIndex=Pin.zIndexCounter+10000}this.bubble.style.display="block";if(a){this.associatedPin=a}else{this.associatedPin=null}if(this.onShowCallback){this.onShowCallback()}this.autoCenter()};InfoWindow.prototype.hide= function(){this.bubble.style.display="none";if(this.onHideCallback){this.onHideCallback()}};InfoWindow.prototype.autoCenter= function(){var j=this.associatedPin;if(!(j&&j.map)||!this.shouldAutoCenter){return}var z=j.map;var f=j.pinImg.clientHeight;var m=j.pinImg.clientWidth;var w=parseInt(j.pinImg.style.top);var B=parseInt(j.pinImg.style.left);var C=Utilities.radsPerPixelAtZoomLevel(z.getTileSize(),z.getZoomController().selected);var p=j.getViewableBoundingBox(C);var A=p.getUpperLeftPosition();var r=z.posToMercPix(A);var y=new PixelPoint(r.x+m,r.y-f);var u=this.bubble.clientHeight;var t=this.bubble.clientWidth;var l=parseInt(this.bubble.style.top);var s=parseInt(this.bubble.style.left);var n=r.y+(w-l);var b=r.x-(B-s);var a=new PixelPoint(b,n);var h=new PixelPoint(b+t,n-u);var o=new PixelPoint(b,n-u);var k=new PixelPoint(b+t,n);var c=z.mercPixToPos(o);var q=z.mercPixToPos(k);var d=new BoundingBox(c,q);var g=d.getCenterPosition();z.panToPosition(g)};InfoWindow.eventClose= function(){var a=this.owner;if(a.onCloseCallback){a.onCloseCallback()}a.hide()};deCarta.JSONParser={};deCarta.JSONParser.parseAddress= function(d){var b=new Address();b.freeFormAddress=d.freeFormAddress;var a=d.Place;if(d.Place&&d.Place.length){for(var c=0;c<a.length;c++){f(b,a[c])}}else{if(d.Place&&d.Place.type){f(b,a)}}b.postalCode=(d.PostalCode)?d.PostalCode:"";b.countryCode=d.countryCode;if(d.StreetAddress&&d.StreetAddress.Street){b.street=d.StreetAddress.Street.content||((typeof d.StreetAddress.Street=="string")?d.StreetAddress.Street:"");b.speedLimit=d.StreetAddress.Street.speedLimit||"";if(d.StreetAddress.Building){b.buildingNumber=d.StreetAddress.Building.number}}return b;function f(h,g){switch(g.type){case"CountrySubdivision":h.countrySubdivision=g.content;break;case"CountrySecondarySubdivision":h.countrySecondarySubdivision=g.content;break;case"CountryTertiarySubdivision":h.countryTertiarySubdivision=g.content;break;case"MunicipalitySubdivision":h.municipalitySubdivision=g.content;break;case"Municipality":h.municipality=g.content;break;case"Landmark":h.landmark=g.content;break}}};deCarta.JSONParser.parsePOI= function(r){var g=[];if(r.POI.POIAttributeList&&r.POI.POIAttributeList.POIInfoList&&r.POI.POIAttributeList.POIInfoList.POIInfo){g=r.POI.POIAttributeList.POIInfoList.POIInfo}var o={};for(var d=0;d<g.length;d++){var l=g[d];var j;for(var h in l){if(h=="name"){j=l[h]}else{if(h=="value"){o[j]=l[h]}}}}if(r.POI.ID){o.ID=r.POI.ID}var c=r.POI.POIName;var s=r.POI.phoneNumber;var m=r.POI.Point.pos;var q=deCarta.JSONParser.parseAddress(r.POI.Address);var f=new POI(c,new Position(m),q,s,o);if(r.Distance.length){for(var k=0;k<r.Distance.length;k++){var b=r.Distance[k].value;var a=r.Distance[k].uom;if(r.Distance[k].onRoute){f.distance={value:parseInt(b),uom:new UOM(a)}}else{f.distanceOffRoute={value:parseInt(b),uom:new UOM(a)}}}}else{var b=r.Distance.value;var a=r.Distance.uom;f.distance={value:parseInt(b),uom:new UOM(a)}}return f};deCarta.JSONParser.parseRoutes= function(f){var d;var c=f.XLS.Response.DetermineRouteResponse;var b=g(c);if(c.AlternateRoute){var j=c.AlternateRoute;var a=j.length;if(a==undefined){b.alternates[0]=g(j)}else{for(d=0;d<a;d++){b.alternates[d]=g(j[d])}}}return b;function g(s){var z=new Route();var p=s.RouteSummary;z.TotalTime=Utilities.podParse(p.TotalTime);z.TotalTimeObject=Utilities.podParseJSON(p.TotalTime);z.TotalDistance=p.TotalDistance.value;z.uom=new UOM(p.TotalDistance.uom);var n=p.BoundingBox;if(n){var r=new Position(n.pos[0].content);var t=new Position(n.pos[1].content);z.boundingBox=new BoundingBox(r,t);z.centerPosition=z.boundingBox.getCenterPosition()}var A=s.RouteHandle;if(A&&A.routeID){z.routeID=A.routeID}var u=s.viaPointSequence;if(u){z.viaPointSequence=u}var y=s.RouteGeometry;if(y){var m=y.LineString.pos;var w=m.length;if(w==undefined||!(deCarta.Array.isArray(m))){z.RouteGeometry[0]=new Position(m)}else{for(d=0;d<w;d++){z.RouteGeometry[d]=new Position(m[d])}}}var k=s.RouteInstructionsList;var q=s.RouteMap;if(k){var l=k.RouteInstruction;var B=l.length;if(B==undefined){z.RouteInstructions[0]=h(l)}else{for(d=0;d<B;d++){z.RouteInstructions[d]=h(l[d]);if(q){var o=new ManeuverMap();o.desc=q[d].Content.description;o.URL=q[d].Content.URL;o.format=q[d].Content.format;o.height=q[d].Content.height;o.width=q[d].Content.width;o.boundingBox=new BoundingBox(new Position(q[d].BBoxContext.pos[0].content),new Position(q[d].BBoxContext.pos[1].content));z.RouteInstructions[d].maneuverMap=o}}}}return z}function h(l){var k=new RouteInstruction();k.Instruction=l.Instruction;k.distance=l.distance.value;k.duration=Utilities.podParse(l.duration);k.position=new Position(l.Point);k.tour=l.tour;return k}};deCarta.JSONParser.parseErrors= function(b){var a=(b.XLS.ResponseHeader.ErrorList)?true:false;if(b.XLS.Response.ErrorList){a=true}return a};deCarta.JSONViewer= function(){deCarta.StyleManager.init();var j=0;var b="";var g=false;var d=0;var a="decarta-json-reflector";var f="decarta-json-type";var h="decarta-json-relation";var k="decarta-json-string";var c="decarta-json-number";this.reflect= function(y){var o;if(!g){j++}if(typeof(y)==="string"){r(null,y);return}else{if(typeof(y)==="number"){w(null,y);return}else{if(typeof(y)==="boolean"){F(null,y);return}else{if(typeof(y)==="null"){C(null,y);return}else{if(typeof(y)==="undefined"){u(null,y);return}else{if(g){if(Object.prototype.toString.call(y)==="[object Array]"){B(null,y);o=d;d=0;for(var G=0;G<y.length;G++){d++;this.reflect(y[G])}d=o;return}else{q(null);g=false;this.reflect(y);g=true;return}}else{for(var l in y){if(typeof(y[l])==="string"){r(l,y[l])}else{if(typeof(y[l])==="number"){w(l,y[l])}else{if(typeof(y[l])==="boolean"){F(l,y[l])}else{if(typeof(y[l])==="null"){C(l,y[l])}else{if(typeof(y[l])==="undefined"){u(l,y[l])}else{if(Object.prototype.toString.call(y[l])==="[object Array]"){B(l,y[l]);g=true;o=d;d=0;for(var E=0;E<y[l].length;E++){d++;this.reflect(y[l][E])}d=o;g=false}else{q(l);this.reflect(y[l])}}}}}}}}}}}}}j--;function r(s,t){var n;if(s){n=z("string ")+s+H()+A(t)}else{n=z("string ")+A(t)}m(n)}function w(s,t){var n;if(s){n=z("number ")+s+H()+D(t)}else{n=z("number ")+D(t)}m(n)}function F(s,t){var n;if(s){n=z("boolean ")+s+H()+D(t)}else{n=z("boolean ")+D(t)}m(n)}function C(s,t){var n;if(s){n=z("null ")+s+H()+D(t)}else{n=z("null ")+D(t)}m(n)}function u(s,t){var n;if(s){n=z("undefined ")+s+H()+D(t)}else{n=z("undefined ")+D(t)}m(n)}function B(s,t){var n;if(s){n=z("array ")+s+" ("+t.length+")"}else{n=z("array ")+" ("+t.length+")"}m(n)}function q(s){var n;if(s){n=z("object ")+s}else{n=z("object ")}m(n)}function z(n){return"<span class='"+f+"'>"+n+"</span>"}function H(){return"<span class='"+h+"'> = </span>"}function A(n){return"<span class='"+k+"'>\""+n+'"</span>'}function D(s){return"<span class='"+c+"'>"+s+"</span>"}function m(n){if(g){b+=p()+"["+d+"]"+n+"\n"}else{b+=p()+n+"\n"}}function p(){var s="";for(var n=0;n<j;n++){s+="\t"}return s}};this.show= function(){var l;l=document.getElementById(a);if(!l){l=document.createElement("pre");l.id=a;document.body.appendChild(l)}l.innerHTML+=b};this.clear= function(){b="";document.getElementById(a).innerHTML=""}};function JSRequest(){}JSRequest.host=null;JSRequest.TIMEOUT=60000;JSRequest.tHandler= function(a){throw new Exception("JSRequest timeout on requestID: "+a)};JSRequest.qtHandler=[];JSRequest.xmlhttp=true;JSRequest.hostInProgress=false;JSRequest.holder=[];JSRequest.callbackFunctions=[];JSRequest.interceptorXMLHTTPRequest=null;JSRequest.interceptorXMLRequest=null;JSRequest.interceptorXMLResponse=null;JSRequest.interceptorJSONResponse=null;JSRequest.registerXMLHTTPRequestInterceptor= function(a){JSRequest.interceptorXMLHTTPRequest=a};JSRequest.registerXMLRequestInterceptor= function(a){JSRequest.interceptorXMLRequest=a};JSRequest.registerQueryTimeoutHandler= function(b,a){JSRequest.qtHandler[b]=a};JSRequest.registerXMLResponseInterceptor= function(a){JSRequest.interceptorXMLResponse=a};JSRequest.registerJSONResponseInterceptor= function(a){JSRequest.interceptorJSONResponse=a};JSRequest.callbackRegistry= function(b){if(GLOBALS.DEBUG_JSON&&b){if(!window.jsonViewer){window.jsonViewer=new deCarta.JSONViewer()}window.jsonViewer.reflect(b);window.jsonViewer.show()}try{if(b&&(b.response!=null)){try{if(typeof JSRequest.interceptorXMLResponse==="function"&&b.xmlResponse){var a=(new DOMParser()).parseFromString(Utilities.normalizePrefixes(b.xmlResponse),"text/xml");if(b.xmlResponse.indexOf("RUOK")==-1){JSRequest.interceptorXMLResponse(a)}}if(typeof JSRequest.interceptorJSONResponse==="function"){b.response=JSRequest.interceptorJSONResponse(b.response)}}catch(c){throw new Exception("Application Error: API user application response interceptor function threw error: "+c.message)}if(JSRequest.callbackFunctions[b.requestID]){if(b.responseFormat=="XML"){}else{if(deCarta.Array.isArray(b.response.XLS.Response)){if(b.response.XLS.Response[0].requestID==-1){b.response.XLS.Response[0].requestID=b.requestID}}else{if(b.response.XLS.Response.requestID==-1){b.response.XLS.Response.requestID=b.requestID}}}JSRequest.callbackFunctions[b.requestID](b.response);JSRequest.callbackFunctions[b.requestID]=undefined;JSRequest.qtHandler[b.requestID]=undefined}}if(document.getElementById(b.requestID+":"+b.chunkNo)){document.getElementsByTagName("head").item(0).removeChild(document.getElementById(b.requestID+":"+b.chunkNo))}}catch(c){throw new Exception(c.message)}};JSRequest.checkTimeout= function(c){var b=(c.split(":"))[0];if(JSRequest.callbackFunctions[b]||JSRequest.qtHandler[b]){JSRequest.host=null;JSRequest.tHandler(b);if(typeof JSRequest.qtHandler[b]=="function"){JSRequest.qtHandler[b](b);JSRequest.qtHandler[b]=undefined}JSRequest.callbackFunctions[b]=undefined;var a=document.getElementById(c);if(a){document.getElementsByTagName("head").item(0).removeChild(a)}}};JSRequest.timeoutHandler= function(b,a){JSRequest.tHandler=b;JSRequest.TIMEOUT=a||60000};JSRequest.send= function(f,j,s,m,l){if(!f){return}var k=s?"responseFormat="+s:(typeof JSRequest.interceptorXMLRequest==="function"||typeof JSRequest.interceptorXMLResponse==="function")?"responseFormat=ALL":"responseFormat=JSON";var h=(l)?l:Credentials.url;if((/\/openls$|\/openls\/$/.test(h))&&!l){h=h.substring(0,Credentials.url.lastIndexOf("openls"))+Credentials.jsonServletName}if(JSRequest.xmlhttp){JSRequest.sendXHR(f,j,k,h);return}if(JSRequest.host==null&&!l){JSRequest.holder.push(f);JSRequest.holder.push(j);JSRequest.holder.push(s);JSRequest.holder.push(m);if(JSRequest.hostInProgress){return}JSRequest.hostInProgress=true;m=JSRequest.getHostTimeout;var b=new deCarta.XMLStringBuilder();var c=b.createRUOKRequest(Utilities.getRequestId());f=c;j=JSRequest.getHost;k="responseFormat=JSON"}try{if(typeof JSRequest.interceptorXMLRequest==="function"&&JSRequest.host!=null){f=(new DOMParser()).parseFromString(Utilities.normalizePrefixes(f),"text/xml");f=Sarissa.serialize(JSRequest.interceptorXMLRequest(f))}}catch(z){throw new Exception("Application Error: API user application request interceptor function threw error: "+z.message)}var u=1800;var A=h.length;var a=80;var y=(encodeURIComponent(f)).length;var o;var w=1;while(true){if(A+a+(y/w)<u){o=w;break}w++}var q="";var B=Math.ceil(f.length/o);var r=Utilities.parseRequestIDFromXLS(f);var p=0;for(w=1;w<=o;w++){JSRequest.callbackFunctions[r]=j;JSRequest.qtHandler[r]=m;var g;if(p==0){g=Math.round(B*w-B)}else{g=p}var d=Math.round(B*w);p=d;var n=f.substring(g,d);q=encodeURIComponent(n);var C=document.createElement("script");C.setAttribute("type","text/javascript");var t=h+"?reqID="+r+"&chunkNo="+w+"&numChunks="+o+"&callback=JSRequest.callbackRegistry&data="+q+"&"+k;t=t.replace(new RegExp("\\+","g"),"%2b");C.setAttribute("src",t);C.setAttribute("id",r+":"+w);document.getElementsByTagName("head").item(0).appendChild(C);if(JSRequest.TIMEOUT!=-1){setTimeout("JSRequest.checkTimeout('"+r+":"+w+"')",JSRequest.TIMEOUT)}}};JSRequest.sendXHR= function(xml,callback,responseFormat,url){try{if(!Utilities.ie){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalPreferencesWrite UniversalBrowserWrite UniversalPreferencesRead UniversalBrowserRead")}catch(e){}}var xmlhttp=new XMLHttpRequest();xmlhttp.open("POST",url+"?"+responseFormat,true)}catch(e){throw new Exception(e.message+"Depending on your browser settings you may have troubles running JavaScript code that uses the XMLHTTPRequest from your local file system.  XMLHTTPRequest verifies that the request to the server is from a script that is downloaded from that same server.  To remedy this problem, place your app inside tomcat and access from localhost.  Or see the feature of using dynamic script tags (JSON/GET) to bypass this security issue.")}xmlhttp.onreadystatechange= function(){if(xmlhttp.readyState==4){if(xmlhttp.responseText==""){throw new Exception("Problem connecting to DDS Web Services: Please try again later or contact support")}if(xmlhttp.responseText&&xmlhttp.responseText!=null&&xmlhttp.responseText.indexOf("problem connecting to DDS")>0){throw new Exception("Problem connecting to DDS: Please try again later or contact support")}var r=eval(xmlhttp.responseText);if(typeof JSRequest.interceptorXMLResponse==="function"&&r.xmlResponse){var xml=(new DOMParser()).parseFromString(Utilities.normalizePrefixes(r.xmlResponse),"text/xml");JSRequest.interceptorXMLResponse(xml)}if(typeof JSRequest.interceptorJSONResponse==="function"){r.response=JSRequest.interceptorJSONResponse(r.response)}if(r.response){callback(r.response)}else{callback(r)}}};if(typeof JSRequest.interceptorXMLHTTPRequest==="function"){JSRequest.interceptorXMLHTTPRequest(xmlhttp)}xmlhttp.send(xml);return};JSRequest.getHost= function(g){var d=g.XLS.Response.RUOKResponse.hostName;var a=Credentials.url;var f,h;if(a.indexOf("https://")>-1){f="https://"}else{f="http://"}var c=a.substring(f.length);if(c.indexOf(":")>-1){h=c.substring(c.indexOf(":"))}else{h=c.substring(c.indexOf("/"))}JSRequest.host=f+d+h;Credentials.url=JSRequest.host;for(var b=0;b<JSRequest.holder.length;b++){JSRequest.send(JSRequest.holder[b],JSRequest.holder[b+1],JSRequest.holder[b+2],JSRequest.holder[b+3]);b=b+3}JSRequest.maxHostAliases=parseInt(g.XLS.Response.RUOKResponse.maxHostAliases)||0;JSRequest.holder=[];JSRequest.hostInProgress=false};JSRequest.getHostTimeout= function(b){for(var a=0;a<JSRequest.holder.length;a++){if(typeof JSRequest.holder[a+3]=="function"){JSRequest.holder[a+3](null)}a=a+3}JSRequest.holder=[];JSRequest.hostInProgress=false};JSRequest.setXMLHTTPMode= function(){JSRequest.xmlhttp=true};JSRequest.setDynamicScriptTagMode= function(){JSRequest.xmlhttp=false};JSRequest.emulatedZoomRequest= function(z,l,d,g,k){_ll_LUT=["0.000345636472797214,0.000343322753906250","0.000691272945568983,0.000686645507812500","0.001382546303032519,0.001373291015625000","0.002765092605263539,0.002746582031250000","0.005530185203987857,0.005493164062500000","0.011060370355776452,0.010986328125000000","0.022120740293895182,0.021972656250000000","0.044241477246363230,0.043945312500000000","0.088482927761462040,0.087890625000000000","0.176965641673330230,0.175781250000000000","0.353929573271679340,0.351562500000000000","0.707845460801532700,0.703125000000000000","1.415581451872543800,1.406250000000000000","2.830287664051185000,2.812500000000000000","5.653589942659626000,5.625000000000000000","11.251819676168665000,11.250000000000000000","22.076741328793200000,22.500000000000000000","41.170427238429790000,45.000000000000000000","66.653475896509040000,90.00000000000000000","85.084059050110410000,180.00000000000000000","89.787438015348100000,360.00000000000000000"];var m=GLOBALS.DEFAULT_MAP_TILE_SIZE;var C=Utilities.radsPerPixelAtZoomLevel(m,l);var c=0;var w=0;var y=0;var u=0;var n=0;var f=0;var r=z.lat;var o=z.lon;y=Math.round(Utilities.lon2pix(o,C));u=Math.round(Utilities.lat2pix(r,C));var s=r;var p=o;n=(m+(y%m))%m;f=(m+(u%m))%m;var B=n-m/2;var A=f-m/2;r=Utilities.pix2lat(u-f+m/2,C);o=Utilities.pix2lon(y-n+m/2,C);w=Math.floor(y/m);c=Math.floor(u/m);var j=m/2*C*Utilities.EARTH_RADIUS_METERS;j*=Math.cos(r*Math.PI/180);var t="";var b="";if(d){var q=Utilities.urlParse(d.baseUrl);q.queryParameters.LLMAX=_ll_LUT[l-1];q.queryParameters.N=c;q.queryParameters.E=w;b=Utilities.urlCompose(q)}if(g){var h=Utilities.urlParse(g.baseUrl);h.queryParameters.ZOOM=Utilities.deCartaToGXZoomLevel(l);h.queryParameters.LL=z.lat+", "+z.lon;h.queryParameters.N=0;h.queryParameters.E=0;t=Utilities.urlCompose(h)}var a={};a.XLS={};a.XLS.Response={};a.XLS.ResponseHeader={};a.XLS.ResponseHeader.ErrorList=false;a.XLS.Response.PortrayMapResponse={};a.XLS.Response.PortrayMapResponse.TileGrid=[];a.XLS.Response.PortrayMapResponse.TileGrid[0]={};a.XLS.Response.PortrayMapResponse.TileGrid[1]={};a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan=[];a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[0]={};a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[0].direction="E";a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[0].numTiles=(B/GLOBALS.DEFAULT_MAP_TILE_SIZE);a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[0].toLon=p;a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[1]={};a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[1].direction="N";a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[1].numTiles=A/GLOBALS.DEFAULT_MAP_TILE_SIZE;a.XLS.Response.PortrayMapResponse.TileGrid[0].Pan[1].toLat=s;a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext={};a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint={};a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint.pos={};a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint.pos.content=r+" "+o;a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint.radius={};a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint.radius.content=j;a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.Radius={};a.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.Radius.content=j;a.XLS.Response.PortrayMapResponse.TileGrid[0].Tile={};a.XLS.Response.PortrayMapResponse.TileGrid[0].Tile.Map={};a.XLS.Response.PortrayMapResponse.TileGrid[0].Tile.Map.Content={};a.XLS.Response.PortrayMapResponse.TileGrid[0].Tile.Map.Content.URL=b;a.XLS.Response.PortrayMapResponse.TileGrid[1].Tile={};a.XLS.Response.PortrayMapResponse.TileGrid[1].Tile.Map={};a.XLS.Response.PortrayMapResponse.TileGrid[1].Tile.Map.Content={};a.XLS.Response.PortrayMapResponse.TileGrid[1].Tile.Map.Content.URL=t;if(typeof k==="function"){k(a)}};function KML(c,a,b){if(!c){throw new Exception("Error constructing a KML object, geometry is required")}this.geometry=c;this.name=a||null;this.description=b||null}function KMLGeometry(a,b){this.type=a;this.coordinates=b}deCarta.LinkedList= function(){this.length=0;this.head=null;this.index=deCarta.LinkedList.Config.genIndex()};deCarta.LinkedList.Config={};deCarta.LinkedList.Config.itemBackPointer="dCLLItemPointer";deCarta.LinkedList.Config.itemBackPointerIndex=0;deCarta.LinkedList.Config.genIndex= function(){return(deCarta.LinkedList.Config.itemBackPointer+deCarta.LinkedList.Config.itemBackPointerIndex++)};deCarta.LinkedList.prototype.add= function(a){var b=null;try{b=new deCarta.LinkedListItem(a,this.index)}catch(c){throw new Exception("Error LinkedList.add(): "+c.message)}if(!this.head){this.head=b;this.head.next=null;this.head.prev=null}else{this.head.prev=b;b.next=this.head;b.prev=null;this.head=b}this.length++};deCarta.LinkedList.prototype.remove= function(b){var c=null;var a=null;if(this.length<=0){return null}if(!b){c=this.head;this.head=c.next}else{if((b.data)&&b.data.hasOwnProperty(this.index)){c=b}else{if(b.hasOwnProperty(this.index)){c=b[this.index]}else{throw new Exception("Attempting to remove an item that's not really a part of the LinkedList.")}}}if(c.prev){c.prev.next=c.next}else{this.head=c.next}if(c.next){c.next.prev=c.prev}a=c.destroy(this.index);this.length--;return a};deCarta.LinkedList.prototype.removeByKey= function(g,b){var f;var d=this.length;var a=this.head;var c;var h=new Array();if(!g||!b){throw new Exception("Attempt to removeByKey keyName: "+g+" and keyVal: "+b)}if(this.length<=0){return null}for(f=0;f<d;f++){c=a;a=c.next;if(b==c.data[g.toString()]){h.push(this.remove(c))}}if(!h.length){return null}else{return h}};deCarta.LinkedList.prototype.removeById= function(c,h){var g;var f=this.length;var b=this.head;var d;var a=null;if(!c||!h){throw new Exception("Attempt to removeByKey keyName: "+c+" and keyVal: "+h)}if(this.length<=0){return null}for(g=0;g<f;g++){d=b;b=d.next;if(h==d.data[c.toString()]){a=this.remove(d);return a}}return null};deCarta.LinkedList.prototype.removeAll= function(){var a=[];var b=null;while(this.length>0){b=this.remove();a.push(b)}return a};deCarta.LinkedList.prototype.returnAsArray= function(){var a=[];var b;var d=this.head;var c=null;for(b=0;b<this.length;b++){a.push(d.data);c=d.next;d=c}return a};deCarta.LinkedList.prototype.operateOnData= function(a){var b;var d=this.head;var c=null;if(typeof a!="function"){throw new Exception("Attempt operateOnData without a function.")}for(b=0;b<this.length;b++){a(d.data);c=d.next;d=c}};deCarta.LinkedListItem= function(b,a){if(!b||(typeof b!="object")||!a){throw new Exception("LinkedList Error: Attempt to add null or primitive.")}if(b.hasOwnProperty(a)){throw new Exception("LinkedList Error: newData already containsproperty backpointer: "+a)}this.data=b;b[a]=this;this.next=null;this.prev=null};deCarta.LinkedListItem.prototype.destroy= function(b){var a=this.data;this.data=null;this.next=null;this.prev=null;delete a[b];return a};function Locale(b,a){this.language=b.toUpperCase();this.country=a.toUpperCase()}Locale.prototype.getLanguage= function(){return this.language};Locale.prototype.setLanguage= function(a){this.language=a.toUpperCase()};Locale.prototype.getCountry= function(){return this.country};Locale.prototype.setCountry= function(a){this.country=a.toUpperCase()};Locale.prototype.toString= function(){return this.language+"_"+this.country};function Map(T){deCarta.StyleManager.init();if(!(T&&T.style)){throw new Exception("Must supply a div element to construct the map.")}this.mapDiv=T;var b=parseInt(deCarta.StyleManager.getCurrentStyle(T,"height"));b=(!isNaN(b))?b:this.mapDiv.offsetHeight;b=(b)?b+"px":GLOBALS.DEFAULT_MAP_HEIGHT;this.mapDiv.style.height=b;var aW=parseInt(deCarta.StyleManager.getCurrentStyle(T,"width"));aW=(!isNaN(aW))?aW:this.mapDiv.offsetWidth;aW=(aW)?aW+"px":GLOBALS.DEFAULT_MAP_WIDTH;this.mapDiv.style.width=aW;this.type="map";var aP=this;var a={};var ao=undefined;var aT=null;var C=null;var ah=null;var z=null;var aN=null;var O=null;var aG=null;var a6=new deCarta.XMLStringBuilder();a6.mapType=GLOBALS.STREET;var a9="server";var aU=false;var g=[];var V=new Array();var ad=new deCarta.LinkedList();var n={};var aR=null;var ab=null;var c=Utilities.ie;var B="px";var aI=0;var al=true;var aV=false;var aj=0;var ag=0;var R=false;var aL=false;var a2=0;var a0=0;var s=false;var W=true;var au=true;var aD=new Date();var ak=new Date();var f=false;var ax=false;var aZ=false;var h=37;var ai=null;var E=GLOBALS.DEFAULT_MAP_TILE_SIZE;var j=E;var aw=0;var a1=0;var D=2;var aq=false;var aH=new PixelPoint(0,0);var aM=0;var aJ=0;var aQ=0;var aO=0;var a7=0;var aK=0;var av=0;var at=0;var a3=false;var U=false;var an=false;var ay={x:0,y:0};var aa={x:0,y:0};var F=null;var aX=null;var d=null;var ar=null;var K=true;var S=undefined;var G=false;this.authenticate= function(bb,ba){if(!bb||!ba||bb==""||ba==""){throw new Exception("Error calling Map.authenticate(), bad params")}Credentials.clientName=bb;Credentials.clientPassword=ba;a6.clientName=bb;a6.clientPassword=ba};this.setURL= function(ba){Credentials.url=ba};this.setConfiguration= function(ba){if(!ba){throw new Exception("error calling Map.setConfiguration() with argument: "+ba)}Credentials.configuration=ba;a6.configuration=ba};this.setTransparentConfiguration= function(ba){if(!ba){throw new Exception("error calling Map.setTransparentConfiguration() with arg: "+ba)}Credentials.transparentConfiguration=ba;a6.transparentConfiguration=ba};this.setMapStyle= function(ba){Credentials.configuration=ba;a6.configuration=ba;if(n[GLOBALS.STREET]&&n[GLOBALS.STREET].refUrl){n[GLOBALS.STREET].refUrl.setParameter("config",ba);n[GLOBALS.STREET].refresh()}};this.setMapFormat= function(ba){a6.streetImgFormat=ba;if(n[GLOBALS.STREET]&&n[GLOBALS.STREET].refUrl){n[GLOBALS.STREET].refUrl.setParameter("format",ba);n[GLOBALS.STREET].refresh()}};this.changeCurrentMapStyle= function(ba){setMapStyle(ba)};this.reDrawMap= function(ba){if(!n[GLOBALS.STREET]&&!n[GLOBALS.SATELLITE]&&!n[GLOBALS.HYBRID]){return false}aP.centerOnPosition(aP.getCenterPosition(),ba);return true};this.addCopyrightMessage= function(bb,ba,bc){if(deCarta.String.isString(bb)){aT=new deCarta.CopyrightMessage(bb)}else{aT=bb}aP.addMapControl(aT);if(ba&&bc){aT.position= function(){};aT.frame.style.top=bc+B;aT.frame.style.left=ba+B}};this.getViewHash= function(){function bf(bh,bg){while(bh.length<bg){bh="0"+bh}return bh}var bd=C.getZoomLevel();var be=aP.getCenterPosition();var bb=bf(this._n2s(Math.round((90+be.getLat())*10000)),5);var bc=bf(this._n2s(Math.round((180+be.getLon())*10000)),5);var ba=bf(this._n2s(bd),1);return ba+bb+bc};this.restoreViewFromHash= function(bb){var ba=aP.parseViewHash(bb);if(!ba){return}aP.zoomMap(ba.zoom);aP.panToPosition(ba.center,function(){},true)};this.parseViewHash= function(be){try{var ba=this._s2n(be.substr(0,1));var bd=(this._s2n(be.substr(1,5))/10000)-90;var bf=(this._s2n(be.substr(6,5))/10000)-180;if(isNaN(ba)||isNaN(bd)||isNaN(bf)){return false}var bc=new Position(bd,bf)}catch(bb){return false}return{zoom:ba,center:bc}};this._n2s= function(ba){var bc="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-=";var bb="";while(ba>0){var bd=ba%64;ba=ba>>6;bb=bc.charAt(bd)+bb}return bb};this._s2n= function(bd){var bc="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-=";var bb=0;for(var ba=0;ba<bd.length;ba++){var bf=bd.charAt(ba);var be=bc.indexOf(bf);bb=(bb<<6)+be}return bb};this.centerOnPosition= function(ba,bf,bd,bb){var bg=Utilities.getRequestId();if(typeof bf=="function"){g[bg]=bf}else{g[bg]=null}var be=Utilities.getRequestId();var bc=a6.createMapRequest(ba,E,bg,C?C.getZoomLevel():5,null,bd,be);JSRequest.send(bc,function(bh){ai=ba.clone();Z();aP.hidePinsBeforeZoom();ap(bh)},null,function(bh){g[bh]=undefined});if(z&&z.frame&&!bb){z.centerOnPosition(ba)}else{if(z&&z.frame&&bb){z.panToPosition(ba)}}};this.panToPosition= function(bf,ba,bg){var bc=bf.clone();var bi=aP.getCenterPosition();var be=this.posToMercPix(bi);var bb=this.posToMercPix(bc);var bd=new PixelPoint(Math.round(be.x-bb.x),Math.round(be.y-bb.y));if(ai&&C.getRadius()){var bh=Utilities.centerContextToBoundingBox(bi,C.getRadius());if(bh.extendedContains(bc)){if(typeof ba=="function"){g.panToPosition=ba}else{g.panToPosition=null}if(bd.x==0&&bd.y==0){if(g.panToPosition){g.panToPosition(aP.getCenterPosition());g.panToPosition=undefined}return}else{if(bg){aQ+=bd.x;aO-=bd.y;av+=bd.x;at-=bd.y;aF(aQ,aO);a5()}else{A(bd.x,-1*bd.y)}if(z&&z.frame){z.panToPosition(bc)}}}else{this.centerOnPosition(bc,ba,null,true)}}else{this.centerOnPosition(bc,ba,null,true)}};this.getCenterPosition= function(){if(!ai){throw new Exception("Center Position not set")}var bc=aQ-a7;var bb=aO-aK;if(bc==0&&bb==0){return ai}var ba=aP.posToMercPix(ai);ba.x-=bc;ba.y+=bb;var bd=aP.mercPixToPos(ba);return bd};this.addCustomInfoWindow= function(ba){if(ab&&aG){ab.removeChild(aG.bubble)}aG=ba;if(ab){ab.appendChild(aG.bubble)}};this.getInfoWindow= function(){var ba=aG||null;return ba};this.addAndCenterOnPin= function(ba){this.addPin(ba);this.panToPosition(ba.position)};this.addPin= function(ba){if(ai==null){throw new Exception("Error adding Pin, you can not add a pin until the center Position is set. Please use the callback of map.centerPosition().")}try{ad.add(ba)}catch(bb){return}ba.map=aP;ba.setPosition(ba.position);ab.appendChild(ba.pinImg);if(ba.pinTxt){ab.appendChild(ba.pinTxt)}};this.getPins= function(){return ad.returnAsArray()};this.getPinById= function(bb){var ba=null;ad.operateOnData(function(bc){if(!bc){return null}if(bc.getId()==bb){ba=bc}});return ba};this.hidePins= function(){ad.operateOnData(function(ba){if(!ba){return}ba.pinImg.style.display="none";ba.pinTxt.style.display="none"})};this.showPins= function(){ad.operateOnData(function(ba){ba.pinImg.style.display="block";ba.pinTxt.style.display="block"})};this.removeAllPins= function(){var ba;while(ad.length>0){ba=ad.remove();ba.destroy()}};this.removePin= function(bb){var ba=null;try{ba=ad.remove(bb)}catch(bc){return}if(!ba){return}ba.destroy()};this.removePinById= function(bc){try{var ba=ad.removeById("id",bc)}catch(bb){return}if(!ba){return}if(ba.pinTxt){Utilities.purge(ba.pinTxt);ab.removeChild(ba.pinTxt);ba.pinTxt=null}Utilities.purge(ba.pinImg);ab.removeChild(ba.pinImg)};this.removePinsById= function(be){var ba=null;var bc=null;var bb;try{ba=ad.removeByKey("id",be)}catch(bd){return}if(!ba){return}for(bb=0,bc=ba.length;bb<bc;bb++){if(ba[bb].pinTxt){Utilities.purge(ba[bb].pinTxt);ab.removeChild(ba[bb].pinTxt);ba[bb].pinTxt=null}Utilities.purge(ba[bb].pinImg);ab.removeChild(ba[bb].pinImg)}};this.setDragEasingEnabled= function(ba){U=ba};this.setDragEnabled= function(ba){if(!"boolean"==(typeof ba)){throw new Exception("Map.setDragEnabled requires boolean")}al=ba};this.setRightClickBBoxZoomEnabled= function(ba){if(!"boolean"==(typeof ba)){throw new Exception("Map.setRightClickBBoxZoomEnabled requires boolean")}a3=ba};this.setShapeClippingEnabled= function(ba){if(!"boolean"==(typeof ba)){throw new Exception("Map.setShapeClippingEnabled requires boolean")}aU=ba};this.setDoubleClickRecenteringEnabled= function(ba){if(!"boolean"==(typeof ba)){throw new Exception("Map.setDoubleClickRecenteringEnabled requires boolean")}au=ba};this.setDoubleClickRecenterAndZoom= function(ba){if(ba){ax=true}else{ax=false}};this.setDigitalZoomEnabled= function(ba){if(ba){W=true}else{W=false}};this.setTileFadingEnabled= function(ba){K=ba};this.getTileFading= function(){return K};this.setWheelZoomEnabled= function(ba){G=ba};this.setPanTimeoutDelay= function(ba){h=ba||37};this.addOverlay= function(ba){if(!ba){return}if(deCarta.Array.isArray(ba)){var bc=ba.length;for(var bb=0;bb<bc;bb++){ba[bb].map=aP;a6.overlays.push(ba[bb]);this.drawShape(ba[bb])}}else{ba.map=aP;a6.overlays.push(ba);this.drawShape(ba)}};this.drawShape= function(bh,bd){if(!(bh instanceof DDSShape)){return}if(bh.rendering=="server"||(a9=="server"&&bh.rendering!="client")){return}if(!bh.isVisible){return}if(!aP.getTileDiv()){return}var ba=aX;if(!ba){aX=ba=k()}var bn=aP.getBoundingBox();var bi=ba.bbox;if(!bd&&y(bh,bn,bi)){aC();return}if(bh.raphael_element){bh.raphael_element.remove()}var bx=C.getZoomLevel();var bg=Utilities.radsPerPixelAtZoomLevel(E,bx);var bf=new Position(bi.maxPosition.lat+" "+bi.minPosition.lon);var bj=Math.round(Utilities.lat2pix(bf.lat,bg));var bk=Math.round(Utilities.lon2pix(bf.lon,bg));var bu="rgb("+bh.borderColorRed+","+bh.borderColorGreen+","+bh.borderColorBlue+")";var bJ="rgb("+bh.fillColorRed+","+bh.fillColorGreen+","+bh.fillColorBlue+")";var bt=bh.fillOpacityFloat;var bc=bh.getBorderWidth();var be=bh.strokeOpacityFloat;var bK=null;var bm=[];if(bh.type=="polygon"||bh.type=="line"){var bB="";var bI=[];var bH=[];if(bh.type=="line"){bc=bh.getWidth();bJ="none";if(bh.clip||aU){bm=bh.getMercPixelsClipped(bx,E,bi)}else{bm[0]=bh.getMercPixels(bx,E)}}else{if(bh.type=="polygon"){bm[0]=bh.getMercPixels(bx,E)}else{throw new Exception("Map inner function draw: fell through to unacceptable situation with line/polygon client side rendering.")}}var bb=Math.round(Utilities.lon2pix(180,bg));var by=bh.getBoundingBox();var bv=bi.minPosition.lon-by.minPosition.lon;var bl=bm.length;for(var bG=0;bG<bl;bG++){var bs=bm[bG].length;bI[bG]=[];bH[bG]=[];for(var bF=0;bF<bs;bF++){var bD=bm[bG][bF];bI[bG][bF]=parseInt(bk-bD.x);if(bv>180){bI[bG][bF]=bI[bG][bF]-2*bb}else{if(bv<(-180)){bI[bG][bF]=bI[bG][bF]+2*bb}}bH[bG][bF]=parseInt(bj-bD.y);if(bF==0){bB+="M "+bI[bG][bF]*-1+" "+bH[bG][bF]+" "}else{bB+="L "+bI[bG][bF]*-1+" "+bH[bG][bF]+" "}}}if(bh.type=="polygon"){bB+="z"}bK=ba.path(bB)}else{if(bh.type=="circle"){var br=bh.getPosition();var bo=Math.round(Utilities.lat2pix(br.lat,bg));var bq=Math.round(Utilities.lon2pix(br.lon,bg));var bz=parseInt(bk-bq);var bw=parseInt(bj-bo);var bC=bh.getRadius().getDegrees();var bE=Math.round(Utilities.lat2pix(br.lat+bC,bg));var bp=parseInt(bE-bo);bK=ba.circle(-bz,bw,bp)}}bK.attr({stroke:bu,fill:bJ,"fill-opacity":bt,"stroke-width":bc,"stroke-opacity":be});for(var bA in bh.eventListenerMap){if(bh.eventListenerMap.hasOwnProperty(bA)){if(typeof(bh.eventListenerMap[bA])=="function"){bK.node[bA]= function(bO){bO=bO?bO:window.event;var bM=this.raphael.owner_shape;var bL=bO.type;bL="on"+bL;var bN=bM.eventListenerMap[bL];bN(bM)}}}}bK.owner_shape=bh;deCarta.IdManager.setTag(bK.node,"ignoreForMapEvents");bh.raphael_element=bK};this.getOverlays= function(){var bb=[];var bc=a6.overlays.length;for(var ba=0;ba<bc;ba++){bb[ba]=a6.overlays[ba]}return bb};this.getOverlayById= function(bb){for(var ba=0;ba<a6.overlays.length;ba++){if(a6.overlays[ba]&&a6.overlays[ba].id==(bb)){return a6.overlays[ba]}}return null};this.removeOverlay= function(ba){if(!ba){return}ba.map=null;var bc=new Array();for(var bb=0;bb<a6.overlays.length;bb++){if(a6.overlays[bb]&&!a6.overlays[bb].equals(ba)){bc.push(a6.overlays[bb])}}a6.overlays=bc;if(ba.raphael_element){ba.raphael_element.remove()}ba.raphael_element=null};this.removeOverlayById= function(bc){var bb=new Array();for(var ba=0;ba<a6.overlays.length;ba++){if(a6.overlays[ba]&&a6.overlays[ba].id!=(bc)){bb.push(a6.overlays[ba])}else{if(a6.overlays[ba]&&a6.overlays[ba].id==(bc)){a6.overlays[ba].map=null;if(a6.overlays[ba].raphael_element){a6.overlays[ba].raphael_element.remove();a6.overlays[ba].raphael_element=null}}}}a6.overlays=bb};this.removeAllOverlays= function(){if(a6==null||a6.overlays==null||(a6.overlays.length<=0)){return}for(var bb=a6.overlays.length-1;bb>=0;bb--){var ba=a6.overlays[bb];if(ba.eventListenerMap){ba.eventListenerMap.onclick=null}if(ba.raphael_element){ba.raphael_element.owner_shape=null;if(ba.raphael_element.node){ba.raphael_element.node.onclick=null}ba.raphael_element.remove()}ba.raphael_element=null;a6.overlays[bb]=null}a6.overlays=[];aC(true)};this.addRouteIDOverlay= function(ba){a6.routeIDOverlay=ba};this.removeRouteIDOverlay= function(){a6.routeIDOverlay=null};this.setShapeRendering= function(ba){if(!ba||!ba=="client"||!ba=="server"){throw new Exception("map.setShapeRendering() error: use 'client' or 'server'")}if(ba=="server"){aA()}else{a9=ba;a6.rendering=ba;aC()}a9=ba;a6.rendering=ba};this.getShapeRendering= function(){return a9};function y(ba,bc,be){if(!bc){return false}if(!be){return true}if(be.equals(bc)||be.containsBoundingBox(bc)){return false}var bf=ba.getBoundingBox();if(be.containsBoundingBox(bf)){return false}var bb=bf.getOverlapBoundingBox(be);var bd=bf.getOverlapBoundingBox(bc);if(bd&&(!bb||!bb.containsBoundingBox(bd))){return true}else{return false}}this.onRotate= function(ba){S=ba};this.redraw= function(){var bb=false;var ba=a6.overlays;if(!aX){return}if(!aP.getTileDiv()){return}aC()};this.panWest= function(){A(GLOBALS.PAN_PIXEL_DISTANCE,0)};this.panEast= function(){A(-GLOBALS.PAN_PIXEL_DISTANCE,0)};this.panNorth= function(){A(0,GLOBALS.PAN_PIXEL_DISTANCE)};this.panSouth= function(){A(0,-GLOBALS.PAN_PIXEL_DISTANCE)};this.panSouthEast= function(){A(-GLOBALS.PAN_PIXEL_DISTANCE,-GLOBALS.PAN_PIXEL_DISTANCE)};this.panNorthEast= function(){A(-GLOBALS.PAN_PIXEL_DISTANCE,GLOBALS.PAN_PIXEL_DISTANCE)};this.panSouthWest= function(){A(GLOBALS.PAN_PIXEL_DISTANCE,-GLOBALS.PAN_PIXEL_DISTANCE)};this.panNorthWest= function(){A(GLOBALS.PAN_PIXEL_DISTANCE,GLOBALS.PAN_PIXEL_DISTANCE)};this.addScaleBar= function(ba){ao=ba;aP.addMapControl(ao)};this.getScaleBar= function(){return ao};this.addMapTypeController= function(ba){if(!ba){throw new Exception("error adding mapTypeController to map")}O=ba;aP.addMapControl(O)};this.setMapType= function(bb){if(!(bb==GLOBALS.STREET||bb==GLOBALS.HYBRID||bb==GLOBALS.SATELLITE)){throw new Exception("unsupported mapType. Use '"+GLOBALS.STREET+"' || '"+GLOBALS.HYBRID+"' || '"+GLOBALS.SATELLITE+"'")}a6.mapType=bb;var ba=false;if(!n||Utilities.isObjectEmpty(n)){return}if(aR){aR.hide()}if(!n[bb]){ac(bb);ba=true}for(layerType in n){if(layerType==bb){n[layerType].show();if(bb==GLOBALS.HYBRID){n[GLOBALS.SATELLITE].show()}}else{if(bb==GLOBALS.HYBRID){if(layerType!=GLOBALS.SATELLITE){n[layerType].hide()}}else{n[layerType].hide()}}}if(z&&z.frame){z.setMapType(bb)}if(ba){this.centerOnPosition(aP.getCenterPosition())}};this.addZoomController= function(ba){C=ba;aP.addMapControl(C);if(ah){C.frame.style.top="61px";C.frame.style.left="21px"}};this.addShapeDrawingTool= function(ba){aN=ba;aP.addMapControl(aN)};this.addPanController= function(ba){ah=ba;aP.addMapControl(ah);if(C){C.frame.style.top="61px";C.frame.style.left="21px"}};this.addMapOverviewController= function(ba){z=ba;aP.addMapControl(z)};this.getZoomController= function(){return C};this.getPanController= function(){return ah};this.getXmlRecFac= function(){return a6};this.resize= function(bj,ba,bh){var bd=parseInt(aP.mapDiv.style.width);var bi=parseInt(aP.mapDiv.style.height);aP.mapDiv.style.height=parseInt(bj)+B;aP.mapDiv.style.width=parseInt(ba)+B;aP.positionMapControls();if(!ab){return}a4();for(var be in n){if(n.hasOwnProperty(be)){var bg=n[be];bg.resize(aw,a1)}}var bc=aQ-a7-(parseInt(ba)-bd)/2;var bb=aO-aK-(parseInt(bj)-bi)/2;var bf=aP.posToMercPix(ai);bf.x-=bc;bf.y+=bb;ai=aP.mercPixToPos(bf);a7=aQ;aK=aO;if(typeof bh=="function"){bh(aP.getCenterPosition())}if(z&&z.frame){z.panToPosition(aP.getCenterPosition())}Q();q()};this.getBoundingBox= function(){var bd=aP.posToMercPix(aP.getCenterPosition());var bb=(a1*E/2);var bh=(aw*E/2);var be=new PixelPoint(bd.x+bh,bd.y+bb);var bf=new PixelPoint(bd.x-bh,bd.y-bb);var ba=aP.mercPixToPos(be);var bc=aP.mercPixToPos(bf);var bg=new BoundingBox(bc,ba);return bg};this.getBoundingBoxViewable= function(){var bc=aP.posToMercPix(aP.getCenterPosition());var bb=parseInt(aP.mapDiv.style.height)/2;var bh=parseInt(aP.mapDiv.style.width)/2;var bf=new PixelPoint(bc.x+bh,bc.y+bb);var be=new PixelPoint(bc.x-bh,bc.y-bb);var bg=aP.mercPixToPos(bf);var ba=aP.mercPixToPos(be);var bd=new BoundingBox(ba,bg);return bd};this.setOnlyLoadTilesInViewport= function(ba){aq=(ba)?true:false};this.getOnlyLoadTilesInViewport= function(){return aq};this.getGridSize= function(){return a1+" "+aw};this.setTileBuffer= function(ba){if(ba){D=2}else{D=1}};this.setTileBorder= function(bb){if(bb){aI=1}else{aI=0}for(var bc in n){if(n.hasOwnProperty(bc)){if(n[bc].tileArray){for(var bd=0;bd<a1;++bd){for(var ba=0;ba<aw;++ba){n[bc].tileArray[ba][bd].border=aI}}}}}};this.getTileSize= function(){return E};this.setTileSize= function(ba){E=parseInt(ba,10);j=E;if(ab){s=true}};this.positionToMapLayerPixel= function(bi){if(!bi||!ai){throw new Exception("Map.positionToMapLayerPixel: bad input: "+bi)}var bc=aP.getCenterPosition();var bk=aP.posToMercPix(bc);var bh=parseInt(aP.mapDiv.style.height)/2;var bg=parseInt(aP.mapDiv.style.width)/2;var bd=new PixelPoint(bk.x-bg,bk.y+bh);var bf=this.posToMercPix(bi);var be=Utilities.radsPerPixelAtZoom(E,C.getGXConvertedZoomLevel());var ba=Utilities.lon2pix(180,be);var bj=-(bd.roundX()-bf.roundX());if(bj>ba){bj-=ba*2}else{if(bj<(-ba)){bj+=ba*2}}var bb=new PixelPoint(bj-aQ,bd.roundY()-bf.roundY()-aO);return bb};this.addMapControl= function(bd){if(!bd){throw new Exception("adding invalid control to map.")}else{if(!bd.type||bd.map){throw new Exception("adding invalid control to map, with properties type:"+bd.type+" map:"+bd.map)}}var bb=bd.type;if(this.existsMapControl(bb)){this.removeMapControl(bb)}a[bb]=bd;bd.map=this;var ba=bd.appendThis();if(ba){this.getMapDiv().appendChild(ba)}var bc=new deCarta.DOMDimensions(this.getMapDiv());bd.position(bc)};this.existsMapControl= function(ba){if(a[ba]){return true}else{return false}};this.removeMapControl= function(ba){if(!ba||!(ba&&a[ba])){return}var bb=a[ba];a[ba]=undefined;this.getMapDiv().removeChild(bb.removeThis());Utilities.purge(bb)};this.positionMapControls= function(){var ba;var bb=new deCarta.DOMDimensions(this.getMapDiv());for(ba in a){if(a.hasOwnProperty(ba)&&a[ba].position){a[ba].position(bb)}}};this.getMapLayers= function(){return n};this.hide= function(){this.getMapDiv().style.display="none"};this.show= function(){this.getMapDiv().style.display="block";this.positionMapControls()};this.setCompatibility= function(bb,ba){switch(bb){case"restrictDragToDiv":if(ba){this.addEventListener("mouseout",w)}else{this.clearListeners("mouseout")}break;default:throw new Exception("Map.setCompatibility: illegal flag: "+bb.toString()+" passed in as argument.");break}};function p(){aG=new DefaultInfoWindow({autoHeight:true})}this.addEventListener= function(bc,bd){var bb=false;for(var ba=0;ba<V.length;ba++){if(V[ba]==bc){V[bc]=bd;bb=true;break}}if(!bb){V.push(bc);V[bc]=bd}};this.getEventListener= function(bb){for(var ba=0;ba<V.length;ba++){if(V[ba]==bb){return V[bb]}}return null};this.clearInstanceListeners= function(){for(var ba=0;ba<V.length;ba++){V[V[ba]]=null;V[ba]=null}};this.clearListeners= function(bb){for(var ba=0;ba<V.length;ba++){if(V[ba]==bb){V[V[ba]]=null;V[ba]=null}}};function aB(bc){if(!GLOBALS.ALLOWDOMEVENTS){return true}bc=bc?bc:window.event;var ba;if(bc.target){ba=bc.target}else{if(bc.srcElement){ba=bc.srcElement}}if(ba&&ba.nodeType==3){ba=ba.parentNode}if(deCarta.IdManager.checkTag(ba,"ignoreForMapEvents")){return true}if(bc.type=="mouseup"){ak=new Date();var bd=new PixelPoint(bc.clientX,bc.clientY);var bb=aP.screenPixToPos(bd);if(V.mouseup){V.mouseup(bb)}if((ak-aD)<300&&V.rightclick&&((c&&bc.button==2)||(!c&&bc.which==3))){if(this.rtClickBoxUpHandler){this.rtClickBoxUpHandler(bc)}V.rightclick(bb,bc);bc.preventDefault();bc.stopPropagation();return false}}else{if(bc.type=="dblclick"){if(F){clearTimeout(F);F=undefined}ae(bc)}else{if(bc.type=="click"&&((ak-aD)<300)){I(bc)}}}}function I(bc){bc=bc?bc:window.event;var ba;if(bc.target){ba=bc.target}else{if(bc.srcElement){ba=bc.srcElement}}if(ba&&ba.nodeType==3){ba=ba.parentNode}if(deCarta.IdManager.checkTag(ba,"ignoreForMapEvents")){return false}ar.style.cursor="pointer";ar.unselectable="on";var bd=new PixelPoint(bc.clientX,bc.clientY);var bb=aP.screenPixToPos(bd);if(V.dblclick&&bc.type=="dblclick"){V.dblclick(bb);return false}if(V.click&&bc.type=="click"){V.click(bb);return false}return false}function af(be){if(!GLOBALS.ALLOWDOMEVENTS){return true}be=be?be:window.event;aD=new Date();var bb;if(be.target){bb=be.target}else{if(be.srcElement){bb=be.srcElement}}if(bb&&bb.nodeType==3){bb=bb.parentNode}if(deCarta.IdManager.checkTag(bb,"ignoreForMapEvents")){return true}var bb;if(be.target){bb=be.target}else{if(be.srcElement){bb=be.srcElement}}if(bb&&bb.nodeType==3){bb=bb.parentNode}if(deCarta.IdManager.checkTag(bb,"ignoreForMapEvents")){return true}if((!c&&be.which==3)||(c&&be.button==2)){if(a3){be.stopPropagation?be.stopPropagation():be.cancelBubble=true;var bi=be.clientX;var bh=be.clientY;var bc=document.getElementById("decarta-bbox-div");if(!bc){bc=document.createElement("div");bc.className="decarta-bbox-div";bc.id="decarta-bbox-div";ar.appendChild(bc)}bc.style.display="block";bc.style.width=null;bc.style.height=null;var bf=Utilities.getAbsoluteTop(aP.mapDiv);var bg=Utilities.getAbsoluteLeft(aP.mapDiv);bc.style.top=(bh-bf)+"px";bc.style.left=(bi-bg)+"px";ar.style.cursor="move";this.rtClickBoxUpHandler= function(bl){if(!bc){return}ar.style.cursor="default";var bk,bj;if(bc.style.width&&bc.style.height){bk=new PixelPoint(parseInt(bc.style.left)+Utilities.getAbsoluteLeft(aP.mapDiv)+parseInt((bc.style.width)?bc.style.width:0),parseInt(bc.style.top)+Utilities.getAbsoluteTop(aP.mapDiv));bj=new PixelPoint(parseInt(bc.style.left)+Utilities.getAbsoluteLeft(aP.mapDiv),parseInt(bc.style.top)+Utilities.getAbsoluteTop(aP.mapDiv)+parseInt(bc.style.height?bc.style.height:0));var bn=aP.screenPixToPos(bk);var bo=aP.screenPixToPos(bj);var bm=new BoundingBox(bo,bn);if(aR){aR.hide()}C.setZoomLevel(C.getZoomLevelToFitBoundingBox(bm));aP.centerOnPosition(bm.getCenterPosition(),function(){if(V.zoomend){V.zoomend()}})}bc.style.display="none";bc=undefined;aP.rtClickBoxMoveHandler=null;aP.rtClickBoxUpHandler=null;return false};document.body.onmouseup=this.rtClickBoxUpHandler;this.rtClickBoxMoveHandler= function(bk){if(!bc){return}bk=bk?bk:window.event;var bj=bk.clientX;var bl=bk.clientY;if(bk.clientX>bi&&bk.clientY>bh){bc.style.height=(bl-bh)+"px";bc.style.width=(bj-bi)+"px"}else{if(bk.clientX<bi&&bk.clientY<bh){bc.style.height=(bh-bl)+"px";bc.style.width=(bi-bj)+"px";bc.style.top=(bh-(bh-bl)-bf)+"px";bc.style.left=(bi-(bi-bj)-bg)+"px"}else{if(bk.clientX<bi&&bk.clientY>bh){bc.style.height=(bl-bh)+"px";bc.style.width=(bi-bj)+"px";bc.style.left=(bi-(bi-bj)-bg)+"px"}else{if(bk.clientX>bi&&bk.clientY<bh){bc.style.height=(bh-bl)+"px";bc.style.width=(bj-bi)+"px";bc.style.top=(bh-(bh-bl)-bf)+"px"}}}}return false};document.body.onmousemove=this.rtClickBoxMoveHandler}return true}if((!c&&be.which==2)||(c&&be.button==4)){return true}if(V.mousedown){var bd=new PixelPoint(be.clientX,be.clientY);var ba=aP.screenPixToPos(bd);V.mousedown(ba)}aV=true;ar.style.cursor="move";aj=be.clientX;ag=be.clientY;document.body.onmousemove=u;document.body.onmouseup=w;return false}function w(ba){aV=false;ar.style.cursor="default";document.body.onmousemove=null;document.body.onmouseup=null;if(aZ&&V.moveend){V.moveend();aZ=false}if(ao){ao.calculate()}for(var bb in n){if(n.hasOwnProperty(bb)){n[bb].showTilesInViewport()}}az();if(an){m();an=false}if(z&&z.frame){z.panToPosition(aP.getCenterPosition())}return false}function m(){var ba=(aa.x-ay.x);var bd=(aa.y-ay.y);var bc=ba*Math.abs(ba);var bb=bd*Math.abs(bd);bc=bc>256?256:bc;bc=bc<-256?-256:bc;bb=bb>256?256:bb;bb=bb<-256?-256:bb;t(bc,bb,new Date().getTime(),300,deCarta.Easing("sineout"),0,0)}function t(bf,be,bc,bd,bi,bb,ba){if(!bf&&!be){F=undefined;return}var bl=new Date().getTime()-bc;if(bl>bd){bl=bd}var bk=bi(bl,0,bf,bd);var bj=bi(bl,0,be,bd);var bh=bk-bb;var bg=bj-ba;av+=bh;aQ+=bh;at+=bg;aO+=bg;aF(aQ,aO);if(Math.abs(av)>j||Math.abs(at)>j){a5()}F=requestAnimFrame(function(){if(bl<bd){t(bf,be,bc,bd,bi,bk,bj)}})}function ae(bg){var be;if(bg.target){be=bg.target}else{if(bg.srcElement){be=bg.srcElement}}if(be&&be.nodeType==3){be=be.parentNode}if(deCarta.IdManager.checkTag(be,"ignoreForMapEvents")){return false}f=true;if(V.dblclick){I(bg)}if(!au){return}var bh=bg.clientX;var bf=bg.clientY;var bb=Utilities.getAbsoluteLeft(aP.mapDiv)-Utilities.getScrollLeft();var ba=Utilities.getAbsoluteTop(aP.mapDiv)-Utilities.getScrollTop();var bd=(parseInt(bh-bb)-Math.round(parseInt(aP.mapDiv.style.width)/2))*-1;var bc=(parseInt(bf-ba)-Math.round(parseInt(aP.mapDiv.style.height)/2))*-1;A(bd,bc)}function u(bd){var be;var bc;bd=bd?bd:window.event;if(!aZ){if(V.movestart){V.movestart()}}if(V.move){be=new PixelPoint(bd.clientX,bd.clientY);bc=aP.screenPixToPos(be);V.move(bc)}if(!al){if(bd.type=="mouseup"&&V.mouseup){be=new PixelPoint(bd.clientX,bd.clientY);bc=aP.screenPixToPos(be);V.mouseup(bc);w(bd)}return false}aZ=true;if(!aV){return false}var bb=bd.clientX-aj;var ba=bd.clientY-ag;av+=bb;at+=ba;if(Math.abs(av)>j||Math.abs(at)>j){a5()}if(!an&&U){an=true}ay.x=aQ;ay.y=aO;aQ+=bb;aO+=ba;aa.x=aQ;aa.y=aO;aF(aQ,aO);if(z&&z.frame){z.panMapDivWinToPos(aP.getCenterPosition())}aj=bd.clientX;ag=bd.clientY;return false}function L(bc){if(!GLOBALS.ALLOWDOMEVENTS){return true}if(!bc){bc=window.event}var bb=bc.target?bc.target:bc.srcElement;var ba=(bc.relatedTarget)?bc.relatedTarget:bc.toElement;try{if(ba&&bb&&(ba.id==bb.id)){return true}}catch(bc){}if(V.mouseout){V.mouseout()}}function P(bc){if(!G){return}var bd=new Date().getTime();if((bd-this.lastWheelTime)<300){return}this.lastWheelTime=bd;var bk=0;if(!bc){bc=window.event}bk=bc.detail?bc.detail*-1:bc.wheelDelta/40;bk=(bk>0)?1:-1;var bb=bc.clientX;var ba=bc.clientY;var bi=Utilities.getAbsoluteLeft(aP.mapDiv)-Utilities.getScrollLeft();var bh=Utilities.getAbsoluteTop(aP.mapDiv)-Utilities.getScrollTop();var bf=parseInt(bb-bi);var be=parseInt(ba-bh);var bj=aP.getZoomController().getZoomLevel();var bg=aP.getZoomController().getClosestValidLevel(bj-bk);aP.getZoomController().zoomToNewLevel(bg,bf,be);if(bc.preventDefault){bc.preventDefault()}bc.returnValue=false}function N(){if(window.addEventListener){window.addEventListener("DOMMouseScroll",P,false)}window.onmousewheel=document.onmousewheel=P}function X(){if(window.removeEventListener){window.removeEventListener("DOMMouseScroll",P,false)}window.onmousewheel=aS}this.getMapDiv= function(){return aP.mapDiv};this.getBubble= function(){return aG};this.getChooser= function(){return O};this.getCopyright= function(){return aT};this.getTileDiv= function(){return ab};this.getZoomLck= function(){return R};this.loaded= function(){return(ab?true:false)};this.hidePinsBeforeZoom= function(){ad.operateOnData(function(ba){if(ba){ba.zoomHide()}})};this.showPinsAfterZoom= function(){ad.operateOnData(function(ba){if(ba){ba.zoomShow()}})};function aY(){ad.operateOnData(function(ba){if(!ba){return}ba.setPosition(ba.position);ba.hideInfoWindow()});aP.showPinsAfterZoom()}function az(){ad.operateOnData(function(bb){if(!bb){return}var bc=bb.setPosition(bb.position);if(bc){var ba=bb.map.getInfoWindow();var bd=(ba)?ba.associatedPin:null;if(ba&&bd&&bd.equals(bb)){bb.hideInfoWindow();bb.showInfoWindow()}}});aP.showPinsAfterZoom()}this.zoomMap= function(bc,bb){if(!n[GLOBALS.STREET]&&!n[GLOBALS.SATELLITE]&&!n[GLOBALS.HYBRID]){return false}if(R){return false}if(typeof bb=="function"){g.zoomMap=bb}else{g.zoomMap=null}var bf=C.selected;if(bf==bc){if(g.zoomMap){g.zoomMap();g.zoomMap=undefined}return false}var bi=aP.getCenterPosition();var ba=Utilities.getRequestId();C.setZoomLevel(bc);aP.hidePinsBeforeZoom();R=true;if(W&&(Math.abs(bf-bc)<=2)){if(!aR){q()}aR.show();if((a6&&a6.mapType=="HYBRID")||(!a6.mapType&&Credentials.mapType=="HYBRID")){n[GLOBALS.HYBRID].hide()}for(var bh in n){if(n.hasOwnProperty(bh)){n[bh].zoom(bf-bc,aR,av,at)}}}else{if(aR){aR.hide()}}for(var be in n){if(n.hasOwnProperty(be)){if(n[be].refUrl&&n[be].layerName=="decarta-street"){var bg=n[be].refUrl}if(n[be].refUrl&&n[be].layerName=="decarta-satellite"){var bd=n[be].refUrl}}}JSRequest.emulatedZoomRequest(bi,bc,bg,bd,r);if(z&&z.frame){z.zoomMap()}return true};function aS(){return false}this.setCountryCode= function(ba){if(!ba){throw new Exception("error calling Map.setCountryCode()")}Credentials.ISOCountryCode=ba};this.getGXPixelPoint= function(ba){this.posToMercPix(ba)};this.posToMercPix= function(bd){var bb=Utilities.radsPerPixelAtZoom(E,C.getGXConvertedZoomLevel());var bc=Utilities.lat2pix(bd.lat,bb);var ba=Utilities.lon2pix(bd.lon,bb);return new PixelPoint(ba,bc)};this.mercPixToPos= function(ba){var bd=Utilities.radsPerPixelAtZoom(E,C.getGXConvertedZoomLevel());var bb=Utilities.pix2lat(ba.y,bd);var bc=Utilities.pix2lon(ba.x,bd);return new Position(bb,bc)};this.screenPixToPos= function(bd){var be=bd.y-Utilities.getAbsoluteTop(aP.mapDiv)+Utilities.getScrollTop();var bb=bd.x-Utilities.getAbsoluteLeft(aP.mapDiv)+Utilities.getScrollLeft();var bg=aP.posToMercPix(aP.getCenterPosition());var bh=bg.x-(parseInt(aP.mapDiv.style.width)/2);var bi=bg.y+(parseInt(aP.mapDiv.style.height)/2);var bc=new PixelPoint(bh,bi);var bf=new PixelPoint(bc.x+bb,bc.y-be);var ba=aP.mercPixToPos(bf);return ba};function ap(bc){var bg=bc.XLS.Response.requestID;var bl,ba;var bi=bc.XLS.Response.PortrayMapResponse.TileGrid[0].Pan;var bd;if(deCarta.JSONParser.parseErrors(bc)){bd=null}else{for(var be=0;be<bi.length;be++){if(bi[be].direction=="E"){aH.x=parseFloat(bi[be].numTiles)*E;ba=bi[be].toLon}else{aH.y=-parseFloat(bi[be].numTiles)*E;bl=bi[be].toLat}}var bj=bc.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint.pos.content;if(isNaN(bl)||isNaN(ba)){ai=new Position(bj)}else{ai=new Position(bl,ba)}var bb=bc.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.Radius.content;C.setRadius((parseFloat((bb))/1000)*aw);var bf=0;try{bf=parseInt(JSRequest.maxHostAliases,10)}catch(bh){}var bk=[bc.XLS.Response.PortrayMapResponse.TileGrid[0].Tile.Map.Content.URL,bc.XLS.Response.PortrayMapResponse.TileGrid[1].Tile.Map.Content.URL];o(bk,bf);if(aG){aG.hide()}aY();bd=aP.getCenterPosition()}if((bg>=0)&&g[bg]){g[bg](bd);g[bg]=undefined}}function r(ba){ap(ba);R=false;if(V.zoomend){V.zoomend()}if(g.zoomMap){g.zoomMap();g.zoomMap=undefined}}function o(ba,be){if(ao){ao.calculate()}am();be=be||0;var bd=new deCarta.MapLayerReferenceUrl((ba[1]));bd.createGlobeXplorerUrl();var bb=new deCarta.MapLayerReferenceUrl((ba[0]),be);bb.createDeCartaTransparentUrl();bb.setParameter("config",a6.transparentConfiguration);var bc=new deCarta.MapLayerReferenceUrl((ba[0]),be);bc.createDeCartaUrl();bc.setParameter("config",a6.configuration);if(n[GLOBALS.SATELLITE]){n[GLOBALS.SATELLITE].populate(bd)}if(n[GLOBALS.HYBRID]){n[GLOBALS.HYBRID].populate(bb)}if(n[GLOBALS.STREET]){n[GLOBALS.STREET].populate(bc)}av-=aH.x;at-=aH.y;aC()}function Z(){if(!ab){a8();return}}function a8(){var ba="decarta-mapviewport";if(!aP.mapDiv.className){aP.mapDiv.className=ba}else{aP.mapDiv.className+=" "+ba}Utilities.setUnselectable(aP.mapDiv);ar=document.createElement("div");ar.style.cssText="position:absolute;overflow:hidden;left:0px;top:0px;width:100%;height:100%;";Utilities.setUnselectable(ar);aP.mapDiv.appendChild(ar);ar.oncontextmenu=aS;ar.onmousedown=af;ar.onmouseout=L;ar.onmouseup=aB;ar.ondblclick=aB;ar.onclick=aB;aP.mapDiv.onmouseover=N;aP.mapDiv.onmouseout=X;ab=document.createElement("div");var bb="decarta-tiles";ab.id=bb;ab.className=bb;ab.style.top=0+B;ab.style.left=0+B;Utilities.setUnselectable(ab);ar.appendChild(ab);if(!C){C=new ZoomController();aP.addMapControl(C);C.hide()}if(!aG){p()}ab.appendChild(aG.bubble);M()}this.getTilesContainer= function(){return ar};function M(){if(n[GLOBALS.SATELLITE]||n[GLOBALS.HYBRID]||n[GLOBALS.STREET]){throw new Exception("buildDefaultTileGrid called on existing tile grid")}if(a6.mapType==GLOBALS.STREET){ac(GLOBALS.STREET)}else{if(a6.mapType==GLOBALS.HYBRID){ac(GLOBALS.HYBRID)}else{if(a6.mapType==GLOBALS.SATELLITE){ac(GLOBALS.SATELLITE)}}}}function ac(bb){if(bb!=GLOBALS.SATELLITE&&bb!=GLOBALS.HYBRID&&bb!=GLOBALS.STREET){throw new Exception("initDefaultMapLayer called with bad value: "+bb)}var bc=parseInt(aP.mapDiv.style.height);var ba=parseInt(aP.mapDiv.style.width);a4();aM=-Math.floor(((aw*E)-ba)/2);aJ=-Math.floor(((a1*E)-bc)/2);if(bb==GLOBALS.SATELLITE){n[GLOBALS.SATELLITE]=new deCarta.MapLayer(aw,a1,aM,aJ,E,"decarta-satellite",1,aP);n[GLOBALS.SATELLITE].show();n[GLOBALS.SATELLITE].appendTiles(ab);return}else{if(bb==GLOBALS.HYBRID){if(!n[GLOBALS.SATELLITE]){n[GLOBALS.SATELLITE]=new deCarta.MapLayer(aw,a1,aM,aJ,E,"decarta-satellite",1,aP);n[GLOBALS.SATELLITE].show();n[GLOBALS.SATELLITE].appendTiles(ab)}n[GLOBALS.HYBRID]=new deCarta.MapLayer(aw,a1,aM,aJ,E,"decarta-transparent",2,aP);n[GLOBALS.HYBRID].show();n[GLOBALS.HYBRID].appendTiles(ab);return}else{if(bb==GLOBALS.STREET){n[GLOBALS.STREET]=new deCarta.MapLayer(aw,a1,aM,aJ,E,"decarta-street",3,aP);n[GLOBALS.STREET].show();n[GLOBALS.STREET].appendTiles(ab);return}}}}function q(){aR=new deCarta.ZoomLayer(aw,a1,E);aR.appendTiles(ab)}function Q(){if(aR&&W){aR.destroy();delete aR}}function Y(){if(!ab){throw new Exception("resizeMap called without an existing map.")}for(var ba in n){if(n.hasOwnProperty(ba)){n[ba].hide();n[ba].destroy();n[ba]=undefined}}n={};ab.style.top=0+B;ab.style.left=0+B;M();aQ=0;aO=0;aj=0;ag=0;aV=false;av=0;at=0}function am(){a7=aQ;aK=aO;var bc=parseInt(aP.mapDiv.style.height);var bb=parseInt(aP.mapDiv.style.width);a4();aM=-Math.floor(((aw*E)-bb)/2);aJ=-Math.floor(((a1*E)-bc)/2);for(var be in n){if(n.hasOwnProperty(be)){var bd=n[be].isVisible;n[be].reset(-aQ-aH.x,-aO-aH.y,aM,aJ);if(bd){n[be].show()}}}var ba=[];if(a6.mapType==GLOBALS.STREET){ba.push(n[GLOBALS.STREET])}else{if(a6.mapType==GLOBALS.HYBRID){ba.push(n[GLOBALS.SATELLITE]);ba.push(n[GLOBALS.HYBRID])}else{if(a6.mapType==GLOBALS.SATELLITE){ba.push(n[GLOBALS.SATELLITE])}else{throw new Exception("Map.reset: encountered unexpected _xmlRecFac.mapType of "+a6.mapType)}}}H(ba);aj=0;ag=0;aV=false;av=0;at=0}function H(bb){var be=bb;var bd=be.length;var bc;if(!R||!W){for(bc=0;bc<bd;bc++){be[bc].show()}return}var bf=100;setTimeout(ba,bf);function ba(){var bg=(aR)?(aR.zoomComplete):true;if(bg){for(bc=0;bc<bd;bc++){be[bc].show()}}else{setTimeout(ba,bf)}}return}function a5(){var ba;if(S){S()}if(av<=-j){av=av+j;for(ba in n){if(n.hasOwnProperty(ba)){n[ba].rotateTiles(0,1)}}aP.redraw()}else{if(av>=j){av=av-j;for(ba in n){if(n.hasOwnProperty(ba)){n[ba].rotateTiles(0,-1)}}aP.redraw()}}if(at<=-j){at=at+j;for(ba in n){if(n.hasOwnProperty(ba)){n[ba].rotateTiles(-1,0)}}aP.redraw()}else{if(at>=j){at=at-j;for(ba in n){if(n.hasOwnProperty(ba)){n[ba].rotateTiles(1,0)}}aP.redraw()}}}function aF(ba,bb){ab.style.left=ba+B;ab.style.top=bb+B}function A(ba,bb){if(aL){return}if(ba>1){ab.style.left=parseInt(ab.style.left)+1+B}else{if(ba<-1){ab.style.left=parseInt(ab.style.left)-1+B}}if(bb>1){ab.style.top=parseInt(ab.style.top)+1+B}else{if(bb<-1){ab.style.top=parseInt(ab.style.top)-1+B}}aL=true;l(ba,bb,true)}function l(ba,bf,be){if(be){a2=ba;a0=bf}var bc=Math.round(Math.abs(a2)*0.3);var bb=Math.round(Math.abs(a0)*0.3);if(bc>0||bb>0){if(a2<0){a2+=bc;av-=bc;aQ-=bc}else{if(a2>0){a2-=bc;av+=bc;aQ+=bc}}if(a0<0){a0+=bb;at-=bb;aO-=bb}else{if(a0>0){a0-=bb;at+=bb;aO+=bb}}aF(aQ,aO);if(Math.abs(av)>j||Math.abs(at)>j){a5()}setTimeout(l,h)}else{aL=false;if(V.moveend){V.moveend()}if(g.panToPosition){g.panToPosition(aP.getCenterPosition());g.panToPosition=undefined}if(ao){ao.calculate()}if(f&&ax){aP.getZoomController().zoomInOneLevel()}f=false;for(var bd in n){if(n.hasOwnProperty(bd)){n[bd].showTilesInViewport()}}az()}}function aE(){if(!aP.getTileDiv()){return null}var ba=d;if(!ba){ba=document.createElement("div");ba.id="svgvml_canvas";aP.getTileDiv().appendChild(ba)}ba.style.position="absolute";ba.style.zIndex=100;d=ba;return ba}function aA(){if(a9=="server"){return}var ba=aE();ba.innerHTML=""}function k(){if(!aP.getTileDiv()){return null}var ba=aE();var be=aP.getGridSize().split(" ");var bd=parseInt(be[1])*E;var bh=parseInt(be[0])*E;ba.style.width=bd+B;ba.style.height=bh+B;var bg=aP.mapDiv;var bc=-Math.floor((bd-parseInt(bg.style.width))/2);var bb=-Math.floor((bh-parseInt(bg.style.height))/2);var bi=ab;ba.style.left=bc-parseInt(bi.style.left)+B;ba.style.top=bb-parseInt(bi.style.top)+B;ba.innerHTML="";var bf=Raphael(ba);bf.bbox=aP.getBoundingBox();return bf}function aC(ba){ba=ba||false;if(a6.overlays.length==0&&!ba){aX=null;return}if(aL||!aP.getTileDiv()){return}aX=k();var bc=a6.overlays;for(var bd=0;bd<bc.length;bd++){var bb=bc[bd];bb.raphael_element=null;aP.drawShape(bb,true)}}this.getRaphaelPaper= function(){return aX};this.getMapOverviewController= function(){return z};function a4(){var bd=parseInt(aP.mapDiv.style.height);var bc=parseInt(aP.mapDiv.style.width);a1=Math.ceil(bd/E)+D;if(a1%2==0){a1++}aw=Math.ceil(bc/E)+D;if(aw%2==0){aw++}var ba=a1*E;var bb=aw*E;ab.style.width=bb+B;ab.style.height=ba+B}}deCarta.MapLayer= function(f,j,h,c,k,g,d,a,b){this.init(f,j,h,c,k,g,d,a,b)};deCarta.MapLayer.dgAliasIndex=0;deCarta.MapLayer.dgAliasMax=3;deCarta.MapLayer.prototype.fadeSpeed=300;deCarta.MapLayer.prototype.owner=null;deCarta.MapLayer.prototype.onlyLoadTilesInViewport=false;deCarta.MapLayer.prototype.xTiles=null;deCarta.MapLayer.prototype.yTiles=null;deCarta.MapLayer.prototype.xOffset=0;deCarta.MapLayer.prototype.yOffset=0;deCarta.MapLayer.prototype.leftIndex=0;deCarta.MapLayer.prototype.topIndex=0;deCarta.MapLayer.prototype.tileSize=null;deCarta.MapLayer.prototype.layerName="mapLayer";deCarta.MapLayer.prototype.cssClass="decarta-maptile";deCarta.MapLayer.prototype.cssZIndex=20;deCarta.MapLayer.prototype.tileArray=null;deCarta.MapLayer.prototype.srcOnHidden=null;deCarta.MapLayer.prototype.srcOnError=null;deCarta.MapLayer.prototype.isVisible=false;deCarta.MapLayer.prototype.numTilesLoaded=0;deCarta.MapLayer.prototype.delayedLoading=false;deCarta.MapLayer.prototype.refUrl=null;deCarta.MapLayer.prototype.init= function(d,j,g,b,l,f,c,a){var k,h;this.xTiles=d;this.yTiles=j;this.xOffset=g;this.yOffset=b;this.tileSize=l;if(f){this.layerName=f}if(c){this.cssZIndex=c}this.owner=a;this.onlyLoadTilesInViewport=this.owner.getOnlyLoadTilesInViewport();this.tileArray=[];this.setDefaultSrc();for(k=0;k<this.xTiles;k++){this.tileArray[k]=[];for(h=0;h<this.yTiles;h++){this.tileArray[k][h]=this.mapTileFactory(k,h);if(this.owner.type=="MapOverviewController"){deCarta.IdManager.setTag(this.tileArray[k][h],"ignoreForMapEvents")}}}};deCarta.MapLayer.prototype.setDefaultSrc= function(){if(!Utilities.ie6){this.srcOnHidden=Credentials.transparentPNG;this.srcOnError=Credentials.transparentPNG}else{this.srcOnHidden=Credentials.transparentGIF;this.srcOnError=Credentials.transparentGIF}};deCarta.MapLayer.prototype.mapTileOnError= function(b){var a;if(!b){a=window.event.srcElement}else{a=b.currentTarget}if(a&&a.src&&a.srcOnError){a.src=a.srcOnError}};deCarta.MapLayer.prototype.mapTileFactory= function(a,f){var d=Math.floor(this.xTiles/2);var b=Math.floor(this.yTiles/2);var c=document.createElement("IMG");c.ownerLayer=this;c.fromCenterX=a-d;c.fromCenterY=b-f;c.id="Tile_"+a+"_"+f+"_"+c.ownerLayer.layerName;c.className=this.cssClass;if(this.srcOnHidden){c.altSrc=this.srcOnHidden;c.src=this.srcOnHidden}else{c.altSrc="";c.src=""}c.style.display="none";c.style.zIndex=this.cssZIndex;c.style.height=this.tileSize+"px";c.style.width=this.tileSize+"px";c.onerror=this.mapTileOnError;c.style.left=(a*this.tileSize)+this.xOffset+"px";c.style.top=(f*this.tileSize)+this.yOffset+"px";Utilities.setUnselectable(c);c.coords=new Object();c.coords.ul=null;c.coords.ur=null;c.coords.lr=null;c.coords.ll=null;c.tileViewed=false;c.setTileCoords=deCarta.MapLayer.setTileCoords;c.isTileInViewPort=deCarta.MapLayer.isTileInViewPort;c.loaded=false;c.setSrc=deCarta.MapLayer.setSrc;if(Utilities.ie6){c.loader=document.createElement("img");c.loader.owner=c;c.loader.loadTile= function(){this.owner.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+this.src+"')";this.owner.src=Credentials.transparentGIF;this.owner.ownerLayer.numTilesLoaded++;return true};c.loader.onload=c.loader.loadTile;c.onload= function(){if(this.src==Credentials.transparentGIF){return}c.style.display="block"};c.show= function(){this.style.display="block";this.style.zIndex=30};c.hide= function(){this.style.display="none"}}else{c.loader=document.createElement("img");c.loader.owner=c;c.delayedShow=false;c.show= function(){if(!this.loaded){return}if(this.fading){return}if(!this.ownerLayer.isVisible){return}if(this.ownerLayer.owner.getTileFading()){this.fading=true;this.style.display="block";Utilities.fade(this,{from:0,to:100,duration:this.ownerLayer.fadeSpeed,onComplete:function(g){g.fading=false}})}else{this.style.display="block";Utilities.setOpacity(this,100)}};c.hide= function(){if(this.ownerLayer.owner.getTileFading()){Utilities.fade(this,{from:100,to:0,duration:this.ownerLayer.fadeSpeed,onComplete:function(g){g.style.display="none";g.fading=false}})}else{this.style.display="none";Utilities.setOpacity(this,0)}};c.loader.loadTile= function(){if(this.src==this.owner.src){return}this.owner.loaded=true;Utilities.setOpacity(this.owner,0);this.owner.style.display="block";this.owner.style.zIndex=30;this.owner.src=this.src;this.owner.ownerLayer.numTilesLoaded++;this.owner.show();return};c.loader.onload=c.loader.loadTile;c.fading=false}return c};deCarta.MapLayer.prototype.showTilesInViewport= function(){if(this.onlyLoadTilesInViewport){for(var a=0;a<this.xTiles;a++){for(var c=0;c<this.yTiles;c++){var b=this.tileArray[a][c];if(!b.tileViewed){b.setSrc(b.altSrc)}}}}};deCarta.MapLayer.setSrc= function(a){if(this.src==a){return}if(this.ownerLayer.layerName=="decarta-satellite"){if(deCarta.MapLayer.dgAliasIndex>=deCarta.MapLayer.dgAliasMax){deCarta.MapLayer.dgAliasIndex=0}else{deCarta.MapLayer.dgAliasIndex++}a=a.replace(/\/\/www\./,"//www"+deCarta.MapLayer.dgAliasIndex+".")}this.loaded=false;this.altSrc=a;Utilities.setOpacity(this,0);if(this.ownerLayer.isVisible){this.loader.src=a;this.src=Credentials.transparentPNG;if(Utilities.ie6){this.src=Credentials.transparentGIF}this.show()}return};deCarta.MapLayer.setTileCoords= function(a){if(!a){return}var d=a.dynamicProps;var t=d.llMin.split(",");var r=parseInt(d.northing,10);var u=parseInt(d.easting,10);var k=this.ownerLayer;var w=k.owner;var p=w.getZoomController().getZoomLevel();var l=w.getTileSize();var y=Utilities.radsPerPixelAtZoomLevel(l,p);var z=new Position(parseFloat(t[0]),parseFloat(t[1]));var f=Math.round(Utilities.lat2pix(z.lat,y));var c=Math.round(Utilities.lon2pix(z.lon,y));var o=f+(r*l)+(this.fromCenterY*l);var h=c+(u*l)+(this.fromCenterX*l);var j=o+k.tileSize;var b=h+k.tileSize;var s=Utilities.pix2lat(o,y);var g=Utilities.pix2lon(h,y);var m=Utilities.pix2lat(j,y);var q=Utilities.pix2lon(b,y);this.coords.ul=new Position(m,g);this.coords.ur=new Position(m,q);this.coords.lr=new Position(s,q);this.coords.ll=new Position(s,g)};deCarta.MapLayer.isTileInViewPort= function(){var c;var d=this.coords;var g=this.ownerLayer.owner.getBoundingBoxViewable();var b=false;for(c in d){if(d.hasOwnProperty(c)){if(g.contains(d[c])){b=true;break}}}if(!b){var a={};a.ul=new Position(g.maxPosition.lat,g.minPosition.lon);a.ur=new Position(g.maxPosition.lat,g.maxPosition.lon);a.lr=new Position(g.minPosition.lat,g.maxPosition.lon);a.ll=new Position(g.minPosition.lat,g.minPosition.lon);var f=new BoundingBox(d.ll,d.ur);for(c in a){if(a.hasOwnProperty(c)){if(f.contains(a[c])){b=true;break}}}}if(b){return true}else{return false}};deCarta.MapLayer.prototype.appendTiles= function(b){for(var a=0;a<this.xTiles;a++){for(var c=0;c<this.yTiles;c++){b.appendChild(this.tileArray[a][c])}}};deCarta.MapLayer.prototype.hide= function(){if(!this.isVisible){return}var a,b;this.isVisible=false;for(a=0;a<this.xTiles;a++){for(b=0;b<this.yTiles;b++){this.tileArray[a][b].hide()}}};deCarta.MapLayer.prototype.show= function(){if(this.isVisible){return}var a,f;this.isVisible=true;for(a=0;a<this.xTiles;a++){for(f=0;f<this.yTiles;f++){var c=this.tileArray[a][f];var b=c.altSrc.replace(/\:80/,"");var d=c.src.replace(/\:80/,"");if(b!=d&&this.refUrl){c.setSrc(c.altSrc)}c.show()}}};deCarta.MapLayer.prototype.reset= function(c,a,h,b){this.refUrl=null;if(h){this.xOffset=h}if(b){this.yOffset=b}var k,j;var g,f,d;var l="px";c=c||0;a=a||0;this.numTilesLoaded=0;this.isVisible=false;this.leftIndex=0;this.topIndex=0;this.updateFromCenterVals();for(k=0;k<this.xTiles;k++){g=this.xOffset+c+(k*this.tileSize);for(j=0;j<this.yTiles;j++){d=this.tileArray[k][j];d.tileViewed=false;d.style.display="none";if(this.srcOnHidden){d.altSrc=this.srcOnHidden;d.src=this.srcOnHidden;if(d.loader){d.loader.src=this.srcOnHidden}}else{d.altSrc="";d.src="";if(d.loader){d.loader.src=""}}f=this.yOffset+a+(j*this.tileSize);d.style.left=g+l;d.style.top=f+l}}};deCarta.MapLayer.prototype.refresh= function(){var a,c;for(a=0;a<this.xTiles;a++){for(c=0;c<this.yTiles;c++){var b=this.tileArray[a][c];b.setSrc(this.refUrl.getRelSrc(b.fromCenterY,b.fromCenterX))}}};deCarta.MapLayer.prototype.rotateTiles= function(m,j){var o,k;var l=this.yTiles;var f=this.xTiles;var q=this.tileSize;var c;var h;var p=0;var a;var d;if(m){if(m>0){this.topIndex-=1;if(this.topIndex<0){this.topIndex=l-1}h=this.topIndex;p-=l*q;a=1}else{h=this.topIndex;this.topIndex+=1;if(this.topIndex>=l){this.topIndex=0}p+=l*q;a=-1}this.updateFromCenterVals();this.refUrl.pan(a,0);var g=[];for(o=0;o<f;o++){g.push(this.tileArray[o][h])}n(g);for(o=0;o<g.length;o++){c=g[o];d=parseInt(c.style.top)+p;c.style.top=(d)+"px";if(this.onlyLoadTilesInViewport){c.setTileCoords(this.refUrl)}c.setSrc(this.refUrl.getRelSrc(c.fromCenterY,c.fromCenterX))}return}if(j){if(j>0){h=this.leftIndex;this.leftIndex+=1;if(this.leftIndex>=f){this.leftIndex=0}p+=f*q;a=1}else{this.leftIndex-=1;if(this.leftIndex<0){this.leftIndex=f-1}h=this.leftIndex;p-=f*q;a=-1}this.updateFromCenterVals();this.refUrl.pan(0,a);g=[];for(k=0;k<l;k++){g.push(this.tileArray[h][k])}n(g);for(k=0;k<g.length;k++){c=g[k];d=parseInt(c.style.left)+p;c.style.left=(d)+"px";if(this.onlyLoadTilesInViewport){c.setTileCoords(this.refUrl)}c.setSrc(this.refUrl.getRelSrc(c.fromCenterY,c.fromCenterX))}}function n(t){for(var s=1;s<t.length;s++){for(var r=0;r<t.length-1;r++){if((Math.abs(t[r].fromCenterX)+Math.abs(t[r].fromCenterY))>(Math.abs(t[r+1].fromCenterX)+Math.abs(t[r+1].fromCenterY))){b(t,r,r+1)}}}}function b(s,u,r){var t;t=s[u];s[u]=s[r];s[r]=t}};deCarta.MapLayer.prototype.zoom= function(d,c,b,a,f){if(!this.isVisible){return}c.zoom(d,this,b,a,f)};deCarta.MapLayer.prototype.populate= function(f){this.refUrl=f;var j,g,b;var d=[];var c=0;var k;for(j=0;j<this.xTiles;j++){for(g=0;g<this.yTiles;g++){d[c]=this.tileArray[j][g];c++}}k=d.length;h(d);for(b=0;b<k;b++){if(this.onlyLoadTilesInViewport){d[b].setTileCoords(f)}d[b].setSrc(f.getRelSrc(d[b].fromCenterY,d[b].fromCenterX))}function h(n){for(var m=1;m<n.length;m++){for(var l=0;l<n.length-1;l++){if((Math.abs(n[l].fromCenterX)+Math.abs(n[l].fromCenterY))>(Math.abs(n[l+1].fromCenterX)+Math.abs(n[l+1].fromCenterY))){a(n,l,l+1)}}}}function a(m,o,l){var n;n=m[o];m[o]=m[l];m[l]=n}};deCarta.MapLayer.prototype.updateFromCenterVals= function(){var k=this.xTiles;var n=this.yTiles;var b=Math.floor(k/2);var g=-b;var a=Math.floor(n/2);var f=-a;var q=this.leftIndex;var c=this.topIndex;var j,h;if(q>b){j=q-b-1}else{j=q+b}if(c>a){h=c-a-1}else{h=c+a}var d=this.tileArray;var p,m;for(p=0;p<k;p++){for(m=0;m<n;m++){var l=d[p][m];var r=p-j;if(r>b){l.fromCenterX=r-k}else{if(r<g){l.fromCenterX=r+k}else{l.fromCenterX=r}}var o=h-m;if(o>a){l.fromCenterY=o-n}else{if(o<f){l.fromCenterY=o+n}else{l.fromCenterY=o}}}}};deCarta.MapLayer.prototype.resize= function(f,h){if(f==this.xTiles&&h==this.yTiles){return}var b=[];var j=parseInt(this.tileArray[this.leftIndex][this.topIndex].style.top);var a=parseInt(this.tileArray[this.leftIndex][this.topIndex].style.left);var d=Math.floor(this.xTiles/2);var c=Math.floor(this.yTiles/2);var l=0;var g=0;var m;var k;for(l=0;l<this.xTiles;l++){for(g=0;g<this.yTiles;g++){m=(l-this.leftIndex);if(m<0){m+=this.xTiles}k=(g-this.topIndex);if(k<0){k+=this.yTiles}if(m>=f||k>=h){this.owner.getTileDiv().removeChild(this.tileArray[l][g]);this.tileArray[l][g]=null}}}for(l=0;l<f;l++){b[l]=[];for(g=0;g<h;g++){if(l<this.xTiles&&g<this.yTiles){m=(this.leftIndex+l)%this.xTiles;k=(this.topIndex+g)%this.yTiles;b[l][g]=this.tileArray[m][k]}else{b[l][g]=this.mapTileFactory(l,g);b[l][g].style.top=(j+g*this.tileSize)+"px";b[l][g].style.left=(a+l*this.tileSize)+"px";if(this.onlyLoadTilesInViewport){b[l][g].setTileCoords(this.refUrl)}b[l][g].setSrc(this.refUrl.getRelSrc(c-g,l-d));this.owner.getTileDiv().appendChild(b[l][g])}}}this.refUrl.pan(-(h-this.yTiles)/2,(f-this.xTiles)/2);this.tileArray=b;this.xTiles=f;this.yTiles=h;this.leftIndex=0;this.topIndex=0;this.updateFromCenterVals()};deCarta.MapLayer.prototype.destroy= function(){var a,b;for(a=0;a<this.xTiles;a++){for(b=0;b<this.yTiles;b++){Utilities.purge(this.tileArray[a][b])}}};deCarta.ZoomLayer= function(a,c,b){this.init(a,c,b)};deCarta.ZoomLayer.prototype.framesTotal=4;deCarta.ZoomLayer.prototype.fps=20;deCarta.ZoomLayer.prototype.msPerFrame=1000/deCarta.ZoomLayer.prototype.fps;deCarta.ZoomLayer.prototype.xTiles=null;deCarta.ZoomLayer.prototype.yTiles=null;deCarta.ZoomLayer.prototype.tileSize=null;deCarta.ZoomLayer.prototype.layerName="zoomLayer";deCarta.ZoomLayer.prototype.cssClass="decarta-maptile";deCarta.ZoomLayer.prototype.cssZIndex=20;deCarta.ZoomLayer.prototype.tileArray=null;deCarta.ZoomLayer.prototype.srcOnHidden=null;deCarta.ZoomLayer.prototype.srcOnError=null;deCarta.ZoomLayer.prototype.isVisible=false;deCarta.ZoomLayer.prototype.init= function(b,f,c){var a,d;this.xTiles=b;this.yTiles=f;this.tileSize=c;this.tileArray=[];this.setDefaultSrc();this.domElement=document.getElementById("decarta-digitalZoomLayer");if(!this.domElement){this.domElement=document.createElement("div")}this.domElement.id="decarta-digitalZoomLayer";this.domElement.style.position="absolute";this.domElement.style.top=0;this.domElement.style.left=0;this.domElement.style.width=(b*c)+"px";this.domElement.style.height=(f*c)+"px";for(a=0;a<this.xTiles;a++){this.tileArray[a]=[];for(d=0;d<this.yTiles;d++){this.tileArray[a][d]=this.mapTileFactory(a,d)}}};deCarta.ZoomLayer.prototype.setDefaultSrc= function(){if(!Utilities.ie6){this.srcOnHidden=Credentials.transparentPNG;this.srcOnError=Credentials.transparentPNG}else{this.srcOnHidden=Credentials.transparentGIF;this.srcOnError=Credentials.transparentGIF}};deCarta.ZoomLayer.prototype.mapTileOnError= function(b){var a;if(!b){a=window.event.srcElement}else{a=b.currentTarget}if(a&&a.src&&a.srcOnError){a.src=a.srcOnError}};deCarta.ZoomLayer.prototype.mapTileFactory= function(a,g){var b="px";var f=Math.floor(this.xTiles/2);var c=Math.floor(this.yTiles/2);var d=document.createElement("IMG");d.fromCenterX=a-f;d.fromCenterY=c-g;d.className=this.cssClass;d.altSrc=this.srcOnHidden;d.src=this.srcOnHidden;d.style.zIndex=this.cssZIndex;d.style.height=this.tileSize+b;d.style.width=this.tileSize+b;d.onerror=this.mapTileOnError;d.id="Tile_"+a+"_"+g+"_zoom";Utilities.setUnselectable(d);d.setSrc=deCarta.ZoomLayer.setSrc;return d};deCarta.ZoomLayer.setSrc= function(a){this.src=a};deCarta.ZoomLayer.prototype.appendTiles= function(b){for(var a=0;a<this.xTiles;a++){for(var c=0;c<this.yTiles;c++){this.domElement.appendChild(this.tileArray[a][c])}}b.appendChild(this.domElement)};deCarta.ZoomLayer.prototype.hide= function(){if(!this.isVisible){return}var a,b;this.isVisible=false;for(a=0;a<this.xTiles;a++){for(b=0;b<this.yTiles;b++){this.tileArray[a][b].style.display="none"}}};deCarta.ZoomLayer.prototype.show= function(){if(this.isVisible){return}var a,b;this.isVisible=true;for(a=0;a<this.xTiles;a++){for(b=0;b<this.yTiles;b++){this.tileArray[a][b].style.display="block"}}};deCarta.ZoomLayer.prototype.transferSrcFromMapLayer= function(c){var a,h,g,d;var b="px";var f=Utilities.removeElementToReinsert(this.domElement);for(a=0;a<c.xTiles;a++){if(typeof this.tileArray[a]==="undefined"){this.tileArray[a]=[]}g=a+c.leftIndex;if(g>=c.xTiles){g-=c.xTiles}for(h=0;h<c.yTiles;h++){if(typeof this.tileArray[a][h]==="undefined"){this.tileArray[a][h]=this.mapTileFactory(a,h)}d=h+c.topIndex;if(d>=c.yTiles){d-=c.yTiles}this.tileArray[a][h].style.top=c.tileArray[g][d].style.top;this.tileArray[a][h].style.left=c.tileArray[g][d].style.left;this.tileArray[a][h].style.height=c.tileSize+b;this.tileArray[a][h].style.width=c.tileSize+b;this.tileArray[a][h].setSrc(c.tileArray[g][d].src)}}this.xTiles=c.xTiles;this.yTiles=c.yTiles;f()};deCarta.ZoomLayer.prototype.zoom= function(n,c,u,t,j){var w=this;w.show();w.transferSrcFromMapLayer(c);var g=u;var f=t;var h=Math.pow(2,n);var b=n>0?+1:-1;var q=this.framesTotal;var o=this.msPerFrame;var l=Math.floor((h*w.tileSize-w.tileSize)/(q));var d=-1*Math.floor(w.xTiles/2);var r=d;var k=-1*Math.floor(w.yTiles/2);var a=k;var m;var p;if(n>0){m=Math.floor(h*b*g/(2*q));p=Math.floor(h*b*f/(2*q))}else{m=Math.floor(h*b*g/(q));p=Math.floor(h*b*f/(q))}this.zoomComplete=false;s();function s(){var A=(new Date).getTime();var L,I;var M="px";var E=w.xTiles;var K=w.yTiles;var B=Utilities.removeElementToReinsert(w.domElement);var D=parseInt(w.tileArray[0][0].style.width)+l+"px";var z=parseInt(w.tileArray[0][0].style.height)+l+"px";for(L=0;L<E;L++){var C=parseInt(w.tileArray[L][0].style.left)-l/2+d*l+m+M;for(I=0;I<K;I++){var F=w.tileArray[L][I];F.style.width=D;F.style.height=z;F.style.left=C;F.style.top=parseInt(F.style.top)-l/2+k*l+p+M;k+=1}d+=1;k=a}d=r;q-=1;B();var G=(new Date).getTime();if(q){var N=(G-A);var H=this.msPerFrame-N;setTimeout(s,Math.max(H,25))}else{w.zoomComplete=true;if(typeof j==="function"){j()}}}};deCarta.ZoomLayer.prototype.destroy= function(){var a,c;for(a=0;a<this.xTiles;a++){for(c=0;c<this.yTiles;c++){var b=this.tileArray[a][c];Utilities.purge(b);if(b.parentNode){b.parentNode.removeChild(b)}}}};deCarta.MapLayerReferenceUrl= function(a,b){this.init(a,b)};deCarta.MapLayerReferenceUrl.prototype.baseUrl=null;deCarta.MapLayerReferenceUrl.prototype.imageHosts=null;deCarta.MapLayerReferenceUrl.prototype.numImageHosts=null;deCarta.MapLayerReferenceUrl.prototype.nextImageHost=null;deCarta.MapLayerReferenceUrl.prototype.staticProps=null;deCarta.MapLayerReferenceUrl.prototype.dynamicProps=null;deCarta.MapLayerReferenceUrl.prototype.urlregx=new RegExp("\\amp;","g");deCarta.MapLayerReferenceUrl.prototype.init= function(a,b){this.baseUrl=a;this.dynamicProps={};this.dynamicProps.northing=0;this.dynamicProps.easting=0;this.llMax=null;this.llMin=null;this.dynamicProps.format="";this.dynamicProps.config="";this.imageHosts=[];this.nextImageHost=0;if(b){this.numImageHosts=b+1}else{this.numImageHosts=1}};deCarta.MapLayerReferenceUrl.prototype.getFullHostName= function(){var d=this.baseUrl.indexOf("?");var c=this.baseUrl.substr(0,d+1);var b=/^[\S]*\/\/([\S]+)/;var a=c.replace(b,"$1");var f=a.split("/")[0];return f};deCarta.MapLayerReferenceUrl.prototype.getProtocol= function(){var c=this.baseUrl.indexOf("?");var b=this.baseUrl.substr(0,c+1);var a=/^([a-zA-Z:]*\/\/)([\s\S]*)/;var d=b.replace(a,"$1");return d};deCarta.MapLayerReferenceUrl.prototype.generateHostAliases= function(){var d;this.imageHosts=[];var j=this.baseUrl.indexOf("?");var k=this.baseUrl.substr(0,j+1);if(this.numImageHosts==1){this.imageHosts[0]=k+this.staticProps;return}else{var g=k.split(".");if(g.length>1){var m=g[0];var f=g.slice(1).join(".");m=m.replace(/-[0-9]+$/,"");this.imageHosts[0]=m+"."+f+this.staticProps;for(d=1;d<this.numImageHosts;d++){if(d<10){this.imageHosts[d]=m+"-0"+d+"."+f+this.staticProps;continue}else{this.imageHosts[d]=m+"-"+d+"."+f+this.staticProps}}}else{var l=this.getProtocol();var a=this.getFullHostName();var b="";if(a.split(":").length>1){b=":"+a.split(":")[1];a=a.split(":")[0]}a=a.replace(/-[0-9]+$/,"");var c=this.baseUrl.indexOf("/",l.length);var h=this.baseUrl.substr(c,j+1-c);this.imageHosts[0]=l+a+b+h+this.staticProps;for(d=1;d<this.numImageHosts;d++){if(d<10){this.imageHosts[d]=l+a+"-0"+d+b+h+this.staticProps;continue}else{this.imageHosts[d]=l+a+"-"+d+b+h+this.staticProps}}}}};deCarta.MapLayerReferenceUrl.prototype.createGlobeXplorerUrl= function(){var c,d,h;var b=[];var f=this.baseUrl.indexOf("?")+1;var a=this.baseUrl.slice(f).split("&");var g=a.length;for(c=0;c<g;c++){d=a[c];if(d.indexOf("N=")==0){this.dynamicProps.northing=parseInt(d.split("=")[1],10);d=null}else{if(d.indexOf("E=")==0){this.dynamicProps.easting=parseInt(d.split("=")[1],10);d=null}else{if(d.indexOf("LLMIN=")==0||d.indexOf("LL=")==0){this.dynamicProps.llMin=d.split("=")[1]}else{if(d.indexOf("key=")==0){if(d.length>4&&!Credentials.dgkey){}else{h=Credentials.dgkey||"";d="key="+h}}}}}if(d!=null){b.push(d)}}this.staticProps=b.join("&");this.generateHostAliases()};deCarta.MapLayerReferenceUrl.prototype.createDeCartaTransparentUrl= function(){var c,d;var b=[];this.baseUrl=this.baseUrl.replace(this.urlregx,"");var f=this.baseUrl.indexOf("?")+1;var a=this.baseUrl.slice(f).split("&");var g=a.length;for(c=0;c<g;c++){d=a[c];if(d.indexOf("N=")==0){this.dynamicProps.northing=parseInt(d.split("=")[1],10);d=null}else{if(d.indexOf("E=")==0){this.dynamicProps.easting=parseInt(d.split("=")[1],10);d=null}else{if(d.indexOf("FORMAT=")==0){this.dynamicProps.format="PNG";d=null}else{if(d.indexOf("CONFIG=")==0){this.dynamicProps.config=d.split("=")[1];d=null}else{if(d.indexOf("LLMIN=")==0||d.indexOf("LL=")==0){this.dynamicProps.llMin=d.split("=")[1]}}}}}if(d!=null){b.push(d)}}this.staticProps=b.join("&");this.generateHostAliases()};deCarta.MapLayerReferenceUrl.prototype.createDeCartaUrl= function(){var c,d;var b=[];this.baseUrl=this.baseUrl.replace(this.urlregx,"");var f=this.baseUrl.indexOf("?")+1;var a=this.baseUrl.slice(f).split("&");var g=a.length;for(c=0;c<g;c++){d=a[c];if(d.indexOf("N=")==0){this.dynamicProps.northing=parseInt(d.split("=")[1],10);d=null}else{if(d.indexOf("E=")==0){this.dynamicProps.easting=parseInt(d.split("=")[1],10);d=null}else{if(d.indexOf("FORMAT=")==0){this.dynamicProps.format=d.split("=")[1];d=null}else{if(d.indexOf("CONFIG=")==0){this.dynamicProps.config=d.split("=")[1];d=null}else{if(d.indexOf("LLMIN=")==0||d.indexOf("LL=")==0){this.dynamicProps.llMin=d.split("=")[1]}}}}}if(d!=null){b.push(d)}}this.staticProps=b.join("&");this.generateHostAliases()};deCarta.MapLayerReferenceUrl.prototype.getNextImageHost= function(){if(this.numImageHosts==1){return this.imageHosts[0]}else{var a=this.imageHosts[this.nextImageHost++];if(this.nextImageHost>=this.numImageHosts){this.nextImageHost=0}return a}};deCarta.MapLayerReferenceUrl.prototype.pan= function(a,b){this.dynamicProps.northing+=a;this.dynamicProps.easting+=b};deCarta.MapLayerReferenceUrl.prototype.getRelSrc= function(g,b){var f=this.getNextImageHost();var d=this.dynamicProps.northing+g;var j=this.dynamicProps.easting+b;var a=this.dynamicProps.config||"";if(a){a="&CONFIG="+a}var c=this.dynamicProps.format||"";if(c){c="&FORMAT="+c}var h=f+c+a+"&N="+d+"&E="+j;return h};deCarta.MapLayerReferenceUrl.prototype.setParameter= function(j,h){var c;var g=this.dynamicProps;for(c in g){if(g.hasOwnProperty(c)){if(c==j){g[j]=h;return}}}var f=this.staticProps.split("&");var d=f.length;var b=j+"=";var a=false;for(c=0;c<d;c++){if(f[c].indexOf(b)==0){f[c]=b+h;a=true;break}}if(!a){f[d]=b+h}this.staticProps=f.join("&");this.generateHostAliases()};deCarta.MapLayerReferenceUrl.prototype.getParameter= function(h){var b;var g=null;var f=this.dynamicProps;for(b in f){if(f.hasOwnProperty(b)){if(b==h){g=f[h];return g}}}var d=this.staticProps.split("&");var c=d.length;var a=h+"=";for(b=0;b<c;b++){if(d[b].indexOf(a)==0){g=d[b].split("=")[1];return g}}return null};deCarta.MapLayerReferenceUrl.prototype.deleteParameter= function(c){var g;var d=this.dynamicProps;for(g in d){if(d.hasOwnProperty(g)){if(g==c){d[c]=null;return true}}}var h=this.staticProps.split("&");var k=[];var a;var b=false;var f=h.length;var j=c+"=";for(g=0;g<f;g++){a=h[g];if(a.indexOf(j)==0){a=null;b=true}if(a){k.push(a)}}if(b){this.staticProps=k.join("&");this.generateHostAliases();return true}else{return false}};function MapOverviewController(X,c,h){this.map=null;this.mapVisible=false;this.frame=null;this.type="MapOverviewController";this.mapDiv=null;this.zoomDif=X||4;this.width=c||120;this.height=h||120;this._queuedOperations=[];var s=this;var y=Utilities.ie;var U=false;var W=new Array();var A={};var R=null;var E=null;var Z=null;var af=true;var j=null;var S=null;var ab=null;var w=[];var n=null;var ak=null;var aa=null;var ad=8;var t;var d;var p;var o;var aj=2;var N=false;var k=new PixelPoint(0,0);var K=0;var I=0;var b=0;var f=0;var Q=0;var O=0;var r="px";var B=0;var z=0;var T=false;this.initialize= function(){this.frame=document.createElement("div");this.frame.id="MapOverviewFrame";this.frame.className="decarta-mapOverviewController-frame";deCarta.IdManager.setTag(this.frame,"ignoreForMapEvents");this.frame.onmousedown= function(an){if(!GLOBALS.ALLOWDOMEVENTS){return true}an=an?an:window.event;an.stoppropagation?an.stoppropagation():an.cancelBubble=true;return false};ag();M()};this.open= function(){s.mapVisible=true;S.src="img/map_overview_hide.png";s.frame.style.height=s.width+5+"px";s.frame.style.width=s.height+5+"px"};this.close= function(){s.mapVisible=false;S.src="img/map_overview_show.png";s.frame.style.height="17px";s.frame.style.width="17px"};function ag(){j=document.createElement("div");j.id="MapOverviewToggle";j.className="decarta-mapOverviewController-mapToggle";j.onclick= function(an){if(!GLOBALS.ALLOWDOMEVENTS){return true}an=an?an:window.event;an.stoppropagation?an.stoppropagation():an.cancelBubble=true;if(s.mapVisible){s.close()}else{s.open()}return true};deCarta.IdManager.setTag(j,"ignoreForMapEvents");s.frame.appendChild(j);S=document.createElement("img");S.src="img/map_overview_show.png";S.className="decarta-mapOverviewController-mapToggleImg";j.appendChild(S);deCarta.IdManager.setTag(S,"ignoreForMapEvents")}function M(){var an=document.createElement("div");an.id="MapOverviewWrapper";an.className="decarta-mapOverviewController-mapDivWrapper";an.style.width=s.width+r;an.style.height=s.height+r;s.frame.appendChild(an);deCarta.IdManager.setTag(an,"ignoreForMapEvents");s.mapDiv=document.createElement("div");s.mapDiv.id="MapOverview";s.mapDiv.className="decarta-mapOverviewController-mapDiv";s.mapDiv.style.width=s.width+"px";s.mapDiv.style.height=s.height+"px";an.appendChild(s.mapDiv);deCarta.IdManager.setTag(s.mapDiv,"ignoreForMapEvents");ak=s.map.getTileSize();aa=ak;n=s.map.getXmlRecFac();s.mapDiv.onmousedown= function(at){if(!GLOBALS.ALLOWDOMEVENTS){return true}at=at?at:window.event;if((!y&&at.which==3)||(y&&at.button==2)){return true}if((!y&&at.which==2)||(y&&at.button==4)){return true}var ar;if(at.target){ar=at.target}else{if(at.srcElement){ar=at.srcElement}}if(ar&&ar.nodeType==3){ar=ar.parentNode}var au=new Date();var aq=true;s.mapDiv.style.cursor="move";var ap=at.clientX;var ao=at.clientY;document.body.onmousemove= function(ay){var az;var ax;ay=ay?ay:window.event;if(!aq){return false}var aw=ay.clientX-ap;var av=ay.clientY-ao;Q+=aw;O+=av;if(Math.abs(Q)>aa||Math.abs(O)>aa){V()}K+=aw;I+=av;D(K,I);ap=ay.clientX;ao=ay.clientY;return false};document.body.onmouseup= function(av){aq=false;s.mapDiv.style.cursor="default";document.body.onmousemove=null;document.body.onmouseup=null;for(var aw in A){if(A.hasOwnProperty(aw)){A[aw].showTilesInViewport()}}s.map.panToPosition(s.getCenterPosition());return false};return false}}function H(){if(Z){al()}else{Z=document.createElement("div");Z.className="decarta-mapOverviewController-mapArrayDivWin";al();deCarta.IdManager.setTag(Z,"ignoreForMapEvents");R.appendChild(Z)}}function al(){var ao=Math.floor(s.map.mapDiv.offsetWidth/Math.pow(2,s.getZoomDifNow()));var an=Math.floor(s.map.mapDiv.offsetHeight/Math.pow(2,s.getZoomDifNow()));if(ao>=s.width||an>=s.height){Z.style.display="none"}else{Z.style.display="block"}Z.style.width=ao+"px";Z.style.height=an+"px";Z.style.left=(s.width-ao)/2-K+"px";Z.style.top=(s.height-an)/2-I+"px"}function g(){var ao=Math.floor(s.map.mapDiv.offsetWidth/Math.pow(2,s.getZoomDifNow()));var an=Math.floor(s.map.mapDiv.offsetHeight/Math.pow(2,s.getZoomDifNow()));if(ao>=s.width||an>=s.height){E.style.display="none"}else{E.style.display=""}E.style.width=ao+"px";E.style.height=an+"px";E.style.left=(s.width-ao)/2+"px";E.style.top=(s.height-an)/2+"px"}function P(){if(E){g()}else{E=document.createElement("div");E.className="decarta-mapOverviewController-mapDivWin";g();deCarta.IdManager.setTag(E,"ignoreForMapEvents");s.mapDiv.appendChild(E);E.onmousedown= function(au){if(!GLOBALS.ALLOWDOMEVENTS){return true}au=au?au:window.event;au.stoppropagation?au.stoppropagation():au.cancelBubble=true;if((!y&&au.which==3)||(y&&au.button==2)){return true}if((!y&&au.which==2)||(y&&au.button==4)){return true}var ar=true;var at=true;var aq=true;if(E.offsetWidth>=s*c){at=false}if(E.offsetHeight>=s*h){aq=false}E.style.cursor="move";var ao=au.clientX;var an=au.clientY;var ap=null;document.body.onmousemove= function(aB){aB=aB?aB:window.event;if(!ar){return false}if(!at||!aq){return false}var aD=aB.clientX-ao;var aF=0;var aA=s.width-E.offsetWidth;var ay=E.offsetLeft+aD;if(ay>aA){ay=aA}if(ay<aF){ay=aF}E.style.left=ay+r;var aC=aB.clientY-an;var aE=0;var az=s.height-E.offsetHeight;var ax=E.offsetTop+aC;if(ax>az){ax=az}if(ax<aE){ax=aE}E.style.top=ax+r;ao=aB.clientX;an=aB.clientY;var aw=0;var av=0;if(ay>=aA){aw=1}if(ay<=aF){aw=-1}if(ax>=az){av=1}if(ax<=aE){av=-1}if(aw||av){m(aw*(-5),av*(-5));if(ap){clearInterval(ap)}ap=setInterval(function(){if(aw||av){m(aw*(-5),av*(-5))}else{if(ap){clearInterval(ap)}ap=0}},300)}else{if(ap){clearInterval(ap)}ap=0}return false};document.body.onmouseup= function(aB){document.body.onmousemove=null;document.body.onmouseup=null;ar=false;E.style.cursor="default";aB=aB?aB:window.event;aB.stoppropagation?aB.stoppropagation():aB.cancelBubble=true;if(ap){clearInterval(ap)}ap=0;var av=s.getCenterPosition();var aC=s.posToMercPix(av);var ax=(s.mapDiv.offsetWidth-E.offsetWidth)/2;var aA=E.offsetLeft-ax;var ay=(s.mapDiv.offsetHeight-E.offsetHeight)/2;var az=E.offsetTop-ay;var aD=new PixelPoint(Math.round(aC.x+aA),Math.round(aC.y-az));var aw=s.mercPixToPos(aD);s.map.panToPosition(aw);return false};return false}}}this.sliderMapDivWin= function(an,ao){E.style.left=E.offsetLeft+an+r;E.style.top=E.offsetTop+ao+r};this.panMapDivWinToPos= function(aq){var ap=s.getCenterPosition();var ao=this.posToMercPix(ap);var an=this.posToMercPix(aq);E.style.left=(s.width-E.offsetWidth)/2+(an.x-ao.x)+r;E.style.top=(s.height-E.offsetHeight)/2-(an.y-ao.y)+r};this.centerOnPosition= function(an,ar,ap){var at=Utilities.getRequestId();if(typeof ar=="function"){w[at]=ar}else{w[at]=null}var aq=Utilities.getRequestId();var au=l();var ao=n.createMapRequest(an,ak,at,au,null,ap,aq);JSRequest.send(ao,function(av){ab=an.clone();ad=au;am();u(av)},null,function(av){w[av]=undefined})};this.zoomMap= function(au){if(!A[GLOBALS.STREET]&&!A[GLOBALS.SATELLITE]&&!A[GLOBALS.HYBRID]){return false}if(U){return false}if(typeof au=="function"){w.zoomMap=au}else{w.zoomMap=null}var ar=ad;var ap=l();if(ar==ap){if(w.zoomMap){w.zoomMap();w.zoomMap=undefined}H();P();return false}var aq=s.getCenterPosition();var av=Utilities.getRequestId();U=true;for(var an in A){if(A.hasOwnProperty(an)){if(A[an].refUrl&&A[an].layerName=="decarta-street"){var ao=A[an].refUrl}if(A[an].refUrl&&A[an].layerName=="decarta-satellite"){var at=A[an].refUrl}}}ad=ap;JSRequest.emulatedZoomRequest(aq,ap,ao,at,ac);return true};function ac(an){u(an);U=false;if(W.zoomend){W.zoomend()}if(w.zoomMap){w.zoomMap();w.zoomMap=undefined}}function am(){if(!R){ah();return}}function ah(){Utilities.setUnselectable(s.mapDiv);R=document.createElement("div");R.className="decarta-mapOverviewController-mapArrayDiv";R.id="mapOverviewTilesDiv";R.style.top=0+"px";R.style.left=0+"px";Utilities.setUnselectable(R);s.mapDiv.appendChild(R);G()}function G(){if(A[GLOBALS.SATELLITE]||A[GLOBALS.HYBRID]||A[GLOBALS.STREET]){throw new Exception("buildDefaultTileGrid called on existing tile grid")}if(n.mapType==GLOBALS.STREET){ae(GLOBALS.STREET)}else{if(n.mapType==GLOBALS.HYBRID){ae(GLOBALS.HYBRID)}else{if(n.mapType==GLOBALS.SATELLITE){ae(GLOBALS.SATELLITE)}}}}function ae(ao){if(ao!=GLOBALS.SATELLITE&&ao!=GLOBALS.HYBRID&&ao!=GLOBALS.STREET){throw new Exception("initDefaultMapLayer called with bad value: "+ao)}var ap=parseInt(s.mapDiv.style.height);var an=parseInt(s.mapDiv.style.width);t=Math.ceil(ap/ak)+aj;if(t%2==0){t++}d=Math.ceil(an/ak)+aj;if(d%2==0){d++}p=-Math.floor(((d*ak)-an)/2);o=-Math.floor(((t*ak)-ap)/2);if(ao==GLOBALS.SATELLITE){A[GLOBALS.SATELLITE]=new deCarta.MapLayer(d,t,p,o,ak,"decarta-satellite",11,s,false);A[GLOBALS.SATELLITE].show();A[GLOBALS.SATELLITE].appendTiles(R);return}else{if(ao==GLOBALS.HYBRID){if(!A[GLOBALS.SATELLITE]){A[GLOBALS.SATELLITE]=new deCarta.MapLayer(d,t,p,o,ak,"decarta-satellite",11,s,false);A[GLOBALS.SATELLITE].show();A[GLOBALS.SATELLITE].appendTiles(R)}A[GLOBALS.HYBRID]=new deCarta.MapLayer(d,t,p,o,ak,"decarta-transparent",12,s,false);A[GLOBALS.HYBRID].show();A[GLOBALS.HYBRID].appendTiles(R);return}else{if(ao==GLOBALS.STREET){A[GLOBALS.STREET]=new deCarta.MapLayer(d,t,p,o,ak,"decarta-street",13,s,false);A[GLOBALS.STREET].show();A[GLOBALS.STREET].appendTiles(R);return}}}}function u(ap){var au=ap.XLS.Response.requestID;var az,an;var aw=ap.XLS.Response.PortrayMapResponse.TileGrid[0].Pan;var aq;if(deCarta.JSONParser.parseErrors(ap)){aq=null}else{for(var ar=0;ar<aw.length;ar++){if(aw[ar].direction=="E"){k.x=parseFloat(aw[ar].numTiles)*ak;an=aw[ar].toLon}else{k.y=-parseFloat(aw[ar].numTiles)*ak;az=aw[ar].toLat}}var ax=ap.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.CenterPoint.pos.content;if(isNaN(az)||isNaN(an)){ab=new Position(ax)}else{ab=new Position(az,an)}var ao=ap.XLS.Response.PortrayMapResponse.TileGrid[0].CenterContext.Radius.content;L((parseFloat((ao))/1000)*d);var at=0;try{at=parseInt(ap.XLS.Response.PortrayMapResponse.TileGrid[0].GridLayer.maxImageHostAliases,10)}catch(av){}var ay=[ap.XLS.Response.PortrayMapResponse.TileGrid[0].Tile.Map.Content.URL,ap.XLS.Response.PortrayMapResponse.TileGrid[1].Tile.Map.Content.URL];C(ay,at);aq=s.getCenterPosition()}if((au>=0)&&w[au]){w[au](aq);w[au]=undefined}H();P();for(var ar=0;ar<s._queuedOperations.length;ar++){s._queuedOperations[ar]();delete s._queuedOperations[ar]}s._queuedOperations=[]}function C(an,ar){Y();ar=ar||0;var aq=new deCarta.MapLayerReferenceUrl((an[1]));aq.createGlobeXplorerUrl();var ao=new deCarta.MapLayerReferenceUrl((an[0]),ar);ao.createDeCartaTransparentUrl();ao.setParameter("config",n.transparentConfiguration);var ap=new deCarta.MapLayerReferenceUrl((an[0]),ar);ap.createDeCartaUrl();ap.setParameter("config",n.configuration);if(A[GLOBALS.SATELLITE]){A[GLOBALS.SATELLITE].populate(aq)}if(A[GLOBALS.HYBRID]){A[GLOBALS.HYBRID].populate(ao)}if(A[GLOBALS.STREET]){A[GLOBALS.STREET].populate(ap)}Q-=k.x;O-=k.y}function Y(){b=K;f=I;var ap=parseInt(s.mapDiv.style.height);var ao=parseInt(s.mapDiv.style.width);t=Math.ceil(ap/ak)+aj;if(t%2==0){t++}d=Math.ceil(ao/ak)+aj;if(d%2==0){d++}p=-Math.floor(((d*ak)-ao)/2);o=-Math.floor(((t*ak)-ap)/2);for(var aq in A){if(A.hasOwnProperty(aq)){A[aq].reset(-K-k.x,-I-k.y,p,o)}}var an=[];if(n.mapType==GLOBALS.STREET){an.push(A[GLOBALS.STREET])}else{if(n.mapType==GLOBALS.HYBRID){an.push(A[GLOBALS.SATELLITE]);an.push(A[GLOBALS.HYBRID])}else{if(n.mapType==GLOBALS.SATELLITE){an.push(A[GLOBALS.SATELLITE])}else{throw new Exception("Map.reset: encountered unexpected _xmlRecFac.mapType of "+n.mapType)}}}q(an);Q=0;O=0}function q(an){var aq=an;var ap=aq.length;var ao;for(ao=0;ao<ap;ao++){aq[ao].show()}}this.setMapType= function(ao){if(!(ao==GLOBALS.STREET||ao==GLOBALS.HYBRID||ao==GLOBALS.SATELLITE)){throw new Exception("unsupported mapType. Use '"+GLOBALS.STREET+"' || '"+GLOBALS.HYBRID+"' || '"+GLOBALS.SATELLITE+"'")}n.mapType=ao;var an=false;if(!A||Utilities.isObjectEmpty(A)){return}if(ao==GLOBALS.STREET){if(A[GLOBALS.HYBRID]){A[GLOBALS.HYBRID].hide()}if(A[GLOBALS.SATELLITE]){A[GLOBALS.SATELLITE].hide()}if(!A[GLOBALS.STREET]){ae(GLOBALS.STREET);an=true}else{A[GLOBALS.STREET].show()}}else{if(ao==GLOBALS.HYBRID){if(A[GLOBALS.STREET]){A[GLOBALS.STREET].hide()}if(!A[GLOBALS.SATELLITE]){ae(GLOBALS.SATELLITE);an=true}else{A[GLOBALS.SATELLITE].show()}if(!A[GLOBALS.HYBRID]){ae(GLOBALS.HYBRID);an=true}else{A[GLOBALS.HYBRID].show()}}else{if(ao==GLOBALS.SATELLITE){if(A[GLOBALS.HYBRID]){A[GLOBALS.HYBRID].hide()}if(A[GLOBALS.STREET]){A[GLOBALS.STREET].hide()}if(!A[GLOBALS.SATELLITE]){ae(GLOBALS.SATELLITE);an=true}else{A[GLOBALS.SATELLITE].show()}}}}if(an){}};this.panToPosition= function(au,an){var ap=au.clone();try{var aw=s.getCenterPosition()}catch(aq){this._queuedOperations.push(Utilities.scope(function(){this.panToPosition(ap,an)},this));return}var at=this.posToMercPix(aw);var ao=this.posToMercPix(ap);var ar=new PixelPoint(Math.round(at.x-ao.x),Math.round(at.y-ao.y));if(ab&&F()){var av=Utilities.centerContextToBoundingBox(aw,F());if(av.extendedContains(ap)){if(typeof an=="function"){w.panToPosition=an}else{w.panToPosition=null}if(ar.x==0&&ar.y==0){if(w.panToPosition){w.panToPosition(s.getCenterPosition());w.panToPosition=undefined}al();g();return}else{m(ar.x,-1*ar.y);al();g()}}else{this.centerOnPosition(ap,an)}}else{this.centerOnPosition(ap,an)}};function m(an,ao){if(T){return}if(an>1){R.style.left=parseInt(R.style.left)+1+r}else{if(an<-1){R.style.left=parseInt(R.style.left)-1+r}}if(ao>1){R.style.top=parseInt(R.style.top)+1+r}else{if(ao<-1){R.style.top=parseInt(R.style.top)-1+r}}T=true;a(an,ao,true)}function a(an,av,au){var ap=an;var ao=av;var ar=Math.round(Math.abs(ap)*0.3);var aq=Math.round(Math.abs(ao)*0.3);while(ar>0||aq>0){if(ap<0){ap+=ar;Q-=ar;K-=ar}else{if(ap>0){ap-=ar;Q+=ar;K+=ar}}if(ao<0){ao+=aq;O-=aq;I-=aq}else{if(ao>0){ao-=aq;O+=aq;I+=aq}}D(K,I);if(Math.abs(Q)>aa||Math.abs(O)>aa){V()}ar=Math.round(Math.abs(ap)*0.3);aq=Math.round(Math.abs(ao)*0.3)}if(W.moveend){W.moveend()}if(w.panToPosition){w.panToPosition(s.getCenterPosition());w.panToPosition=undefined}T=false;for(var at in A){if(A.hasOwnProperty(at)){A[at].showTilesInViewport()}}}function V(){var an;if(Q<=-aa){Q=Q+aa;for(an in A){if(A.hasOwnProperty(an)){A[an].rotateTiles(0,1)}}ai()}else{if(Q>=aa){Q=Q-aa;for(an in A){if(A.hasOwnProperty(an)){A[an].rotateTiles(0,-1)}}ai()}}if(O<=-aa){O=O+aa;for(an in A){if(A.hasOwnProperty(an)){A[an].rotateTiles(-1,0)}}ai()}else{if(O>=aa){O=O-aa;for(an in A){if(A.hasOwnProperty(an)){A[an].rotateTiles(1,0)}}ai()}}}function L(an){B=an;z=B/d*t}function F(){return z}function D(an,ao){R.style.left=an+r;R.style.top=ao+r}this.getOnlyLoadTilesInViewport= function(){return N};this.getCenterPosition= function(){if(!ab){throw new Exception("Center Position not set")}var ap=K-b;var ao=I-f;if(ap==0&&ao==0){return ab}var an=s.posToMercPix(ab);an.x-=ap;an.y+=ao;var aq=s.mercPixToPos(an);return aq};this.getZoomLevel= function(){return ad};this.posToMercPix= function(aq){var ao=Utilities.radsPerPixelAtZoom(ak,21-ad);var ap=Utilities.lat2pix(aq.lat,ao);var an=Utilities.lon2pix(aq.lon,ao);return new PixelPoint(an,ap)};this.mercPixToPos= function(an){var aq=Utilities.radsPerPixelAtZoom(ak,21-ad);var ao=Utilities.pix2lat(an.y,aq);var ap=Utilities.pix2lon(an.x,aq);return new Position(ao,ap)};function ai(){}this.getZoomDifNow= function(){return ad-s.map.getZoomController().getZoomLevel()};function l(){var an=s.map.getZoomController();if(!an){return 5+s.zoomDif}var ao=an.getZoomLevel()+s.zoomDif;if(ao>an.upperBound){ao=an.upperBound}if(ao<an.lowerBound){ao=an.lowerBound}return ao}this.appendThis= function(){if(!this.frame){this.initialize()}var an=this.frame||null;return an};this.position= function(an){if(!this.map){return}if(this.frame){}};this.getTileFading= function(){return false}}function MapTypeController(){this.init()}MapTypeController.prototype.map=null;MapTypeController.prototype.type="MapTypeController";MapTypeController.prototype.frame=null;MapTypeController.prototype.cssClass="decarta-mapTypeController";MapTypeController.prototype.linkCssClass="decarta-mapTypeControllerLink";MapTypeController.prototype.streetLabel=GLOBALS.STREET;MapTypeController.prototype.hybridLabel=GLOBALS.HYBRID;MapTypeController.prototype.satelliteLabel=GLOBALS.SATELLITE;MapTypeController.prototype.init= function(){};MapTypeController.prototype.build= function(){this.frame=document.createElement("DIV");this.frame.id=this.cssClass;this.frame.className=this.cssClass;deCarta.IdManager.setTag(this.frame,"ignoreForMapEvents");var c=document.createElement("span");c.innerHTML=" | ";deCarta.IdManager.setTag(c,"ignoreForMapEvents");var a=document.createElement("span");a.innerHTML=" | ";deCarta.IdManager.setTag(a,"ignoreForMapEvents");var f=document.createElement("a");f.className=this.linkCssClass;f.innerHTML=this.streetLabel;f.href="#";f.mapType=GLOBALS.STREET;f.owner=this;f.onclick=this.handleClick;deCarta.IdManager.setTag(f,"ignoreForMapEvents");var b=document.createElement("a");b.className=this.linkCssClass;b.innerHTML=this.hybridLabel;b.href="#";b.mapType=GLOBALS.HYBRID;b.owner=this;b.onclick=this.handleClick;deCarta.IdManager.setTag(b,"ignoreForMapEvents");var d=document.createElement("a");d.className=this.linkCssClass;d.innerHTML=this.satelliteLabel;d.href="#";d.owner=this;d.mapType=GLOBALS.SATELLITE;d.onclick=this.handleClick;deCarta.IdManager.setTag(d,"ignoreForMapEvents");this.frame.appendChild(f);this.frame.appendChild(c);this.frame.appendChild(b);this.frame.appendChild(a);this.frame.appendChild(d)};MapTypeController.prototype.appendThis= function(){if(!this.frame){this.build()}return this.frame};MapTypeController.prototype.removeThis= function(){this.map=null;return this.frame};MapTypeController.prototype.position= function(a){this.frame.style.top="5px";this.frame.style.left=a.width-207+"px"};MapTypeController.prototype.handleClick= function(){if(!GLOBALS.ALLOWDOMEVENTS){return true}this.owner.map.setMapType(this.mapType);return false};deCarta.Math={};deCarta.Math.MercatorSpherical= function(){var d=null;var b=null;var h=null;var j=null;function a(l){return(l*Math.PI/180)}function k(l){return(l*180/Math.PI)}function f(m){var p=a(m);var n=Math.sin(p);var o=Math.log((1+n)/(1-n))/2;var l=k(o);return l}function c(m){var p=a(m);var n=Math.exp(2*p);var o=Math.asin((n-1)/(n+1));var l=k(o);return l}function g(){if(!d||(!b&&b!==0)||(!h&&h!==0)){return false}j=h/Math.abs(d.maxPosition.lon-d.minPosition.lon);return true}this.getBoundingBox= function(){return d};this.setBoundingBox= function(l){if(l.minPosition==undefined||l.maxPosition==undefined){throw new Exception("deCarta.Math.MercatorSpherical.setPixelHeight passed invalid boundingBox of: "+l)}else{d=l}};this.getPixelHeight= function(){return b};this.setPixelHeight= function(l){var m=parseInt(l,10);if(isNaN(m)||(m<0)){throw new Exception("deCarta.Math.MercatorSpherical.setPixelHeight passed invalid height of: "+l)}else{b=m}};this.getPixelWidth= function(){return h};this.setPixelWidth= function(m){var l=parseInt(m,10);if(isNaN(l)||(l<0)){throw new Exception("deCarta.Math.MercatorSpherical.setPixelWidth passed invalid width of: "+m)}else{h=l}};this.positionToPixels= function(o){if(!g()||!o||(!o.lat&&o.lat!=0)||(!o.lon&&o.lon!=0)){throw new Exception("deCarta.Math.MercatorSpherical.positionToPixels: need to setBoundingBox, setPixelHeight and setPixelWidth prior to calculating positionToPixels")}var m=new PixelPoint(0,0);m.x=j*(d.minPosition.lon-o.lon)*-1;var n=f(d.maxPosition.lat)-f(o.lat);var l=f(d.maxPosition.lat)-f(d.minPosition.lat);m.y=b*n/l;return m};this.pixelsToPosition= function(m){if(!g()||!m||(!m.x&&m.x!=0)||(!m.y&&m.y!=0)){throw new Exception("deCarta.Math.MercatorSpherical.positionToPixels: need to setBoundingBox, setPixelHeight and setPixelWidth prior to calculating pixelsToPositiion")}var o=new Position(0,0);o.lon=d.minPosition.lon+(m.x/j);var l=f(d.maxPosition.lat)-f(d.minPosition.lat);var n=(m.y/b)*l;o.lat=c(f(d.maxPosition.lat)-n);return o}};deCarta.Math.MercatorEllipsoidal= function(){var d=null;var b=null;var h=null;var j=null;function a(l){return(l*Math.PI/180)}function k(l){return(l*180/Math.PI)}function f(o){var n=0.081819190842;var q=a(o);var l=n*Math.sin(q);var p=Math.log(Math.pow(((1-l)/(1+l)),n/2)*Math.tan((Math.PI/4)+(q/2)));var m=k(p);return m}function c(n){var q=a(n);var p=Math.pow(Math.E,-q);var m=r();for(var o=0;o<6;o++){m=s(m)}var l=k(m);return l;function r(){return Math.PI/2-2*Math.atan(p)}function s(A){var u=0.0818191908426216;var t=u*Math.sin(A);var z=p*Math.pow((1-t)/(1+t),u/2);var w=(Math.PI/2)-(2*Math.atan(z));return w}}function g(){if(!d||(!b&&b!==0)||(!h&&h!==0)){return false}j=h/Math.abs(d.maxPosition.lon-d.minPosition.lon);return true}this.getBoundingBox= function(){return d};this.setBoundingBox= function(l){if(l.minPosition==undefined||l.maxPosition==undefined){throw new Exception("deCarta.Math.MercatorEllipsoidal.setPixelHeight passed invalid boundingBox of: "+l)}else{d=l}};this.getPixelHeight= function(){return b};this.setPixelHeight= function(l){var m=parseInt(l,10);if(isNaN(m)||(m<0)){throw new Exception("deCarta.Math.MercatorEllipsoidal.setPixelHeight passed invalid height of: "+l)}else{b=m}};this.getPixelWidth= function(){return h};this.setPixelWidth= function(m){var l=parseInt(m,10);if(isNaN(l)||(l<0)){throw new Exception("deCarta.Math.MercatorEllipsoidal.setPixelWidth passed invalid width of: "+m)}else{h=l}};this.positionToPixels= function(o){if(!g()||!o||(!o.lat&&o.lat!=0)||(!o.lon&&o.lon!=0)){throw new Exception("deCarta.Math.MercatorEllipsoidal.positionToPixels: need to setBoundingBox, setPixelHeight and setPixelWidth prior to calculating positionToPixels")}var m=new PixelPoint(0,0);m.x=j*(d.minPosition.lon-o.lon)*-1;var n=f(d.maxPosition.lat)-f(o.lat);var l=f(d.maxPosition.lat)-f(d.minPosition.lat);m.y=b*n/l;return m};this.pixelsToPosition= function(m){if(!g()||!m||(!m.x&&m.x!=0)||(!m.y&&m.y!=0)){throw new Exception("deCarta.Math.MercatorEllipsoidal.positionToPixels: need to setBoundingBox, setPixelHeight and setPixelWidth prior to calculating pixelsToPositiion")}var o=new Position(0,0);o.lon=d.minPosition.lon+(m.x/j);var l=f(d.maxPosition.lat)-f(d.minPosition.lat);var n=(m.y/b)*l;o.lat=c(f(d.maxPosition.lat)-n);return o}};deCarta.Math.greatCircleDist= function(m,l,a){if(!m||!l){throw new Exception("Utilities.greatCircleDist: must have valid coords")}var d=Math.PI*m.lat/180;var h=Math.cos(d);var j=Math.PI*m.lon/180;var c=Math.PI*l.lat/180;var g=Math.cos(c);var f=Math.PI*l.lon/180;var k=Math.abs(Math.abs(j)-Math.abs(f));var o=6372795;var b;var n=2*Math.asin(Math.sqrt(Math.pow(Math.sin(((c-d)/2)),2)+(h*g*Math.pow(Math.sin(k/2),2))));b=o*n;if(!a||a.value=="M"){return b}switch(a.value){case"KM":b/=1000;break;case"MI":b/=1609;break;case"FT":b*=3.28084;break;default:throw new Exception("Utilities.greatCircleDist: unexpected uom value of: "+a.value);break}return b};deCarta.Math.pointInPolygon= function(h,g){function o(r,t,s){if(t.lat<s.lat){if(r){return false}else{return true}}else{if(!r){return false}else{return true}}}function q(s,t,r){if(t.lon<r.lon){if(!s){return false}else{return true}}else{if(s){return false}else{return true}}}var b;var j;var a=0;var p=0;if(g.lat<h[0].lat){j=true}else{j=false}if(g.lon<h[0].lon){b=false}else{b=true}for(var m in h){var f=q(b,g,h[m]);var l=o(j,g,h[m]);if(f&&l){var c=h[m].lat-h[m-1].lat;var d=h[m].lon-h[m-1].lon;var k=c/d;c=g.lat-h[m-1].lat;d=g.lon-h[m-1].lon;var n=c/d;if((b&&!j)||(!b&&!j)){if(n>k){p++}else{a++}}if((!b&&j)||(b&&j)){if(n<k){p++}else{a++}}b=!b;j=!j}else{if(f){b=!b}if(l){j=!j;if(b){a++}else{p++}}}}if(a%2==0){return false}else{return true}};deCarta.Math.headingFromPositions= function(c,a){if(!c||(!c.lat&&c.lat!=0)||(!c.lon&&c.lon!=0)||!a||(!a.lat&&a.lat!=0)||(!a.lon&&a.lon!=0)){throw new Exception("deCarta.Math.headingFromPosition: bad arguments.")}var f=Math.PI/180;var h=c.lat*f;var d=c.lon*f;var g=a.lat*f;var b=a.lon*f;var j=Math.atan2(Math.sin(b-d)*Math.cos(g),Math.cos(h)*Math.sin(g)-Math.sin(h)*Math.cos(g)*Math.cos(b-d));return j/f};deCarta.ObjectToJSON= function(k,d,a){var f;var h="";var c="";if(typeof a==="number"){for(f=0;f<a;f+=1){c+=" "}}else{if(typeof a==="string"){c=a}}var j=d;if(d&&typeof d!=="function"&&(typeof d!=="object"||typeof d.length!=="number")){throw new Exception("Bad replacer in deCarta.ObjectToJSON")}return g("",{"":k});function b(l){var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;n.lastIndex=0;return n.test(l)?'"'+l.replace(n,function(o){var p=m[o];return typeof p==="string"?p:"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+l+'"'}function g(s,p){var n,m,t,l,q=h,o,r=p[s];if(r&&typeof r==="object"&&typeof r.toJSON==="function"){r=r.toJSON(s)}if(typeof j==="function"){r=j.call(p,s,r)}switch(typeof r){case"string":return b(r);case"number":return isFinite(r)?String(r):"null";case"boolean":case"null":return String(r);case"object":if(!r){return"null"}h+=c;o=[];if(Object.prototype.toString.apply(r)==="[object Array]"){l=r.length;for(n=0;n<l;n+=1){o[n]=g(n,r)||"null"}t=o.length===0?"[]":h?"[\n"+h+o.join(",\n"+h)+"\n"+q+"]":"["+o.join(",")+"]";h=q;return t}if(j&&typeof j==="object"){l=j.length;for(n=0;n<l;n+=1){m=j[n];if(typeof m==="string"){t=g(m,r);if(t){o.push(b(m)+(h?": ":":")+t)}}}}else{for(m in r){if(Object.hasOwnProperty.call(r,m)){t=g(m,r);if(t){o.push(b(m)+(h?": ":":")+t)}}}}t=o.length===0?"{}":h?"{\n"+h+o.join(",\n"+h)+"\n"+q+"}":"{"+o.join(",")+"}";h=q;return t}}};function OpenSearchQuery(){this.url=null;this.callback=null;this.params=null}OpenSearchQuery.prototype.setCallback= function(a){this.callback=a};OpenSearchQuery.prototype.setURL= function(a){this.url=a};OpenSearchQuery.prototype.setParams= function(b){this.params="?";for(var a in b){if(b.hasOwnProperty(a)){this.params+=a+"="+b[a]+"&"}}};OpenSearchQuery.prototype.send= function(){var b=this;if(!Utilities.ie){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalPreferencesWrite UniversalBrowserWrite UniversalPreferencesRead UniversalBrowserRead")}catch(c){}}var a=new XMLHttpRequest();a.open("POST",this.url+this.params,true);a.onreadystatechange= function(){if(a.readyState==4){b.callback(a.responseText)}};a.send(null)};function POI(d,a,b,c,f){this.name=d;this.position=a;this.address=b;this.phoneNumber=c;this.distance=null;this.properties=f||{};this.toString= function(){return this.name+" "+this.position+" "+this.address+" "+this.phoneNumber};this.toWSFormat= function(){var h={};h.POIName=this.name;h.phoneNumber=this.phoneNumber;h.ID=this.properties.ID;h.POIAttributeList={};h.POIAttributeList.POIInfoList=[];for(var j in this.properties){if(j!="ID"){h.POIAttributeList.POIInfoList.push({name:j,value:this.properties[j]})}}h.Address={};h.Address.PostalCode=this.address.postalCode;h.Address.CountryCode=this.address.countryCode;h.Address.freeFormAddress=this.properties["freeform-address"];h.Address.StreetAddress={Street:this.address.street,Building:{number:this.address.buildingNumber}};h.Address.Place=[];function g(l){l+="";var k=l.charAt(0).toUpperCase();return k+l.substr(1)}for(var j in this.address){if(typeof this.address[j]!=="function"){h.Address.Place.push({content:this.address[j],type:g(j)})}}h.Point={ns5:"http://www.opengis.net/gml",pos:this.position.lat+" "+this.position.lon};return h}}function POIQuery(){this.xmlRecFac=new deCarta.XMLStringBuilder();var b=[];var a=this;this.authenticate= function(d,c){if(!d||!c||d==""||c==""){throw new Exception("Error authenticating POIQuery, invalid parameters.");return false}Credentials.clientName=d;Credentials.clientPassword=c;this.xmlRecFac.clientName=d;this.xmlRecFac.clientPassword=c};this.query= function(f,h,c){var g=Utilities.getRequestId();if(typeof h=="function"){b[g]=h}else{throw new Exception("POIQuery.query: callBack must be a function, arg was: "+h)}var d=this.xmlRecFac.createPOIRequest(f,g);JSRequest.send(d,a.queryCallback,null,c)};this.fullDetailsQuery= function(h,g,c){var f=Utilities.getRequestId();if(typeof g=="function"){b[f]=g}else{throw new Exception("POIQuery.fullDetailsQuery: callBack must be a function, arg was: "+g)}var d=this.xmlRecFac.createFullDetailsPOIRequest(h,f);JSRequest.send(d,a.fullDetailsQueryCallback,null,c)};this.queryCallback= function(h){var j=false;var d;var f=[];var g;if(deCarta.JSONParser.parseErrors(h)){g=h.XLS.Response.requestID}else{if(deCarta.Array.isArray(h.XLS.Response)){g=h.XLS.Response[0].requestID;j=true;for(d=0;d<h.XLS.Response.length;d++){f.push([]);c(h.XLS.Response[d].DirectoryResponse.POIContext)}}else{g=h.XLS.Response.requestID;c(h.XLS.Response.DirectoryResponse.POIContext)}}if((g>=0)&&b[g]){b[g](f);b[g]=undefined}function c(n){var l;if(!n){return}else{if(n.length==undefined){l=[];l.push(n)}else{l=n}}for(var k=0;k<l.length;k++){var m=deCarta.JSONParser.parsePOI(l[k]);if(j){f[d].push(m)}else{f.push(m)}}}};this.fullDetailsQueryCallback= function(d){var c=d.XLS.Response.requestID;if((c>=0)&&b[c]){b[c]((d.XLS.Response.DirectoryResponse.POIContext.POI));b[c]=undefined}}}function PanController(a){this.init(a)}PanController.prototype.map=null;PanController.prototype.type="PanController";PanController.prototype.frame=null;PanController.prototype.cssClass="decarta-panController";PanController.prototype.opts={screenPosition:"topLeft",xMargin:0,yMargin:0};PanController.prototype.init= function(a){if(!a){a={}}this.setOpts(a)};PanController.prototype.setOpts= function(a){if(typeof a.screenPosition!=="undefined"){this.opts.screenPosition=a.screenPosition}if(typeof a.xMargin!=="undefined"){this.opts.xMargin=a.xMargin}if(typeof a.yMargin!=="undefined"){this.opts.yMargin=a.yMargin}};PanController.prototype.build= function(){this.frame=document.createElement("DIV");this.frame.id=this.cssClass;this.frame.className=this.cssClass;var h=document.createElement("img");h.className="decarta-panController-north";h.src=Credentials.imgPath+"z2t_pan_north.png";h.onclick=this.map.panNorth;var b=document.createElement("img");b.className="decarta-panController-south";b.src=Credentials.imgPath+"z2t_pan_south.png";b.onclick=this.map.panSouth;var d=document.createElement("img");d.className="decarta-panController-east";d.src=Credentials.imgPath+"z2t_pan_east.png";d.onclick=this.map.panEast;var a=document.createElement("img");a.className="decarta-panController-west";a.src=Credentials.imgPath+"z2t_pan_west.png";a.onclick=this.map.panWest;var g=document.createElement("img");g.className="decarta-panController-center";g.src=Credentials.imgPath+"z2t_pan_center_gray.png";var f=this;g.onclick= function(){if(g.src.indexOf("loading-ball.gif")>-1){return}g.src=Credentials.imgPath+"loading-ball.gif";var j= function(m){m=m.coords||m;var n=new Position(m.latitude+" "+m.longitude);return n};var c= function(m){g.src=Credentials.imgPath+"z2t_pan_center_gray.png";f.map.panToPosition(j(m))};var k= function(){g.src=Credentials.imgPath+"z2t_pan_center_gray.png";alert("unable to position")};if(navigator.geolocation){navigator.geolocation.getCurrentPosition(c,k)}else{if(window.google&&google.gears){var l=google.gears.factory.create("beta.geolocation");if((l)&&(l.getPermission())){l.getCurrentPosition(c,k)}}else{g.src=Credentials.imgPath+"z2t_pan_center_gray.png"}}};this.frame.appendChild(h);this.frame.appendChild(b);this.frame.appendChild(d);this.frame.appendChild(a);this.frame.appendChild(g);this.position()};PanController.prototype.appendThis= function(){if(!this.frame){this.build()}return this.frame};PanController.prototype.removeThis= function(){this.map=null;return this.frame};PanController.prototype.position= function(a){switch(this.opts.screenPosition){default:case"topLeft":this.frame.style.marginLeft=this.opts.xMargin+"px";this.frame.style.marginTop=this.opts.yMargin+"px";break;case"topRight":throw ("Not Implemented");break}};function Pin(f,k,w,y){if(!f){throw new Exception("Error instantiating Pin, must at least provide a Position.");return false}var p=this;var l=new Array();var z=170;var D=null;var B=null;var u=false;var h=false;var m=null;var g=null;var j=null;this.type="pin";this.position=null;if(f&&f.clone){this.position=f.clone()}this.icon=y||new Icon(Credentials.pinIconPath,12,12,24,24);this.map=null;this.isVisible=true;this.id="";this.pinImg=null;this.pinImg=document.createElement("img");var d="decarta-pin";this.pinImg.className=d;this.pinImg.style.position="absolute";this.pinImg.id=f.toString();this.pinImg.src=this.icon.src;this.pinImg.style.width=parseInt(this.icon.width)+"px";this.pinImg.style.height=parseInt(this.icon.height)+"px";Pin.zIndexCounter++;this.pinImg.style.zIndex=Pin.zIndexCounter;this.pinImg.style.cursor="pointer";this.pinImg.style.display="block";this.pinImg.msg=k||"";if(Utilities.ie6&&this.pinImg.src.match(new RegExp("\\bpng\\b","g"))){Utilities.fixPng(this.pinImg)}deCarta.IdManager.setTag(this.pinImg,"ignoreForMapEvents");this.poi=null;this.hoverIconOn=null;this.hoverIconOff=null;this.pinTxt=null;this.pinTxt=document.createElement("DIV");this.pinTxt.id="decarta-textoverlay";this.pinTxt.innerHTML=this.icon.overlay.text;this.pinTxt.className=this.icon.overlay.className;this.pinTxt.style.position="absolute";this.pinTxt.style.color=this.icon.overlay.color;this.pinTxt.style.fontSize=this.icon.overlay.size;this.pinTxt.style.fontFamily=this.icon.overlay.fontFamily;if(this.icon.overlay.text==""){this.pinTxt.style.display="none"}else{this.pinTxt.style.display="block"}Pin.zIndexCounter++;this.pinTxt.style.zIndex=Pin.zIndexCounter;this.pinTxt.style.cursor="pointer";deCarta.IdManager.setTag(this.pinTxt,"ignoreForMapEvents");this.animateDrop=false;this.dropSpeed=30;this.animate= function(E,F,G){if(E=="DROP"){this.animateDrop=true;this.dropFunc=new deCarta.Easing(G);if(typeof F=="number"){this.dropSpeed=20;this.dropDuration=F}else{if(F=="FAST"){this.dropSpeed=20;this.dropDuration=200}else{this.dropSpeed=35;this.dropDuration=400}}}};this.animateDropPosition=300;this.animateDropStartTime=null;function o(){if(!p.animateDropStartTime){p.animateDropStartTime=new Date().getTime();p.dropStartY=parseFloat(p.pinImg.style.top)}var E=new Date().getTime()-p.animateDropStartTime;var F=p.dropFunc(E,p.dropStartY,p.animateDropPosition,p.dropDuration);p.pinImg.style.top=(F)+"px";p.pinTxt.style.top=(F)+"px";if(E<p.dropDuration){setTimeout(o,0)}else{p.animateDrop=false;p.pinImg.style.top=(p.dropStartY+p.animateDropPosition)+"px";p.pinTxt.style.top=(p.dropStartY+p.animateDropPosition)+"px"}}this.getZIndex= function(){return(this.pinImg.style.zIndex)};this.setZIndex= function(F){var E=parseInt(F,10);if(!isNaN(E)){this.pinImg.style.zIndex=E;if(this.pinTxt){this.pinTxt.style.zIndex=E+1}}else{this.pinImg.style.zIndex=0;if(this.pinTxt){this.pinTxt.style.zIndex=1}}};this.setId= function(E){this.id=E};this.getId= function(){return this.id};this.setCursorStyle= function(E){this.pinImg.style.cursor=E;this.pinTxt.style.cursor=E};this.getCursorStyle= function(){return this.pinImg.style.cursor};this.setIcon= function(E){p.pinImg.src=E.src;if(p.icon.anchorY==E.anchorY&&p.icon.anchorX==E.anchorX&&E._previousY&&E._previousX){p.pinImg.style.top=(parseInt(p.pinImg.style.top)+E._previousY-E.anchorY)+"px";p.pinImg.style.left=(parseInt(p.pinImg.style.left)+E._previousX-E.anchorX)+"px"}else{p.pinImg.style.top=(parseInt(p.pinImg.style.top)+p.icon.anchorY-E.anchorY)+"px";p.pinImg.style.left=(parseInt(p.pinImg.style.left)+p.icon.anchorX-E.anchorX)+"px"}p.pinImg.style.width=E.width+"px";p.pinImg.style.height=E.height+"px";p.icon=E;if(E.overlay.text!=""){p.pinTxt.style.display="block";p.pinTxt.innerHTML=this.icon.overlay.text;p.pinTxt.style.position="absolute";if(E.overlay.className){p.pinTxt.style.className=E.overlay.className}if(E.overlay.color){p.pinTxt.style.color=E.overlay.color}if(E.overlay.size){p.pinTxt.style.fontSize=E.overlay.size}if(E.overlay.fontFamily){p.pinTxt.style.fontFamily=E.overlay.fontFamily}p.pinTxt.style.left=(parseInt(p.pinImg.style.left)+parseInt(p.icon.overlay.anchorX))+"px";p.pinTxt.style.top=(parseInt(p.pinImg.style.top)+parseInt(p.icon.overlay.anchorY))+"px"}else{p.pinTxt.innerHTML="";p.pinTxt.style.display="none"}if(Utilities.ie6&&this.pinImg.src.match(new RegExp("\\bpng\\b","g"))){var F=this.pinImg.src;this.pinImg.src=Credentials.transparentGIF;this.pinImg.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+F+"',sizingMethod='scale')"}};this.getIcon= function(){return p.icon};this.setX= function(E){var F=E-p.icon.anchorX;if(p.pinImg.offsetLeft==F){return false}p.pinImg.style.left=F+"px";if(p.pinTxt){p.pinTxt.style.left=(F+p.icon.overlay.anchorX)+"px"}return true};this.setY= function(F){if(p.animateDrop){p.pinImg.style.top=(F-p.icon.anchorY-p.animateDropPosition)+"px";if(p.pinTxt){p.pinTxt.style.top=(F-p.icon.anchorY+p.icon.overlay.anchorY-p.animateDropPosition)+"px"}}else{var E=F-p.icon.anchorY;if(p.pinImg.offsetTop==E){return false}p.pinImg.style.top=(E)+"px";if(p.pinTxt){p.pinTxt.style.top=(E+p.icon.overlay.anchorY)+"px"}}if(p.animateDrop){o()}return true};this.getPosition= function(){return p.position};this.setPosition= function(H){if(p.map!=null){var G=p.map.positionToMapLayerPixel(H);var F=p.setX(G.x);var E=p.setY(G.y)}p.position=H;return((F||E)?true:false)};this.setMessage= function(E){p.pinImg.msg=E;if(p.map&&p.pinImg&&p.map.getInfoWindow()&&(p==p.map.getInfoWindow().associatedPin)){p.map.getInfoWindow().setContent(E)}};this.getMessage= function(){return p.pinImg.msg};this.hide= function(){p.isVisible=false;p.pinImg.style.display="none";p.pinTxt.style.display="none"};this.show= function(){p.isVisible=true;p.pinImg.style.display="block";if(p.pinTxt.innerHTML!=""){p.pinTxt.style.display="block"}};this.zoomHide= function(){if(p.isVisible){p.pinImg.style.display="none";p.pinTxt.style.display="none"}};this.zoomShow= function(){if(p.isVisible){p.pinImg.style.display="block";if(p.pinTxt.innerHTML!=""){p.pinTxt.style.display="block"}}};this.showInfoWindow= function(){p.map.getInfoWindow().setPosition(parseInt(p.pinImg.style.left),parseInt(p.pinImg.style.top));p.map.getInfoWindow().setContent(p.pinImg.msg);p.map.getInfoWindow().show(p)};this.hideInfoWindow= function(){p.map.getInfoWindow().hide()};this.addEventListener= function(F,G){var H=false;for(var E=0;E<l.length;E++){if(l[E]==F){l[F]=G;H=true;break}}if(!H){l.push(F);l[F]=G;if(F=="click"||F=="dblclick"||F=="rightclick"){deCarta.Events.addEvent(p.pinImg,"mousedown",r);deCarta.Events.addEvent(p.pinImg,"mouseup",s);deCarta.Events.addEvent(p.pinTxt,"mousedown",r);deCarta.Events.addEvent(p.pinTxt,"mouseup",s)}else{if(F=="mouseover"){deCarta.Events.addEvent(p.pinImg,"mouseover",C);deCarta.Events.addEvent(p.pinTxt,"mouseover",C)}else{if(F=="mouseout"){deCarta.Events.addEvent(p.pinImg,"mouseout",A);deCarta.Events.addEvent(p.pinTxt,"mouseout",A)}}}}};this.clearInstanceListeners= function(){for(var E=0;E<l.length;E++){l[l[E]]=null;l[E]=null}};this.clearListeners= function(F){for(var E=0;E<l.length;E++){if(l[E]==F){l[l[E]]=null;l[E]=null}}};function r(E){if(!GLOBALS.ALLOWDOMEVENTS){return true}if(E.button==2||E.which==3){u=true;return false}if(l.mousedown){l.mousedown(p)}return false}function s(E){if(!GLOBALS.ALLOWDOMEVENTS){return true}if(u){t();return false}if(l.mouseup){l.mouseup(p)}if(!D){B=setTimeout(q,z);D=new Date()}else{clearTimeout(B);n()}return false}function q(){c();if(l.click){l.click(p)}}function n(){c();if(l.dblclick){l.dblclick(p)}}function t(){c();if(l.rightclick){l.rightclick(p)}}this.pickup= function(){if(!h){deCarta.Events.addEvent(window.document,"mousemove",a)}};this.drop= function(){if(h){b()}};function a(V){var M=V.clientX;var L=V.clientY;var Y=p.pinImg;var K=parseInt(Y.style.top,10);var F=parseInt(Y.style.left,10);var Q=p.pinTxt;var N=parseInt(Q.style.top,10);var I=parseInt(Q.style.left,10);var W=p.map;var H=0;var G=0;var O=0;var E=0;if(!h){h=true;m=new PixelPoint(M,L);g=new PixelPoint(F,K);j=new PixelPoint(I,N)}var R=L-Utilities.getAbsoluteTop(W.mapDiv)+Utilities.getScrollTop();var S=M-Utilities.getAbsoluteLeft(W.mapDiv)+Utilities.getScrollLeft();var P=K+parseInt(W.getTileDiv().style.top,10);var T=P+Y.clientHeight/2;var X=F+parseInt(W.getTileDiv().style.left,10);var U=X+Y.clientWidth/2;if(T!=R){G=R-T}O=K+G;Y.style.top=O+"px";Q.style.top=(N+G)+"px";if(U!=S){H=S-U}E=F+H;Y.style.left=E+"px";Q.style.left=(I+H)+"px";return false}function b(H){deCarta.Events.removeEvent(window.document,"mousemove",a);var N=parseInt(p.pinImg.style.left,10)-g.x;var M=-(parseInt(p.pinImg.style.top,10)-g.y);var O=p.map.getZoomController().getGXConvertedZoomLevel();var G=Utilities.radsPerPixelAtZoom(p.map.getTileSize(),O);var L=Utilities.lon2pix(p.position.lon,G);var K=Utilities.lat2pix(p.position.lat,G);var E=Utilities.pix2lon((L+N),G);var I=Utilities.pix2lat((K+M),G);var F=new Position(I,E);p.setPosition(F);h=false;m=null;g=null;j=null;return false}function C(){if(!GLOBALS.ALLOWDOMEVENTS){return}if(l.mouseover){l.mouseover(p)}}function A(){if(!GLOBALS.ALLOWDOMEVENTS){return}if(l.mouseout){l.mouseout(p)}}function c(){D=null;B=null;u=false}if(w&&(w=="onmouseover"||w=="mouseover")){p.addEventListener("mouseover",p.showInfoWindow);p.addEventListener("mouseout",p.hideInfoWindow)}else{if(w&&(w=="onclick"||w=="click")){p.addEventListener("click",p.showInfoWindow)}}this.destroy= function(){if(p&&p.map){if(p.pinImg){deCarta.Events.removeEvent(p.pinImg,"mousedown",r);deCarta.Events.removeEvent(p.pinImg,"mouseup",s);deCarta.Events.removeEvent(p.pinImg,"mouseover",C);deCarta.Events.removeEvent(p.pinImg,"mouseout",A);if(Utilities.ie){Utilities.purge(p.pinImg)}p.map.getTileDiv().removeChild(p.pinImg);p.pinImg=null}if(p.pinTxt){deCarta.Events.removeEvent(p.pinTxt,"mousedown",r);deCarta.Events.removeEvent(p.pinTxt,"mouseup",s);deCarta.Events.removeEvent(p.pinTxt,"mouseover",C);deCarta.Events.removeEvent(p.pinTxt,"mouseout",A);if(Utilities.ie){Utilities.purge(p.pinTxt)}p.map.getTileDiv().removeChild(p.pinTxt);p.pinTxt=null}}p.clearInstanceListeners();p=null};this.toString= function(){if(!p){p=this}var E=p.position.toString();return E};this.equals= function(E){if(E&&E.toString()==this.toString()&&E.pinImg==this.pinImg){return true}else{return false}};this.getViewableBoundingBox= function(I){var N=Utilities.lat2pix(p.position.lat,I);var F=Utilities.lon2pix(p.position.lon,I);var M=N+p.icon.anchorY;var S=F+parseInt(p.pinImg.style.width)-p.icon.anchorX;var R=N-parseInt(p.pinImg.style.height)+p.icon.anchorY;var K=F-p.icon.anchorX;var O=Utilities.pix2lat(M,I);var E=Utilities.pix2lon(S,I);var P=Utilities.pix2lat(R,I);var G=Utilities.pix2lon(K,I);var L=new Position(O,E);var H=new Position(P,G);var Q=new BoundingBox(H,L);return Q}}Pin.zIndexCounter=100;function PixelPoint(a,c){try{this.x=parseFloat(a);this.y=parseFloat(c);if(isNaN(this.x)||isNaN(this.y)){throw new Exception("")}}catch(b){throw new Exception("PixelPoint: bad constructor values for x: "+a+" and y: "+c)}}PixelPoint.prototype.getX= function(){return this.x};PixelPoint.prototype.roundX= function(){return Math.round(this.x)};PixelPoint.prototype.setX= function(a){this.x=parseFloat(a);if(isNaN(this.x)){throw new Exception("PixelPoint: setX bad argument x: "+a)}};PixelPoint.prototype.getY= function(){return this.y};PixelPoint.prototype.roundY= function(){return Math.round(this.y)};PixelPoint.prototype.setY= function(a){this.y=parseFloat(a);if(isNaN(this.y)){throw new Exception("PixelPoint: setY bad argument y: "+a)}};PixelPoint.prototype.toString= function(){return this.x+" "+this.y};PixelPoint.prototype.equals= function(a){if(a&&a.toString()==this.toString()){return true}else{return false}};function Position(f,b){this.lat=0;this.lon=0;if(arguments.length==1){var d=f.split(" ");if(d.length!=2){throw new Exception("error initializing Position object")}try{this.lat=parseFloat(d[0]);this.lon=parseFloat(d[1]);if(isNaN(this.lat)||isNaN(this.lon)){throw new Exception()}}catch(c){throw new Exception("error initializing Position object")}}else{if(arguments.length==2){try{this.lat=parseFloat(f);this.lon=parseFloat(b);if(isNaN(this.lat)||isNaN(this.lon)){throw new Exception()}}catch(c){throw new Exception("error initializing Position object")}}else{throw new Exception("error initializing Position object")}}if(this.lat>90){this.lat=89.5}if(this.lat<-90){this.lat=-89.5}if(this.lon>180||this.lon<-180){var a=this.lon%360;if(a<=-180){a=(360+a)}else{if(a>=180){a=-(360-a)}}this.lon=a}this.customProperties={}}Position.prototype.clone= function(){return new Position(this.toString())};Position.prototype.getLat= function(){return this.lat};Position.prototype.getLon= function(){return this.lon};Position.prototype.setLat= function(a){this.lat=a};Position.prototype.setLon= function(a){this.lon=a};Position.prototype.getLatLon= function(){return this.lat+" "+this.lon};Position.prototype.getLatCommaLon= function(){return this.lat+", "+this.lon};Position.prototype.equals= function(a){if(a&&a.getLatLon()==this.getLatLon()){return true}else{return false}};Position.prototype.toString= function(){return this.lat.toFixed(14)+" "+this.lon.toFixed(14)};deCarta.PositionAnimator= function(b,a){if(b&&a){this.animate(b,a)}};deCarta.PositionAnimator.prototype={animate:function(c,a){this.map=c;var b={start:null,end:null,duration:300,onStep:null,onEnd:null};if(!a.start||!a.end||!a.onStep||!c){throw ("You need to specify a start point, and end point and a callback for a position animation")}a=Utilities.extend(b,a);this.start=a.start;this.end=a.end;this.duration=a.duration;this.onStep=a.onStep;this.onEnd=a.onEnd;this.endTime=new Date().getTime()+this.duration;this.step()},step:function(){var d=1-((this.endTime-new Date().getTime())/this.duration);if(d>=0.99){if(typeof this.onEnd==="function"){this.onEnd(this.end)}}else{var g=this.posToPix(this.start);var c=this.posToPix(this.end);var b=c.x-g.x;var a=c.y-g.y;var j=b*d;var h=a*d;var f=this.pixToPos({x:g.x+j,y:g.y+h});if(typeof this.onStep==="function"){this.onStep(f)}setTimeout(this.step.scope(this),20)}},posToPix:function(c){var a=this.map.getZoomController().getGXConvertedZoomLevel();var b=Utilities.radsPerPixelAtZoom(this.map.getTileSize(),a);return{x:Utilities.lon2pix(c.lon,b),y:Utilities.lat2pix(c.lat,b)}},pixToPos:function(a){var b=this.map.getZoomController().getGXConvertedZoomLevel();var c=Utilities.radsPerPixelAtZoom(this.map.getTileSize(),b);return new Position(Utilities.pix2lat(a.y,c),Utilities.pix2lon(a.x,c))}};function Radius(c,b){this.distance=c;this.uom=b||new UOM("KM");var a;if(b=="KM"){a="K"}else{if(b=="M"){a="M"}else{if(b=="MI"){a="R"}else{if(b=="FT"){a="F"}}}}this.uomdds=a;this.toString= function(){return this.distance+" "+this.uom};this.getDegrees= function(){if(this.uom=="KM"){return this.distance/111.111}else{if(this.uom=="M"){return(this.distance/1000)/111.111}else{if(this.uom=="MI"){return(this.distance*1.609)/111.111}else{if(this.uom=="FT"){return((this.distance/3.28)/1000)/111.111}}}}};this.getMiles= function(){switch(this.uom){case"KM":return this.distance*0.621371192;break;case"M":return(this.distance/1000)*0.621371192;break;case"MI":return this.distance;break;case"FT":return this.distance*0.000189393939;break;default:deCarta.Mobile.Exception.raise("Unknown UOM : "+this.uom);break}};this.getKm= function(){switch(this.uom){case"KM":return this.distance;break;case"M":return(this.distance/1000);break;case"MI":return this.distance*1.609344;break;case"FT":return this.distance*0.0003048;break;default:deCarta.Mobile.Exception.raise("Unknown UOM : "+this.uom);break}}}function Route(){this.alternates=[];this.TotalTime="";this.TotalTimeObject={};this.TotalDistance="";this.viaPointSequence="";this.RouteInstructions=[];this.RouteGeometry=[];this.routeID="";this.boundingBox=null;this.centerPosition=null;this.uom=null;this.id=Math.floor(Math.random()*10000000);this.title="";this.description="";this.customProperties={}}function ManeuverMap(){this.desc;this.URL;this.height;this.width;this.format;this.boundingBox}function RouteInstruction(){this.maneuverMap=undefined;this.Instruction="";this.distance="";this.duration="";this.position=null;this.tour=""}function RoutePreference(b,c,a){this.maneuverMaps=false;this.maneuverMapConfig={format:"GIF",height:200,width:200};this.routePreference=b||"Fastest";this.vehicleType=null;this.validVehicleTypes={PassengerCar:"Regular passenger cars","4WD":"Vehicles with four wheel drive",HOV:"High Occupancy Vehicles",Emergency:"Emergency Vehicles, Ambulance",Taxi:"Taxis",PublicBus:"Public buses, ex: city bus",DeliveryTruck:"Delivery Trucks",TransportTruck:"Transport Trucks",Motorcycle:"Motorcycles",Pedestrian:"Pedestrians"};this.uom=c||new UOM("KM");this.routeQueryType=a||"RTXT";this.rules=null;this.optimized=false;this.expectedStartTime=null;this.alternateRoutes=0;this.avoidAreas=[];this.avoidList=[];this.generalizationFactor=0;this.generalizationBBox=null;this.returnRouteGeometry=true;this.returnRouteInstructions=true;this.useExclusionZone=false}RoutePreference.prototype.setOptimized= function(a){this.optimized=a};RoutePreference.prototype.getOptimized= function(){return this.optimized};RoutePreference.prototype.setRules= function(a){this.rules=a};RoutePreference.prototype.getRules= function(){return this.rules};RoutePreference.prototype.setExpectedStartTime= function(a){this.expectedStartTime=a};RoutePreference.prototype.getExpectedStartTime= function(){return this.expectedStartTime};RoutePreference.prototype.getAvoidAreas= function(){return this.avoidAreas};RoutePreference.prototype.addAvoidArea= function(a){if(!a){this.avoidAreas=[]}else{this.avoidAreas.push(a)}};RoutePreference.prototype.getAvoidList= function(){return this.avoidList};RoutePreference.prototype.setVehicleType= function(a){if(a in this.validVehicleTypes){this.vehicleType=a;return}throw new Exception("RoutePreference.setVehicleType: invalid type: "+a)};RoutePreference.prototype.getVehicleType= function(){return this.vehicleType};RoutePreference.prototype.getValidVehicleType= function(){return this.validVehicleTypes};RoutePreference.prototype.setAvoidList= function(a){if(typeof a=="string"||a instanceof "String"){switch(a.toLowerCase()){case"ferry":this.avoidList.push("Ferry");return;case"toll":this.avoidList.push("Toll");return;case"tunnels":this.avoidList.push("Tunnels");return;case"bridges":this.avoidList.push("Bridges");return;default:break}}throw new Exception("RoutePreference.setAvoidList: invalid argument: feature: "+a)};RoutePreference.prototype.getGeneralizationFactor= function(){return this.generalizationFactor};RoutePreference.prototype.setGeneralizationFactor= function(a,c){try{this.generalizationBBox=Utilities.positionsToBoundingBox(a);this.generalizationFactor=Utilities.generalizationFactor(this.generalizationBBox,c)}catch(b){throw b}};RoutePreference.prototype.setUseExclusionZone= function(a){this.useExclusionZone=a};function RouteQuery(){this.xmlRecFac=new deCarta.XMLStringBuilder();var b=[];var a=this;this.authenticate= function(d,c){if(!d||!c||d==""||c==""){throw new Exception("Error authenticating RouteQuery, invalid parameters.");return false}Credentials.clientName=d;Credentials.clientPassword=c;this.xmlRecFac.clientName=d;this.xmlRecFac.clientPassword=c};this.query= function(c,g,j,d){var h=Utilities.getRequestId();if(typeof j=="function"){b[h]=j}else{throw new Exception("RouteQuery.query: callBack must be a function, arg was: "+j)}var f=this.xmlRecFac.createRouteGeometryRequest(c,h,g);JSRequest.send(f,a.queryCallback,null,d)};this.queryById= function(h,g,c){var f=Utilities.getRequestId();if(typeof g=="function"){b[f]=g}else{throw new Exception("RouteQuery.queryById: callBack must be a function, arg was: "+g)}var d=this.xmlRecFac.createRouteGeometryByIdRequest(h,f);JSRequest.send(d,a.queryCallback,null,c)};this.queryCallback= function(f){var d=f.XLS.Response.requestID;var c;if(deCarta.JSONParser.parseErrors(f)){c=null}else{c=deCarta.JSONParser.parseRoutes(f)}if((d>=0)&&b[d]){b[d](c);b[d]=undefined}}}function ScaleBar(a){if(!a){a={}}this.setOpts(a);this.init()}ScaleBar.prototype.map=null;ScaleBar.prototype.type="ScaleBar";ScaleBar.prototype.frameHeight=40;ScaleBar.prototype.frameWidth=120;ScaleBar.prototype.frame=null;ScaleBar.prototype.cssClass="decarta-scaleBar";ScaleBar.prototype.measureImperial=null;ScaleBar.prototype.measureMetric=null;ScaleBar.prototype.measureCssClass="decarta-scaleBarMeasure";ScaleBar.prototype.scaleImperial=null;ScaleBar.prototype.scaleImperialCssClass="decarta-scaleBarImperialScale";ScaleBar.prototype.scaleMetric=null;ScaleBar.prototype.scaleMetricCssClass="decarta-scaleBarMetricScale";ScaleBar.prototype.opts={screenPosition:"bottomRight",xMargin:0,yMargin:0};ScaleBar.prototype.setOpts= function(a){if(typeof a.screenPosition!=="undefined"){this.opts.screenPosition=a.screenPosition}if(typeof a.xMargin!=="undefined"){this.opts.xMargin=a.xMargin}if(typeof a.yMargin!=="undefined"){this.opts.yMargin=a.yMargin}};ScaleBar.prototype.init= function(){};ScaleBar.prototype.build= function(){this.measureImperial=document.createElement("div");this.measureImperial.className=this.measureCssClass;Utilities.setUnselectable(this.measureImperial);this.scaleImperial=document.createElement("div");this.scaleImperial.className=this.scaleImperialCssClass;if(Utilities.ie6){this.scaleImperial.innerHTML="&nbsp;"}Utilities.setUnselectable(this.scaleImperial);this.measureMetric=document.createElement("div");this.measureMetric.className=this.measureCssClass;Utilities.setUnselectable(this.measureMetric);this.scaleMetric=document.createElement("div");this.scaleMetric.className=this.scaleMetricCssClass;if(Utilities.ie6){this.scaleMetric.innerHTML="&nbsp;"}Utilities.setUnselectable(this.scaleMetric);this.frame=document.createElement("div");this.frame.id=this.cssClass;this.frame.className=this.cssClass;Utilities.setUnselectable(this.frame);this.frame.appendChild(this.measureImperial);this.frame.appendChild(this.scaleImperial);this.frame.appendChild(this.scaleMetric);this.frame.appendChild(this.measureMetric)};ScaleBar.prototype.appendThis= function(){if(!this.frame){this.build()}return this.frame};ScaleBar.prototype.removeThis= function(){this.map=null;return this.frame};ScaleBar.prototype.position= function(b){if(!this.map){return}var a="px";switch(this.opts.screenPosition){case"topLeft":this.frame.style.top=this.opts.yMargin+a;this.frame.style.left=this.opts.xMargin+a;break;case"topRight":this.frame.style.top=this.opts.yMargin+a;this.frame.style.left=b.width-this.opts.xMargin-this.frameWidth+a;break;case"bottomLeft":this.frame.style.top=b.height-this.opts.yMargin-this.frameHeight+a;this.frame.style.left=this.opts.xMargin+a;break;default:case"bottomRight":this.frame.style.top=b.height-this.opts.yMargin-this.frameHeight+a;this.frame.style.left=b.width-this.opts.xMargin-this.frameWidth+a;break}};ScaleBar.prototype.calculate= function(){if(!this.map||!this.map.getZoomController()){return}try{this.map.getCenterPosition()}catch(m){return}var t=this.map.getZoomController().getGXConvertedZoomLevel();var f=Utilities.radsPerPixelAtZoom(this.map.getTileSize(),t);var d=this.map.getCenterPosition();var a=Math.cos(((d.lat)*(Math.PI/180)));var b=Utilities.lon2pix(d.lon,f);var s=Utilities.pix2lon(b+1,f);var r=Utilities.pix2lon(b,f);var c=s-r;var l=parseFloat(a*111325);var g=(c*l);var o=g*3.28;var n=this.frameWidth-15;this.scaleMetric.style.width=q(g,n)+"px";this.scaleImperial.style.width=k(o,n)+"px";this.measureMetric.innerHTML=j(g,n);this.measureImperial.innerHTML=h(o,n);function k(A,p){var w=[25,50,100,200,500,1000,2000,5280,10560,26400,52800,132000,264000,396000,528000,1056000,1584000,2640000,3168000,3696000,4224000,4752000,5280000,10560000,15840000,21120000,26400000];var B=A*p;var y;var u=w.length;for(y=0;y<u;y++){if(B<=w[y]){break}}y=(y-1>0)?y-1:0;var z=w[y]/A;return z}function h(z,p){var w=[25,50,100,200,500,1000,2000,5280,10560,26400,52800,132000,264000,396000,528000,1056000,1584000,2640000,3168000,3696000,4224000,4752000,5280000,10560000,15840000,21120000,26400000];var B=["25 ft","50 ft","100 ft","200 ft","500 ft","1000 ft","2000 ft","1 mi","2 mi","5 mi","10 mi","25 mi","50 mi","75 mi","100 mi","200 mi","300 mi","500 mi","600 mi","700 mi","800 mi","900 mi","1000 mi","2000 mi","3000 mi","4000 mi","5000 mi"];var A=z*p;var y;var u=w.length;for(y=0;y<u;y++){if(A<=w[y]){break}}y=(y-1>0)?y-1:0;return B[y]}function q(u,p){var y=[10,25,50,100,200,500,1000,2000,5000,10000,25000,50000,75000,100000,200000,300000,500000,600000,700000,800000,900000,1000000,2000000,3000000,4000000,5000000];var B=u*p;var z;var w=y.length;for(z=0;z<w;z++){if(B<=y[z]){break}}z=(z-1>0)?z-1:0;var A=y[z]/u;return A}function j(u,p){var y=[10,25,50,100,200,500,1000,2000,5000,10000,25000,50000,75000,100000,200000,300000,500000,600000,700000,800000,900000,1000000,2000000,3000000,4000000,5000000];var B=["10 m","25 m","50 m","100 m","200 m","500 m","1 km","2 km","5 km","10 km","25 km","50 km","75 km","100 km","200 km","300 km","500 km","600 km","700 km","800 km","900 km","1000 km","2000 km","3000 km","4000 km","5000 km"];var A=u*p;var z;var w=y.length;for(z=0;z<w;z++){if(A<=y[z]){break}}z=(z-1>0)?z-1:0;return B[z]}};ScaleBar.prototype.getDiv= function(){return this.frame};function SearchCriteria(g,b,a,d,c,f){this.queryString=g;this.position=null;if(b&&b.clone){this.position=b.clone()}else{throw new Exception("SearchCriteria constructor: position not valid")}this.radius=a||new Radius(0.5);if(d){this.maximumResponses=d}if(c){this.database=c}if(c){this.defaultUOM=f}}SearchCriteria.prototype=new AbstractSearchCriteria();SearchCriteria.prototype.constructor=AbstractSearchCriteria;function ServerMonitor(){var _callBackArray=[];var _xmlStringBuilder=new deCarta.XMLStringBuilder();this.query= function(callBack){if(!callBack||(typeof callBack!="function")){return false}var reqId=Utilities.getRequestId();_callBackArray[reqId]=callBack;var xmlRequestString=_xmlStringBuilder.createRUOKRequest(reqId);this.sendServerMonitorQueryRequest(xmlRequestString);return true};this.sendServerMonitorQueryRequest= function(xmlRequestString){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalPreferencesWrite UniversalBrowserWrite UniversalPreferencesRead UniversalBrowserRead")}catch(e){}var url=Credentials.url;if(url.indexOf("/openls/openls")>-1){url=url.substring(0,url.indexOf("/openls/openls"));url=url+"/openls/JSON?responseFormat=ALL"}var xmlhttp=null;try{if(XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{xmlhttp=new ActiveXObject()}}catch(e){}if(!xmlhttp){throw new Exception("ServerMonitor: I can't believe your system cannot generate an XMLHttpRequest. Oh the shame.")}xmlhttp.open("POST",url,true);xmlhttp.onreadystatechange= function(){if(xmlhttp.readyState==4){var rawResponse=eval(xmlhttp.responseText);var response={};response.status=xmlhttp.status;response.xml=rawResponse.xmlResponse;response.json=rawResponse.response;if(_callBackArray[response.json.XLS.Response.requestID]){_callBackArray[response.json.XLS.Response.requestID](response)}}};xmlhttp.send(xmlRequestString)}}function ShapeDrawingTool(p){this.map=null;this.frame=null;this.type="ShapeDrawingTool";this.domView=true;var j=p||a;var d=this;var m=null;var g=null;var u=null;var h=null;var z=[];var f=Utilities.ie;var r=null;var b=null;var l=null;this.initialize= function(){if(!this.domView){return}this.frame=document.createElement("DIV");this.frame.id="decarta-shapeDrawingTool";this.frame.style.cssText="position:absolute;z-index:9999;left:100px;top:10px;";deCarta.IdManager.setTag(this.frame,"ignoreForMapEvents");r=document.createElement("img");r.src=Credentials.imgPath+"draw-tool-drag-selected.png";r.style.cssText="width:31px;height:31px;position:absolute;left:0px;top:0px;";r.onclick= function(){s(true)};this.frame.appendChild(r);var E="circle";m=document.createElement("IMG");m.src=Credentials.imgPath+"draw-tool-"+E+".png";m.style.cssText="width:39px;height:31px;position:absolute;left:31px;top:0px;";m.toolName=E;m.onclick= function(G){G=G||event;G.stoppropagation?G.stoppropagation():G.cancelBubble=true;var F=G.clientX-Utilities.getAbsoluteLeft(m)+Utilities.getScrollLeft();if(F>this.offsetWidth*2/3){g.style.display="block"}else{if(F<this.offsetWidth*2/3){g.style.display="none";d.drawShape(this.toolName)}}};deCarta.IdManager.setTag(m,"ignoreForMapEvents");this.frame.appendChild(m);D();this.frame.appendChild(g)};function D(){g=document.createElement("DIV");g.className="decarta-drawingToolMenu";deCarta.IdManager.setTag(g,"ignoreForMapEvents");var G=document.createElement("DIV");G.innerHTML="Draw a circle";G.className="decarta-drawingToolMenuItemOff";G.onmouseover= function(){this.className="decarta-drawingToolMenuItemOn"};G.onmouseout= function(){this.className="decarta-drawingToolMenuItemOff"};G.onclick= function(){m.toolName="circle";d.drawShape("circle")};deCarta.IdManager.setTag(G,"ignoreForMapEvents");g.appendChild(G);var E=document.createElement("DIV");g.appendChild(E);E.className="decarta-drawingToolMenuItemOff";E.innerHTML="Draw a line";E.onmouseover= function(){this.className="decarta-drawingToolMenuItemOn"};E.onmouseout= function(){this.className="decarta-drawingToolMenuItemOff"};deCarta.IdManager.setTag(E,"ignoreForMapEvents");E.onclick= function(){m.toolName="line";d.drawShape("line")};var F=document.createElement("DIV");g.appendChild(F);F.innerHTML="Draw a polygon";F.className="decarta-drawingToolMenuItemOff";F.onmouseover= function(){this.className="decarta-drawingToolMenuItemOn"};F.onmouseout= function(){this.className="decarta-drawingToolMenuItemOff"};deCarta.IdManager.setTag(F,"ignoreForMapEvents");F.onclick= function(){m.toolName="poly";d.drawShape("poly")}}this.drawShape= function(E){if(E!="circle"&&E!="poly"&&E!="line"){throw new Exception("toolName should be circle or poly or line")}if(!l){A()}C(E)};function C(E){s(true);l=E;if(m){m.src=Credentials.imgPath+"draw-tool-"+l+"-selected.png"}if(r){r.src=Credentials.imgPath+"draw-tool-drag.png"}if(E=="circle"){u=new DDSCircle();u.setFillColor("(77.0.255)")}else{if(E=="line"){u=new DDSLine()}else{u=new DDSLine()}}u.addEventListener("onclick",y);h=new DDSLine();d.map.getTilesContainer().style.cursor="crosshair";EventRegistry.addListener(d.map,"moveend",function(){d.map.getTilesContainer().style.cursor="crosshair"});EventRegistry.addListener(d.map,"zoomend",function(){var G=z;for(var F=0;F<G.length;F++){G[F].setPosition(G[F].position)}});EventRegistry.addListener(d.map,"click",function(G){var H=new w(G);z.push(H);d.addSquarePinToMap(H);if(E=="circle"){if(!u.position){u.position=G;d.map.getTilesContainer().onmousemove=t}else{s();var F=Utilities.positions2Distance(u.position,G);u.setRadius(F);d.map.addOverlay(u);y(u)}}else{u.positions.push(G);if(u.positions.length==2){d.map.addOverlay(u)}if(u.positions.length>2){u.setPositions(u.positions)}d.map.getTilesContainer().onmousemove=t}})}function A(){b={};b.click=d.map.getEventListener("click");b.moveend=d.map.getEventListener("moveend");b.zoomend=d.map.getEventListener("zoomend")}function q(){for(var E in b){if(b[E]&&b.hasOwnProperty(E)){d.map.addEventListener(E,b[E])}else{if(b.hasOwnProperty(E)){d.map.clearListeners(E)}}}}function n(H){H=H?H:window.event;H.stoppropagation?H.stoppropagation():H.cancelBubble=true;var G=l;var I=this.squarePin;if(G=="circle"){s(true)}else{if(G=="line"){if(z.length==1){s(true)}else{var E=u.positions;if(this.squarePin==z[0]||I==z[z.length-1]){if(I==z[0]){E.push(I.position)}s();u.setPositions(E);y(u)}else{E.push(I.position);u.setPositions(E);var F=new w(I.position);z.push(F);d.addSquarePinToMap(F)}}}else{if(z.length==1){s(true)}else{E=u.positions;if(this.squarePin==z[0]||I==z[z.length-1]){s();u.type="polygon";u.setFillColor("(77.0.255)");u.setPositions(E);y(u)}else{E.push(I.position);u.setPositions(E);F=new w(I.position);z.push(F);d.addSquarePinToMap(F)}}}}}function o(){g.style.display="none"}function B(){g.style.display="none"}function t(L){L=L?L:window.event;if(!z.length){return}var F=new PixelPoint(L.clientX,L.clientY);var N=z[z.length-1].position;var E=d.map.screenPixToPos(F);var G=Utilities.radsPerPixelAtZoomLevel(d.map.getTileSize(),d.map.getZoomController().getZoomLevel());var O=E.lon-N.lon;if(O>180){O=O-360}else{if(O<-180){O=O+360}}var M=E.lat-N.lat;if(E.lat==90||E.lat==-90){return}var K=M/Math.cos(E.lat*Math.PI/180);var P=Math.atan2(K,O);var H=Math.sin(P)*G*180/Math.PI*Math.cos(E.lat*Math.PI/180);var I=Math.cos(P)*(G*180/Math.PI);if(h){d.map.removeOverlay(h)}if(Math.sqrt(O*O+K*K)<15*G*180/Math.PI){return}E=new Position(E.lat-5*H,E.lon-5*I);N=new Position(N.lat+10*H,N.lon+10*I);h=new DDSLine();h.setPositions([N,E]);d.map.addOverlay(h)}this.appendThis= function(){if(!this.frame){this.initialize()}var E=this.frame||null;return E};this.removeThis= function(){this.map=null;return this.frame};this.position= function(E){if(!this.map){return}if(this.frame){}};this.addSquarePinToMap= function(E){E.setPosition(E.position);d.map.getTileDiv().appendChild(E.frame)};this.removeSquarePinFromMap= function(E){if(!E||!E.frame){return}d.map.getTileDiv().removeChild(E.frame);E.frame=null};this.getSquarePins= function(){return z};function y(E){j(E)}function a(E){var G=E.map;var F=G.positionToMapLayerPixel(E.getPosition());G.getInfoWindow().setPosition(F.x,F.y);k(E);G.getInfoWindow().show(E)}function k(E){var G=c(E);var F=E.map;F.getInfoWindow().setContentSelectable(true);F.getInfoWindow().setContent(G)}function c(M){var E=M.map;var F=document.createElement("div");F.style.width="100%";F.style.height="100%";var G=document.createElement("div");var K=document.createElement("span");K.className="decarta-drawingToolInfoWin";K.innerHTML="Title      ";G.appendChild(K);var L=document.createElement("input");L.type="text";L.value=M?M.title:"";L.id="titleInput";L.size="20";G.appendChild(L);F.appendChild(G);var I=document.createElement("div");I.style.cssText="width:100%;height:100%;overflow:auto;";var H=document.createElement("div");H.className="decarta-drawingToolInfoWin";H.innerHTML="Description";I.appendChild(H);var P=document.createElement("textarea");P.value=M?M.description:"";I.appendChild(P);F.appendChild(I);var O=document.createElement("div");F.appendChild(O);var Q=document.createElement("input");Q.type="button";Q.value="delete";Q.onclick= function(){E.getInfoWindow().hide();E.removeOverlay(M)};O.appendChild(Q);var N=document.createElement("input");N.type="button";N.value="save";N.onclick= function(){if(L.value){L.value=L.value.replace(/^\s*|\s*$/g,"")}M.setTitle((L.value)?(L.value):"");if(P.value){P.value=P.value.replace(/^\s*|\s*$/g,"")}M.setDescription((P.value)?(P.value):"");E.getInfoWindow().hide();M.customProperties.saved=true};O.appendChild(N);var R=document.createElement("input");R.type="button";R.value="cancel";R.onclick= function(){E.getInfoWindow().hide();if(M.customProperties.saved!=true){E.removeOverlay(M)}};O.appendChild(R);return F}function w(E){this.position=E;this.frame=null;this.frame=document.createElement("DIV");this.frame.style.cssText="border:1px solid blue;background-color:white;opacity:50%;z-index:110;position:absolute;width:10px;height:10px;";this.frame.squarePin=this;this.frame.id="decarta_square_pin "+E.toString();var F=d.map.positionToMapLayerPixel(this.position);this.frame.style.left=F.x-5+"px";this.frame.style.top=F.y-5+"px";this.frame.onclick=n;this.setPosition= function(G){this.position=G;var H=d.map.positionToMapLayerPixel(this.position);this.frame.style.left=H.x-5+"px";this.frame.style.top=H.y-5+"px"};this.equals= function(G){if(this.position.equals(G.position)){return true}else{return false}}}function s(F){if(m){var G=m.src;G=G.replace(/-selected\.png$/,".png");m.src=G}if(r){r.src=Credentials.imgPath+"draw-tool-drag-selected.png"}if(g){g.style.display="none"}l=null;for(var E=0;E<z.length;E++){d.removeSquarePinFromMap(z[E])}if(h){d.map.removeOverlay(h)}d.map.getInfoWindow().hide();h=null;z=[];d.map.getTilesContainer().onmousemove=null;d.map.getTilesContainer().style.cursor="default";if(F){if(u&&u.customProperties.saved!=true){d.map.removeOverlay(u)}u=null}q()}this.getDefaultShapeClickHandler= function(){return a};this.setDomView= function(E){E=(E)?true:false;this.domView=E};this.show= function(){if(this.frame){this.frame.style.display="block"}};this.hide= function(){if(this.frame){this.frame.style.display="none"}}}deCarta.String={};deCarta.String.isString= function(a){if(typeof a==="string"||a instanceof String){return true}else{return false}};deCarta.String.trim= function(a){return a.replace(/^\s*/,"").replace(/\s*$/,"")};deCarta.String.rtrim= function(a){return a.replace(/\s*$/,"")};deCarta.String.ltrim= function(a){return a.replace(/^\s*/,"")};deCarta.String.cleanUTF8= function(b){var a=decodeURIComponent(encodeURIComponent(b));return a};deCarta.StyleManager={};deCarta.StyleManager.stylesCreated=false;deCarta.StyleManager.cssString=".decarta-close{position:absolute; width:20px; height:20px; top:2px; left:178px; display:block; cursor:pointer;}.decarta-bubbleContent{padding:16px;}.decarta-bubble{display:none; width:200px; background-color:#ffffff; filter:alpha(opacity=100); opacity:1; border: 1px solid #cccccc; position:absolute; z-index:10000; color:#000000; font-size:11px;}.decarta-copyright{background-color:#ffffff; opacity:50; filter:alpha(opacity=80); opacity:0.8; padding:1px; font-family:arial; color:#000000; font-size:11px; border:1px solid #cccccc; display:block; position:absolute; z-index:9999;}.decarta-mapTypeController{background-color:#ffffff; opacity:50; filter:alpha(opacity=80); opacity:0.8; padding:3px; font-family:Arial; color:#000000; font-size:11px; font-weight:bold; border:1px solid #cccccc; display:block; position:absolute; height:14px;width:154px; visibility:visible; z-index:9999;}.decarta-mapTypeControllerLink{text-decoration:none;}.decarta-zoomButton{padding:0; margin:0; display:block;}.decarta-zoom{cursor: pointer; width: 20px; height:278px;top: 10px; left: 10px; position: absolute; z-index: 9999;}.decarta-zoomTop{margin:0px;padding:0px;position:absolute;left:0px;width:20px;top:0px;height:20px;}.decarta-zoomPillar{margin:0px;padding:0px;position:absolute;left:0px;width:20px;top:20px;height:170px;}.decarta-zoomBottom{margin:0px;padding:0px;position:absolute;left:0px;width:20px;top:190px;height:20px;}.decarta-zoomSlider{maring:0px;padding:0px;position:absolute;left:0px;width:20px;height:10px;}.decarta-drawingToolMenu{position:absolute;left:31px;top:31px;width:120px;background-color:white;display:none;}.decarta-drawingToolMenuItemOn{padding:3px;background-color:#bbb;color:#000;font-size:11px;font-family:arial}.decarta-drawingToolMenuItemOff{padding:3px;background-color:#fff;color:#888;font-size:11px;font-family:arial}.decarta-drawingToolInfoWin{padding:3px;background-color:#fff;color:#888;font-size:11px;font-family:arial}.decarta-scaleBar{position:absolute; width:120px; text-align:left; z-index:9999;}.decarta-scaleBarMeasure{font-family:arial; font-size:8pt; padding:0px 0px 0px 3px; margin:0;}.decarta-scaleBarImperialScale{display:block; padding:0; margin:0; font-size:6px; height:6px; border-left:2px solid #000; border-right:2px solid #000; border-bottom:1px solid #000;}.decarta-scaleBarMetricScale{display:block; padding:0; margin:0; font-size:6px; height:6px; border-left:2px solid #000; border-right:2px solid #000; border-top:1px solid #000;}.decarta-mapviewport{position:relative; z-index:0; overflow:hidden;}.decarta-tiles{position:absolute; left:0px; top:0px; z-index:0;}.decarta-maptile{z-index:0; position:absolute; display:none;}.decarta-bbox-div{border:4px solid #999;position:absolute}.decarta-panController{z-index:100; position:absolute; top:1px; left:1px; height:60px; width:60px; padding:0px; margin:0px; }.decarta-panController-north{position:absolute; top:0px; left:20px; height:20px; width:20px; padding:0px; margin:0px; cursor: pointer;}.decarta-panController-south{position:absolute; top:40px; left:20px; height:20px; width:20px; padding:0px; margin:0px; cursor: pointer;}.decarta-panController-east{position:absolute; top:20px; left:40px; height:20px; width:20px; padding:0px; margin:0px; cursor: pointer;}.decarta-panController-west{position:absolute; top:20px; left:0px; height:20px; width:20px; padding:0px; margin:0px;cursor: pointer; }.decarta-panController-center{position:absolute; top:20px; left:20px; height:20px; width:20px; padding:0px; margin:0px;cursor: pointer; }.decarta-mapOverviewController-mapArrayDivWin{position:absolute;border: 1px solid blue;background-color: rgb(102, 102, 204); opacity: 0.4;-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=40)';filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=40);z-index:10020;}.decarta-mapOverviewController-mapDivWin{position:absolute;border: 1px solid blue;background-color: rgb(102, 102, 204); opacity: 0.4;-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=40)';filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=40);z-index:10021;}.decarta-mapOverviewController-mapDiv{position:absolute;left:0px;top:0px;overflow:hidden;}.decarta-mapOverviewController-frame{position:absolute;right:0px;bottom:0px;width:17px;height:17px;z-index:10010;background-color:gray;}.decarta-mapOverviewController-mapToggle{position: absolute; right: 0px; bottom: 0px; width: 17px; height: 17px;z-index:10020;}.decarta-mapOverviewController-mapToggleImg{position:absolute;left:0px;top:0px;width:17px;height:17px;}.decarta-mapOverviewController-mapDivWrapper{position:absolute;left:5px;top:5px;overflow:hidden;}.decarta-mapOverviewController-mapArrayDiv{position:absolute; left:0px; top:0px;}.decarta-tiles img {-webkit-transform-origin: 0 0 }.decarta-tiles img {-webkit-transform: translate3d(0, 0, 0) }.decarta-tiles img {-moz-transform: translate3d(0, 0, 0)}.decarta-tiles img {-o-transform: translate3d(0, 0, 0)}";deCarta.StyleManager.init= function(){if(deCarta.StyleManager.stylesCreated){return}if(document.styleSheets[0]&&document.styleSheets[0].cssText){document.styleSheets[0].cssText+=deCarta.StyleManager.cssString}else{var a=document.createElement("style");a.appendChild(document.createTextNode(deCarta.StyleManager.cssString));document.getElementsByTagName("head")[0].appendChild(a)}deCarta.StyleManager.stylesCreated=true};deCarta.StyleManager.getCurrentStyle= function(b,a){var c=b.style[d(a)];if(!c){if(document.defaultView){c=document.defaultView.getComputedStyle(b,"").getPropertyValue(a)}else{if(b.currentStyle){c=b.currentStyle[d(a)]}}}return c;function d(f){for(var g=/-([a-z])/;g.test(f);f=f.replace(g,RegExp.$1.toUpperCase())){}return f}};function TextOverlay(g,b,h,c,d,a,f){this.text=g||"";this.anchorX=b||0;this.anchorY=h||0;this.color=c||null;this.size=d||null;this.fontFamily=a||null;this.className=f||null;this.toString= function(){return this.text+" "+this.anchorX+" "+this.anchorY+" "+this.size+" "+this.fontFamily+" "+this.className}}TextOverlay.prototype.getAnchorX= function(){return this.anchorX};TextOverlay.prototype.getAnchorY= function(){return this.anchorY};TextOverlay.prototype.getText= function(){return this.text};TextOverlay.prototype.getClassName= function(){return this.className};TextOverlay.prototype.getColor= function(){return this.color};TextOverlay.prototype.getSize= function(){return this.size};TextOverlay.prototype.getFontFamily= function(){return this.fontFamily};TextOverlay.prototype.setAnchorX= function(a){this.anchorX=a};TextOverlay.prototype.setAnchorY= function(a){this.anchorY=a};TextOverlay.prototype.setText= function(a){this.text=a};TextOverlay.prototype.setClassName= function(a){this.className=a};TextOverlay.prototype.setColor= function(a){this.color=a};TextOverlay.prototype.setSize= function(a){this.size=a};TextOverlay.prototype.setFontFamily= function(a){this.fontFamily=a};function TrafficIncident(a,c,b){this.position=a;this.description=c||"";this.severity=b||"";this.toString= function(){return this.position+"  "+this.description}}function TrafficIncidentQuery(){this.xmlRecFac=new deCarta.XMLStringBuilder();var c=null;var b=[];var a=this;this.authenticate= function(f,d){if(!f||!d){throw new Exception("Error authenticating TrafficIncidentQuery, invalid parameters.")}Credentials.clientName=f;Credentials.clientPassword=d;this.xmlRecFac.clientName=f;this.xmlRecFac.clientPassword=d};this.query= function(f,h,d){var g=Utilities.getRequestId();if(typeof h=="function"){b[g]=h}else{throw new Exception("TrafficIncidentQuery.query: callBack must be a function, arg was: "+h)}c=this.xmlRecFac.createTrafficIncidentRequest(f,g);JSRequest.send(c,a.queryCallback,null,d)};this.queryCallback= function(j){var d=[];var h=j.XLS.Response.requestID;if(deCarta.JSONParser.parseErrors(j)){}else{var g=j.XLS.Response.TrafficResponse.Incident;var l=g.length;if(!l){d.push(new TrafficIncident(new Position(g.Position),g.Description,g.severity))}else{for(var f=0;f<g.length;f++){var k=g[f];d.push(new TrafficIncident(new Position(k.Position),k.Description,k.severity))}}}if((h>=0)&&b[h]){b[h](d);b[h]=undefined}}}function TrafficIncidentSearchCriteria(b,a,c,d){if(c>100){throw new Exception("maximumResponses cannot exceed 100")}this.position=b.clone();this.radius=a;this.maximumResponses=c;this.minimumSeverity=d}function UOM(a){if(a!="KM"&&a!="M"&&a!="MI"&&a!="FT"){throw new Exception("invalid UOM type,  KM M MI FT")}this.value=a;this.toString= function(){return this.value}}function Utilities(){}Utilities.EARTH_RADIUS_METERS=6371000;Utilities.regx2=new RegExp("\\s","g");Utilities.parseRequestIDFromXLS= function(b){var a=/requestID=[\'\"]([0-9]+)/;var d=a.exec(b);var c=null;if(d&&d[1]){c=d[1]}return c};Utilities.isObjectEmpty= function(c){var a=true;for(var b in c){if(c.hasOwnProperty(b)){a=false;break}}return a};Utilities.parseKML= function(k){var b=new RegExp("&","g");k=k.replace(b," ");b=new RegExp("<kml xmlns=");k=k.replace(b,"<kml xmlns:goog=");var c=[];var m=(new DOMParser()).parseFromString(k,"text/xml");m.setProperty("SelectionLanguage","XPath");m.setProperty("SelectionNamespaces","xmlns:goog='http://earth.google.com/kml/2.2' xmlns:atom='http://www.w3.org/2005/Atom'");var f=m.selectNodes("//Placemark");for(var d=0;d<f.length;d++){var a;var h;var l;for(var p=0;p<f[d].childNodes.length;p++){try{if(f[d].childNodes[p].nodeName=="name"){a=Sarissa.getText(f[d].childNodes[p])||""}if(f[d].childNodes[p].nodeName=="description"){h=Sarissa.getText(f[d].childNodes[p])||""}if(f[d].childNodes[p].nodeName=="Point"){var o=Utilities.parseKMLCoords(f[d].childNodes[p].childNodes);l=new KMLGeometry("Point",o[0])}if(f[d].childNodes[p].nodeName=="Polygon"){var n=Utilities.parseKMLCoords(f[d].childNodes[p].childNodes);l=new KMLGeometry("Polygon",n)}if(f[d].childNodes[p].nodeName=="LineString"){var q=Utilities.parseKMLCoords(f[d].childNodes[p].childNodes);l=new KMLGeometry("LineString",q)}if(f[d].childNodes[p].nodeName=="MultiGeometry"){var g=Utilities.parseKMLMultiGeometry(f[d].childNodes[p].childNodes);l=new KMLGeometry("MultiGeometry",g)}}catch(j){continue}}if(l){c.push(new KML(l,a,h));l=undefined;a="";h=""}else{}}return c};Utilities.parseKMLMultiGeometry= function(f){var a=[];for(var b=0;b<f.length;b++){var c=f[b].nodeName;var d=Utilities.parseKMLCoords(f[b].childNodes);a.push(new KMLGeometry(c,d))}return a};Utilities.parseKMLCoords= function(d){var b=[];var a;c(d);function c(m){for(var h=0;h<m.length;h++){if(m[h].nodeName=="coordinates"){var g=Sarissa.getText(m[h]);var g=g.replace(Utilities.regx2,",");var j=g.split(",");var f=0;var k,l;for(var h=0;h<j.length;h++){if(f==0){l=j[h];f++;continue}else{if(f==1){k=j[h];b.push(new Position(k,l));f++;continue}else{if(f==2){f=0;continue}}}}a=b;break}else{if(m[h].childNodes.length){c(m[h].childNodes)}}}}return a};Utilities.getElementByTagName= function(j,h,a){var c=h+":"+a;var g;if(navigator.userAgent.toLowerCase().indexOf("safari")>-1){g=j.getElementsByTagNameNS("*",a)[0];if(!g){var b=j.getElementsByTagName("*");var f=b.length;for(var d=0;d<f;d++){if(b[d].nodeName==c){g=b[d];break}}}}else{g=j.getElementsByTagName(c)[0]}return g};Utilities.px="px";Utilities.LL2VR7= function(b){var g=b[0];var h=10000000;var a=(b.length)+","+(b[0].lat*h)+","+(b[0].lon*h);for(var f=1;f<b.length;f++){var d=Math.round((b[f].lat-g.lat)*h);var c=Math.round((b[f].lon-g.lon)*h);g=b[f];a+=","+d+","+c}return a};Utilities.timer= function(){this.green=null;this.red=null;this.start= function(){this.green=new Date().getTime()};this.stop= function(){this.red=new Date().getTime();return this.red-this.green}};Utilities.ie="\v"=="v";Utilities.ie6=(document.all&&!window.opera&&(typeof document.documentElement.style.maxHeight=="undefined"))?true:false;Utilities.fixPng= function(a){if(a.src){var b=a.src;if(a.style.height&&a.style.width){a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b+"', sizingMethod='scale')"}else{a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b+"')"}a.src=Credentials.transparentGIF}else{if(a.style.backgroundImage){var b=a.style.backgroundImage.replace("url(","src='");b=b.replace(")","'");a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader ("+b+"')";a.style.backgroundImage=""}}};Utilities.getScrollTop= function(){var a=0;if(document.documentElement&&document.documentElement.scrollTop){a=document.documentElement.scrollTop}else{if(document.body&&document.body.scrollTop){a=document.body.scrollTop}}return parseInt(a)};Utilities.getScrollLeft= function(){var a=0;if(document.documentElement&&document.documentElement.scrollLeft){a=document.documentElement.scrollLeft}else{if(document.body&&document.body.scrollLeft){a=document.body.scrollLeft}}return parseInt(a)};Utilities.podParse= function(b){var f=parseInt(b.substring(b.indexOf("P")+1,b.indexOf("D")));var a=parseInt(b.substring(b.indexOf("T")+1,b.indexOf("H")));var c=parseInt(b.substring(b.indexOf("H")+1,b.indexOf("M")));var d=parseInt(b.substring(b.indexOf("M")+1,b.indexOf("S")));if(f>0){return((f*24)+a)+" hours "+c+" minutes "}else{if(a>0){return a+" hours "+c+" minutes "}else{if(c>0){return c+" minutes "+d+" seconds "}else{return d+" seconds"}}}};Utilities.podParseJSON= function(b){var g=parseInt(b.substring(b.indexOf("P")+1,b.indexOf("D")));var f=parseInt(b.substring(b.indexOf("T")+1,b.indexOf("H")));var a=parseInt(b.substring(b.indexOf("H")+1,b.indexOf("M")));var c=parseInt(b.substring(b.indexOf("M")+1,b.indexOf("S")));return{days:g,hours:f,minutes:a,seconds:c}};Utilities.htmlizeXMLDom= function(c){var b=new RegExp("\\>","g");var a=new RegExp("\\<","g");var d=(Sarissa.serialize(c));d=d.replace(b,"&gt;");d=d.replace(a,"&lt;");return"<PRE>"+d+"</PRE>"};Utilities.p= function(a){};Utilities.c= function(){};Utilities.generalize= function(l,r,j,q){j=Math.round(j/2);var c=r.getZoomLevel?r.getZoomLevel():r;var d=Utilities.radsPerPixelAtZoomLevel(q,c);var k=l.length;var b=[];var p,h,n,m,a,o,g;for(var f=0;f<k;f++){if(f==0||!p.contains(l[f])){h=Utilities.lat2pix(l[f].lat,d)+j;n=Utilities.lon2pix(l[f].lon,d)+j;m=Utilities.lat2pix(l[f].lat,d)-j;a=Utilities.lon2pix(l[f].lon,d)-j;o=Utilities.pix2lat(h,d)+" "+Utilities.pix2lon(n,d);g=Utilities.pix2lat(m,d)+" "+Utilities.pix2lon(a,d);p=new BoundingBox(new Position(g),new Position(o));b.push(l[f]);continue}}return b};Utilities.grouper= function(w,b,h,k){if(!w||!b||h<=0){throw new Exception("Utilities.grouper: Invalid input posArray: "+w+" zoom: "+b+" radius: "+h)}var n=b.getZoomLevel?b.getZoomLevel():b;var t=Utilities.radsPerPixelAtZoomLevel(k,n);var l=w.length;var c,y,o,a,r,s,u;var m=[];var f=[];var d=0;var q,p;var g=[];for(q=0;q<l;q++){for(p=0;p<d;p++){if(m[p].contains(w[q])){g[p].push(w[q]);break}}if(p!=d){continue}else{y=Utilities.lat2pix(w[q].lat,t)+h;o=Utilities.lon2pix(w[q].lon,t)+h;a=Utilities.lat2pix(w[q].lat,t)-h;r=Utilities.lon2pix(w[q].lon,t)-h;s=Utilities.pix2lat(y,t)+" "+Utilities.pix2lon(o,t);u=Utilities.pix2lat(a,t)+" "+Utilities.pix2lon(r,t);c=new BoundingBox(new Position(u),new Position(s));m[d]=c;f[d]=w[q];g[d]=[];d++;continue}}for(q=0;q<d;q++){g[q].push(f[q])}return g};Utilities.groupObjByPosition= function(c,o,h,n){var g,d;var b,m;var l=[];var a="gTag";var k;var f;if(!c||!c[0].position||!o||h<=0||!n||Position.prototype[a]){throw new Exception("Utilities.groupObjByPosition: Invalid input objArray: "+c+" zoom: "+o+" radius: "+h+" tileSize: "+n)}b=c.length;for(g=0;g<b;g++){l[g]=c[g].position.clone();l[g][a]=c[g]}k=Utilities.grouper(l,o,h,n);f=[];b=k.length;for(g=0;g<b;g++){f[g]=[];m=k[g].length;for(d=0;d<m;d++){f[g][d]=k[g][d][a]}}return f};Utilities.getRequestId= function(){return Math.floor(Math.random()*10000000)};Utilities.getAbsoluteLeft= function(c){var b=c.offsetLeft;var a=c.offsetParent;while(a!=null){b+=a.offsetLeft;a=a.offsetParent}return b};Utilities.getAbsoluteTop= function(c){var b=c.offsetTop;var a=c.offsetParent;while(a!=null){b+=a.offsetTop;a=a.offsetParent}return b};Utilities.unloadMap= function(a){a.removeAllPins();Utilities.purge(a.mapDiv)};Utilities.purge= function(g){var c=g.attributes,f,b,h;if(c){b=c.length;for(f=0;f<b;f+=1){h=c[f].name;if(typeof g[h]==="function"){g[h]=null}}}c=g.childNodes;if(c){b=c.length;for(f=0;f<b;f+=1){Utilities.purge(g.childNodes[f])}}};Utilities.what= function(c){var b="";for(var a in c){b+="  "+a}alert(b)};Utilities.normalizePrefixes= function(k){var f=new RegExp("ns1:","g");var j=k.replace(f,"xls:");var d=new RegExp("ns\\d+:","g");var h=j.replace(d,"gml:");var b=new RegExp('\\sxmlns:ns\\d+="http://www.opengis.net/gml"',"g");var g=h.replace(b,"");var a=new RegExp('xmlns:ns1="http://www.opengis.net/xls"',"g");var c=g.replace(a,'xmlns:xls="http://www.opengis.net/xls" xmlns:gml="http://www.opengis.net/gml"');return c};Utilities.centerContextToBoundingBox= function(h,g){var a=g/111.111;var f=g/111.111/Math.cos(((h.lat*Math.PI)/180));var j=(h.lon-parseFloat(f));var k=(h.lon+parseFloat(f));var b=a;var c=(h.lat-parseFloat(b));var d=(h.lat+parseFloat(b));return new BoundingBox(new Position(c,j),new Position(d,k))};Utilities.centerContextToBoundingBoxViewable= function(j,b,a){var d=b/111.111;var c=a/111.111;var k=(j.lon-parseFloat(d));var l=(j.lon+parseFloat(d));var h=c*Math.cos(((j.lat*Math.PI)/180));var f=(j.lat-parseFloat(h));var g=(j.lat+parseFloat(h));return new BoundingBox(new Position(f,k),new Position(g,l))};Utilities.latLonToPixels= function(c,f,d){var b=d*((f.lon-c.minPosition.lon)/(c.maxPosition.lon-c.minPosition.lon));var a=d*((c.maxPosition.lat-f.lat)/(c.maxPosition.lat-c.minPosition.lat));return new PixelPoint(Math.round(b),Math.round(a))};Utilities.formatRadiusToString= function(a){if(typeof a=="number"||typeof a!="string"){a=a.toString()}return a.replace(new RegExp(","),".")};Utilities.pixelsToLatLon= function(n,m,j,f,a,b,p,k){try{n=j-n;m=f-m;var o=p.getLat();var h=p.getLon();var g=(k*2)/111.111;var c=g/(a*b);var d=(g/Math.cos(((o*Math.PI)/180)))/(a*b);if(m!=0){o=""+(parseFloat(o)+parseFloat(m*c))}if(n!=0){h=""+(parseFloat(h)-parseFloat(n*d))}return new Position(o,h)}catch(l){throw new Exception(l.message)}};Utilities.positionsToBoundingBoxLonSpanIndexes= function(f){if(!f||f.length<2){throw new Exception("Utilities.positionsToBoundingBox requires at least two positions")}var o=[];o=f.slice(0);d(o);var b=o.length;var a=360;var h=0;var l=b-1;for(var c=0;c<b;c++){l=(b+(c-1)%b)%b;var k=m(o[c].lon,o[l].lon);if(k<a){a=k;h=c}}l=(b+(h-1)%b)%b;var n,g;for(i=0;i<f.length;i++){if(f[i]==o[h]){n=i;break}}for(i=0;i<f.length;i++){if(f[i]==o[l]){g=i;break}}return[n,g];function m(p,j){if(p<j){return j-p}else{return j+360-p}}function d(p){var r=Math.floor((p.length-1-1)/2);for(;r>=0;r--){j(r,p.length-1)}for(r=p.length-1;r>0;r--){var q=p[0];p[0]=p[r];p[r]=q;j(0,r-1)}function j(y,s){var u=y;var w=y*2+1;var t;while(w<=s){if(w<s&&p[w].lon<p[w+1].lon){w=w+1}if(p[u].lon>p[w].lon){break}else{t=p[u];p[u]=p[w];p[w]=t;u=w;w=u*2+1}}}}};Utilities.positionsToBoundingBox= function(b){if(!b||b.length<1){throw new Exception("Utilities.positionsToBoundingBox requires at least one position")}if(b.length==1){return new BoundingBox(b[0],b[0])}var f=Utilities.positionsToBoundingBoxLonSpanIndexes(b);var a=b[f[0]].lon;var h=b[f[1]].lon;var g=90;var d=-90;for(var c=0;c<b.length;c++){if(b[c].lat<g){g=b[c].lat}if(b[c].lat>d){d=b[c].lat}}return new BoundingBox(new Position(g,a),new Position(d,h))};Utilities.pinsToBoundingBox= function(g,d){if(!d){throw new Exception("Utilities.pinsToBoundingBox requires a scale argument")}if(!g||g.length<2){throw new Exception("Utilities.pinsToBoundingBox requires at least two pins")}var n=[];for(var k=0;k<g.length;k++){n[k]=g[k].getPosition()}var b=Utilities.positionsToBoundingBoxLonSpanIndexes(n);var a=g[b[0]].getViewableBoundingBox(d);var l=a.minPosition.lon;var h=g[b[1]].getViewableBoundingBox(d);var m=h.maxPosition.lon;var f=90;var j=-90;for(k=0;k<g.length;k++){var c=g[k].getViewableBoundingBox(d);if(c.minPosition.lat<f){f=c.minPosition.lat}if(c.maxPosition.lat>j){j=c.maxPosition.lat}}return new BoundingBox(new Position(f,l),new Position(j,m))};Utilities.pixYDist= function(j,g,c,d){if(!d){d=GLOBALS.DEFAULT_MAP_TILE_SIZE}var b=c.getGXConvertedZoomLevel();var a=Utilities.radsPerPixelAtZoom(d,b);var h=Math.round(Utilities.lat2pix(j,a));var f=Math.round(Utilities.lat2pix(g,a));return Math.abs(h-f)};Utilities.pixXDist= function(g,d,c,f){if(!f){f=GLOBALS.DEFAULT_MAP_TILE_SIZE}var b=c.getGXConvertedZoomLevel();var a=Utilities.radsPerPixelAtZoom(f,b);var j=Math.round(Utilities.lon2pix(g,a));var h=Math.round(Utilities.lon2pix(d,a));return Math.abs(j-h)};Utilities.lat2pix= function(d,g){var f=(parseFloat(d)*(2*Math.PI))/360;var b=0.08181919084262157;var a=Math.sin(f);var h=b*a;var c=Math.log(((1+a)/(1-a))*Math.pow((1-h)/(1+h),b))/2;return(c/g)};Utilities.lon2pix= function(b,a){return((b/180)*Math.PI)/a};Utilities.radsPerPixelAtZoom= function(b,a){return 2*Math.PI/(b<<a)};Utilities.radsPerPixelAtZoomLevel= function(b,c){var a=Math.abs(21-c);return 2*Math.PI/(b<<a)};Utilities.deCartaToGXZoomLevel= function(b){var a=Math.abs(21-parseInt(b,10));return a};Utilities.pix2lon= function(a,b){return(a*b)*180/Math.PI};Utilities.pix2lat= function(j,g){var h=1e-7;var f=12;var b=Math.pow(Math.E,-j*g);var d=Utilities.mercatorUnproject(b);var a=Utilities.findRadPhi(d,b);var c=0;while(c<f&&Math.abs(d-a)>h){d=a;a=Utilities.findRadPhi(d,b);c++}return a*180/Math.PI};Utilities.mercatorUnproject= function(a){return(Math.PI/2)-2*Math.atan(a)};Utilities.findRadPhi= function(c,b){var a=0.08181919084262157;var d=a*Math.sin(c);return(Math.PI/2)-(2*Math.atan(b*Math.pow((1-d)/(1+d),a/2)))};Utilities.generalizationFactor= function(f,d){if(!f||!d||!f.minPosition){throw new Exception("Utilities.generalizationFactor: bad input.bbox: "+f+"zoomLevel: "+d)}var c=[0.14916746,0.298780196,0.597003797,1.19445287,2.388571783,4.777143566,9.554287132,19.10857426,38.21725985,76.43440838,152.8688168,305.7376335,611.475267,1222.950534,2445.901068,4891.802136,9783.604272,19567.20854,39134.41709,78268.83418,156537.6684,313075.3367];var b=f.minPosition.lat*Math.PI/180;var a=c[d-1];return(a*Math.cos(b))};Utilities.setUnselectable= function(a){if(a){if(typeof a.onselectstart!="undefined"){a.onselectstart= function(c){c=c||event;var b=c.target||c.srcElement;if(b=="[object Text]"&&b.parentNode){b=b.parentNode}if(!deCarta.IdManager.checkTag(b,"txtSelectable")){return false}else{return true}}}else{if(typeof a.style.MozUserSelect!="undefined"){a.style.MozUserSelect="-moz-none"}else{}}}};Utilities.setSelectable= function(a){if(a){if(typeof a.onselectstart!="undefined"){deCarta.IdManager.setTag(a,"txtSelectable")}else{if(typeof a.style.MozUserSelect!="undefined"){a.style.MozUserSelect="text"}else{}}}};Utilities.vrToPositions= function(d){if(!d){throw new Exception("vrToPositions: illegal argument: "+d)}var h=d.replace(/%[Vv][Rr]=/,"").split(",");var k=h[0]-1;var a=g(h[1]);var f=g(h[2]);var b=h.slice(3);var l=[];l.push(new Position(a,f));var c;for(c=0;c<k;c++){a+=g(b[0]);f+=g(b[1]);b=b.slice(2);var j=new Position(a,f);l.push(j)}return l;function g(r){var o;var m="";if(r.toString().charAt(0)=="-"){m="-";r=r.slice(1)}r=r.toString();var q=r.length;var p;if(q<=5&&q>0){p=["0","0","0","0","0"];var n=5;for(o=1;o<=q;o++){p[n-o]=r.charAt(q-o)}return(parseFloat(parseFloat(m+"0."+p.join("")).toFixed(5)))}else{if(q>5){p=[];for(o=0;o<q;o++){p.push(r.charAt(o));if(q-o-1==5){p.push(".")}}return(parseFloat(parseFloat(m+p.join("")).toFixed(5)))}else{throw new Exception("vrToPositions failed in vrOffsetToFloat with "+r)}}}};Utilities.vr7ToPositions= function(d){if(!d){throw new Exception("vr7ToPositions: illegal argument: "+d)}var g=d.replace(/%[Vv][Rr]7=/,"").split(",");var k=g[0]-1;var a=h(g[1]);var f=h(g[2]);var b=g.slice(3);var l=[];l.push(new Position(a,f));var c;for(c=0;c<k;c++){a+=h(b[0]);f+=h(b[1]);b=b.slice(2);var j=new Position(a,f);l.push(j)}return l;function h(r){var o;var m="";if(r.toString().charAt(0)=="-"){m="-";r=r.slice(1)}r=r.toString();var q=r.length;var p;if(q<=7&&q>0){p=["0","0","0","0","0","0","0"];var n=7;for(o=1;o<=q;o++){p[n-o]=r.charAt(q-o)}return parseFloat(parseFloat(m+"0."+p.join("")).toFixed(7))}else{if(q>7){p=[];for(o=0;o<q;o++){p.push(r.charAt(o));if(q-o-1==7){p.push(".")}}return parseFloat(parseFloat(m+p.join("")).toFixed(7))}else{throw new Exception("vrToPositions failed in vrOffsetToFloat with "+r)}}}};Utilities.positionsToVr= function(f){if(!f&&!f.length){throw new Exception("positionsToVr: cannot create empty VR string.")}var d;var c=f.length;var g=[];g.push("%VR="+c);g.push(k(f[0].lat));g.push(k(f[0].lon));var j=f[0].lat;var a=f[0].lon;for(d=1;d<c;d++){var b=f[d].lat-j;g.push(k(b));j+=b;var h=f[d].lon-a;g.push(k(h));a+=h}return g.join(",");function k(m){var l=parseFloat(parseFloat(m).toFixed(5).toString().replace(/\./,""));return l}};Utilities.positionsToVr7= function(g){if(!g&&!g.length){throw new Exception("positionsToVr7: cannot create empty VR string.")}var f;var d=g.length;var h=[];h.push("%VR7="+d);h.push(b(g[0].lat));h.push(b(g[0].lon));var k=g[0].lat;var a=g[0].lon;for(f=1;f<d;f++){var c=g[f].lat-k;h.push(b(c));k+=c;var j=g[f].lon-a;h.push(b(j));a+=j}return h.join(",");function b(m){var l=parseFloat(parseFloat(m).toFixed(7).toString().replace(/\./,""));return l}};Utilities.positions2Distance= function(g,f){var h=g.lat*Math.PI/180;var c=f.lat*Math.PI/180;var b=g.lon*Math.PI/180;var k=f.lon*Math.PI/180;var a=6366.191;var j=a*Math.acos(Math.cos(h)*Math.cos(c)*Math.cos(b-k)+Math.sin(h)*Math.sin(c));return new Radius(j,new UOM("KM"))};Utilities.positionsAngle= function(h,f,k){if(!k){k=256}var d=Utilities.radsPerPixelAtZoom(k,21);var b=Utilities.lon2pix(h.lon,d);var j=Utilities.lat2pix(h.lat,d);var a=Utilities.lon2pix(f.lon,d);var g=Utilities.lat2pix(f.lat,d);var c=Math.atan2(g-j,a-b)*180/Math.PI;return c};Utilities.setOpacity= function(d,c){var b=(c/100);var a=d.style;a.opacity=b;a.MozOpacity=(c/100);a.KhtmlOpacity=(c/100);a.filter="alpha(opacity="+c+")";return true};Utilities.extend= function(c,b){for(var a in b){if(typeof c[a]=="Array"||typeof c[a]=="Object"){c[a]=Utilities.extend(c[a],b[a])}c[a]=b[a]}return c};Utilities.fade= function(d,k){var b={from:100,to:0,duration:500,fps:10};b=Utilities.extend(b,k);var f=b.from;Utilities.setOpacity(d,f);var a=1000/b.fps;var g=Math.floor(b.duration/a);var j=(b.to-b.from)/g;var c=0;function h(m,l,n){n++;if(g==n){Utilities.setOpacity(m,b.to);if(typeof b.onComplete==="function"){b.onComplete(m)}}else{l+=j;Utilities.setOpacity(m,l);setTimeout(function(){h(m,l,n)},a)}}h(d,f,c)};Utilities.setStyle= function(a,b){var d=a.style;d.display="none";for(var c in b){if(c=="opacity"){a.setOpacity(b[c])}else{d[(c=="float"||c=="cssFloat")?(Object.isUndefined(d.styleFloat)?"cssFloat":"styleFloat"):c]=b[c]}}d.display="block";return a};Utilities.scope= function(c,b){var d=Array.prototype.slice;function h(m,j){var l=m.length,k=j.length;while(k--){m[l+k]=j[k]}return m}function g(k,j){k=d.call(k,0);return h(k,j)}if(arguments.length<2&&(typeof arguments[0]==="Undefined")){return c}var f=c;var a=d.call(arguments,1);return function(){var j=g(a,arguments);return f.apply(b,j)}};Utilities.urlParse= function(f){var a={};var d=f.split("#");f=d[0];if(d[1]){a.hash=d[1]}d=f.split("?");a.baseUrl=d[0];a.queryParameters={};if(d.length===1){return a}var b=d[1].split("&");var h={};for(var c=0;c<b.length;c++){var g=b[c].split("=");h[g[0]]=g[1]}a.queryParameters=h;return a};Utilities.urlCompose= function(a){var f=a.baseUrl+"?";var d=true;var c=a.queryParameters;for(var b in c){if(!d){f+="&"}else{d=false}f+=b+"="+c[b]}return f};Utilities.removeElementToReinsert= function(b){var a=b.parentNode;var c=b.nextSibling;a.removeChild(b);return function(){if(c){a.insertBefore(b,c)}else{a.appendChild(b)}}};Utilities.geolocateConvertPosition= function(a){a=a.coords||a;var b=new Position(a.latitude+" "+a.longitude);return b};Utilities.geolocate= function(a,b){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(a,b)}else{if(window.google&&google.gears){var c=google.gears.factory.create("beta.geolocation");if((c)&&(c.getPermission())){c.getCurrentPosition(a,b)}}}};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c,a,b){if(!b){b=1000/60}window.setTimeout(c,b)}})();deCarta.Easing= function(f){var a=Math.PI*2,g=Math.PI/2;var l=Math.abs,d=Math.pow,h=Math.sin,c=Math.asin,j=Math.cos;var k=1.70158;var b={linear:function(n,m,p,o){return p*n/o+m},backin:function(n,m,p,o){return p*(n/=o)*n*((k+1)*n-k)+m},backout:function(n,m,p,o){return p*((n=n/o-1)*n*((k+1)*n+k)+1)+m},backinout:function(n,m,p,o){return((n/=o/2)<1)?p/2*(n*n*(((k*=(1.525))+1)*n-k))+m:p/2*((n-=2)*n*(((k*=(1.525))+1)*n+k)+2)+m},bouncein:function(n,m,p,o){return p-b.bounceout(o-n,0,p,o)+m},bounceout:function(n,m,p,o){if((n/=o)<(1/2.75)){return p*(7.5625*n*n)+m}else{if(n<(2/2.75)){return p*(7.5625*(n-=(1.5/2.75))*n+0.75)+m}else{if(n<(2.5/2.75)){return p*(7.5625*(n-=(2.25/2.75))*n+0.9375)+m}else{return p*(7.5625*(n-=(2.625/2.75))*n+0.984375)+m}}}},bounceinout:function(n,m,p,o){if(n<o/2){return b.bouncein(n*2,0,p,o)/2+m}else{return b.bounceout(n*2-o,0,p,o)/2+p/2+m}},cubicin:function(n,m,p,o){return p*(n/=o)*n*n+m},cubicout:function(n,m,p,o){return p*((n=n/o-1)*n*n+1)+m},cubicinout:function(n,m,p,o){if((n/=o/2)<1){return p/2*n*n*n+m}return p/2*((n-=2)*n*n+2)+m},elasticin:function(o,m,w,u,n,r){var q;if(o==0){return m}if((o/=u)==1){return m+w}if(!r){r=u*0.3}if(!n||n<l(w)){n=w;q=r/4}else{q=r/a*c(w/n)}return -(n*d(2,10*(o-=1))*h((o*u-q)*a/r))+m},elasticout:function(o,m,w,u,n,r){var q;if(o==0){return m}if((o/=u)==1){return m+w}if(!r){r=u*0.3}if(!n||n<l(w)){n=w;q=r/4}else{q=r/a*c(w/n)}return(n*d(2,-10*o)*h((o*u-q)*a/r)+w+m)},elasticinout:function(o,m,w,u,n,r){var q;if(o==0){return m}if((o/=u/2)==2){return m+w}if(!r){r=u*(0.3*1.5)}if(!n||n<l(w)){n=w;q=r/4}else{q=r/a*c(w/n)}if(o<1){return -0.5*(n*d(2,10*(o-=1))*h((o*u-q)*a/r))+m}return n*d(2,-10*(o-=1))*h((o*u-q)*a/r)*0.5+w+m},quadin:function(n,m,p,o){return p*(n/=o)*n+m},quadout:function(n,m,p,o){return -p*(n/=o)*(n-2)+m},quadinout:function(n,m,p,o){if((n/=o/2)<1){return p/2*n*n+m}return -p/2*((--n)*(n-2)-1)+m},sinein:function(n,m,p,o){return -p*j(n/o*g)+p+m},sineout:function(n,m,p,o){return p*h(n/o*g)+m},sineinout:function(n,m,p,o){return -p/2*(j(Math.PI*n/o)-1)+m}};return(b[f])?b[f]:b.linear};function WSXMLTunnel(){var a=this;this.responseFormat="XML";var b=[];this.send= function(c,f){if(!deCarta.String.isString(c)){if(!window.Sarissa&&!window.Sarissa.serialize){throw new Exception("Sarissa is required to use the WSXMLTunnel with XMLDocument Objects.")}c=Sarissa.serialize(c)}var d=Utilities.parseRequestIDFromXLS(c);if(typeof f=="function"){b[d]=f}else{throw new Exception("WSXMLTunnel.send: callBack must be a function, arg was: "+f)}JSRequest.send(c,this._callBack,this.responseFormat)};this._callBack= function(c){var d,f;if(a.responseFormat=="XML"){d=Sarissa.getDomDocument();d=(new DOMParser()).parseFromString(Utilities.normalizePrefixes(c),"text/xml");d.setProperty("SelectionLanguage","XPath");d.setProperty("SelectionNamespaces","xmlns:xls='http://www.opengis.net/xls' xmlns:gml='http://www.opengis.net/gml'");f=(d.selectSingleNode("//xls:Response/@requestID").value)}else{d=c;if(deCarta.Array.isArray(d.XLS.Response)){f=d.XLS.Response[0].requestID}else{f=d.XLS.Response.requestID}}b[f](d)}}deCarta.XMLStringBuilder= function(){this.overlays=[];this.routeIDOverlay=null;this.rendering="server";this.routeID=null;this.clientName=Credentials.clientName;this.clientPassword=Credentials.clientPassword;this.configuration=Credentials.configuration;this.transparentConfiguration=Credentials.transparentConfiguration;this.mapType=GLOBALS.STREET;this.streetImgFormat="PNG";this.hybridImgFormat="PNG"};deCarta.XMLStringBuilder.prototype.getRequestHeader= function(a,b){a=a||Utilities.getRequestId();var c="<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls'";if(Credentials.rel){c+=" rel='"+Credentials.rel+"' "}c+="xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='"+this.clientName+"' sessionID='"+a+"' clientAPI='desktopjs' clientPassword='"+this.clientPassword+"' configuration='";if(this.mapType=="STREET"){c+=this.configuration+"'"}else{c+=this.transparentConfiguration+"'"}if(b){c+=" defaultUOM='"+b+"' "}c+="/>";return c};deCarta.XMLStringBuilder.prototype.getRequestOpen= function(a,c,b){b=b||"10";c=c||Utilities.getRequestId();var d="<xls:Request maximumResponses='"+b+"' version='1.0' requestID='"+c+"' methodName='"+a+"'>";return d};deCarta.XMLStringBuilder.prototype.getHeader= function(a,c,b,d,f){var g=this.getRequestHeader(d,f);g+=this.getRequestOpen(a,c,b);return g};deCarta.XMLStringBuilder.prototype.getFooter= function(){return"</xls:Request></xls:XLS>"};deCarta.XMLStringBuilder.prototype.createRUOKRequest= function(b){var a=this.getHeader("RuokRequest",b,25,Utilities.getRequestId());a+="<xls:RUOKRequest />"+this.getFooter();return a};deCarta.XMLStringBuilder.prototype.createMapRequest= function(g,k,b,j,c,h,d){var a=this.overlaysToXLSString();if(!a[1]&&!Credentials.trafficEnabled){d=GLOBALS.TILE_SESSION_ID}var f=this.getHeader("PortrayMapRequest",b,null,d);f+="<xls:PortrayMapRequest><xls:Output height='"+k+"' width='"+k+"' ";f+="format='"+(this.mapType=="STREET"?this.streetImgFormat:this.hybridImgFormat)+"' fixedgrid='true' useCache='true'><xls:CenterContext SRS='WGS-84'><xls:CenterPoint><gml:pos>"+g.toString()+"</gml:pos></xls:CenterPoint><xls:Radius unit='KM'>4</xls:Radius></xls:CenterContext><xls:TileGrid rows='1' columns='1'><xls:GridLayer name='deCarta'/><xls:GridLayer name='globexplorer' meta-inf='zoom=";if(!c){f+=Utilities.deCartaToGXZoomLevel(j)}else{f+=Utilities.deCartaToGXZoomLevel(c)+":"+Utilities.deCartaToGXZoomLevel(j)}f+="'/></xls:TileGrid></xls:Output>"+a[0];if(Credentials.trafficEnabled){if(h){f+="<xls:Overlay><xls:Traffic><xls:FlowReporting/></xls:Traffic></xls:Overlay>"}else{f+="<xls:Overlay><xls:Traffic><xls:FlowReporting"+(h?" time='"+h+"'":"")+"/></xls:Traffic></xls:Overlay>"}}f+="</xls:PortrayMapRequest>";f+=this.getFooter();return f};deCarta.XMLStringBuilder.prototype.createGeocodeRequest= function(b,g,f,a){var c=this.getHeader("GeocodeRequest",g);c+="<xls:GeocodeRequest";if(f){c+=" returnFreeForm='true'>"}else{c+=" returnFreeForm='false'>"}if(a){c+='<xls:Point xmlns:xls="http://www.opengis.net/gml"><xls:pos>'+a.getLat()+" "+a.getLon()+"</xls:pos></xls:Point>"}c+="<xls:Address countryCode='"+b.getLocale().getCountry()+"'";c+=" language='"+b.getLocale().getLanguage()+"'>";if(b.type=="FreeForm"){c+="<xls:freeFormAddress>"+b.toString()+"</xls:freeFormAddress>"}else{var d="";var h="";if(!(b.buildingNumber&&b.street)&&(b.streetNameAndNumber)){c+="<xls:StreetNameAndNumber>"+b.streetNameAndNumber+"</xls:StreetNameAndNumber>"}else{if(b.buildingNumber||b.buildingNumber==0){d="<xls:Building number='"+b.buildingNumber+"'/>"}if(b.street){h="<xls:Street>"+b.street+"</xls:Street>"}if(b.street){c+="<xls:StreetAddress>"+d+h+"</xls:StreetAddress>"}}if(b.countrySubdivision){c+="<xls:Place type='CountrySubdivision'>"+b.countrySubdivision+"</xls:Place>"}if(b.countrySecondarySubdivision){c+="<xls:Place type='CountrySecondarySubdivision'>"+b.countrySecondarySubdivision+"</xls:Place>"}if(b.countryTertiarySubdivision){c+="<xls:Place type='CountryTertiarySubdivision'>"+b.countryTertiarySubdivision+"</xls:Place>"}if(b.municipality){c+="<xls:Place type='Municipality'>"+b.municipality+"</xls:Place>"}if(b.municipalitySubdivision){c+="<xls:Place type='MunicipalitySubdivision'>"+b.municipalitySubdivision+"</xls:Place>"}if(b.postalCode){c+="<xls:PostalCode>"+b.postalCode+"</xls:PostalCode>"}}c+="</xls:Address></xls:GeocodeRequest>";c+=this.getFooter();return c};deCarta.XMLStringBuilder.prototype.createReverseGeocodeRequest= function(c,b){var a=this.getHeader("ReverseGeocodeRequest",b);a+="<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+c.toString()+"</gml:pos></gml:Point></xls:Position>";a+="<xls:ReverseGeocodePreference>StreetAddress</xls:ReverseGeocodePreference>";a+="</xls:ReverseGeocodeRequest>";a+=this.getFooter();return a};deCarta.XMLStringBuilder.prototype.createPOIRequest= function(c,f){var d=deCarta.Array.isArray(c);var b;var a="";if(d){a+=this.getRequestHeader(null,c.defaultUOM);for(b=0;b<c.length;b++){a+=this.getRequestOpen("DirectoryRequest",f,c[b].maximumResponses);a+=this.getDirectoryRequest(c[b]);a+="</xls:Request>"}a+="</xls:XLS>"}else{a+=this.getHeader("DirectoryRequest",f,c.maximumResponses,null,c.defaultUOM);a+=this.getDirectoryRequest(c);a+=this.getFooter()}return a};deCarta.XMLStringBuilder.prototype.createFullDetailsPOIRequest= function(c,b){var a=this.getHeader("DirectoryRequest",b,10);a+='<xls:DirectoryRequest paging="current"><xls:POI ID="'+c+'"/></xls:DirectoryRequest>';a+=this.getFooter();return a};deCarta.XMLStringBuilder.prototype.getDirectoryRequest= function(d){var c="";c+="<xls:DirectoryRequest";if(d.database!=null){c+=" database='"+d.database+"'"}if(d.sortDirection){c+=" sortDirection='"+d.sortDirection+"'"}if(d.sortCriteria){c+=" sortCriteria='"+d.sortCriteria+"'"}if(d.rankCriteria){c+=" rankCriteria='"+d.rankCriteria+"'"}if(d.allowAggregates){c+=" allowAggregates='true'"}c+=">";if(d.routeId){c+="<xls:POILocation><xls:NearRoute>";if(d.type==="distance"){c+="<xls:distance value='"+d.distance+"' uom='M'/>"}else{if(d.type==="euclideanDistance"){c+="<xls:euclideanDistance value='"+d.distance+"' uom='M'/>"}else{c+="<xls:drivetime>P0DT"+Math.floor(d.duration/60)+"H"+(d.duration%60)+"M0S</xls:drivetime>"}}c+="<xls:RouteID>"+d.routeId+"</xls:RouteID>";c+="</xls:NearRoute></xls:POILocation>"}else{c+="<xls:POILocation><xls:WithinDistance>";c+="<xls:POI ID='1'><gml:Point><gml:pos>"+d.position.toString()+"</gml:pos></gml:Point></xls:POI>";c+="<xls:MinimumDistance value='0' uom='KM'/><xls:MaximumDistance value='"+d.radius.distance+"' uom='"+d.radius.uom.value+"'/>";c+="</xls:WithinDistance></xls:POILocation>"}c+="<xls:POIProperties>";if(!d.retrieveAll){var b=false;for(var a in d.properties){if(d.properties.hasOwnProperty(a)){b=true;c+="<xls:POIProperty value='"+d.properties[a]+"' name='"+a+"'/>"}}if(!b){c+="<xls:POIProperty value='"+d.queryString+"' name='Keyword'/>"}}c+="</xls:POIProperties></xls:DirectoryRequest>";return c};deCarta.XMLStringBuilder.prototype.createRouteGeometryRequest= function(a,g,f){var b=this.getHeader("DetermineRouteRequest",g);b+="<xls:DetermineRouteRequest distanceUnit='"+f.uom+"' routeQueryType='"+f.routeQueryType+"' provideRouteHandle='true'";if(f.alternateRoutes){b+=" numAltRoutes='"+f.alternateRoutes+"'"}b+=">";b+="<xls:RoutePlan";if(Credentials.trafficEnabled){b+=" useRealTimeTraffic='true'"}if(f.optimized){b+=" optimize='true'"}if(f.expectedStartTime){b+=" expectedStartTime='"+f.expectedStartTime+"'"}if(f.useExclusionZone==true){b+=" useExclusionZone='true'"}b+=">";b+="<xls:RoutePreference>"+f.routePreference+"</xls:RoutePreference>";b+="<xls:WayPointList>";for(var d=0;d<a.length;d++){if(d==0){b+="<xls:StartPoint><xls:Position><gml:Point><gml:pos>"+a[d].toString()+"</gml:pos></gml:Point></xls:Position></xls:StartPoint>"}else{if(d>0&&d<(a.length-1)){b+="<xls:ViaPoint><xls:Position><gml:Point><gml:pos>"+a[d].toString()+"</gml:pos></gml:Point></xls:Position></xls:ViaPoint>"}else{if(d==(a.length-1)){b+="<xls:EndPoint><xls:Position><gml:Point><gml:pos>"+a[d].toString()+"</gml:pos></gml:Point></xls:Position></xls:EndPoint>"}}}}b+="</xls:WayPointList>";if(f.vehicleType){b+="<xls:TypeOfVehicle>"+f.vehicleType+"</xls:TypeOfVehicle>"}if(f.avoidList.length>0||f.avoidAreas.length>0){b+="<xls:AvoidList>";for(d=0;d<f.avoidAreas.length;d++){b+=this.avoidAreasToXLSString(f.avoidAreas[d])}for(d=0;d<f.avoidList.length;d++){b+="<xls:AvoidFeature>"+f.avoidList[d].toString()+"</xls:AvoidFeature>"}b+="</xls:AvoidList>"}var c=f.logisticsPreference;if(c&&(c.preferredRoute||c.hazmat||c.vehicleParameters||c.vehicleTypes||c.preferredTurn)){b+="<xls:Logistics>";if(c.preferredRoute){b+="<xls:PreferredRoute>"+c.preferredRoute+"</xls:PreferredRoute>"}if(c.hazmat){b+="<xls:Hazmat>"+c.hazmat+"</xls:Hazmat>"}if(c.vehicleParameters){b+="<xls:VehicleParameters>"+c.vehicleParameters+"</xls:VehicleParameters>"}if(c.vehicleTypes){b+="<xls:VehicleTypes>"+c.vehicleTypes+"</xls:VehicleTypes>"}if(c.preferredTurn){b+="<xls:PreferredTurn>"+c.preferredTurn+"</xls:PreferredTurn>"}b+="</xls:Logistics>"}b+="</xls:RoutePlan>";if(f.returnRouteInstructions){b+="<xls:RouteInstructionsRequest providePoint='true'";if(f.rules){b+=" rules='"+f.rules+"'"}b+="/>"}b+="<xls:RouteGeometryRequest returnRouteIDOnly=";if(f.returnRouteGeometry){b+="'false'"}else{b+="'true'"}if(f.generalizationFactor&&f.generalizationFactor!==0&&f.generalizationBBox){b+=" resolution ='"+f.generalizationFactor+"'>";b+="<xls:BoundingBox><gml:pos>"+f.generalizationBBox.minPosition+"</gml:pos><gml:pos>"+f.generalizationBBox.maxPosition+"</gml:pos></xls:BoundingBox></xls:RouteGeometryRequest>"}else{b+="/>"}if(f.maneuverMaps){b+='<xls:RouteMapRequest><xls:Output format="'+f.maneuverMapConfig.format+'" width="'+f.maneuverMapConfig.width+'" height="'+f.maneuverMapConfig.height+'" /></xls:RouteMapRequest>'}b+="</xls:DetermineRouteRequest>";b+=this.getFooter();return b};deCarta.XMLStringBuilder.prototype.createRouteGeometryByIdRequest= function(d,c,b){var a=this.getHeader("DetermineRouteRequest",c,null,b);a+="<xls:DetermineRouteRequest routeQueryType='RMAN'><xls:RouteHandle serviceID='DetermineRouteService' routeID='"+d+"'/><xls:RouteInstructionsRequest providePoint='true'/><xls:RouteGeometryRequest/>";a+="</xls:DetermineRouteRequest>";a+=this.getFooter();return a};deCarta.XMLStringBuilder.prototype.createTrafficIncidentRequest= function(b,c){var a=this.getHeader("TrafficRequest",c,b.maxiumResponses);a+="<xls:TrafficRequest><xls:IncidentReporting minimumSeverity='"+b.minimumSeverity+"'/>";a+="<xls:CenterContext SRS='WGS-84'><xls:CenterPoint><gml:pos>"+b.position+"</gml:pos></xls:CenterPoint>";a+="<xls:Radius unit='"+b.radius.uom.value+"'>"+b.radius.distance+"</xls:Radius></xls:CenterContext>";a+="</xls:TrafficRequest>";a+=this.getFooter();return a};deCarta.XMLStringBuilder.prototype.overlaysToXLSString= function(){var g=[];if(this.routeIDOverlay){g.push("<xls:Overlay><xls:RouteID>"+this.routeIDOverlay+"</xls:RouteID></xls:Overlay>")}for(var c=0;c<this.overlays.length;c++){if(this.overlays[c].rendering=="client"||(this.rendering!="server"&&this.overlays[c].rendering!="server")){continue}if(!this.overlays[c]||(this.overlays[c]&&!this.overlays[c].isVisible)){continue}var b="";var f=this.overlays[c];b+="<xls:Overlay>";if(f.type=="line"){b+="<xls:Shape color='"+f.fillColor+"_"+f.borderColor+"' style='"+f.borderStyle+"' width='"+f.width+"_"+f.borderWidth+"'";if(f.strokeOpacity){b+=" opacity='"+f.strokeOpacity+"'"}else{b+=" opacity='"+f.opacity+"'"}}else{b+="<xls:Shape type='"+f.type+"' color='"+f.fillColor+"_"+f.borderColor+"' style='"+f.borderStyle+"' width='"+f.borderWidth+"'";if(f.strokeOpacity||f.fillOpacity){var a=f.strokeOpacity||f.opacity;var d=f.fillOpacity||f.opacity;b+=" opacity='"+d+"_"+a+"'"}else{b+=" opacity='"+f.opacity+"'"}}if(f.type=="circle"){b+=" pointspec='LL' radius='"+f.radius.uomdds+f.radius.distance+"'>"+f.position.lat+","+f.position.lon}else{f.VR7=f.VR7||Utilities.LL2VR7(f.positions);if(f.type=="line"){b+=" pointspec='VR7'>"+f.VR7}else{b+=" pointspec='VR7PG'>"+f.VR7}}b+="</xls:Shape></xls:Overlay>";g.push(b)}var h=g.join("");return[h,(g.length>0)?true:false]};deCarta.XMLStringBuilder.prototype.avoidAreasToXLSString= function(b){var c;var a="<xls:AOI>";if(/Line/i.test(b.name)){a+="<gml:LineString>";for(c=0;c<b.pos.length;c++){a+="<gml:pos>"+b.pos[c]+"</gml:pos>"}a+="</gml:LineString>"}else{if(/Polygon/i.test(b.name)){a+="<gml:Polygon><gml:exterior><gml:LinearRing>";for(c=0;c<b.pos.length;c++){a+="<gml:pos>"+b.pos[c]+"</gml:pos>"}a+="</gml:LinearRing></gml:exterior></gml:Polygon>"}else{if(/Rectangle/i.test(b.name)){a+="<gml:Envelope>";a+="<gml:pos>"+b.pos[0]+"</gml:pos><gml:pos>"+b.pos[1]+"</gml:pos>";a+="</gml:Envelope>"}else{if(/Circle/i.test(b.name)){a+="<gml:CircleByCenterPoint numArc='1'>";a+="<gml:pos>"+b.pos[0]+"</gml:pos>";a+="<gml:radius uom='"+b.radius.uom+"'>"+b.radius.distance+"</gml:radius>";a+="</gml:CircleByCenterPoint>"}else{throw new Exception("deCarta.XMLStringBuilder.avoidAreasToXLSString: invalid type of avoid object: "+b.name)}}}}a+="</xls:AOI>";return a};function ZoomController(r,t,a,g,b,f,m){if(!m){m={}}this.opts={};this.setOpts= function(y){this.opts.xMargin=(y.xMargin)?y.xMargin:0;this.opts.yMargin=(y.yMargin)?y.yMargin:0};this.setOpts(m);this.selected=r||5;this.domView=true;this.zoomLevels=17;this.lowerBound=1;this.upperBound=17;this.color=t||"";this.uncheckedSrc=g||Credentials.zoomUnselectedIconPath;this.checkedSrc=a||Credentials.zoomSelectedIconPath;this.bottomCapSrc=f||Credentials.zoomOutIconPath;this.bottomCapSrc=Credentials.imgPath+"z2t_zoom_bottom_gray.png";this.topCapSrc=b||Credentials.zoomInIconPath;this.topCapSrc=Credentials.imgPath+"z2t_zoom_top_gray.png";this.pillarSrc=Credentials.imgPath+"z2t_zoom_rail_gray.png";this.sliderSrc=Credentials.imgPath+"z2t_zoom_selected_gray.png";this.zoomer=null;this.map=null;this.type="ZoomController";this.frame=null;var n=this;var d=null;var q=null;var w=null;var s=null;var l=false;var h=Utilities.ie;var j;var k;var o=true;this.setDomView= function(y){y=(y)?true:false;this.domView=y};this.initialize= function(){if(!this.domView){return false}d=document.createElement("IMG");d.id="decarta-ztop";d.src=this.topCapSrc;d.className="decarta-zoomTop";d.onclick= function(A){if(!GLOBALS.ALLOWDOMEVENTS){return true}A=A||event;A.stoppropagation?A.stoppropagation():A.cancelBubble=true;n.zoomInOneLevel();return true};deCarta.IdManager.setTag(d,"ignoreForMapEvents");w=document.createElement("DIV");w.style.backgroundImage="url("+this.pillarSrc+")";w.style.backgroundRepeat="repeat-y";w.style.backgroundPosition="center";w.id="decarta-zpillar";w.className="decarta-zoomPillar";w.onclick= function(C){if(!GLOBALS.ALLOWDOMEVENTS){return true}C=C||event;C.stoppropagation?C.stoppropagation():C.cancelBubble=true;var A=C.clientY-Utilities.getAbsoluteTop(w)+Utilities.getScrollTop();var B=parseInt(w.offsetHeight);var D=Math.round(A/B*(n.zoomLevels-1))+1;D+=(n.lowerBound-1);n.map.zoomMap(D);return true};deCarta.IdManager.setTag(w,"ignoreForMapEvents");s=document.createElement("IMG");s.src=this.sliderSrc;s.className="decarta-zoomSlider";s.id="decarta-zslider";deCarta.IdManager.setTag(s,"ignoreForMapEvents");s.onmousedown= function(A){if(!GLOBALS.ALLOWDOMEVENTS){return true}A=A?A:window.event;A.stoppropagation?A.stoppropagation():A.cancelBubble=true;if((!h&&A.which==3)||(h&&A.button==2)){return true}if((!h&&A.which==2)||(h&&A.button==4)){return true}l=true;s.style.cursor="move";document.body.onmousemove=p;document.body.onmouseup=u;return false};w.appendChild(s);q=document.createElement("IMG");q.src=this.bottomCapSrc;q.id="decarta-zbottom";q.className="decarta-zoomBottom";q.onclick= function(A){if(!GLOBALS.ALLOWDOMEVENTS){return true}A=A||event;A.stoppropagation?A.stoppropagation():A.cancelBubble=true;n.zoomOutOneLevel();return true};deCarta.IdManager.setTag(q,"ignoreForMapEvents");var z="decarta-zoom";var y=z;n.frame=document.createElement("DIV");n.frame.id=z;n.frame.className=y;n.frame.innerHTML="";if(n.color){n.frame.style.backgroundColor=n.color}deCarta.IdManager.setTag(n.frame,"ignoreForMapEvents");n.frame.appendChild(d);n.frame.appendChild(w);n.frame.appendChild(q);this.zoomer=this.frame;if(!o){this.frame.style.display="none"}c();return true};function u(z){document.body.onmousemove=null;document.body.onmouseup=null;l=false;s.style.cursor="default";z=z?z:window.event;z.stoppropagation?z.stoppropagation():z.cancelBubble=true;var y=z.clientY-Utilities.getAbsoluteTop(w)+Utilities.getScrollTop();var A=Math.round(y/w.offsetHeight*(n.zoomLevels-1))+1;A+=(n.lowerBound-1);if(A<1){A=1}if(A>17){A=17}n.map.zoomMap(A);return false}function p(B){B=B?B:window.event;if(!l){return false}var A=s.offsetHeight/2;var z=w.offsetHeight-s.offsetHeight/2;var y=B.clientY-Utilities.getAbsoluteTop(w)+Utilities.getScrollTop();if(y<=z&&y>=A){s.style.top=y-s.offsetHeight/2+"px"}return false}this.setZoomRange= function(y,z){if(y<1||z>21||y>z){throw new Exception("illegal values setZoomRange: "+y+", "+z)}if(n.selected>z){n.selected=z}if(n.selected<y){n.selected=y}n.lowerBound=y;n.upperBound=z;n.zoomLevels=z-y+1;c()};this.setZoomButtonImages= function(B,A,y,C){if(B){this.checkedSrc=B}if(A){this.uncheckedSrc=A}if(B||A){for(var z=0;z<_zoomButtons.length;z++){_zoomButtons[z].src=this.uncheckedSrc}if(n.selected){_zoomButtons[n.selected-1].src=this.checkedSrc}}if(y){this.topCapSrc=y;d.src=y}if(C){this.bottomCapSrc=C;q.src=C}};this.setColor= function(y){this.frame.style.backgroundColor=y};this.show= function(){o=true;if(this.frame){this.frame.style.display="block"}};this.hide= function(){o=false;if(this.frame){this.frame.style.display="none"}};this.getRadius= function(){return j};this.setRadius= function(B){k=B;var A=n.map.getGridSize().split(" ");var C=A[0];var z=A[1];if(C==z){j=B}else{j=(k/z)*C}};this.getRadiusX= function(){return k};this.setRadiusX= function(y){k=y};this.getMinViewableRadius= function(){var C=n.map.getGridSize().split(" ");var A=C[0]*GLOBALS.DEFAULT_MAP_TILE_SIZE;var B=C[1]*GLOBALS.DEFAULT_MAP_TILE_SIZE;var E=parseInt(n.map.mapDiv.style.width);var D=parseInt(n.map.mapDiv.style.height);var z=(E/B)*k;var y=(D/A)*j;return y<z?y:z};this.getMaxViewableRadius= function(){var C=n.map.getGridSize().split(" ");var A=C[0]*GLOBALS.DEFAULT_MAP_TILE_SIZE;var B=C[1]*GLOBALS.DEFAULT_MAP_TILE_SIZE;var E=parseInt(n.map.mapDiv.style.width);var D=parseInt(n.map.mapDiv.style.height);var z=(E/B)*k;var y=(D/A)*j;return y>z?y:z};this.getMaxRadius= function(){return k<j?j:k};this.getZoomLevel= function(){return n.selected};this.setZoomValue= function(y){this.setZoomLevel(y)};this.setZoomLevel= function(A){if(A&&A<n.lowerBound||A>n.upperBound){throw new Exception("Error calling setZoomLevel, out of range");return false}n.selected=A;if(s&&s.style){var y=parseInt(w.offsetHeight);var z=parseInt(s.offsetHeight);A=A-(n.lowerBound-1);s.style.top=(A-1/2)*y/n.zoomLevels-1/2*z+"px";w.removeChild(s);w.appendChild(s)}};this.getGXConvertedZoomLevel= function(){return Math.abs(21-n.selected)};this.zoomToNewLevel= function(y){if(y&&y<n.lowerBound||y>n.upperBound){throw new Exception("Error calling zoomToNewLevel, out of range");return false}n.map.zoomMap(y)};this.zoomInOneLevel= function(){if(n.selected<=n.lowerBound){return false}n.map.zoomMap(parseInt(n.selected)-1)};this.zoomOutOneLevel= function(){if(n.selected==n.upperBound){return false}n.map.zoomMap(parseInt(n.selected)+1)};this.getZoomLevelToFitBoundingBox= function(B){var F=parseInt(n.map.mapDiv.style.height)/2;var G=parseInt(n.map.mapDiv.style.width)/2;for(var D=20;D>0;--D){var A=Utilities.radsPerPixelAtZoom(this.map.getTileSize(),D);var I=Utilities.lat2pix(B.getCenterPosition().getLat(),A);var L=Utilities.lon2pix(B.getCenterPosition().getLon(),A);var C=Utilities.pix2lat(I+F,A);var K=Utilities.pix2lon(L+G,A);var z=Utilities.pix2lat(I-F,A);var H=Utilities.pix2lon(L-G,A);var y=new BoundingBox(new Position(z,H),new Position(C,K));if(y.contains(B.minPosition)&&y.contains(B.maxPosition)){var E=Math.abs(21-D);E=(E<n.lowerBound?n.lowerBound:E);return E;break}}};this.getZoomLevelToFitPositions= function(y){var z=Utilities.positionsToBoundingBox(y);return n.getZoomLevelToFitBoundingBox(z)};this.getZoomLevelToFitPins= function(B){var z=[];for(var A=0;A<B.length;A++){z[A]=B[A].position.clone()}var C=Utilities.positionsToBoundingBox(z);var D=n.getZoomLevelToFitBoundingBox(C);var y=Utilities.radsPerPixelAtZoom(n.map.getTileSize(),Math.abs(21-D));C=Utilities.pinsToBoundingBox(B,y);return n.getZoomLevelToFitBoundingBox(C)};this.getClosestValidLevel= function(y){if(y<this.lowerBound){return this.lowerBound}if(y>this.upperBound){return this.upperBound}return y};this.appendThis= function(){if(!this.frame){this.initialize()}var y=this.frame||null;return y};this.removeThis= function(){this.map=null;return this.frame};this.position= function(y){if(!this.map){return}if(this.frame){switch(this.opts.screenPosition){default:if(this.map.getPanController()){this.frame.style.top=61+this.opts.yMargin+"px";this.frame.style.left=21+this.opts.xMargin+"px"}else{this.frame.style.top="10px";this.frame.style.left="10px"}break;case"topRight":throw ("Not Implemented");break}this.setZoomLevel(n.selected)}};function c(){if(n.frame){w.style.height=(n.zoomLevels*10)+"px";q.style.top=((n.zoomLevels*10)+20)+"px"}}}AutoPing= function(){};AlertObj= function(){this.iccid;this.name="Unkown address.";this.pos;this.speed;this.limitSpeed;this.time};AutoPing.callback=null;AutoPing.timeloop=5000;AutoPing.hasNewMsg=false;AutoPing.alertObj=new AlertObj();AutoPing.repingCallBackMod= function(){document.getElementById("speedAlertDiv").style.display="none";document.getElementById("violationDiv").style.display="none";document.getElementById("mail").style.display="none";var b=Message.createPingDOM();var c=new WSXMLTunnelFCS();c.responseFormat="JSON";try{JSRequest.timeoutHandler(AutoPing.timeoutCallback,AutoPing.timeloop);c.send(b,AutoPing.callback,JSRequest.getHostTimeout,CONFIG.fcsUrl)}catch(a){alert(a.message)}setTimeout(AutoPing.repingCallBackMod,AutoPing.timeloop)};AutoPing.reping= function(){document.getElementById("speedAlertDiv").style.display="none";document.getElementById("violationDiv").style.display="none";document.getElementById("mail").style.display="none";var b=Message.createPingDOM();var c=new WSXMLTunnelFCS();c.responseFormat="JSON";try{JSRequest.timeoutHandler(AutoPing.timeoutCallback,AutoPing.timeloop);c.send(b,AutoPing.pingCallBack,JSRequest.getHostTimeout,CONFIG.fcsUrl)}catch(a){alert(a.message)}setTimeout(AutoPing.reping,AutoPing.timeloop)};AutoPing.pingCallBack= function(a){window.status="FCS Gateway Connected.";if(a.XLS.Response.MsgResponse!=null&&a.XLS.Response.MsgResponse.Alert!=null){AutoPing.doAlert(a.XLS.Response.MsgResponse)}else{if(a.XLS.Response.MsgResponse!=null&&a.XLS.Response.MsgResponse.Violation!=null){AutoPing.doViolation(a.XLS.Response.MsgResponse)}else{if(a.XLS.Response.MsgResponse!=null){AutoPing.hasNewMsg=true}else{AutoPing.hasNewMsg=false}}}if(AutoPing.hasNewMsg){document.getElementById("mail").style.display="block"}else{document.getElementById("mail").style.display="none"}};AutoPing.doAlert= function(a){if(a.Receipt!=null){packetId=a.Receipt.packetId;sequenceId=a.Receipt.sequenceId;AutoPing.sendReceipt(packetId,sequenceId)}AutoPing.alertObj.iccid=a.iccid;AutoPing.alertObj.speed=a.Alert.Speed;AutoPing.alertObj.limitSpeed=a.Alert.Limit;AutoPing.alertObj.time=getLocalTimeStr(a.Message.Time);var b=a.Alert.Pos.Lat;var d=a.Alert.Pos.Lon;b=b/10000000;d=~d+1;d=-d/10000000;AutoPing.alertObj.pos=new Position(b+" "+d);var c=new Geocoder();c.reverseGeocode(AutoPing.alertObj.pos,AutoPing.rgCallback)};AutoPing.doViolation= function(a){if(a.Receipt!=null){packetId=a.Receipt.packetId;sequenceId=a.Receipt.sequenceId;AutoPing.sendReceipt(packetId,sequenceId)}AutoPing.alertObj.iccid=a.iccid;AutoPing.alertObj.time=getLocalTimeStr(a.Violation.Time);var b=a.Violation.Pos.Lat;var d=a.Violation.Pos.Lon;b=b/10000000;d=~d+1;d=-d/10000000;AutoPing.alertObj.pos=new Position(b+" "+d);var c=new Geocoder();c.reverseGeocode(AutoPing.alertObj.pos,AutoPing.vioRgCallback)};AutoPing.vioRgCallback= function(a){if(a&&a.toString()!=""){a=a.buildingNumber+" "+a.street+", "+a.countrySecondarySubdivision+", "+a.countrySubdivision;AutoPing.alertObj.name=a}var b=FleetVehicle.createFakeVehicles();v=FleetVehicle.getVehicleByIccid(b,AutoPing.alertObj.iccid);document.getElementById("violationCar").innerHTML="Route Compliance Alert - "+v.name;document.getElementById("violationAddress").innerHTML=AutoPing.alertObj.name;document.getElementById("violationValue").innerHTML=AutoPing.alertObj.time;document.getElementById("violationDiv").style.display="block"};AutoPing.rgCallback= function(a){if(a&&a.toString()!=""){a=a.buildingNumber+" "+a.street+", "+a.countrySecondarySubdivision+", "+a.countrySubdivision;AutoPing.alertObj.name=a}var b=FleetVehicle.createFakeVehicles();v=FleetVehicle.getVehicleByIccid(b,AutoPing.alertObj.iccid);document.getElementById("speedAlertCar").innerHTML="Speed Alert - "+v.name;document.getElementById("speedAlertAddress").innerHTML=AutoPing.alertObj.name;document.getElementById("speedAlertTime").innerHTML=AutoPing.alertObj.time;document.getElementById("speedAlertValue").innerHTML="<font color='red'>"+AutoPing.alertObj.speed+"</font>/"+AutoPing.alertObj.limitSpeed;document.getElementById("speedAlertDiv").style.display="block"};AutoPing.sendReceipt= function(a,d){var c=Message.createPingReceitDOM(a,d);var f=new WSXMLTunnelFCS();f.responseFormat="JSON";try{f.send(c,AutoPing.receitCallBack,JSRequest.getHostTimeout,CONFIG.fcsUrl)}catch(b){alert(b.message)}};AutoPing.receitCallBack= function(){};AutoPing.timeoutCallback= function(){window.status="FCS Gateway Disconnected."};AutoPing.autoPing= function(){window.setTimeout(AutoPing.reping,AutoPing.timeloop)};AutoPing.autoPingCallBackMod= function(a){AutoPing.callback=a;window.setTimeout(AutoPing.repingCallBackMod,AutoPing.timeloop)};function closePanel(){document.getElementById("speedAlertDiv").style.display="none";document.getElementById("violationDiv").style.display="none"}function DispatchQuery(){var j=new deCarta.XMLStringBuilder();var d=[];this.bestVehicleForJob= function(t,q,r,n,u,o){var s=Utilities.getRequestId();if(typeof u=="function"){d[s]=u}else{throw new Exception("DispatchQuery.bestVehicleForJob: callback must be a function, arg was: "+u)}var p=f(t,q,r,n,s);JSRequest.send(p,function(A){var w=A.XLS.Response.requestID;var C=[];var E=[];if(deCarta.JSONParser.parseErrors(A)){}else{if(A.XLS.Response.DispatchResponse&&A.XLS.Response.DispatchResponse.BestVehicleForJobResponse){var F=A.XLS.Response.DispatchResponse.BestVehicleForJobResponse;if(!deCarta.Array.isArray(F)){F=[F]}for(var B=0;B<F.length;B++){var y,D;if(F[B].Vehicle){y=m(F[B].Vehicle)}if(F[B].Route){D=h(F[B].Route);if(F[B].RouteInstructionsList){var z=g(F[B].RouteInstructionsList);D.RouteInstructions=z}}C.push(y);E.push(D)}}}if((w>=0)&&d[w]){d[w](C,E);d[w]=undefined}},null,o)};this.bestJobForVehicle= function(n,t,r,o,u,p){var s=Utilities.getRequestId();if(typeof u=="function"){d[s]=u}else{throw new Exception("DispatchQuery.bestJobForVehicle: callback must be a function, arg was: "+u)}var q=b(n,t,r,o,s);JSRequest.send(q,function(B){var w=B.XLS.Response.requestID;var z=[];var F=[];if(deCarta.JSONParser.parseErrors(B)){}else{if(B.XLS.Response.DispatchResponse&&B.XLS.Response.DispatchResponse.BestJobForVehicleResponse){var D=B.XLS.Response.DispatchResponse.BestJobForVehicleResponse;if(!deCarta.Array.isArray(D)){D=[D]}for(var C=0;C<D.length;C++){var y,E;if(D[C].Job){y=k(D[C].Job)}if(D[C].Route){E=h(D[C].Route);if(D[C].RouteInstructionsList){var A=g(D[C].RouteInstructionsList);E.RouteInstructions=A}}z.push(y);F.push(E)}}}if((w>=0)&&d[w]){d[w](z,F);d[w]=undefined}},null,p)};function f(o,u,w,s,n,q){n=n||Utilities.getRequestId();q=q||Utilities.getRequestId();var r=j.getHeader("DispatchRequest",n,null,q);r+="<xls:DispatchRequest>";r+=l(w);r+="<xls:BestVehicleForJobRequest";for(var t in s){if(s.hasOwnProperty(t)){r+=" "+t+"='"+s[t]+"'"}}r+=">";r+=c(o);r+="<xls:VehicleList>";for(var p=0;p<u.length;p++){r+=a(u[p])}r+="</xls:VehicleList>";r+="</xls:BestVehicleForJobRequest>";r+="</xls:DispatchRequest></xls:Request></xls:XLS>";return r}function b(p,o,w,t,n,r){n=n||Utilities.getRequestId();r=r||Utilities.getRequestId();var s=j.getHeader("DispatchRequest",n,null,r);s+="<xls:DispatchRequest>";s+=l(w);s+="<xls:BestJobForVehicleRequest";for(var u in t){if(t.hasOwnProperty(u)){s+=" "+u+"='"+t[u]+"'"}}s+=">";s+="<xls:JobList>";for(var q=0;q<p.length;q++){s+=c(p[q])}s+="</xls:JobList>";s+=a(o);s+="</xls:BestJobForVehicleRequest>";s+="</xls:DispatchRequest></xls:Request></xls:XLS>";return s}function l(q){var o="";var n=q.getAvoidList();o+="<xls:RoutePreference>"+q.routePreference+"</xls:RoutePreference>";if(n.length>0){o+="<xls:AvoidList>";for(var p=0;p<n.length;p++){o+="<xls:AvoidFeature>"+n[p]+"</xls:AvoidFeature>"}o+="</xls:AvoidList>"}return o}function c(o){var n="";n+="<xls:Job ID='"+o.id+"'>";n+="<xls:Position>"+o.position.toString()+"</xls:Position>";if(o.schedule){n+="<xls:Schedule>"+o.schedule+"</xls:Schedule>"}n+="</xls:Job>";return n}function a(s){var p="";p+="<xls:Vehicle ID='"+s.id+"'>";var o=s.positions;for(var q=0;q<o.length;q++){var n=o[q];p+="<xls:Position><gml:Point><gml:pos>"+n.toString()+"</gml:pos></gml:Point>";var r=n.customProperties.time;if(r&&r.begin){p+="<xls:Time begin='"+r.begin+"'";if(r.duration){p+=" duration='"+r.duration+"'"}p+="/>"}p+="</xls:Position>"}p+="</xls:Vehicle>";return p}function m(r){var t=new Vehicle();t.id=r.ID;var o=r.Position;if(!o){o=[]}else{if(!deCarta.Array.isArray(o)){o=[o]}}for(var q=0;q<o.length;q++){var p=o[q];var n=new Position(p.Point.pos);if(p.Time){var s=new Time(p.Time.begin);if(p.Time.duration){s.duration=p.Time.duration}n.customProperties.time=s}t.positions.push(n)}return t}function k(n){var o=new DispatchJob();o.id=n.ID;o.position=n.Position;o.schedule=n.Schedule;return o}function h(o){var n=new Route();n.routeID=o.RouteID;n.TotalDistance=o.Distance.value;n.uom=new UOM(o.Distance.uom);n.customProperties.eta=o.Eta;return n}function g(r){if(!r){return[]}var s=[];if(deCarta.Array.isArray(r)){r=r[0]}if(r){var o=r.RouteInstruction;var q=o.length;if(q==undefined){s[0]=p(o)}else{for(var n=0;n<q;n++){s[n]=p(o[n])}}}return s;function p(t){var u=new RouteInstruction();u.Instruction=t.Instruction;u.distance=t.distance.value;u.duration=Utilities.podParse(t.duration);if(t.Point){u.position=new Position(t.Point)}u.tour=t.tour;return u}}}function ExclusionZoneQuery(){this.xmlRecFac=new deCarta.XMLStringBuilder();var g=[];var k=[];var n=this;this.create= function(p,s,o){var r=Utilities.getRequestId();if(typeof s=="function"){g[r]=s}else{throw new Exception("ExclusionZoneQuery.create: callback must be a function, arg was: "+s)}if(p instanceof DDSShape){k[r]=p}var q=j(p,r);JSRequest.send(q,function(u){var w=u.XLS.Response.requestID;var y=undefined;if(deCarta.JSONParser.parseErrors(u)){}else{if(u.XLS.Response.ExclusionZoneResponse){y=u.XLS.Response.ExclusionZoneResponse.ZoneCreateResponse.ExclusionZone.id}}if((w>=0)&&g[w]){var t=k[w];k[w]=undefined;g[w](y,t);g[w]=undefined}},null,o)};this.remove= function(s,r,o){var q=Utilities.getRequestId();if(typeof r=="function"){g[q]=r}else{throw new Exception("ExclusionZoneQuery.create: callback must be a function, arg was: "+r)}var p=a(s,q);JSRequest.send(p,function(t){var u=t.XLS.Response.requestID;var w=undefined;if(deCarta.JSONParser.parseErrors(t)){}else{if(t.XLS.Response.ExclusionZoneResponse){w=t.XLS.Response.ExclusionZoneResponse.ZoneDeleteResponse.ExclusionZone.id}}if((u>=0)&&g[u]){g[u](w);g[u]=undefined}},null,o)};this.update= function(p,s,o){var r=Utilities.getRequestId();if(typeof s=="function"){g[r]=s}else{throw new Exception("ExclusionZoneQuery.create: callback must be a function, arg was: "+s)}var q=m(p,r);JSRequest.send(q,function(t){var u=t.XLS.Response.requestID;var w=undefined;if(deCarta.JSONParser.parseErrors(t)){}else{if(t.XLS.Response.ExclusionZoneResponse){w=t.XLS.Response.ExclusionZoneResponse.ZoneUpdateResponse.ExclusionZone.id}}if((u>=0)&&g[u]){g[u](w);g[u]=undefined}},null,o)};this.retrieveById= function(s,r,o){var q=Utilities.getRequestId();if(typeof r=="function"){g[q]=r}else{throw new Exception("ExclusionZoneQuery.create: callback must be a function, arg was: "+r)}var p=d(s,q);JSRequest.send(p,function(u){var w=u.XLS.Response.requestID;var t=[];if(deCarta.JSONParser.parseErrors(u)){}else{if(u.XLS.Response.ExclusionZoneResponse){t=l(u.XLS.Response.ExclusionZoneResponse.ZoneRetrieveResponse)}}if((w>=0)&&g[w]){g[w](t);g[w]=undefined}},null,o)};this.retrieveAll= function(r,s,o){if(r!=false){r=true}var q=Utilities.getRequestId();if(typeof s=="function"){g[q]=s}else{throw new Exception("ExclusionZoneQuery.create: callback must be a function, arg was: "+s)}var p=h(r,q);JSRequest.send(p,function(u){var w=u.XLS.Response.requestID;var t=[];if(deCarta.JSONParser.parseErrors(u)){}else{if(u.XLS.Response.ExclusionZoneResponse){t=l(u.XLS.Response.ExclusionZoneResponse.ZoneRetrieveResponse)}}if((w>=0)&&g[w]){g[w](t);g[w]=undefined}},null,o)};this.retrieveByProperties= function(q,s,o){if(detailResponse!=false){detailResponse=true}var r=Utilities.getRequestId();if(typeof s=="function"){g[r]=s}else{throw new Exception("ExclusionZoneQuery.create: callback must be a function, arg was: "+s)}var p=f(q,r);JSRequest.send(p,function(u){var w=u.XLS.Response.requestID;var t=[];if(deCarta.JSONParser.parseErrors(u)){}else{if(u.XLS.Response.ExclusionZoneResponse){t=l(u.XLS.Response.ExclusionZoneResponse.ZoneRetrieveResponse)}}if((w>=0)&&g[w]){g[w](t);g[w]=undefined}},null,o)};function j(o,q,r){q=q||Utilities.getRequestId();r=r||Utilities.getRequestId();var p=n.xmlRecFac.getHeader("ExclusionZoneRequest",q,null,r);p+="<xls:ExclusionZoneRequest><xls:ZoneCreateRequest><xls:ExclusionZone ";p+="name='"+o.title+"' ";if(o.description&&o.description!=""){p+="description='"+o.description+"' "}p+=b(o);p+=">";p+=c(o);p+="</xls:ExclusionZone></xls:ZoneCreateRequest></xls:ExclusionZoneRequest></xls:Request></xls:XLS>";return p}function m(o,q,r){q=q||Utilities.getRequestId();r=r||Utilities.getRequestId();var p=n.xmlRecFac.getHeader("ExclusionZoneRequest",q,null,r);p+="<xls:ExclusionZoneRequest><xls:ZoneUpdateRequest><xls:ExclusionZone id='";p+=o.id+"' ";p+="name='"+o.title+"' ";if(o.description&&o.description!=""){p+="description='"+o.description+"' "}p+=b(o);p+=">";p+=c(o);p+="</xls:ExclusionZone></xls:ZoneUpdateRequest></xls:ExclusionZoneRequest></xls:Request></xls:XLS>";return p}function b(o){var p="";p+="metaInfo='borderColorRed@"+o.borderColorRed+" borderColorGreen@"+o.borderColorGreen+" borderColorBlue@"+o.borderColorBlue;p+=" fillColorRed@"+o.fillColorRed+" fillColorGreen@"+o.fillColorGreen+" fillColorBlue@"+o.fillColorBlue;p+=" fillOpacityFloat@"+o.fillOpacityFloat;p+=" borderWidth@"+o.borderWidth;p+=" strokeOpacityFloat@"+o.strokeOpacityFloat;if(o.width){p+=" width@"+o.width}p+="'";return p}function c(q){var r="";r+="<xls:Geometry>";if(q.type=="circle"){r+="<gml:CircleByCenterPoint numArc='1'><gml:pos>"+q.getPosition().toString()+"</gml:pos><gml:radius uom='";r+=q.radius.uom.toString()+"'>"+q.radius.distance+"</gml:radius></gml:CircleByCenterPoint>"}else{if(q.type=="line"){r+="<gml:LineString>";var p=q.getPositions();for(var s=0;s<p.length;s++){r+="<gml:pos>"+p[s].toString()+"</gml:pos>"}r+="</gml:LineString>"}else{if(q.type=="polygon"){r+="<gml:Polygon><gml:exterior><gml:LinearRing>";p=q.getPositions();for(s=0;s<p.length;s++){r+="<gml:pos>"+p[s].toString()+"</gml:pos>"}if(p.length==3){r+="<gml:pos>"+p[0].toString()+"</gml:pos>"}r+="</gml:LinearRing></gml:exterior></gml:Polygon>"}}}r+="</xls:Geometry>";if(!Utilities.isObjectEmpty(q.customProperties.properties)){r+="<xls:Properties>";for(var t in q.customProperties.properties){if(q.customProperties.properties.hasOwnProperty(t)){r+="<xls:Property name='"+t+"' value='"+q.customProperties.properties[t]+"'/>"}}r+="</xls:Properties>"}if(!Utilities.isObjectEmpty(q.customProperties.restrictedActiveTimes)){r+="<xls:RestrictedActiveTimes>";for(t in q.customProperties.restrictedActiveTimes){if(q.customProperties.restrictedActiveTimes.hasOwnProperty(t)){var o=q.customProperties.restrictedActiveTimes[t];r+="<xls:ActiveTime recurrenceType='"+o.recurrenceType;if(o.recurrenceType=="W"){r+="' weeklyRecurrenceDay='"+o.weeklyRecurrenceDay+"'>"}else{r+="'>"}r+="<xls:StartTime>"+o.startTime+"</xls:StartTime><xls:EndTime>";r+=o.endTime+"</xls:EndTime></xls:ActiveTime>"}}r+="</xls:RestrictedActiveTimes>"}return r}function h(s,t,u){t=t||Utilities.getRequestId();u=u||Utilities.getRequestId();s=s?"true":"false";var r=s;var o=s;var q=s;var p=n.xmlRecFac.getHeader("ExclusionZoneRequest",t,null,u);p+="<xls:ExclusionZoneRequest><xls:ZoneRetrieveRequest returnGeometry='"+r+"' returnProperties='"+o+"' returnRestrictedActiveTimes='"+q+"'>";p+="</xls:ZoneRetrieveRequest></xls:ExclusionZoneRequest></xls:Request></xls:XLS>";return p}function d(u,s,t){s=s||Utilities.getRequestId();t=t||Utilities.getRequestId();var r="true";var o=n.xmlRecFac.getHeader("ExclusionZoneRequest",s,null,t);o+="<xls:ExclusionZoneRequest><xls:ZoneRetrieveRequest detailResponse='"+r+"'>";var q=[];if(u){if(u.length==undefined){q.push(u)}else{q=u}}else{q.push(undefined)}for(var p=0;p<q.length;p++){o+="<xls:ID>";o+=q[p]+"</xls:ID>"}o+="</xls:ZoneRetrieveRequest></xls:ExclusionZoneRequest></xls:Request></xls:XLS>";return o}function f(p,r,t){r=r||Utilities.getRequestId();t=t||Utilities.getRequestId();var q="true";var o=n.xmlRecFac.getHeader("ExclusionZoneRequest",r,null,t);o+="<xls:ExclusionZoneRequest><xls:ZoneRetrieveRequest detailResponse='"+q+"'>";o+="<xls:Properties>";for(var s in p){if(p.hasOwnProperty(s)){o+="<xls:Property name='"+s+"' value='"+p[s]+"'/>"}}o+="</xls:Properties>";o+="</xls:ZoneRetrieveRequest></xls:ExclusionZoneRequest></xls:Request></xls:XLS>";return o}function a(r,p,q){p=p||Utilities.getRequestId();q=q||Utilities.getRequestId();var o=n.xmlRecFac.getHeader("ExclusionZoneRequest",p,null,q);o+="<xls:ExclusionZoneRequest><xls:ZoneDeleteRequest>";o+="<xls:ID>";o+=r+"</xls:ID>";o+="</xls:ZoneDeleteRequest></xls:ExclusionZoneRequest></xls:Request></xls:XLS>";return o}function l(C){if(!C){return null}var s=C.ExclusionZone;if(!s){s=[]}else{if(!deCarta.Array.isArray(s)){s=[C.ExclusionZone]}}var q=[];for(var u=0;u<s.length;u++){var y={};var z=s[u];if(z.Geometry){if(z.Geometry.Polygon){y=new DDSPolygon();y.positions=[];if(z.Geometry.Polygon.exterior.LinearRing.pos.length=="undefined"){var w=new Position(z.Geometry.Polygon.exterior.LinearRing.pos);y.positions.push(w)}else{for(var F=0;F<z.Geometry.Polygon.exterior.LinearRing.pos.length;F++){w=new Position(z.Geometry.Polygon.exterior.LinearRing.pos[F]);y.positions.push(w)}}}else{if(z.Geometry.CircleByCenterPoint){y=new DDSCircle();y.position=new Position(z.Geometry.CircleByCenterPoint.pos);var p=z.Geometry.CircleByCenterPoint.radius.uom||"M";var o=z.Geometry.CircleByCenterPoint.radius.content||0;y.radius=new Radius(o,p)}else{if(z.Geometry.LineString){y=new DDSLine();y.positions=[];if(z.Geometry.LineString.pos.length=="undefined"){w=new Position(z.Geometry.LineString.pos);y.positions.push(w)}else{for(F=0;F<z.Geometry.LineString.pos.length;F++){w=new Position(z.Geometry.LineString.pos[F]);y.positions.push(w)}}}}}}y.title=(z.name=="undefined"||!z.name)?"":(z.name);y.id=z.id;y.description=(z.description=="undefined"||!z.description)?"":(z.description);y.customProperties={};if(z.Properties){var A=z.Properties.Property;if(A.length==undefined){A=[z.Properties.Property]}y.customProperties.properties={};for(var t=0;t<A.length;t++){y.customProperties.properties[A[t].name]=A[t].value}}if(z.RestrictedActiveTimes){var E=z.RestrictedActiveTimes.ActiveTime;if(z.RestrictedActiveTimes.ActiveTime.length==undefined){E=[z.RestrictedActiveTimes.ActiveTime]}y.customProperties.restrictedActiveTimes=[];for(F=0;F<E.length;F++){var r={};r.startTime=E[F].StartTime;r.endTime=E[F].EndTime;r.recurrenceType=E[F].recurrenceType;r.weeklyRecurrenceDay=E[F].weeklyRecurrenceDay;y.customProperties.restrictedActiveTimes.push(r)}}if(z.metaInfo){var D=z.metaInfo;var B=/([a-zA-Z]+)@((?:\d+\.\d+)|\d+|(?:[a-zA-Z]+))/g;var G;while((G=B.exec(D))!=null){y[G[1]]=G[2]}}y.customProperties.saved=true;q.push(y)}return q}}FleetVehicle= function(){this.id="";this.iccid="";this.name="";this.latestMsg="";this.time="";this.status="";this.lat="";this.lon="";this.canRspLst=[];this.positions=[]};FleetVehicle.getVehicleByIccid= function(b,c){for(var a=0;a<b.length;a++){if(b[a].iccid==c){return b[a]}}return null};FleetVehicle.getVehicleIndexByIccid= function(b,c){for(var a=0;a<b.length;a++){if(b[a].iccid==c){return a}}return null};FleetVehicle.createFakeVehicles= function(){var n=new Position("37.347398 -121.892052");var o=[];var p=new Date();var g=Utils.formatDate2String(p);var h=1;for(var l=0;l<3;l++,h++){id=Math.floor(Math.random()*10000);var a="Demo"+h;p=new Date(p.getTime()+((Math.random())*6-3)*3600*1000);g=p.format("yyyy-mm-dd'T'HH:MM:ss");g=g.replace(/T/," ");var f=g;var c=Math.random()*0.1-0.05;var b=Math.random()*0.1-0.05;var m=new Position(n.lat-c,n.lon-b);m.customProperties.time=f;var k=[m];var d=FleetVehicle.createFakeVehicle(l,a,k);d.time=f;d.lat=m.lat;d.lon=m.lon;o.push(d)}return o};FleetVehicle.createFakeVehicle= function(c,b,a){var d=new FleetVehicle();d.id=ICCID[c];d.iccid=ICCID[c];d.name=b;d.latestMsg="--";d.status="on";d.positions=a;return d};FleetVehicle.selectVehiclesByName= function(c,d){var f=new Array();for(var a=0;a<d.length;a++){var b=d[a].name;if(b.indexOf(c)!=-1){f.push(d[a])}}return f};function GeofencingQuery(){var m=new deCarta.XMLStringBuilder();var g=[];var l=[];this.create= function(r,u,q){var t=Utilities.getRequestId();if(typeof u=="function"){g[t]=u}else{if(u){throw new Exception("GeofencingQuery.create: callback must be a function, arg was: "+u)}}if(r.type!="polygon"&&r.type!="circle"){throw new Exception("GeofencingQuery.create: shape must be polygon or circle")}if(r instanceof DDSShape){l[t]=r}var s=k(r,t);JSRequest.send(s,function(y){var z=y.XLS.Response.requestID;var A=undefined;if(deCarta.JSONParser.parseErrors(y)){}else{if(y.XLS.Response.GeofencingResponse){A=y.XLS.Response.GeofencingResponse.FenceCreateResponse.Geofence.id}}if((z>=0)&&g[z]){var w=l[z];l[z]=undefined;g[z](A,w);g[z]=undefined}},null,q)};this.remove= function(u,t,q){var s=Utilities.getRequestId();if(typeof t=="function"){g[s]=t}else{throw new Exception("GeofencingQuery.create: callback must be a function, arg was: "+t)}var r=a(u,s);JSRequest.send(r,function(w){var y=w.XLS.Response.requestID;var z=undefined;if(deCarta.JSONParser.parseErrors(w)){}else{if(w.XLS.Response.GeofencingResponse){z=w.XLS.Response.GeofencingResponse.FenceDeleteResponse.Geofence.id}}if((y>=0)&&g[y]){g[y](z);g[y]=undefined}},null,q)};this.update= function(r,u,q){var t=Utilities.getRequestId();if(typeof u=="function"){g[t]=u}else{throw new Exception("GeofencingQuery.create: callback must be a function, arg was: "+u)}var s=p(r,t);JSRequest.send(s,function(w){var y=w.XLS.Response.requestID;var z=undefined;if(deCarta.JSONParser.parseErrors(w)){}else{if(w.XLS.Response.GeofencingResponse){z=w.XLS.Response.GeofencingResponse.FenceUpdateResponse.Geofence.id}}if((y>=0)&&g[y]){g[y](z);g[y]=undefined}},null,q)};this.retrieveById= function(u,t,q){var s=Utilities.getRequestId();if(typeof t=="function"){g[s]=t}else{throw new Exception("GeofencingQuery.create: callback must be a function, arg was: "+t)}var r=d(u,s);JSRequest.send(r,function(y){var z=y.XLS.Response.requestID;var w=[];if(deCarta.JSONParser.parseErrors(y)){}else{if(y.XLS.Response.GeofencingResponse){w=c(y.XLS.Response.GeofencingResponse.FenceRetrieveResponse)}}if((z>=0)&&g[z]){g[z](w);g[z]=undefined}},null,q)};this.retrieveAll= function(t,u,q){if(t!=false){t=true}var s=Utilities.getRequestId();if(typeof u=="function"){g[s]=u}else{throw new Exception("GeofencingQuery.create: callback must be a function, arg was: "+u)}var r=j(t,s);JSRequest.send(r,function(y){var z=y.XLS.Response.requestID;var w=[];if(deCarta.JSONParser.parseErrors(y)){}else{if(y.XLS.Response.GeofencingResponse){w=c(y.XLS.Response.GeofencingResponse.FenceRetrieveResponse)}}if((z>=0)&&g[z]){g[z](w);g[z]=undefined}},null,q)};this.retrieveByProperties= function(s,u,q){if(detailResponse!=false){detailResponse=true}var t=Utilities.getRequestId();if(typeof u=="function"){g[t]=u}else{throw new Exception("GeofencingQuery.create: callback must be a function, arg was: "+u)}var r=f(s,t);JSRequest.send(r,function(y){var z=y.XLS.Response.requestID;var w=[];if(deCarta.JSONParser.parseErrors(y)){}else{if(y.XLS.Response.GeofencingResponse){w=c(y.XLS.Response.GeofencingResponse.FenceRetrieveResponse)}}if((z>=0)&&g[z]){g[z](w);g[z]=undefined}},null,q)};this.violationCheck= function(t,w,u,q){var s=Utilities.getRequestId();if(typeof u=="function"){g[s]=u}else{throw new Exception("GeofencingQuery.create: callback must be a function, arg was: "+u)}var r=o(t,w,s);JSRequest.send(r,function(B){var C=B.XLS.Response.requestID;var z;var A=null;var y=null;if(deCarta.JSONParser.parseErrors(B)){}else{if(B.XLS.Response.GeofencingResponse){z=n(B.XLS.Response.GeofencingResponse.FenceViolationCheckResponse);A=z[0];y=z[1]}if(A&&!(deCarta.Array.isArray(t))){A=A[0];y=y[0]}}if((C>=0)&&g[C]){g[C](A,y);g[C]=undefined}},null,q)};function k(q,s,t){s=s||Utilities.getRequestId();t=t||Utilities.getRequestId();var r=m.getHeader("GeofencingRequest",s,null,t);r+="<xls:GeofencingRequest><xls:FenceCreateRequest><xls:Geofence ";r+="name='"+q.title+"' ";if(q.description&&q.description!=""){r+="description='"+q.description+"' "}r+="violationType='"+q.customProperties.violationType+"' ";r+=b(q);r+=">";r+=h(q);r+="</xls:Geofence></xls:FenceCreateRequest></xls:GeofencingRequest></xls:Request></xls:XLS>";return r}function p(q,s,t){s=s||Utilities.getRequestId();t=t||Utilities.getRequestId();var r=m.getHeader("GeofencingRequest",s,null,t);r+="<xls:GeofencingRequest><xls:FenceUpdateRequest><xls:Geofence id='";r+=q.id+"' ";r+="name='"+q.title+"' ";if(q.description&&q.description!=""){r+="description='"+q.description+"' "}r+="violationType='"+q.customProperties.violationType+"' ";r+=b(q);r+=">";r+=h(q);r+="</xls:Geofence></xls:FenceUpdateRequest></xls:GeofencingRequest></xls:Request></xls:XLS>";return r}function b(q){var r="";r+="metaInfo='borderColorRed@"+q.borderColorRed+" borderColorGreen@"+q.borderColorGreen+" borderColorBlue@"+q.borderColorBlue;r+=" fillColorRed@"+q.fillColorRed+" fillColorGreen@"+q.fillColorGreen+" fillColorBlue@"+q.fillColorBlue;r+=" fillOpacityFloat@"+q.fillOpacityFloat;r+=" borderWidth@"+q.borderWidth;r+=" strokeOpacityFloat@"+q.strokeOpacityFloat;if(q.width){r+=" width@"+q.width}r+="'";return r}function h(s){var t="";t+="<xls:Geometry>";if(s.type=="circle"){t+="<gml:CircleByCenterPoint numArc='1'><gml:pos>"+s.getPosition().toString()+"</gml:pos><gml:radius uom='";t+=s.radius.uom.toString()+"'>"+s.radius.distance+"</gml:radius></gml:CircleByCenterPoint>"}else{if(s.type=="line"){t+="<gml:LineString>";var r=s.getPositions();for(var u=0;u<r.length;u++){t+="<gml:pos>"+r[u].toString()+"</gml:pos>"}t+="</gml:LineString>"}else{if(s.type=="polygon"){t+="<gml:Polygon><gml:exterior><gml:LinearRing>";r=s.getPositions();for(u=0;u<r.length;u++){t+="<gml:pos>"+r[u].toString()+"</gml:pos>"}if(r.length==3){t+="<gml:pos>"+r[0].toString()+"</gml:pos>"}t+="</gml:LinearRing></gml:exterior></gml:Polygon>"}}}t+="</xls:Geometry>";if(s.customProperties&&!Utilities.isObjectEmpty(s.customProperties.properties)){t+="<xls:Properties>";for(var w in s.customProperties.properties){if(s.customProperties.properties.hasOwnProperty(w)){t+="<xls:Property name='"+w+"' value='"+s.customProperties.properties[w]+"'/>"}}t+="</xls:Properties>"}if(s.customProperties&&!Utilities.isObjectEmpty(s.customProperties.restrictedActiveTimes)){t+="<xls:RestrictedActiveTimes>";for(w in s.customProperties.restrictedActiveTimes){if(s.customProperties.restrictedActiveTimes.hasOwnProperty(w)){var q=s.customProperties.restrictedActiveTimes[w];t+="<xls:ActiveTime recurrenceType='"+q.recurrenceType;if(q.recurrenceType=="W"){t+="' weeklyRecurrenceDay='"+q.weeklyRecurrenceDay+"'>"}else{t+="'>"}t+="<xls:StartTime>"+q.startTime+"</xls:StartTime><xls:EndTime>";t+=q.endTime+"</xls:EndTime></xls:ActiveTime>"}}t+="</xls:RestrictedActiveTimes>"}return t}function j(u,w,y){w=w||Utilities.getRequestId();y=y||Utilities.getRequestId();u=u?"true":"false";var t=u;var q=u;var s=u;var r=m.getHeader("GeofencingRequest",w,null,y);r+="<xls:GeofencingRequest><xls:FenceRetrieveRequest returnGeometry='"+t+"' returnProperties='"+q+"' returnRestrictedActiveTimes='"+s+"'>";r+="</xls:FenceRetrieveRequest></xls:GeofencingRequest></xls:Request></xls:XLS>";return r}function d(u,w,z){w=w||Utilities.getRequestId();z=z||Utilities.getRequestId();var s="true";var r=s;var B=s;var t=s;var A=m.getHeader("GeofencingRequest",w,null,z);A+="<xls:GeofencingRequest><xls:FenceRetrieveRequest returnGeometry='"+r+"' returnProperties='"+B+"' returnRestrictedActiveTimes='"+t+"'>";var q=[];if(u){if(u.length==undefined){q.push(u)}else{q=u}}else{q.push(undefined)}for(var y=0;y<q.length;y++){A+="<xls:ID>";A+=q[y]+"</xls:ID>"}A+="</xls:FenceRetrieveRequest></xls:GeofencingRequest></xls:Request></xls:XLS>";return A}function f(y,t,u){t=t||Utilities.getRequestId();u=u||Utilities.getRequestId();var r="true";var q=r;var B=r;var s=r;var w=m.getHeader("GeofencingRequest",t,null,u);w+="<xls:GeofencingRequest><xls:FenceRetrieveRequest returnGeometry='"+q+"' returnProperties='"+B+"' returnRestrictedActiveTimes='"+s+"'>";w+="<xls:Properties>";for(var A in y){if(y.hasOwnProperty(A)){w+="<xls:Property name='"+A+"' value='"+y[A]+"'/>"}}w+="</xls:Properties>";w+="</xls:FenceRetrieveRequest></xls:GeofencingRequest></xls:Request></xls:XLS>";return w}function a(t,r,s){r=r||Utilities.getRequestId();s=s||Utilities.getRequestId();var q=m.getHeader("GeofencingRequest",r,null,s);q+="<xls:GeofencingRequest><xls:FenceDeleteRequest>";q+="<xls:ID>";q+=t+"</xls:ID>";q+="</xls:FenceDeleteRequest></xls:GeofencingRequest></xls:Request></xls:XLS>";return q}function c(u){if(!u){return null}var w=u.Geofence;if(!w){w=[]}else{if(!deCarta.Array.isArray(w)){w=[u.Geofence]}}var s=[];for(var z=0;z<w.length;z++){var B={};var G=w[z];if(G.Geometry){if(G.Geometry.Polygon){B=new DDSPolygon();B.positions=[];if(G.Geometry.Polygon.exterior.LinearRing.pos.length=="undefined"){var A=new Position(G.Geometry.Polygon.exterior.LinearRing.pos);B.positions.push(A)}else{for(var H=0;H<G.Geometry.Polygon.exterior.LinearRing.pos.length;H++){A=new Position(G.Geometry.Polygon.exterior.LinearRing.pos[H]);B.positions.push(A)}}}else{if(G.Geometry.CircleByCenterPoint){B=new DDSCircle();B.position=new Position(G.Geometry.CircleByCenterPoint.pos);var r=G.Geometry.CircleByCenterPoint.radius.uom||"M";var q=G.Geometry.CircleByCenterPoint.radius.content||0;B.radius=new Radius(q,r)}else{if(G.Geometry.LineString){B=new DDSLine();B.positions=[];if(G.Geometry.LineString.pos.length=="undefined"){A=new Position(G.Geometry.LineString.pos);B.positions.push(A)}else{for(H=0;H<G.Geometry.LineString.pos.length;H++){A=new Position(G.Geometry.LineString.pos[H]);B.positions.push(A)}}}}}}B.title=(G.name=="undefined"||!G.name)?"":(G.name);B.id=G.id;B.description=(G.description=="undefined"||!G.description)?"":(G.description);B.customProperties={};B.customProperties.violationType=G.violationType;if(G.Properties){var C=G.Properties.Property;if(C.length==undefined){C=[G.Properties.Property]}B.customProperties.properties={};for(var y=0;y<C.length;y++){B.customProperties.properties[C[y].name]=C[y].value}}if(G.RestrictedActiveTimes){var F=G.RestrictedActiveTimes.ActiveTime;if(G.RestrictedActiveTimes.ActiveTime.length==undefined){F=[G.RestrictedActiveTimes.ActiveTime]}B.customProperties.restrictedActiveTimes=[];for(H=0;H<F.length;H++){var t={};t.startTime=F[H].StartTime;t.endTime=F[H].EndTime;t.recurrenceType=F[H].recurrenceType;t.weeklyRecurrenceDay=F[H].weeklyRecurrenceDay;B.customProperties.restrictedActiveTimes.push(t)}}if(G.metaInfo){var E=G.metaInfo;var D=/([a-zA-Z]+)@((?:\d+\.\d+)|\d+|(?:[a-zA-Z]+))/g;var I;while((I=D.exec(E))!=null){B[I[1]]=I[2]}}B.customProperties.saved=true;s.push(B)}return s}function o(y,A,t,w){t=t||Utilities.getRequestId();w=w||Utilities.getRequestId();var r=m.getHeader("GeofencingRequest",t,null,w);r+="<xls:GeofencingRequest><xls:FenceViolationCheckRequest returnViolationOnly='false'>";if(y.length=="undefined"){y=[y]}for(var s=0;s<y.length;s++){r+="<xls:CheckPoint><gml:pos>"+y[s].toString()+"</gml:pos>";if(y[s].customProperties.violationCheckDateTime){r+=" <xls:DateTime>"+y[s].customProperties.violationCheckDateTime+"</xls:DateTime>"}r+="</xls:CheckPoint>"}if(A){r+="<xls:GeofenceLookupCriteria>";if(!isNaN(A)){A=[A]}if(deCarta.Array.isArray(A)){for(var q=0;q<A.length;q++){r+="<xls:ID>"+A[q]+"</xls:ID>"}}else{if(!Utilities.isObjectEmpty(A)){r+="<xls:Properties>";for(var u in A){if(A.hasOwnProperty(u)){r+="<xls:Property name='"+u+"' value='"+A[u]+"'/>"}}r+="</xls:Properties>"}}r+="</xls:GeofenceLookupCriteria>"}r+="</xls:FenceViolationCheckRequest></xls:GeofencingRequest></xls:Request></xls:XLS>";return r}function n(u){if(!u){return null}var F=[];var r=[];var y=u.CheckPointResult;if(!y){y=[]}else{if(!deCarta.Array.isArray(y)){y=[y]}}for(var w=0;w<y.length;w++){var B=y[w];var A=new Position(B.pos.content);A.customProperties.violationCheckDateTime=B.DateTime;A.isViolation=B.isViolation;var s=[];if(B.ViolatedGeofences){s=B.ViolatedGeofences.Geofence}if(!s){s=[]}else{if(!deCarta.Array.isArray(s)){s=[s]}}var q=[];for(var t=0;t<s.length;t++){var E=s[t];var z={};z.title=(E.name=="undefined"||!E.name)?"":(E.name);z.id=E.id;z.description=(E.description=="undefined"||!E.description)?"":(E.description);z.customProperties={};z.customProperties.violationType=E.violationType;if(E.metaInfo){var D=E.metaInfo;var C=/([a-zA-Z]+)@((?:\d+\.\d+)|\d+|(?:[a-zA-Z]+))/g;var G;while((G=C.exec(D))!=null){z[G[1]]=G[2]}}z.customProperties.saved=true;q.push(z)}F.push(A);r.push(q)}return[F,r]}}function DispatchJob(b){this.id=0;this.position=null;this.schedule=null;this.init= function(c){if(c&&c.schedule&&!a(c.schedule)){throw new Exception("schedule must be in 2010-03-20T12:03:13 or 2010-03-20T12:03:13-05:00 format")}for(var d in c){if(c.hasOwnProperty(d)){this[d]=c[d]}}};this.init(b);function a(d){var c=/^\d{4}-\d{2}-\d{2}T\d{2}\:\d{2}\:\d{2}(\.\d+)?(Z|(\+|-)\d{2}\:\d{2})?$/;if(c.test(d)){return true}else{return false}}this.setSchedule= function(c){if(c&&!a(validate(c))){throw new Exception("schedule must be in 2010-03-20T12:03:13 or 2010-03-20T12:03:13-05:00 format")}else{this.schedule=c}}}function Message(d,b,f,a){this.toClient=b;this.msgContent=f;this.nowTime=c();this.type=d;this.id=Utilities.getRequestId();this.iccid=a;this.getICCID= function(){return this.iccid};this.setICCID= function(g){this.iccid=g};this.setType= function(g){this.type=g};this.setToClient= function(g){this.toClient=g};this.setMsgContent= function(g){this.msgContent=g};this.setNowTime= function(g){this.nowTime=g};this.getId= function(){return this.id};this.getType= function(){return this.type};this.getToClient= function(){return this.toClient};this.getMsgContent= function(){return this.msgContent};this.getNowTime= function(){return this.nowTime};function c(){var g=new Date();var h=new Date(g.toUTCString());var j=new Date();j.setUTCFullYear(1989);j.setUTCMonth(11);j.setUTCDate(31);j.setUTCHours(12);j.setUTCMinutes(0);j.setUTCSeconds(0);return Math.floor((h.getTime()-j.getTime())/1000)}}Message.createPingDOM= function(){JSRequest.setDynamicScriptTagMode();var d=Sarissa.getDomDocument();var a=d.createElement("xls:XLS");a.setAttribute("xls:lang","en");a.setAttribute("version","1");a.setAttribute("xmlns:xls","http://www.opengis.net/xls");a.setAttribute("xmlns:gml","http://www.opengis.net/gml");d.appendChild(a);var c=d.createElement("xls:RequestHeader");c.setAttribute("clientName",CONFIG.clientName);c.setAttribute("configuration",CONFIG.configuration);c.setAttribute("sessionID",Math.floor(Math.random()*10000000));c.setAttribute("clientPassword",CONFIG.fleetClientPassword);a.appendChild(c);var b=d.createElement("xls:Request");b.setAttribute("maximumResponses","1");b.setAttribute("version","1.0");b.setAttribute("requestID",Math.floor(Math.random()*10000000));b.setAttribute("methodName","PingRequest");a.appendChild(b);var f=d.createElement("xls:PingRequest");b.appendChild(f);return d};Message.createPingReceitDOM= function(a,j){JSRequest.setDynamicScriptTagMode();var h=Sarissa.getDomDocument();var d=h.createElement("xls:XLS");d.setAttribute("xls:lang","en");d.setAttribute("version","1");d.setAttribute("xmlns:xls","http://www.opengis.net/xls");d.setAttribute("xmlns:gml","http://www.opengis.net/gml");h.appendChild(d);var g=h.createElement("xls:RequestHeader");g.setAttribute("clientName",CONFIG.clientName);g.setAttribute("configuration",CONFIG.configuration);g.setAttribute("sessionID",Math.floor(Math.random()*10000000));g.setAttribute("clientPassword",CONFIG.fleetClientPassword);d.appendChild(g);var f=h.createElement("xls:Request");f.setAttribute("maximumResponses","1");f.setAttribute("version","1.0");f.setAttribute("requestID",Math.floor(Math.random()*10000000));f.setAttribute("methodName","ReceiptRequest");d.appendChild(f);var c=h.createElement("xls:ReceiptRequest");f.appendChild(c);var b=h.createElement("xls:Receipt");b.setAttribute("packetId",a);b.setAttribute("sequenceId",j);c.appendChild(b);return h};Message.createMsgRequestDOM= function(m,r){JSRequest.setDynamicScriptTagMode();var z=Sarissa.getDomDocument();var j=z.createElement("xls:XLS");j.setAttribute("xls:lang","en");j.setAttribute("version","1");j.setAttribute("xmlns:xls","http://www.opengis.net/xls");j.setAttribute("xmlns:gml","http://www.opengis.net/gml");z.appendChild(j);var u=z.createElement("xls:RequestHeader");u.setAttribute("clientName",CONFIG.clientName);u.setAttribute("configuration",CONFIG.configuration);u.setAttribute("sessionID",Math.floor(Math.random()*10000000));u.setAttribute("clientPassword",CONFIG.fleetClientPassword);j.appendChild(u);var h=z.createElement("xls:Request");h.setAttribute("maximumResponses","1");h.setAttribute("version","1.0");h.setAttribute("requestID",Math.floor(Math.random()*10000000));h.setAttribute("methodName","MsgRequest");j.appendChild(h);var y=z.createElement("xls:MsgRequest");h.appendChild(y);var A=z.createElement("xls:MsgHeader");var d=z.createElement("xls:to");var a=z.createTextNode(m.getToClient());d.appendChild(a);A.appendChild(d);y.appendChild(A);var t=z.createElement("xls:IccidList");var f=z.createElement("xls:Iccid");var c=z.createTextNode(m.getICCID());t.appendChild(f);f.appendChild(c);var l=z.createElement("xls:MsgBody");var p=z.createElement("xls:id");var w=z.createTextNode(m.getId());p.appendChild(w);var g=z.createElement("xls:type");var k=z.createTextNode(m.getType());g.appendChild(k);var s=z.createElement("xls:content");var q=z.createTextNode(m.getMsgContent());var o=z.createElement("xls:nowTime");var n=m.getNowTime();var b=z.createTextNode(n);s.appendChild(q);o.appendChild(b);l.appendChild(p);l.appendChild(g);l.appendChild(s);l.appendChild(o);y.appendChild(t);y.appendChild(l);y.appendChild(t);return z};Message.createAddCanResponseDOM= function(k,b,l){JSRequest.setDynamicScriptTagMode();var m=Sarissa.getDomDocument();var h=m.createElement("xls:XLS");h.setAttribute("xls:lang","en");h.setAttribute("version","1");h.setAttribute("xmlns:xls","http://www.opengis.net/xls");h.setAttribute("xmlns:gml","http://www.opengis.net/gml");m.appendChild(h);var o=m.createElement("xls:RequestHeader");o.setAttribute("clientName",CONFIG.clientName);o.setAttribute("configuration",CONFIG.configuration);o.setAttribute("sessionID",Math.floor(Math.random()*10000000));o.setAttribute("clientPassword",CONFIG.fleetClientPassword);h.appendChild(o);var f=m.createElement("xls:Request");f.setAttribute("maximumResponses","1");f.setAttribute("version","1.0");f.setAttribute("requestID",Math.floor(Math.random()*10000000));f.setAttribute("methodName","SetCannedMsgRequest");h.appendChild(f);var p=m.createElement("xls:SetCannedMsgRequest");f.appendChild(p);var g=m.createElement("xls:response_id");var d=m.createTextNode(k);g.appendChild(d);p.appendChild(g);var j=m.createElement("xls:response_text");var q=m.createTextNode(b);j.appendChild(q);p.appendChild(j);var a=m.createElement("xls:IccidList");var n=m.createElement("xls:Iccid");var c=m.createTextNode(l);a.appendChild(n);n.appendChild(c);p.appendChild(a);return m};Message.createDelCanResponseDOM= function(j,b,k){JSRequest.setDynamicScriptTagMode();var l=Sarissa.getDomDocument();var h=l.createElement("xls:XLS");h.setAttribute("xls:lang","en");h.setAttribute("version","1");h.setAttribute("xmlns:xls","http://www.opengis.net/xls");h.setAttribute("xmlns:gml","http://www.opengis.net/gml");l.appendChild(h);var n=l.createElement("xls:RequestHeader");n.setAttribute("clientName",CONFIG.clientName);n.setAttribute("configuration",CONFIG.configuration);n.setAttribute("sessionID",Math.floor(Math.random()*10000000));n.setAttribute("clientPassword",CONFIG.fleetClientPassword);h.appendChild(n);var f=l.createElement("xls:Request");f.setAttribute("maximumResponses","1");f.setAttribute("version","1.0");f.setAttribute("requestID",Math.floor(Math.random()*10000000));f.setAttribute("methodName","DelCannedMsgRequest");h.appendChild(f);var o=l.createElement("xls:DelCannedMsgRequest");f.appendChild(o);var g=l.createElement("xls:message_id");var d=l.createTextNode(j);g.appendChild(d);o.appendChild(g);var a=l.createElement("xls:IccidList");var m=l.createElement("xls:Iccid");var c=l.createTextNode(k);a.appendChild(m);m.appendChild(c);o.appendChild(a);return l};Message.creatCannedResponseListDOM= function(c,o,m){JSRequest.setDynamicScriptTagMode();var n=Sarissa.getDomDocument();var k=n.createElement("xls:XLS");k.setAttribute("xls:lang","en");k.setAttribute("version","1");k.setAttribute("xmlns:xls","http://www.opengis.net/xls");k.setAttribute("xmlns:gml","http://www.opengis.net/gml");n.appendChild(k);var q=n.createElement("xls:RequestHeader");q.setAttribute("clientName",CONFIG.clientName);q.setAttribute("configuration",CONFIG.configuration);q.setAttribute("sessionID",Math.floor(Math.random()*10000000));q.setAttribute("clientPassword",CONFIG.fleetClientPassword);k.appendChild(q);var h=n.createElement("xls:Request");h.setAttribute("maximumResponses","1");h.setAttribute("version","1.0");h.setAttribute("requestID",Math.floor(Math.random()*10000000));h.setAttribute("methodName","CannedRespListRequest");k.appendChild(h);var d=n.createElement("xls:CannedRespListRequest");h.appendChild(d);var j=n.createElement("xls:message_id");var g=n.createTextNode(c);j.appendChild(g);var b=n.createElement("xls:IccidList");var p=n.createElement("xls:Iccid");var f=n.createTextNode(m);b.appendChild(p);p.appendChild(f);d.appendChild(b);d.appendChild(j);if(o){for(var a=0;a<o.length;a++){var l=n.createElement("xls:response_id");var s=n.createTextNode(o[a]);l.appendChild(s);d.appendChild(l)}}return n};Message.createStopXML= function(g,d,f,c,a){var b='<xls:XLS version="1.0" xls:lang="en" rel="4.5.1" xmlns:xls="http://www.opengis.net/xls" xmlns:gml="http://www.opengis.net/gml"><xls:RequestHeader clientPassword="'+CONFIG.clientPassword+'" sessionID="'+Math.floor(Math.random()*10000000)+'" clientName="'+CONFIG.clientName+'" configuration="'+Credentials.configuration+'"/><xls:Request methodName="StopRequest" requestID="'+Math.floor(Math.random()*10000000)+'" maximumResponses="25" version="1.0"><xls:StopRequest><xls:Job ID="'+g+'" text="'+d+'"><xls:Position>'+f+"</xls:Position><xls:Schedule>"+c+"</xls:Schedule></xls:Job><xls:iccid>"+a+"</xls:iccid></xls:StopRequest></xls:Request></xls:XLS>";return b};function CanResponse(b,c,a){this.iccid=a;this.rspId=b;this.rspTxt=c;this.isSelected=false}function Job(f,c,d,b,a){this.iccid=a;this.id=f;this.text=c;this.position=d;this.schedule=b}function RouteComplianceQuery(){var l=new deCarta.XMLStringBuilder();var f=[];this.create= function(p,s,o){var r=Utilities.getRequestId();if(typeof s=="function"){f[r]=s}else{throw new Exception("RouteCompliance.create: callback must be a function, arg was: "+s)}if(!(p instanceof Route)){throw new Exception("route should be DDSLine or RouteID or array of positions")}var q=j(p,r);JSRequest.send(q,function(t){var u=t.XLS.Response.requestID;var w=undefined;if(deCarta.JSONParser.parseErrors(t)){}else{if(t.XLS.Response.RouteComplianceResponse){w=t.XLS.Response.RouteComplianceResponse.RouteCreateResponse.Route.id}}if((u>=0)&&f[u]){f[u](w);f[u]=undefined}},null,o)};this.remove= function(s,r,o){var q=Utilities.getRequestId();if(typeof r=="function"){f[q]=r}else{throw new Exception("RouteCompliance.create: callback must be a function, arg was: "+r)}var p=a(s,q);JSRequest.send(p,function(t){var u=t.XLS.Response.requestID;var w=undefined;if(deCarta.JSONParser.parseErrors(t)){}else{if(t.XLS.Response.RouteComplianceResponse){w=t.XLS.Response.RouteComplianceResponse.RouteDeleteResponse.Route.id}}if((u>=0)&&f[u]){f[u](w);f[u]=undefined}},null,o)};this.update= function(p,s,o){var r=Utilities.getRequestId();if(typeof s=="function"){f[r]=s}else{throw new Exception("RouteCompliance.create: callback must be a function, arg was: "+s)}var q=n(p,r);JSRequest.send(q,function(t){var u=t.XLS.Response.requestID;var w=undefined;if(deCarta.JSONParser.parseErrors(t)){}else{if(t.XLS.Response.RouteComplianceResponse){w=t.XLS.Response.RouteComplianceResponse.RouteUpdateResponse.Route.id}}if((u>=0)&&f[u]){f[u](w);f[u]=undefined}},null,o)};this.retrieveById= function(s,r,o){var q=Utilities.getRequestId();if(typeof r=="function"){f[q]=r}else{throw new Exception("RouteCompliance.create: callback must be a function, arg was: "+r)}var p=c(s,q);JSRequest.send(p,function(u){var w=u.XLS.Response.requestID;var t=[];if(deCarta.JSONParser.parseErrors(u)){}else{if(u.XLS.Response.RouteComplianceResponse){t=k(u.XLS.Response.RouteComplianceResponse.RouteRetrieveResponse)}}if((w>=0)&&f[w]){f[w](t);f[w]=undefined}},null,o)};this.retrieveAll= function(r,s,o){if(r!=false){r=true}var q=Utilities.getRequestId();if(typeof s=="function"){f[q]=s}else{throw new Exception("RouteCompliance.create: callback must be a function, arg was: "+s)}var p=g(r,q);JSRequest.send(p,function(u){var w=u.XLS.Response.requestID;var t=[];if(deCarta.JSONParser.parseErrors(u)){}else{if(u.XLS.Response.RouteComplianceResponse){t=k(u.XLS.Response.RouteComplianceResponse.RouteRetrieveResponse)}}if((w>=0)&&f[w]){f[w](t);f[w]=undefined}},null,o)};this.retrieveByProperties= function(q,s,o){if(detailResponse!=false){detailResponse=true}var r=Utilities.getRequestId();if(typeof s=="function"){f[r]=s}else{throw new Exception("RouteCompliance.create: callback must be a function, arg was: "+s)}var p=d(q,r);JSRequest.send(p,function(u){var w=u.XLS.Response.requestID;var t=[];if(deCarta.JSONParser.parseErrors(u)){}else{if(u.XLS.Response.RouteComplianceResponse){t=k(u.XLS.Response.RouteComplianceResponse.RouteRetrieveResponse)}}if((w>=0)&&f[w]){f[w](t);f[w]=undefined}},null,o)};this.violationCheck= function(r,t,s,o){var q=Utilities.getRequestId();if(typeof s=="function"){f[q]=s}else{throw new Exception("RouteCompliance.create: callback must be a function, arg was: "+s)}var p=m(r,t,q);JSRequest.send(p,function(A){var D=A.XLS.Response.requestID;var z=[];var y=[];if(deCarta.JSONParser.parseErrors(A)){}else{if(A.XLS.Response.RouteComplianceResponse&&A.XLS.Response.RouteComplianceResponse.ComplianceCheckResponse){var C=A.XLS.Response.RouteComplianceResponse.ComplianceCheckResponse;var B=C.CheckPoint;if(!B){B=[]}else{if(!deCarta.Array.isArray(B)){B=[B]}}for(var w=0;w<B.length;w++){var u=B[w];z.push(u.pointIndex);y.push(u.violated)}}if(r&&!(deCarta.Array.isArray(r))){z=z[0];y=y[0]}}if((D>=0)&&f[D]){f[D](z,y);f[D]=undefined}},null,o)};function j(o,q,r){q=q||Utilities.getRequestId();r=r||Utilities.getRequestId();var p=l.getHeader("RouteComplianceRequest",q,null,r);p+="<xls:RouteComplianceRequest><xls:RouteCreateRequest><xls:Route ";p+="name='"+o.title+"' ";if(o.description&&o.description!=""){p+="description='"+o.description+"' "}p+=h(o);p+=">";p+=b(o);p+="</xls:Route></xls:RouteCreateRequest></xls:RouteComplianceRequest></xls:Request></xls:XLS>";return p}function n(o,q,r){q=q||Utilities.getRequestId();r=r||Utilities.getRequestId();var p=l.getHeader("RouteComplianceRequest",q,null,r);p+="<xls:RouteComplianceRequest><xls:RouteUpdateRequest><xls:Route id='";p+=o.id+"' ";p+="name='"+o.title+"' ";if(o.description&&o.description!=""){p+="description='"+o.description+"' "}p+=h(o);p+=">";p+=b(o);p+="</xls:Route></xls:RouteUpdateRequest></xls:RouteComplianceRequest></xls:Request></xls:XLS>";return p}function h(o){var p="";if(o.customProperties.metaInfo){p="metaInfo='"+o.customProperties.metaInfo+"' "}return p}function b(p){var q="";q+="<xls:Geometry>";if(p.routeID){q+="<xls:RouteID>"+p.routeID+"</xls:RouteID>"}else{if(p.RouteGeometry&&p.RouteGeometry.length>0){q+="<gml:LineString>";for(var r=0;r<p.RouteGeometry.length;r++){q+="<gml:pos>"+p.RouteGeometry[r].toString()+"</gml:pos>"}q+="</gml:LineString>"}}q+="</xls:Geometry>";var o=p.customProperties.buffer;q+="<xls:Buffer uom='"+o.uom.value+"' value='"+o.distance+"'/>";if(!Utilities.isObjectEmpty(p.customProperties.properties)){q+="<xls:Properties>";for(var s in p.customProperties.properties){if(p.customProperties.properties.hasOwnProperty(s)){q+="<xls:Property name='"+s+"' value='"+p.customProperties.properties[s]+"'/>"}}q+="</xls:Properties>"}return q}function g(r,s,t){s=s||Utilities.getRequestId();t=t||Utilities.getRequestId();r=r?"true":"false";var q=r;var o=r;var p=l.getHeader("RouteComplianceRequest",s,null,t);p+="<xls:RouteComplianceRequest><xls:RouteRetrieveRequest returnGeometry='"+q+"' returnProperties='"+o+"'>";p+="</xls:RouteRetrieveRequest></xls:RouteComplianceRequest></xls:Request></xls:XLS>";return p}function c(r,s,u){s=s||Utilities.getRequestId();u=u||Utilities.getRequestId();var q="true";var p=q;var y=q;var w=l.getHeader("RouteComplianceRequest",s,null,u);w+="<xls:RouteComplianceRequest><xls:RouteRetrieveRequest returnGeometry='"+p+"' returnProperties='"+y+"'>";var o=[];if(r){if(r.length==undefined){o.push(r)}else{o=r}}else{o.push(undefined)}for(var t=0;t<o.length;t++){w+="<xls:ID>";w+=o[t]+"</xls:ID>"}w+="</xls:RouteRetrieveRequest></xls:RouteComplianceRequest></xls:Request></xls:XLS>";return w}function d(r,t,w){t=t||Utilities.getRequestId();w=w||Utilities.getRequestId();var s="true";var q=s;var o=s;var p=l.getHeader("RouteComplianceRequest",t,null,w);p+="<xls:RouteComplianceRequest><xls:RouteRetrieveRequest returnGeometry='"+q+"' returnProperties='"+o+"'>";p+="<xls:Properties>";for(var u in r){if(r.hasOwnProperty(u)){p+="<xls:Property name='"+u+"' value='"+r[u]+"'/>"}}p+="</xls:Properties>";p+="</xls:RouteRetrieveRequest></xls:RouteComplianceRequest></xls:Request></xls:XLS>";return p}function a(r,p,q){p=p||Utilities.getRequestId();q=q||Utilities.getRequestId();var o=l.getHeader("RouteComplianceRequest",p,null,q);o+="<xls:RouteComplianceRequest><xls:RouteDeleteRequest>";o+="<xls:ID>";o+=r+"</xls:ID>";o+="</xls:RouteDeleteRequest></xls:RouteComplianceRequest></xls:Request></xls:XLS>";return o}function k(u){if(!u){return null}var o=u.Route;if(!o){o=[]}else{if(!deCarta.Array.isArray(o)){o=[u.Route]}}var p=[];for(var s=0;s<o.length;s++){var q={};var w=o[s];if(w.Geometry){if(w.Geometry.RouteID){q=new Route();q.routeID=w.Geometry.RouteID}}q.title=(w.name=="undefined"||!w.name)?"":(w.name);q.id=w.id;q.description=(w.description=="undefined"||!w.description)?"":(w.description);q.customProperties.properties={};if(w.Buffer){q.customProperties.buffer=new Radius();q.customProperties.buffer.uom=new UOM(w.Buffer.uom);q.customProperties.buffer.distance=w.Buffer.value}if(w.Properties){var t=w.Properties.Property;if(t.length==undefined){t=[w.Properties.Property]}q.customProperties.properties={};for(var r=0;r<t.length;r++){q.customProperties.properties[t[r].name]=t[r].value}}if(w.metaInfo){q.customProperties.metaInfo=w.metaInfo}q.customProperties.saved=true;p.push(q)}return p}function m(t,u,r,s){r=r||Utilities.getRequestId();s=s||Utilities.getRequestId();var p=l.getHeader("RouteComplianceRequest",r,null,s);p+="<xls:RouteComplianceRequest><xls:ComplianceCheckRequest returnViolationOnly='false'>";if(t.length=="undefined"){t=[t]}for(var q=0;q<t.length;q++){p+="<xls:CheckPoint><gml:pos>"+t[q].toString()+"</gml:pos>";p+="</xls:CheckPoint>"}if(u){p+="<xls:ComplianceLookupCriteria>";if(!isNaN(u)){p+="<xls:ID>"+u+"</xls:ID>"}else{if(u instanceof Route){var o=u;p+="<xls:ComplianceRoute ";p+=">";p+="<xls:Geometry>";if(o.routeID){p+="<xls:RouteID>"+o.routeID+"</xls:RouteID>"}else{if(o.RouteGeometry&&o.RouteGeometry.length>0){p+="<gml:LineString>";for(q=0;q<o.RouteGeometry.length;q++){p+="<gml:pos>"+o.RouteGeometry[q].toString()+"</gml:pos>"}p+="</gml:LineString>"}}p+="</xls:Geometry>";p+="<xls:Buffer uom='"+o.customProperties.buffer.uom+"' value='"+o.customProperties.buffer.distance+"'></xls:Buffer>";p+="</xls:ComplianceRoute>"}}p+="</xls:ComplianceLookupCriteria>"}p+="</xls:ComplianceCheckRequest></xls:RouteComplianceRequest></xls:Request></xls:XLS>";return p}}function Time(b,c){if(!(b)||!a(b)){throw new Exception("begin format is: 2010-03-10T10:30:10Z or 2010-03-10T10:30:10-05:00.")}this.begin=b;if(c&&!d(c)){throw new Exception("duration should be like PnYnMnDTnHnMnS format.")}this.duration=c;function d(g){var f=/^P(?=\T|\d+)(\d+Y)?(\d+M)?(\d+D)?(T(\d+H)?(\d+M)?(\d+S)?)?$/;if(f.test(g)){return true}else{return false}}function a(g){var f=/^\d{4}-\d{2}-\d{2}T\d{2}\:\d{2}\:\d{2}(\.\d+)?(Z|(\+|-)\d{2}\:\d{2})?$/;if(f.test(g)){return true}return false}}var dateFormat= function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,c= function(g,f){g=String(g);f=f||2;while(g.length<f){g="0"+g}return g};return function(k,A,t){var h=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(k)=="[object String]"&&!/\d/.test(k)){A=k;k=undefined}k=k?new Date(k):new Date;if(isNaN(k)){throw SyntaxError("invalid date")}A=String(h.masks[A]||A||h.masks["default"]);if(A.slice(0,4)=="UTC:"){A=A.slice(4);t=true}var w=t?"getUTC":"get",p=k[w+"Date"](),f=k[w+"Day"](),l=k[w+"Month"](),r=k[w+"FullYear"](),u=k[w+"Hours"](),n=k[w+"Minutes"](),z=k[w+"Seconds"](),q=k[w+"Milliseconds"](),g=t?0:k.getTimezoneOffset(),j={d:p,dd:c(p),ddd:h.i18n.dayNames[f],dddd:h.i18n.dayNames[f+7],m:l+1,mm:c(l+1),mmm:h.i18n.monthNames[l],mmmm:h.i18n.monthNames[l+12],yy:String(r).slice(2),yyyy:r,h:u%12||12,hh:c(u%12||12),H:u,HH:c(u),M:n,MM:c(n),s:z,ss:c(z),l:c(q,3),L:c(q>99?Math.round(q/10):q),t:u<12?"a":"p",tt:u<12?"am":"pm",T:u<12?"A":"P",TT:u<12?"AM":"PM",Z:t?"UTC":(String(k).match(b)||[""]).pop().replace(d,""),o:(g>0?"-":"+")+c(Math.floor(Math.abs(g)/60)*100+Math.abs(g)%60,4),S:["th","st","nd","rd"][p%10>3?0:(p%100-p%10!=10)*p%10]};return A.replace(a,function(m){return m in j?j[m]:m.slice(1,m.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format= function(a,b){return dateFormat(this,a,b)};function WSXMLTunnelFCS(){var a=this;this.responseFormat="XML";var b=[];this.send= function(d,h,g,c){if(!deCarta.String.isString(d)){if(!window.Sarissa&&!window.Sarissa.serialize){throw new Exception("Sarissa is required to use the WSXMLTunnelFCS with XMLDocument Objects.")}d=Sarissa.serialize(d)}var f=Utilities.parseRequestIDFromXLS(d);if(typeof h=="function"){b[f]=h}else{throw new Exception("WSXMLTunnelFCS.send: callBack must be a function, arg was: "+h)}JSRequest.send(d,this._callBack,this.responseFormat,g,c)};this._callBack= function(c){var d,f;if(a.responseFormat=="XML"){d=Sarissa.getDomDocument();d=(new DOMParser()).parseFromString(Utilities.normalizePrefixes(c),"text/xml");d.setProperty("SelectionLanguage","XPath");d.setProperty("SelectionNamespaces","xmlns:xls='http://www.opengis.net/xls' xmlns:gml='http://www.opengis.net/gml'");f=(d.selectSingleNode("//xls:Response/@requestID").value)}else{d=c;if(deCarta.Array.isArray(d.XLS.Response)){f=d.XLS.Response[0].requestID}else{f=d.XLS.Response.requestID}}b[f](d)}}function addT2UTC(b){var a=/\s/;return b.replace(a,"T")}function getUTC(l){var h=new Date();h.setUTCFullYear(1989);h.setUTCMonth(11);h.setUTCDate(31);h.setUTCHours(12);h.setUTCMinutes(0);h.setUTCSeconds(0);var k=Number(h.getTime())+Number(l*1000);var b=new Date(k);var f=b.getUTCMonth()+1;if(f<10){f="0"+f}var c=b.getUTCDate();if(c<10){c="0"+c}var g=b.getUTCHours();if(g<10){g="0"+g}var d=b.getUTCMinutes();if(d<10){d="0"+d}var a=b.getUTCSeconds();if(a<10){a="0"+a}var j=b.getUTCFullYear()+"-"+(f)+"-"+c+" "+g+":"+d+":"+a;return j}function getLocalTimeStr(l){var h=new Date();h.setUTCFullYear(1989);h.setUTCMonth(11);h.setUTCDate(31);h.setUTCHours(12);h.setUTCMinutes(0);h.setUTCSeconds(0);var k=Number(h.getTime())+Number(l*1000);var b=new Date(k);var f=b.getMonth()+1;if(f<10){f="0"+f}var c=b.getDate();if(c<10){c="0"+c}var g=b.getHours();if(g<10){g="0"+g}var d=b.getMinutes();if(d<10){d="0"+d}var a=b.getSeconds();if(a<10){a="0"+a}var j=b.getFullYear()+"-"+(f)+"-"+c+" "+g+":"+d+":"+a;return j}function getNowDateMillis(){var a=new Date();var b=new Date(a.toUTCString());var c=new Date();c.setUTCFullYear(1989);c.setUTCMonth(11);c.setUTCDate(31);c.setUTCHours(12);c.setUTCMinutes(0);c.setUTCSeconds(0);return Math.floor((b.getTime()-c.getTime())/1000)}function createDispatchXML(d,b,a){var c='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><ns1:XLS ns1:lang="en" version="1.0" xmlns:ns1="http://www.opengis.net/xls"><ns1:RequestHeader sessionID="999" clientName="'+CONFIG.clientName+'" clientPassword="'+CONFIG.clientPassword+'"/><ns1:Request maximumResponses="2" requestID="10" version="1.0" methodName="DispatchRequest"><ns1:DispatchRequest><ns1:Job ID="'+d.id+'" name="'+d.text+'"><ns1:Position>'+d.position+"</ns1:Position><ns1:Schedule>"+d.schedule+"</ns1:Schedule></ns1:Job><ns1:RouteID>"+b.routeID+"</ns1:RouteID><ns1:iccid>"+a+"</ns1:iccid></ns1:DispatchRequest></ns1:Request></ns1:XLS>";return c}Utils={};Utils.formatDate2String= function(a){if(!a){return null}if(!(a instanceof Date)){return null}var g="";g+=(a.getYear()+1900);g+="-";var d=a.getMonth()+1;g+=(d>9)?(d):("0"+d);g+="-";g+=(a.getDate()>9)?(a.getDate()):("0"+a.getDate());g+="T";g+=(a.getHours()>9)?(a.getHours()):("0"+a.getHours());g+=":";g+=(a.getMinutes()>9)?(a.getMinutes()):("0"+a.getMinutes());g+=":";g+=(a.getSeconds()>9)?(a.getSeconds()):("0"+a.getSeconds());var f=a.getTimezoneOffset();if(f<0){g+="+";var c=Math.floor((-f)/60);var b=(-f)%60}else{g+="-";c=Math.floor(f/60);b=f%60}g+=(c>9)?(c):("0"+c);g+=":";g+=(b>9)?(b):("0"+b);return g};Utils.validateDateTime= function(b){var a=/^\d{4}-\d{2}-\d{2}T\d{2}\:\d{2}\:\d{2}(\.\d+)?(Z|(\+|-)\d{2}\:\d{2})?$/;if(a.test(b)){return true}return false};Utils.validateTime= function(b){var a=/\d{2}\:\d{2}\:\d{2}(\.\d+)?(Z|(\+|-)\d{2}\:\d{2})?/;if(a.test(b)){return true}else{return false}};function Vehicle(a){this.id=0;this.positions=[];this.init= function(b){for(var c in b){if(b.hasOwnProperty(c)){this[c]=b[c]}}};this.init(a)};